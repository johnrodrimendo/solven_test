<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/mainTemplate">
<head>

    <title>Consolida tus deudas</title>

    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>
    <!-- / Jquery Validation-->

    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/js/bootstrap-datepicker.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/locales/bootstrap-datepicker.es.min.js'}"></script>
    <!-- / Bootstrap DatePicker -->

    <!-- Owl. Carousel -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.js'}"></script>
    <!-- / Owl. Carousel -->

    <!-- Bootstrap selectpicker -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
    <!-- / Bootstrap selectpicker -->

    <!-- SwipeBox -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <!-- / SwipeBox -->

    <!-- Burger Menu -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/hamburger/hamburgers.min.css'}"/>
    <!-- / Burger Menu -->

    <script th:inline="javascript">
        /*<![CDATA[*/
        var loanApplicationToken;

        function letMeKnow() {
            var baseUrl = /*[[@{/early/5/}]]*/;
            if (!isEmail($('#earlyEmail').val())) {
                $('#early-response-block').html(errorAjaxMessage('Ingresa un email v&aacute;lido.'));
            } else {
                $('#early-response-block').html('');
                $('#landingSubmit').loading();
                defaultAjax({
                    url: baseUrl,
                    type: 'POST',
                    data: $('#frmEarlyAccess').serializeObject(),
                    success: function (data) {
                        $('#landingSubmit').unloading();
                        $('.hideAjax').css({'display': 'none'});
                        $('#early-response-block').html(successAjaxMessage('Te avisaremos apenas estemos listos.'));
                    },
                    error: function() {
                        $('#landingSubmit').unloading();
                    }
                });
            }
        }

        $(document).on('ready', function () {

            <!-- BirthDate -->
            $('#birthDate').datepicker({
                endDate: "-18y",
                autoclose: true,
                startView: 2,
                format: "dd/mm/yyyy",
                focusOnShow: true
            });
            <!-- / BirthDate -->

            <!-- swipebox -->
            /*$('.swipebox-video').swipebox();*/
            <!-- / swipebox -->

            <!-- Cookies Notification -->
            /*if (getCookie('acceptCookies') != 'true') {
                $('.cookiesBar').fadeIn();
                $('#acceptCookies').on('click', function (event) {
                    event.preventDefault();
                    $('.cookiesBar').fadeOut();
                    createCookie('acceptCookies', 'true', 360);
                });
            }*/
            <!-- / Cookies Notification -->

            var resendButtonToken = $('#resendToken');
            resendButtonToken.on('click', function (event) {
                event.preventDefault();
                var url = /*[[@{/loanapplication}]]*/;
                defaultAjax({
                    url: url + "/"+loanApplicationToken+"/resendSmsToken",
                    type: 'POST',
                    success: function (data) {
                        resendButtonToken.fadeOut();
//                        $('.responseResend').html('Te hemos reenviado el PIN');
                        setTimeout(function () {
                            resendButtonToken.fadeIn();
//                            $('.responseResend').html('');
                        }, 30000);
                        console.log(data);
                    }
                });
            });

            <!-- Selectpicker -->
            $('.selectpicker').selectpicker({
                style: 'btn-info',
                size: 4
            });
            <!-- / Selectpicker -->


            $('#docNumber').forceLettersOnly("^[0-9 ()]+$", true, 8, 8);
            $('#cellphone').forceLettersOnly("^[0-9 ()]+$", true, 9, 9);
            $('#authToken').forceLettersOnly("^[0-9 ()]+$", true, 4, 4);

            <!-- Swip document -->
            $('#docType').on('change', function(){
                $('#response-block').html('');
                if($(this).val() == 1) {
                    $('#docNumber').val('');
                    $('#ceSection').css({'display' : 'none'});
                    $('#docNumber').forceLettersOnly("^[0-9 ()]+$", true, 8, 8);
                } else {
                    $('#docNumber').val('');
                    $('#ceSection').css({'display' : 'inline-block'});
                    $('#docNumber').forceLettersOnly("^[0-9 ()]+$", true, 9, 9);
                }

            });
            <!-- / Swip document -->



            $('#frmConsolidation').find('input').on('keyup', function(e){
                if(e.keyCode == 13)
                {
                    console.log($(this).closest('.block-e').find('.toTarget'));
                    $(this).closest('.block-e').find('.toTarget:enabled').trigger('click');
                }
            });

            $('.toTarget').on('click', function (event) {
                event.preventDefault();

                var  cell;

                switch ($(this).data('target')) {
                    case 'submitDniConsolidation':

                        var v = false,
                                msgError = 'N&uacute;mero de documento inv&aacute;lido.';
                        if ($('#docNumber').val().length == 8 && $('#docType').val() == 1) {
                            v = true;
                        }

                        if ($('#docNumber').val().length == 9 && $('#docType').val() == 2){
                            v = true;
                            if ($('#birthDate').val().length > 0 && $('#birthDate').val() != '' && $('#birthDate').val().length == 10){
                                v = true;
                            } else {
                                v = false;
                                msgError = 'Fecha de nacimiento inv&aacute;lido.';
                            }
                        }

                        if(v) {
                            $('#response-block').html('');
                            $('[data-target=submitDniConsolidation]').loading();
                            defaultAjax({
                                url: /*[[@{/user/validateDocument/__${T(com.affirm.common.model.catalog.Product).DEBT_CONSOLIDATION}__}]]*/null,
                                type: 'POST',
                                data: {
                                    docType: $('#docType').val(),
                                    docNumber: $('#docNumber').val(),
                                    birthDate: $('#birthDate').val()
                                },
                                success: function (data) {
                                    if (isJsonString(data)) {
                                        showMessageModal(JSON.parse(data).message);
                                    }

                                    if(data == "waitCE"){
                                        setTimeout(function () {
                                            defaultAjax({
                                                url: /*[[@{/user/validCE/}]]*/null,
                                                type: 'POST',
                                                success: function (data) {
                                                    docValidationOk();
                                                },
                                                error: function () {
                                                    $('[data-target=submitDniConsolidation]').unloading();
                                                }
                                            });
                                        }, 30000);
                                        return;
                                    }
                                    docValidationOk();
                                },
                                error: function () {
                                    $('[data-target=submitDniConsolidation]').unloading();
                                }
                            });
                        } else {
                            $('#response-block').html(errorAjaxMessage(msgError));
                        }

                        break;
                    case 'submitCellConsolidation':

                        cell = isValidCellphone($('#cellphone').val());

                        if($('#cellphone').val().length == 9 && cell) {
                            $('#response-block').html('');
                            $('[data-target=submitCellConsolidation]').loading();
                            defaultAjax({
                                url: /*[[@{/debtconsolidationloanapplication}]]*/null,
                                type: 'POST',
                                data: {
                                    docType: $('#docType').val(),
                                    docNumber: $('#docNumber').val(),
                                    cellphone: $('#cellphone').val(),
                                    birthday: $('#birthDate').val()
                                },
                                success: function (data) {
                                    debugger;
                                    loanApplicationToken = JSON.parse(data).loanApplicationToken;

                                    $('[data-target=submitCellConsolidation]').unloading();
                                    $('.cellConsolidation').css({'display': 'none'});
                                    $('.pinConsolidation').fadeIn();
                                },
                                error: function () {
                                    $('[data-target=submitCellConsolidation]').unloading();
                                }
                            });
                        } else {
                            $('#response-block').html(errorAjaxMessage('Ingresa un n&uacute;mero v&aacute;lido.'));
                        }

                        break;
                    case 'submitPinConsolidation':
                        if($('#authToken').val().length == 4) {
                            $('#landingResponse').html('').hide();
                            $('[data-target=submitPinConsolidation]').loading();
                            defaultAjax({
                                url: /*[[@{debtconsolidation/cellphone/validate}]]*/null,
                                type: 'POST',
                                data: {
                                    authToken: $('#authToken').val(),
                                    loanApplicationToken: loanApplicationToken
                                },
                                success: function (data) {
                                },
                                error: function () {
                                    $('[data-target=submitPinConsolidation]').unloading();
                                }
                            });
                            break;
                        } else {
                            $('#landingResponse').css({'display': 'inline-block'});
                            $('#landingResponse').html('Ingresa el PIN correcto!');
                        }

                }
            });
            <!-- / Show Sections and Submit -->

            <!-- Header Sticky -->
            $(window).on('scroll', function () {
                var scrollTop = $(window).scrollTop(),
                        header = $('.home-header');

                if (scrollTop > 1) {

                    /*if ($(window).width() > 480) {
                        $('.cookiesBar').removeClass('slideInDown');
                        $('.cookiesBar').removeClass('slideInUp');
                        $('.cookiesBar').css({'bottom': 0}).addClass('slideInDown');
                    }*/

                    sticky(header);
                } else {

                   /* if ($(window).width() > 480) {
                        $('.cookiesBar').removeClass('slideInDown');
                        $('.cookiesBar').removeClass('slideInUp');
                        $('.cookiesBar').css({'bottom': '70px'}).addClass('slideInUp');
                    }*/

                    unSticky(header);
                }

            });
            <!-- / Header Sticky -->

        });

        function docValidationOk() {
            $('[data-target=submitDniConsolidation]').unloading();
            $('.dniConsolidation').css({'display': 'none'});
            $('.cellConsolidation').fadeIn();
        }

        /*]]>*/
    </script>

    <!--TOKY-->
    <script th:if="${@configuration.TOKY_ACTIVE()}">

        (function(v,p){
            var s=document.createElement('script');
            s.src='https://app.toky.co/resources/widgets/toky-widget.js?v='+v;
            s.onload=function(){Toky.load(p);};
            document.head.appendChild(s);
        })('6800f1c', {"$username":"Solven","$bubble":false,"$color": "#00aabb,#f7323f,#ffffff"});

    </script>

</head>
<body>

<!-- Header -->
<th:block layout:fragment="header">
    <th:block th:replace="fragments/headers :: headerLanding(landingType='consolidationDebts')"></th:block>
</th:block>
<!-- /Header -->


<!-- Content -->
<th:block layout:fragment="content">
    <!-- Cookies -->
    <!--<div class="cookiesBar animated">
        <div class="container">
            <p>Las cookies nos ayudan a mejorar tu experiencia en Solven. Se utilizan tambi&eacute;n en estad&iacute;sticas,
                redes sociales, controles de calidad y junto con nuestros aliados, en marketing. Al continuar navegando
                en nuestro sitio web, aceptas el uso. <a href="#" id="acceptCookies">Ocultar</a>.</p>
        </div>
    </div>-->
    <!-- / -->

    <!-- Landing -->
    <div class="landing consolida-bg">
        <div class="overlay"></div>
        <div class="hero-title landings">

            <div class="top">
                <h2 class="red-text">Paga menos por tus créditos.</h2>
                <p>&iquest;Cansado de pagar altas tasas de inter&eacute;s? Calcula cu&aacute;nto te puedes ahorrar consolidando tus
                    deudas a trav&eacute;s de Solven.</p>
            </div>

            <div class="middle">
                <div class="form-unlocked">
                    <div class="frm" id="frmConsolidation" th:if="${product.active == true and session.countryUnlocked}">
                        <div class="form-block block-e dniConsolidation">

                            <div class="field inline">
                                <select class="selectpicker" name="docType" id="docType">
                                    <option th:value="${T(com.affirm.common.model.catalog.IdentityDocumentType).DNI}">DNI
                                    </option>
                                    <option th:value="${T(com.affirm.common.model.catalog.IdentityDocumentType).CE}">CE
                                    </option>
                                </select>
                                <input type="text" class="input-landing align-center input-document-big" name="docNumber" id="docNumber"
                                       placeholder="Documento" autocomplete="off" pattern="[0-9]*"/>
                            </div>

                            <div class="field inline" id="ceSection">
                                <input type="text" class="input-landing input-lastnames align-center" id="birthDate"
                                       placeholder="dd/mm/yyy"/>
                                <div class="small-text d-block">Fecha de nacimiento.</div>
                            </div>

                            <div class="field inline block">
                                <button class="button red-button toTarget" data-target="submitDniConsolidation">
                                    Calcular
                                </button>
                            </div>
                        </div>

                        <div class="form-block block-e cellConsolidation">

                            <div class="field inline">
                                <input type="text" id="cellphone" name="cellphone" class="input-landing align-center cellphone-input-big"
                                       placeholder="N&uacute;mero Celular" autocomplete="off" pattern="[0-9]*"/>

                            </div>

                            <div class="field inline">
                                <button class="button red-button toTarget" data-target="submitCellConsolidation">
                                    Enviar
                                </button>
                            </div>
                            <div class="small-text">Ingresa tu n&uacute;mero de celular. Te enviaremos un SMS con el PIN de
                                verificaci&oacute;n.</div>
                        </div>

                        <div class="form-block block-e pinConsolidation">

                            <div class="field inline">
                                <input type="text" id="authToken" name="authToken" class="input-landing align-center small-input-number"
                                       placeholder="PIN" autocomplete="off" pattern="[0-9]*"/>
                            </div>


                            <div class="field inline">
                                <button class="button red-button toTarget" data-target="submitPinConsolidation">
                                    Verificar
                                </button>
                            </div>
                            <br/>
                            <div class="small-text d-block">Ingresa el PIN de verificaci&oacute;n que te acabamos de enviar. <a href="#" id="resendToken">Reenviar</a></div>

                        </div>

                        <div class="block" id="response-block"></div>
                    </div>

                    <form class="frm" role="form" id="frmEarlyAccess" action="#" th:if="${product.active == false and session.countryUnlocked}" autocomplete="off">
                        <div class="form-block">

                            <div class="form-block field inline input-email-big hideAjax">
                                <input type="hidden" value="null"/>
                                <input type="hidden" value=""/>
                                <input type="text" class="input-landing" name="email"
                                       placeholder="Correo Electr&oacute;nico" id="earlyEmail" autocomplete="false"/>
                            </div>

                            <div class="form-block field inline hideAjax">
                                <button class="button red-button" id="landingSubmit" onclick="letMeKnow();return false;">
                                    ¡Avísenme!
                                </button>
                            </div>

                            <div class="block" id="early-response-block"></div>
                        </div>

                    </form>

                    <div class="small-text successMessage" id="countryLocked" th:if="${session.countryUnlocked == false}">Lo sentimos mucho, pero en este momento s&oacute;lo es posible solicitar productos desde Per&uacute;.</div>

                </div>
            </div>
        </div>
        <div class="scroll-down landing-scroll">
            <i class="icon down-arrow-icon"></i>
        </div>
        <div class="bottom-info bottom-info-landing">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6"><p>Desde <span th:text="${@utilService.integerMoneyFormat(product.minAmount)}"></span> a <span th:text="${@utilService.integerMoneyFormat(product.maxAmount)}"></span></p></div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6"><p>Tasas desde <span th:text="${@utilService.percentFormat(product.minTea)}"></span></p></div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6"><p>Hasta <span th:text="${product.maxInstallments}"></span> cuotas</p></div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6"><p>Sin costos ocultos</p></div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Landing -->

    <!-- Press -->
    <div class="press">
        <div class="container">
            <th:block layout:fragment="pressCarousel">
                <th:block th:replace="fragments/pressCarousel :: pressCarousel"></th:block>
            </th:block>
        </div>
    </div>
    <!-- / Press -->

    <!-- How it works -->
    <div id="how-it-works-consolidation" class="how-it-works-consolidation">
        <div class="container">
            <div class="hero-content">
                <div class="row">
                    <h2 class="title-home">&iquest;C&oacute;mo funciona?</h2>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="box">
                            <div class="icon-image">
                                <img th:src="@{/img/icons/add-debts.png}" alt="Agrega"/>
                            </div>
                            <h3>Suma</h3>
                            <p>Nunca fue m&aacute;s f&aacute;cil calcular y consolidar tus deudas. Ingresa con tu
                                documento, nosotros te decimos cuanto debes y las tasas promedio que tu Banco cobra.</p>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="box">
                            <div class="icon-image">
                                <img th:src="@{/img/icons/interest-icon.png}" alt="Calcula"/>
                            </div>
                            <h3>Calcula</h3>
                            <p>S&oacute;lo debes realizar algunos ajustes. Actualiza tus saldos pendientes y las tasas
                                de inter&eacute;s reales que est&aacute;s pagando. &iexcl;Hecha la calculadora a andar!
                                El resto los hacemos nosotros por ti.</p>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="box">
                            <div class="icon-image">
                                <img th:src="@{/img/icons/consolidate-icon.png}" alt="Consolida"/>
                            </div>
                            <h3>Consolida</h3>
                            <p>Te indicamos que deudas consolidar y cuales no, ya que podr&iacute;as tener alg&uacute;n
                                cr&eacute;dito a mejores tasas. Nuestra meta es que hagas realidad las tuyas, y no es s&oacute;lo
                                un slogan.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- / How it works -->
    <th:block th:fragment="linkToProducts">
        <th:block th:replace="fragments/linkToProductsFragment :: linkToProducts"></th:block>
    </th:block>
    <!-- Play video -->
    <div class="play-video">
        <div class="container">
            <a class="circle swipebox-video" rel="vimeo" th:if="false"><i
                    class="icon bullet-right-icon"></i></a>
            <p th:if="false">Ver video</p>
        </div>
    </div>
    <!-- / Play video -->

</th:block>
<!-- /Content -->

<!-- Footer -->
<th:block layout:fragment="footer">
    <th:block th:replace="fragments/footers :: footerDefault"></th:block>
</th:block>
<!-- / Footer -->

</body>
</html>