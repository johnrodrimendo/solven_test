<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/loanApplicationTemplate">
<head>
    <title>El cr&eacute;dito que mereces</title>
    <!-- improgress -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/imgprogress/imgProgress.css'}"/>
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/moment/min/moment.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/locales/bootstrap-datepicker.es.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datetimepicker/bootstrap-datetimepicker.js'}"></script>
    <!--Jquery Numeric-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/numeric/jquery.numeric.min.js'}"></script>
    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>
    <!--Moment-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/moment/min/moment-with-locales.min.js'}"></script>
    <!-- Take picture -->
    <script th:src="@{/js/mobile-detect/mobile-detect.js}"/>
    <script th:src="@{/js/take-picture/Tp.js}"/>
    <!-- Owl. Carousel -->
    <link rel="stylesheet"
          th:href="${@urlService.externalUrl(#httpServletRequest) + '/owlCarousel2/assets/owl.carousel.min.css'}"/>
    <link rel="stylesheet"
          th:href="${@urlService.externalUrl(#httpServletRequest) + '/owlCarousel2/assets/owl.theme.default.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/owlCarousel2/owl.carousel.min.js'}"></script>
    <!-- Question Framework -->
    <script th:src="@{/js/QuestionFramework.js}"/>
    <!-- reCaptcha -->
    <script src="https://www.google.com/recaptcha/api.js"></script>
    <!--Oauthy-->
    <script th:src="@{/js/Oauthy.js}"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/pdfExport.css}"/>
    <!--Google maps-->
    <script async="true" defer="defer"
            th:src="${'https://maps.googleapis.com/maps/api/js?libraries=places&amp;key=' + T(com.affirm.system.configuration.Configuration).GOOGLE_API_KEY}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/imgprogress/imgProgress.js'}"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var showWelcome = /*[[${showWelcome}]]*/;
        var evaluationType = /*[[ ${evaluationType} ]]*/;
        var url = /*[[ ${agent?.avatarUrl} ]]*/;
        $(document).on('ready', function () {
            var size = 130;
            if ($(window).width() <= 1280 && $(window).width() > 768) {
                size = 100;
            } else if ($(window).width() <= 768) {
                size = 60;
            }

            $('.avatar-advisor').doOnce(function () {
                $(".avatar-advisor").imgProgress({
                    img_url: url, // path to the image
                    size: size, // size in pixels
                    barSize: 10, // bar size

                    backgroundColor: $StrokeSolvenColor, // background color - brand
                    foregroundColor: $FillSolvenColor, // foreground color - brand

                    backgroundSize: 'cover', // CSS background-size property
                    percent: 5 // current percentage value
                });
            });
            $('#firstDueDate').datepicker().on('changeDate', function (ev) {       });
            if (showWelcome) {
                swal({
                    title: '',
                    text: /*[[${showWelcomeMessage}]]*/,
                    timer: 5000,
                    showConfirmButton: false
                });
            }
        });

        /*]]>*/
    </script>
    <script th:if="${@configuration.TOKY_ACTIVE()}">
        (function (v, p) {
            var s = document.createElement('script');
            s.src = 'https://app.toky.co/resources/widgets/toky-widget.js?v=' + v;
            s.onload = function () {
                Toky.load(p);
            };
            document.head.appendChild(s);
            //})('6800f1c', {"$username": "Solven", "$bubble": false, "$color": "#f7323f,#00aabb,#ffffff"});
        })('dd282c9', {"$lang":"es","$username":"Solven","$bubble":false,"$position":"left", "$color":"#F7323F,#F7323F,#F7323F"});
        //})('dd282c9', {"$lang":"es","$username":"Solven","$bubble":false,"$position":"left","$text":"Ll√°manos","$color":"#00aabb,#00aabb,#00aabb"})
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var questionFw;

        $(document).on('ready', function () {
            var evaluationType = /*[[${evaluationType}]]*/;
            questionFw = new QuestionFramework($('#question-replaceable'));
            questionFw.brandingPrimaryColor = $cadena_colorweb;
            questionFw.brandingSecundaryColor = $cadena_colorwebsecond;
            questionFw.branding = isBranded;
            var questionFwType;
            if (evaluationType == "selfevaluation")
                questionFwType = questionFw.TYPE_SELFEVALUATION;
            if (evaluationType == "evaluation")
                questionFwType = questionFw.TYPE_EVALUATION;
            if (evaluationType == "comparison")
                questionFwType = questionFw.TYPE_COMPARISON;
            questionFw.token = /*[[${token}]]*/;
            questionFw.type = questionFwType;
            questionFw.currentQuestion = /*[[${currentQuestion}]]*/;
            questionFw.categoryUrl = /*[[${categoryUrl}]]*/;
            questionFw.agent = /*[[${agent?.id}]]*/;
            questionFw.externalParams = /*[[${externalParams}]]*/;
            questionFw.errorContainer = $('#error-content');
            questionFw.init();
            questionFw.resetUrl();
            questionFw.loggable = /*[[${!@configuration.hostEnvIsProduction()}]]*/;

            $('#anchor-back').click(function () {
                questionFw.backwards();
            });
        });
        /*]]>*/
    </script>
</head>
<body th:classappend="${@brandingService.isBranded(#httpServletRequest) ? 'wrap-pages brand' : 'wrap-pages'}">
<!-- Header begins -->
<th:block layout:fragment="header">
    <th:block th:replace="fragments/headers :: processHeader"></th:block>
</th:block>
<!-- Header ends -->
<th:block layout:fragment="content">
    <!-- Sidebar breadcrumb begins -->
    <div id="sectionSidebar" class="sidebar-breadcrumb display-none">
        <ul>
            <li data-section="2">
                <div class="circle"><i class="icon icon-person-info"></i></div>
                <span>Datos Personales</span>
                <span class="bullets"></span>
            </li>
            <li data-section="3">
                <div class="circle"><i class="icon icon-dollar"></i></div>
                <span>Ingresos</span>
                <span class="bullets"></span>
            </li>
            <li data-section="4">
                <div class="circle"><i class="icon icon-percent"></i></div>
                <span>Oferta</span>
                <span class="bullets"></span>
            </li>
            <li data-section="5">
                <div class="circle"><i class="icon icon-check"></i></div>
                <span>Verificaci&oacute;n</span>
                <span class="bullets"></span>
            </li>
            <li data-section="6">
                <div class="circle"><i class="icon icon-sign"></i></div>
                <span>Contrato</span>
                <span class="bullets"></span>
            </li>
        </ul>
    </div>
    <!-- / Sidebar breadcrumb begins -->
    <!-- Content begins -->
    <section class="loan-process" th:if="${evaluationType == 'evaluation'}" >
        <div class="container">
            <div class="adviser-section animated fadeIn" style="display:none">
                <div class="avatar-progress">
                    <div class="avatar-advisor"></div>
                </div>
                <div class="horizontal-line">
                    <div class="line brand-bg-colorweb"></div>
                    <a href="#" class="circle" id="anchor-back"><i class="icon icon-bullet-left"></i></a>
                </div>
            </div>

            <div id="question-replaceable"></div>
            <div id="error-content" class="display-none">
                <div class="block text-center">
                    <p class="text-black">Se produjo un error inesperado, <br/>por favor int&eacute;ntalo nuevamente o cont&aacute;ctanos.</p>
                    <br/>
                    <div class="actions">
                        <a th:href="@{/}" class="anchor-button bg-red icon icon-home">Ir al home</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="loan-process autoevaluacion" th:if="${evaluationType == 'selfevaluation'}">
        <div class="container">
            <div class="adviser-section animated fadeIn" style="display:none">
                <div class="avatar-progress">
                    <div class="avatar-advisor"></div>
                </div>
                <div class="horizontal-line">
                    <div class="line brand-bg-colorweb"></div>
                    <a href="#" class="circle" id="anchor-back"><i class="icon icon-bullet-left"></i></a>
                </div>
            </div>

            <div id="question-replaceable"></div>
            <div id="error-content" class="display-none" style="margin-top: 20px;">
                <div class="block text-center">
                    <p class="text-black">Se produjo un error inesperado, <br/>por favor int&eacute;ntalo nuevamente o cont&aacute;ctanos.</p>
                    <br/>
                    <div class="actions">
                        <a cclass="anchor-button bg-red icon icon-home">Ir al home</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <p th:if="${evaluationType == 'selfevaluation'}" id="texto_legal">El servicio de autoevaluaci√≥n provisto por Solven es una herramienta destinada a que los usuarios puedan tener una idea orientativa acerca de las posibilidades de obtener un cr√©dito en empresas del sistema financiero. El an√°lisis realizado se basa en informaci√≥n provista por el usuario y en informaci√≥n de acceso p√∫blico. De ninguna forma el proceso de autoevaluaci√≥n genera para Solven la obligaci√≥n de otorgar un pr√©stamo al usuario, ni implica que los financiadores que operan a trav√©s de la plataforma lo hagan, dado que sus pol√≠ticas de cr√©dito utilizan informaci√≥n y/ o criterios adicionales a los aplicados por Solven en el servicio de autoevaluaci√≥n.</p>

    <script th:inline="javascript">
        /*<![CDATA[*/
        if( $('.loan-process').hasClass('autoevaluacion') ){
            $('body').addClass('w-autoevaluacion');
        }
        /*]]>*/
    </script>

    <!-- Content ends -->
    <!-- Footer begins -->
    <th:block layout:fragment="footers">
        <th:block th:replace="fragments/footers :: processFooter"></th:block>
    </th:block>
    <!-- Footer ends -->
    <!-- Footer begins -->
    <th:block layout:fragment="footers">
        <th:block th:replace="fragments/footers :: processFooterChooseAgent"></th:block>
    </th:block>
    <!-- Footer ends -->
    <!-- Modal begins -->
    <div class="modal fade" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="editModal">
    </div>
    <div id="questionModals">
    </div>
    <!-- Modals ends -->
    <div class="modal fade" id="offer_modal" tabindex="-1" role="dialog" aria-labelledby="offerModal">
        <div class="modal-dialog" role="edit">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <h4 class="title-modal">¬øC√≥mo elegimos la mejor oferta?</h4>
                        <div class="corner-close">
                            <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                    </div>
                </div>
                <div class="modal-middle">
                    <div class="block-content text-center">
                        <div>
                            <div class="title-wrap">
                                <span class="title-modals">Consultamos a todos los financiadores afiliados a nuestra plataforma, para saber quienes est√°n dispuestos a prestarte.
                                </span>
                            </div>
                            <ul>
                                <li>
                                    <span>1) En caso que te ofrezcan el monto solicitado (o m√°s):</span>
                                    Elegimos a quien te cobre la menor tasa de inter√©s (TCEA), priorizando a quien desembolse el cr√©dito en l√≠nea.
                                </li>
                                <li>
                                    <span>2) En caso que no te ofrezcan el monto solicitado:</span>
                                    Elegimos a quien te ofrezca el monto m√°s alto posible y que te cobre la menor tasa de inter√©s (TCEA), priorizando tambi√©n a quien desembolse el cr√©dito en l√≠nea.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>


<th:block th:fragment="modal_edit_loan_application">
    <div class="modal-dialog" role="edit">
        <div class="modal-content">
            <div class="modal-top">
                <div class="title-wrap">
                    <h4 class="title-modal">Editar montos</h4>
                </div>
                <div class="corner-close">
                    <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-middle">
                <div class="block-content text-center">
                    <form id="updateForm" th:object="${updateLoanAppForm}" autocomplete="off">
                        <div class="box-b">
                            <div class="field field-amount inline">
                                <div class="wrap-field">
                                    <div class="box-icon prefix-box tiny-input">
                                        <span class="prefix">S/</span>
                                    </div>
                                    <input type="text" class="input-outline amount-input" th:field="*{amount}"/>
                                    <small class="input-help">Monto</small>
                                </div>
                            </div>
                            <div class="field inline">
                                <input type="text" class="input-outline small-input" th:field="*{installments}"/>
                                <small class="input-help"></small>
                            </div>
                            <div class="field inline">
                                <button type="button" class="button bg-red" id="updateButton">Guardar</button>
                            </div>
                        </div>
                        <div class="display-block">
                            <div class="errorContainer"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#updateForm'), JSON.parse(/*[[${updateLoanAppForm.validator.toJson(#locale)}]]*/));
        $('#updateButton').click(function () {
            if ($('#updateForm').valid()) {
                questionFw.updateLoanApplication({
                    type: "POST",
                    form: $('#updateForm'),
                    button: $('#updateButton'),
                    data: $('#updateForm').serializeObject(),
                    success: function () {
                        $('#edit-modal').modal('hide');
                        questionFw.refreshAmountAndInstallments();
                    }
                });
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="modal_edit_loan_offer">
    <div class="modal-dialog" role="edit">
        <div class="modal-content">
            <div class="modal-top">
                <div class="title-wrap">
                    <h4 class="title-modal">Editar montos</h4>
                </div>
                <div class="corner-close">
                    <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-middle">
                <div class="block-content text-center">
                    <form id="updateForm" th:object="${updateLoanOfferForm}">
                        <div class="box-purple">
                            <div class="box-b">
                                <div class="field field-amount inline">
                                    <div class="wrap-field">
                                        <div class="box-icon prefix-box tiny-input">
                                            <span class="prefix">S/</span>
                                        </div>
                                        <input type="text" class="input-outline amount-input" th:field="*{amount}"/>
                                        <small class="display-block text-left text-white">Monto</small>
                                    </div>
                                </div>
                                <div class="field inline">
                                    <input type="text" class="input-outline small-input" th:field="*{installments}"/>
                                    <small class="display-block text-left text-white">Cuotas</small>
                                </div>
                            </div>
                        </div>
                        <div class="actions text-center">
                            <div class="errorContainer"></div>
                            <button type="button" class="button bg-red" id="updateButton">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#updateForm'), JSON.parse(/*[[${updateLoanOfferForm.validator.toJson(#locale)}]]*/));
        $('#updateButton').click(function () {
            if ($('#updateForm').valid()) {
                questionFw.updateLoanOffer({
                    type: "POST",
                    form: $('#updateForm'),
                    button: $('#updateButton'),
                    data: $('#updateForm').serializeObject(),
                    success: function () {
                        $('#edit-modal').modal('hide');
                        questionFw.refreshAmountAndInstallments();
                        questionFw.refreshQuestion();
                    }
                });
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="modal_edit_loan_offer_vehicle">
    <div class="modal-dialog" role="edit">
        <div class="modal-content">
            <div class="modal-top">
                <div class="title-wrap">
                    <h4 class="title-modal">Editar inicial</h4>
                </div>
                <div class="corner-close">
                    <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-middle">
                <div class="block-content text-center">
                    <form id="updateForm" th:object="${updateLoanOfferForm}">
                        <div class="box-purple">
                            <div class="box-b">
                                <div class="field field-amount inline">
                                    <div class="wrap-field">
                                        <div class="box-icon prefix-box tiny-input">
                                            <span class="prefix" th:text="${T(com.affirm.common.model.catalog.Currency).USD_CURRENCY}"></span>
                                        </div>
                                        <input type="text" class="input-outline amount-input" th:field="*{downPayment}"/>
                                        <small class="display-block text-left text-white">Cuota inicial</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="actions text-center">
                            <div class="errorContainer"></div>
                            <button type="button" class="button bg-red" id="updateButton">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#updateForm'), JSON.parse(/*[[${updateLoanOfferForm.validator.toJson(#locale)}]]*/));
        $('#updateButton').click(function () {
            //debugger;
            if ($('#updateForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    form: $('#updateForm'),
                    button: $('#updateButton'),
                    data: $('#updateForm').serializeObject(),
                    success: function () {
                        $('#edit-modal').modal('hide');
                        questionFw.refreshAmountAndInstallments();
                        questionFw.refreshQuestion();
                    }
                }, "/edit");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="modal_edit_vehicle">
    <div class="modal-dialog" role="edit">
        <div class="modal-content">
            <div class="modal-top">
                <div class="title-wrap">
                    <h4 class="title-modal">
                        <span class="circle"></span>
                        <span class="text"> Elige un auto</span>
                    </h4>
                </div>
                <div class="corner-close">
                    <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-middle">
                <div class="block-content text-center">
                    <div class="edit-autos">
                        <div class="block" id="brand-section">

                            <ul class="brand-list">
                                <li th:each="brand : ${@catalogService.getActiveVehicleBrands()}">
                                    <a href= "#" class="brandSelected" th:attr="data-id=${brand.id}">
                                        <img th:src="${brand.image}"/>
                                        <h3 th:text="${brand.brand}"></h3>
                                    </a>
                                </li>
                            </ul>
                            <div class="actions">
                                <button id="nextTo" class="button bg-red hidden" th:text="#{button.next}"></button>
                            </div>
                        </div>
                        <div class="block block-hidden" id="car-section">
                            <div class="results-car">

                            </div>
                            <div class="actions">
                                <br/>
                                <button type="button" class="button bg-red" id="savePreference">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $(function () {
            var toSend = [];
            $('.brandSelected').on('click', function (e) {
                e.preventDefault();
                var id = $(this).data('id');
                if ($.inArray(id, toSend) != -1) {
                    $(this).removeClass('brand-active');

                    for (i = 0; i < toSend.length; i++) {
                        if (toSend[i] == id) {
                            toSend.remove(toSend[i]);
                        }
                    }
                } else {
                    toSend.push(id);
                    $(this).addClass('brand-active');
                }
                (toSend.length > 0) ? $('#nextTo').removeClass('hidden') : $('#nextTo').addClass('hidden');
            });

            $('#nextTo').on('click', function (e) {
                e.preventDefault();
                defaultAjax({
                    url: /*[[@{/__${T(com.affirm.common.model.catalog.ProductCategory).VEHICULO_CATEGORY_URL}__/__${@evaluationController.URL}__/__${token}__/updateLoanApplication/vehicleResults}]]*/,
                    type: 'GET',
                    data: {brands: JSON.stringify(toSend)},
                    success: function (data) {
                        $('#nextTo').closest('.block').addClass('block-hidden');
                        $('#car-section').removeClass('block-hidden');
                        $('.results-car').html(data);
                        $('.real-radio').radio();
                    }
                });
            });

            function productStyles(selection) {
                if (!selection.id) {
                    return selection.text;
                }
                var thumb = $(selection.element).data('thumb');
                if (!thumb) {
                    return selection.text;
                } else {
                    var $selection = $('<img src=   "' + thumb + '" alt=""><span class="img-changer-text">' + $(selection.element).text() + '</span>');
                    return $selection;
                }
            }

            $('.real-radio').radio();

            $('#savePreference').click(function () {
                questionFw.updateLoanApplicationVehicle({
                    type: "POST",
                    form: $('#updateForm'),
                    button: $('#savePreference'),
                    data: {vehicleId: $('input[name=model]:checked').val()},
                    success: function () {
                        $('#edit-modal').modal('hide');
                        questionFw.refreshAmountAndInstallments();
                    }
                });
            });
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="modal_edit_vehicle_results">
    <div class="car" th:each="vehicle : ${results}">
        <div class="row">
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 col">
                <label class="custom-input-radio">
                    <input type="radio" name="model" th:value="${vehicle?.vehicleDetails[0]?.id}" class="real-radio"/>
                </label>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 col">
                <img th:src="${vehicle?.image}" alt=""/>
            </div>
            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7 col">
                <div class="wrap">
                    <div class="top">
                        <h2 th:text="${vehicle.brand.brand+' '+vehicle.model}"></h2>
                        <span th:text="${vehicle?.version}"></span>
                    </div>
                    <div class="price">
                        <h4 class="text-red" th:text="${@utilService.integerMoneyFormat(vehicle.price, vehicle?.currency?.symbol)}"></h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="question_config">
    <div id="questionConfiguration"
         th:attr="data-section=${section},data-show-application-update-modal=${showLoanApplicationUpdateModal},data-show-offer-update-modal=${showLoanOfferUpdateModal},data-show-agent=${showAgent},data-percentage=${progressPercentage},data-show-toky=${showToky},data-force-vehicle-modal-show=${forceVehicleModalShow},data-show-go-back=${showGoBack},data-show-name-email=${showNameEmail},data-user-email=${userEmail},data-user-name=${userFullName}"></div>
</th:block>

<th:block th:fragment="question_1">
    <th:block th:replace="this :: question_config"></th:block>

    <div id="modal_msg_question1" class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="offerModal">
        <div class="modal-dialog" role="help">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <span class="circle"></span>
                        <span class="text">Personas Expuestas Pol√≠citamente (PEP)</span>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-middle">
                    <div class="block-content">
                        <p>Son personas naturales, nacionales o extranjeras, que cumplen o que en los √∫ltimos cinco (5) a√±os hayan cumplido funciones p√∫blicas destacadas o funciones prominentes en una organizaci√≥n internacional, sea en el territorio nacional o extranjero, y cuyas circunstancias financieras puedan ser objeto de un inter√©s. Asimismo, se considera como PEP al colaborador directo de la m√°xima autoridad de la instituci√≥n.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="questions-section animated fadeInRight" th:classappend="${@countryContextService.isCountryContextInArgentina(#httpServletRequest) ? 'main-arg' : ''}">
        <p th:if="${isSelfEvaluation}" th:utext="#{questions.block.greeting.selfEvaluation(${agent.name})}"></p>
        <p th:if="${isEvaluation}" th:text="'¬øCu√°l es tu email y tu n√∫mero de documento?'"></p>
        <div class="forms" style="margin-top: 20px;">

            <form id="questionForm" th:object="${form}">
                <div class="field field-username inline display-block email-block">
                    <div class="wrap-field">
                        <div class="box-icon"><i class="icon icon-gmail"></i></div>
                        <input type="text" class="input-outline" th:field="*{email}" autocorrect="off"
                               autocapitalize="none"/>
                        <small class="input-help">Correo electr&oacute;nico</small>
                    </div>
                </div>
                <div class="field inline">
                    <th:block th:if="${@countryContextService.isCountryContextInPeru(#httpServletRequest)}">
                        <select th:field="*{docType}" data-width="80">
                            <option th:each="type : ${@catalogService.getIdentityDocumentTypeByCountry(@countryContextService.getCountryParamsByRequest(#httpServletRequest).id, false)}" th:value="${type.id}" th:text="${type.name}"></option>
                        </select>
                    </th:block>
                </div>

                <div class="field inline">
                    <th:block th:if="${@countryContextService.isCountryContextInArgentina(#httpServletRequest)}">
                        <label class="type-doc">CUIT / CUIL / CDI</label>
                    </th:block>
                    <input id="docNumber" name="docNumber" type="text" class="input-outline document-input" style="width:130px" th:value="*{docNumber}"/>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block" th:if="${isEvaluation}" >
                    <label for="pep" class="custom-check">
                        <span class="check-inner"><i class="icon icon-check"></i></span>
                        <span class="check-label">Declaro que soy una persona expuesta pol&iacute;ticamente
                            <a id="open-modal-question1" href="#">(PEP)</a>
                        </span>
                        <input type="checkbox" class="real-check" id="pep" name="pep"/>
                    </label>
                </div>
                <th:block th:if="${@countryContextService.isCountryContextInArgentina(#httpServletRequest)}">
                    <div class="display-block arg-block">
                        <label for="acceptAgreement" class="custom-check">
                            <span class="check-inner"><i class="icon icon-check"></i></span>
                            <span class="check-label">He le√≠do, comprendo y acepto los <a th:href="@{/terminos-y-condiciones}">T√©rminos y Condiciones</a> Generales de Uso y <a th:href="@{/politica-de-privacidad}">la Pol√≠tica de Privacidad
                                </a></span>
                            <input type="checkbox" class="real-check" id="acceptAgreement" name="acceptAgreement"/>
                        </label>
                    </div>
                </th:block>
                <div class="display-block">
                    <div class="errorContainer"></div>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var docType = $('#docType'),
            docNumber = $('#docNumber');

        var firstOnChange = true;
        docType.on('change', function () {
            if (!firstOnChange) {
                docNumber.val('');
            } else {
                firstOnChange = false;
            }
            if ($(this).val() == /*[[${T(com.affirm.common.model.catalog.IdentityDocumentType).CE}]]*/) {
                $('#docNumber').removeClass('document-input').addClass('document-input-ce');
                $('#questionForm').data('validatorJson').rules.docNumber.minlength = 8;
                $('#questionForm').data('validatorJson').rules.docNumber.maxlength = 9;
                $('')
            } else if ($(this).val() == /*[[${T(com.affirm.common.model.catalog.IdentityDocumentType).DNI}]]*/) {
                $('#docNumber').removeClass('document-input-ce').addClass('document-input');
                $('#questionForm').data('validatorJson').rules.docNumber.minlength = 8;
                $('#questionForm').data('validatorJson').rules.docNumber.maxlength = 8;
            } else {
                $('#docNumber').removeClass('document-input-ce').addClass('document-input');
                $('#questionForm').data('validatorJson').rules.docNumber.minlength = 11;
                $('#questionForm').data('validatorJson').rules.docNumber.maxlength = 11;
            }
            $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
            $('#questionForm').data('validator').resetForm();

            questionFw.initializeFormInputs();
        });
        docType.change();

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        pep: $('#pep').is(':checked'),
                        agent: questionFw.agent,
                        categoryUrl: questionFw.categoryUrl
                    })
                }, "");
            }
        });

        $('#open-modal-question1').on('click', function (event) {
            event.preventDefault();
            self.openMsg1Modal();
            $("#modal_msg_question1").modal('show');
            console.log('lanz√≥ el modal');
        });
        this.openMsg1Modal = function () {
            //$('#offer_modal').modal({backdrop: 'static', keyboard: false, show: true});
            $("#modal_msg_question1").modal('show');
            //$('#offer_modal').html('');
        };



        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_2">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.birthdate}"></p>
            <div class="field field-birthdate inline">
                <div class="wrap-field">
                    <div class="box-icon tiny-input"><i class="icon icon-cake"></i></div>
                    <input type="text" id="birthDay" class="input-outline tiny-input" placeholder="dd"
                           pattern="[0-9]*"/>
                    <input type="text" id="birthMonth" class="input-outline tiny-input" placeholder="mm"
                           pattern="[0-9]*"/>
                    <input type="text" id="birthYear" class="input-outline small-input" placeholder="yyyy"
                           pattern="[0-9]*"/>
                </div>
            </div>
            <div class="field inline">
                <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
            </div>
            <div class="display-block">
                <small class="errorContainer error-text"></small>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var yearFrom = /*[[${yearFrom}]]*/;
        var yearTo = /*[[${yearTo}]]*/;
        var dateFromServer = /*[[${form.birthday}]]*/;

        if (dateFromServer != null) {
            var serverDate = moment(dateFromServer, "DD/MM/YYYY");

            $('#birthDay').val(serverDate.format("DD"));
            $('#birthMonth').val(serverDate.format("MM"));
            $('#birthYear').val(serverDate.format("YYYY"));
        }

        $('#birthDay').forceIntegerOnly(true, 1, 31);
        $('#birthMonth').forceIntegerOnly(true, 1, 12);
        $('#birthYear').forceIntegerOnly(true, yearFrom, yearTo);

        $('#birthDay').keyup(function (event) {
            if ($(this).val().length == 2) {
                $('#birthMonth').focus();
            }
        });
        $('#birthMonth').keyup(function (event) {
            if ($(this).val().length == 2) {
                $('#birthYear').focus();
            }
        });

        $('#sendButton').click(function () {
            $('.errorContainer').html("");

            var date = moment($('#birthDay').val() + "/" + $('#birthMonth').val() + "/" + $('#birthYear').val(), "DD/MM/YYYY");
            if (!date.isValid() || date.get('years') > yearTo || date.get('years') < yearFrom) {
                $('.errorContainer').html("La fecha es incorrecta");
            } else {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    data: {
                        birthday: date.format("DD/MM/YYYY")
                    }
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_3">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:if="${isSelfEvaluation}" th:utext="#{questions.block.willLike}"></p>
            <p th:if="${isEvaluation}" th:utext="#{questions.block.willLikeEvaluation}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field inline">
                    <select th:field="*{loanReasonId}" data-width="245" data-placeholder="Selecciona el motivo">
                        <th:block th:each="category : ${@catalogService.getLoanApplicationReasonCategories(#locale)}"
                                  th:with="reasons = ${selectedEntity != null ? @catalogService.getLoanApplicationReasonsByCategoryAndEntityActivatedProducts(#locale, true, category.id, selectedEntity) : @catalogService.getLoanApplicationReasonsByCategory(#locale, true, category.id)}">
                            <th:block th:if="${reasons != null and !reasons.isEmpty()}">
                                <option value="" disabled="disabled" selected="selected"></option>
                                <option th:each="reason : ${reasons}" th:value="${reason.id}"
                                        th:text="${reason.reason}"></option>
                            </th:block>
                        </th:block>
                    </select>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST",
                form: $('#questionForm'),
                data: $('#questionForm').serializeObject()
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_4">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.useFor}"></p>
            <div class="field inline" th:each="usage : ${@catalogService.getCreditUsages(#locale)}">
                <label class="input-radio">
                    <input type="radio" name="use" th:value="${usage.id}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-business"
                               th:classappend="${#strings.toUpperCase(usage.usage) == T(com.affirm.common.model.catalog.CreditUsage).PARTICULAR ? 'icon-independent' : 'icon-dependent'}"></i>
                            <h5 th:text="${usage.usage}"></h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=use]:radio').change(function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {usageId: $(this).val()}
            }, "");
        });


        $(".input-radio").hover(function() {
            $(this).addClass("hover-input");
        }, function() {
            $(this).removeClass("hover-input");
        });



        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_5">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.car.initialFee}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">$</span>
                        </div>
                        <input type="text" class="input-outline amount-input" name="initialAmount" id="initialAmount"/>
                        <small class="input-help">Tu inicial</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>

                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_6">

    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.amountAndInstallments}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix" th:text="#{static.queston.currency}"></span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{amount}"/>
                        <small class="input-help">Monto a solicitar</small>
                    </div>
                </div>
                <div class="field field-amount inline">
                    <input type="text" class="input-outline tiny-input" th:field="*{installments}"/>
                    <small class="input-help">Plazo (meses)</small>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));
        $('#installments').forceLettersOnly("^[0-9]+$", true, 0, 2)
        $('#amount').forceLettersOnly("^[0-9]+$", true, 0, 6)

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
            else {
                var amount = $("#amount");
                var installments = $("#installments");
                var maxAmount = /*[[${maxAmount}]]*/;
                var minAmount = /*[[${minAmount}]]*/;
                var maxInstallments = /*[[${maxInstallments}]]*/;
                var minInstallments = /*[[${minInstallments}]]*/;


                if(amount.val() > maxAmount) {
                    amount.val(maxAmount);
                }
                else if(amount.val() < minAmount) {
                    amount.val(minAmount);
                }

                if(installments.val() > maxInstallments) {
                    installments.val(maxInstallments);
                }
                else if(installments.val() < minInstallments) {
                    installments.val(minInstallments);
                }
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_7">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.whatIsYourSalary}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{fixedGrossIncome}"/>
                        <small class="input-help">Monto</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_8">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.block.signUp}"></p>
        <small class="input-help" style="text-align:center">¬°No te confundas! Por tu seguridad, este correo se vincular√° a tu DNI.</small>
        <form action="" id="questionForm" th:object="${form}">
            <div class="block" id="form-sign-up">
                <div class="field field-username inline">
                    <div class="wrap-field">
                        <div class="box-icon"><i class="icon icon-user"></i></div>
                        <input type="text" class="input-outline" th:field="*{email}" autocorrect="off"
                               autocapitalize="none"/>
                        <small class="input-help">Correo electr&oacute;nico</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red">Continuar</button>
                </div>
                <div class="display-block">
                    <div class="errorContainer"></div>
                </div>
            </div>
            <div class="block">
                <hr class="or-divisor"/>
            </div>
            <div class="block" id="social-networks">
                <!-- outline-box-active -->
                <a id="facebook" class="outline-box" th:classappend="${facebook != null ? 'outline-box-active' : ''}"
                   onclick="login('facebook')"><i class="icon icon-facebook"></i></a>
                <a id="linkedin" class="outline-box" th:classappend="${linkedin != null ? 'outline-box-active' : ''}"
                   onclick="login('linkedin')"><i class="icon icon-linkedin"></i></a>
                <a id="google" class="outline-box" th:classappend="${google != null ? 'outline-box-active' : ''}"
                   onclick="login('google')"><i class="icon icon-google-plus"></i></a>
                <a id="windows" class="outline-box" th:classappend="${windows != null ? 'outline-box-active' : ''}"
                   onclick="login('windows')"><i class="icon icon-outlook"></i></a>
                <a id="yahoo" class="outline-box" th:classappend="${yahoo != null ? 'outline-box-active' : ''}"
                   onclick="login('yahoo')"><i class="icon icon-yahoo"></i></a>
            </div>
            <br/>
            <div class="note">
                <small>Al crear tu cuenta declaras que aceptas los <a rel="noopener noreferrer"
                                                                      th:href="@{/terminos-y-condiciones}"
                                                                      target="_blank" class="text-lightblue">T&eacute;rminos
                    y Condiciones</a> y la <a
                        th:href="@{/politica-de-privacidad}" target="_blank" rel="noopener noreferrer"
                        class="text-lightblue">Pol&iacute;tica de Privacidad</a>.
                </small>
            </div>
        </form>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/

        $('.input-outline').on("input", function () {
            $(this).val($(this).val().replace(/ /g, ""));
        });



        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        oauthy.setupNetwork('google',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('windows',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('yahoo',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('facebook',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('linkedin',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getDefaultPermission()}]]*/null);

        $('#show-block').on('click', function (e) {
            e.preventDefault();

            switch ($(this).attr('data-target')) {
                case '#form-sign-up':
                    $('#social-networks').addClass('block-hidden');
                    $(this).html('Reg&iacute;strate con tu red social');
                    if (/*[[${user?.email != null && user?.password != null}]]*/) {
                        $('#emailExists').show();
                    }
                    $($(this).attr('data-target')).removeClass('block-hidden').addClass('fadeIn');
                    $(this).attr('data-target', '#social-networks');
                    break;
                case '#social-networks':
                    $('#form-sign-up').addClass('block-hidden');
                    $(this).html('Reg&iacute;strate con tu correo electr&oacute;nico');
                    $('#emailExists').hide();
                    $($(this).attr('data-target')).removeClass('block-hidden').addClass('fadeIn');
                    $(this).attr('data-target', '#form-sign-up');
                    break;
            }

        });

        $('#sendButton').click(function () {

            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }

        });


        function login(network) {
            oauthy.login(network, function (code) {
                questionFw.ajaxToCurrentQuestionController({
                    type: 'POST',
                    data: {
                        networkProvider: network == 'google' ? 'G' : network == 'windows' ? 'W' : network == 'yahoo' ? 'Y' : network == 'facebook' ? 'F' : network == 'linkedin' ? 'L' : null,
                        authCode: code
                    }
                }, "");
            }, function () {
                showErrorModal('Se produjo un error al intentar vincular tus redes, <br/>por favor int&eacute;ntalo nuevamente o cont&aacute;ctanos.');
            });
        }


        if( $('body').hasClass('w-autoevaluacion') ){
            $('#texto_legal').css('margin-bottom','40px');
        }

        /*]]>*/

    </script>
</th:block>

<th:block th:fragment="question_9">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.calculating}"></p>
            <div class="calculation-response">
                <h4 class="block-hidden" id="finish-text">
                    <i class="icon icon-check text-lightblue"></i>
                    An√°lisis completo
                </h4>
                <div th:if="${isSelfEvaluation}" id="msg_loaded" class="msg-loaded">
                    <span>
                        Puede demorar hasta 45 segundos.
                        <div class="sk-fading-circle">
                            <div class="sk-circle1 sk-circle"></div>
                            <div class="sk-circle2 sk-circle"></div>
                            <div class="sk-circle3 sk-circle"></div>
                            <div class="sk-circle4 sk-circle"></div>
                            <div class="sk-circle5 sk-circle"></div>
                            <div class="sk-circle6 sk-circle"></div>
                            <div class="sk-circle7 sk-circle"></div>
                            <div class="sk-circle8 sk-circle"></div>
                            <div class="sk-circle9 sk-circle"></div>
                            <div class="sk-circle10 sk-circle"></div>
                            <div class="sk-circle11 sk-circle"></div>
                            <div class="sk-circle12 sk-circle"></div>
                        </div>
                    </span>
                </div>
                <ul>
                    <li id="step-1" class="fade-in">
                        <p>Revisando bases de datos externas</p>
                        <div class="rating">
                            <div class="progressBar">
                                <div class="track">
                                    <div class="bar" id="bar-1"></div>
                                    <div class="bar" id="bar-2"></div>
                                    <div class="bar" id="bar-3"></div>
                                    <div class="bar" id="bar-4"></div>
                                    <div class="bar" id="bar-5"></div>
                                    <div class="bar" id="bar-6"></div>
                                    <div class="bar" id="bar-7"></div>
                                    <div class="bar" id="bar-8"></div>
                                    <div class="bar" id="bar-9"></div>
                                    <div class="bar" id="bar-10"></div>
                                    <div class="bar" id="bar-11"></div>
                                    <div class="bar" id="bar-12"></div>
                                    <div class="bar" id="bar-13"></div>
                                    <div class="bar" id="bar-14"></div>
                                    <div class="bar" id="bar-15"></div>
                                    <div class="bar" id="bar-16"></div>
                                    <div class="bar" id="bar-17"></div>
                                    <div class="bar" id="bar-18"></div>
                                    <div class="bar" id="bar-19"></div>
                                    <div class="bar" id="bar-20"></div>
                                    <div class="bar" id="bar-21"></div>
                                    <div class="bar" id="bar-22"></div>
                                    <div class="bar" id="bar-23"></div>
                                    <div class="bar" id="bar-24"></div>
                                    <div class="bar" id="bar-25"></div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li id="step-2" class="block-hidden">
                        <p>Revisando tus antecedentes financieros</p>
                        <div class="rating">
                            <div class="progressBar">
                                <div class="track">
                                    <div class="bar" id="bar-1"></div>
                                    <div class="bar" id="bar-2"></div>
                                    <div class="bar" id="bar-3"></div>
                                    <div class="bar" id="bar-4"></div>
                                    <div class="bar" id="bar-5"></div>
                                    <div class="bar" id="bar-6"></div>
                                    <div class="bar" id="bar-7"></div>
                                    <div class="bar" id="bar-8"></div>
                                    <div class="bar" id="bar-9"></div>
                                    <div class="bar" id="bar-10"></div>
                                    <div class="bar" id="bar-11"></div>
                                    <div class="bar" id="bar-12"></div>
                                    <div class="bar" id="bar-13"></div>
                                    <div class="bar" id="bar-14"></div>
                                    <div class="bar" id="bar-15"></div>
                                    <div class="bar" id="bar-16"></div>
                                    <div class="bar" id="bar-17"></div>
                                    <div class="bar" id="bar-18"></div>
                                    <div class="bar" id="bar-19"></div>
                                    <div class="bar" id="bar-20"></div>
                                    <div class="bar" id="bar-21"></div>
                                    <div class="bar" id="bar-22"></div>
                                    <div class="bar" id="bar-23"></div>
                                    <div class="bar" id="bar-24"></div>
                                    <div class="bar" id="bar-25"></div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li id="step-3" class="block-hidden">
                        <p>Calculando tus niveles de endeudamiento</p>
                        <div class="rating">
                            <div class="progressBar">
                                <div class="track">
                                    <div class="bar" id="bar-1"></div>
                                    <div class="bar" id="bar-2"></div>
                                    <div class="bar" id="bar-3"></div>
                                    <div class="bar" id="bar-4"></div>
                                    <div class="bar" id="bar-5"></div>
                                    <div class="bar" id="bar-6"></div>
                                    <div class="bar" id="bar-7"></div>
                                    <div class="bar" id="bar-8"></div>
                                    <div class="bar" id="bar-9"></div>
                                    <div class="bar" id="bar-10"></div>
                                    <div class="bar" id="bar-11"></div>
                                    <div class="bar" id="bar-12"></div>
                                    <div class="bar" id="bar-13"></div>
                                    <div class="bar" id="bar-14"></div>
                                    <div class="bar" id="bar-15"></div>
                                    <div class="bar" id="bar-16"></div>
                                    <div class="bar" id="bar-17"></div>
                                    <div class="bar" id="bar-18"></div>
                                    <div class="bar" id="bar-19"></div>
                                    <div class="bar" id="bar-20"></div>
                                    <div class="bar" id="bar-21"></div>
                                    <div class="bar" id="bar-22"></div>
                                    <div class="bar" id="bar-23"></div>
                                    <div class="bar" id="bar-24"></div>
                                    <div class="bar" id="bar-25"></div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li id="step-4" class="block-hidden">
                        <p>Realizando una estimaci&oacute;n de tu perfil</p>
                        <div class="rating">
                            <div class="progressBar">
                                <div class="track">
                                    <div class="bar" id="bar-1"></div>
                                    <div class="bar" id="bar-2"></div>
                                    <div class="bar" id="bar-3"></div>
                                    <div class="bar" id="bar-4"></div>
                                    <div class="bar" id="bar-5"></div>
                                    <div class="bar" id="bar-6"></div>
                                    <div class="bar" id="bar-7"></div>
                                    <div class="bar" id="bar-8"></div>
                                    <div class="bar" id="bar-9"></div>
                                    <div class="bar" id="bar-10"></div>
                                    <div class="bar" id="bar-11"></div>
                                    <div class="bar" id="bar-12"></div>
                                    <div class="bar" id="bar-13"></div>
                                    <div class="bar" id="bar-14"></div>
                                    <div class="bar" id="bar-15"></div>
                                    <div class="bar" id="bar-16"></div>
                                    <div class="bar" id="bar-17"></div>
                                    <div class="bar" id="bar-18"></div>
                                    <div class="bar" id="bar-19"></div>
                                    <div class="bar" id="bar-20"></div>
                                    <div class="bar" id="bar-21"></div>
                                    <div class="bar" id="bar-22"></div>
                                    <div class="bar" id="bar-23"></div>
                                    <div class="bar" id="bar-24"></div>
                                    <div class="bar" id="bar-25"></div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        setTimeout(function () {
            $('#step-1').removeClass('fade-in');
            setTimeout(function () {
                $('#step-2').removeClass('block-hidden').addClass('fade-in');
                setTimeout(function () {
                    $('#step-2').removeClass('fade-in');
                    $('#step-3').removeClass('block-hidden').addClass('fade-in');
                    setTimeout(function () {
                        $('#step-3').removeClass('fade-in');
                        $('#step-4').removeClass('block-hidden').addClass('fade-in');
                        setTimeout(function () {
                            $('#step-4').removeClass('fade-in');
                            setTimeout(function () {
                                sendPost();
                            }, 2000);
                        }, 1000)
                    }, 3000);
                }, 3000);
            }, 3000);
        }, 3000);

        function sendPost() {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                success: function (data) {
                    if (data == null || data == '') {
                        setTimeout(function () {
                            sendPost();
                        }, 1000);
                    }else {
                        $('#finish-text').removeClass('block-hidden').addClass('fadeIn');
                    }
                }
            }, "");
        }



        if( $('body').hasClass('w-autoevaluacion') ){
            $('#texto_legal').css('margin-bottom','0px');
        }

        /*]]>*/
    </script>

    <script th:if="${isSelfEvaluation}" th:inline="javascript">
        /*<![CDATA[*/
        setTimeout(function () {
            $('#msg_loaded').addClass('active');
        }, 16000);
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_10">
    <th:block th:replace="this :: question_config"></th:block>
    <th:block th:if="${@countryContextService.isCountryContextInPeru(#httpServletRequest)}">
        <div class="questions-section animated fadeInRight">
            <div class="forms">
                <p th:utext="#{questions.block.calculatingResult(${person.getFirstName() != null and !person.getFirstName().isEmpty() ? person.getFirstName() : 'Hola'})}"></p>
                <div class="calculation-response">
                    <div class="result">
                        <div class="stars">
                            <!-- positive, negative -->
                            <h3 class="positive"
                                th:text="${'¬°' + selfEvaluation.getScoreLabel() + '!'}"></h3>
                            <i class="icon icon-star star-1"></i>
                            <i class="icon icon-star star-2"></i>
                            <i class="icon icon-star star-3"></i>
                            <i class="icon icon-star star-4"></i>
                            <i class="icon icon-star star-5"></i>
                        </div>
                        <div class="actions">
                            <a href="#" id="applyButton" class="anchor-button bg-red">Solicita tu cr&eacute;dito aqu√≠</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="divisor-bottom"/>
        <script th:inline="javascript">
            /*<![CDATA[*/
            var calification = /*[[ ${selfEvaluation.score} ]]*/;
            $(function () {
                for (var i = 0; i <= calification; i++) {
                    $('.star-' + i).addClass('positive');
                }
            });

            $('#applyButton').click(function () {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    button: $('#applyButton')
                }, "loanApplication");
            });
            /*]]>*/
        </script>
    </th:block>
    <th:block th:if="${@countryContextService.isCountryContextInArgentina(#httpServletRequest)}">
        <div class="questions-section animated fadeInRight qs-arg">
            <div class="forms">
                <p th:utext="#{questions.block.calculatingResult(${person.getFirstName() != null and !person.getFirstName().isEmpty() ? person.getFirstName() : 'Hola'})}"></p>
                <div class="calculation-response">
                    <div class="result">
                        <div class="stars">
                            <h3 class="positive" th:text="${selfEvaluation.getScoreLabel()}"></h3>
                        </div>
                        <p th:utext="${selfEvaluation.getScoreMessage()}"></p>
                        <div class="actions">
                            <a href="#" id="applyButton" class="anchor-button bg-red commingsoon">Solicit√° tu pr√©stamo aqu√≠</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="divisor-bottom"/>
    </th:block>
</th:block>

<th:block th:fragment="question_11">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">

            <p th:utext="#{questions.block.rejectionTittle(${personFirstName ?: 'Hola'})}"></p>
            <p th:if="${preEvaluation != null}" th:utext="${preEvaluation.hardFilterMessage}"></p>
            <p th:if="${evaluation != null}" th:utext="${evaluation.policyMessage}"></p>

            <th:block th:if="${preEvaluation?.hardFilterMessageKey != null
                    and preEvaluation?.hardFilterMessageKey.equals('bd.preliminaryEvaluation.closedPlatform')
                    and loanApplication?.selfEvaluationId == null}">
                <br/>
                <div class="note">
                    ¬øQuieres aprender m&aacute;s de finanzas? <br/>Visita nuestro blog <a th:href="@{/blog}"
                                                                                          class="text-lightblue">aqu√≠</a>.
                </div>
            </th:block>
            <div th:if="${preEvaluation?.helpMessage != null || evaluation?.helpMessage != null}"
                 class="calculation-response">
                <div class="result">
                    <div class="actions" id="negative-result">
                        <p th:text="#{questions.block.needTips}"></p>

                        <a href="#" class="anchor-button bg-black" onclick="sendPost(false)">No</a>
                        <a href="#" class="anchor-button bg-red" onclick="sendPost(true)">Si</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        function sendPost(advices) {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {advices: advices}
            }, "");
        }
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_12">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.notGiveTips(${personFirstName})}"></p>
            <div class="note">
                ¬°√Ånimo! No es el fin del mundo.
            </div>
            <a th:href="@{/blog}" class="anchor-button bg-red">BLOG</a>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_13">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.giveTips(${personFirstName})}"></p>
            <div th:if="${helpMessage != null}" class="note">
                <div id="helpMessageTitle" th:utext="${helpMessage.tittle}"></div>
                <div id="helpMessageBody" th:utext="${helpMessage.body}"></div>
            </div>
            <a  th:href="@{/blog}" class="anchor-button bg-red">BLOG</a>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_20">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <th:block th:switch="${category}">
            <p th:case="${T(com.affirm.common.model.catalog.ProductCategory).VEHICULO}"
               th:utext="#{questions.block.areYouReadyQuestion1(${agent.name},'comprar un auto')}"></p>
            <p th:case="*" th:utext="#{questions.block.areYouReadyQuestion2(${agent.name})}"></p>
        </th:block>
        <div class="note" th:utext="#{questions.block.areYouReadyNote}"></div>

        <div th:if="${!isInCorrectCountry}" id="response-block">
            <span class="small-text alert successMessage">
                <small>Estas en otro pa√≠s, haz click <a th:href="${redirectUrl}" class="successMessage text-bold" style="text-decoration: underline">aqui</a> para ir al tuyo.</small>
            </span>
        </div>

        <div class="actions">
            <button id="comeBack" type="button" class="button bg-black">&iexcl;Regreso luego!</button>
            <button id="sendButton" type="button" class="button bg-red">&iexcl;Estoy listo!</button>
        </div>

    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/

        var homeUrl = /*[[ @{/} ]]*/;

        $('#comeBack').on('click', function (e) {
            e.preventDefault();
            window.location.href = homeUrl;
        });

        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                data: {
                    category: /*[[${category}]]*/
                },
                type: "POST"
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_21">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <form id="questionForm" th:object="${form}">
            <div class="forms" id="marital-status-block">
                <p th:text="#{questions.block.maritalStatus(${personName != null and !personName.isEmpty() ? personName : 'Hola'})}"></p>
                <div class="field inline">
                    <select th:field="*{maritalStatus}" data-width="200" data-placeholder="Selecciona tu estado civil">
                        <option value="" disabled="disabled" selected="selected"></option>
                        <option th:each="maritalStatus : ${@catalogService.getMaritalStatus(#locale)}"
                                th:value="${maritalStatus.id}" th:text="${maritalStatus.status}"></option>
                    </select>
                </div>
                <div class="field inline">
                    <button type="button" id="nextButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </div>
            <div class="forms block-hidden" id="document-block">
                <p>&iquest;Cu&aacute;l es el n&uacute;mero documento de tu esposo(a) o conviviente?</p>
                <div class="field inline">
                    <select th:field="*{partnerDocType}" data-width="80">
                        <option value="1">DNI</option>
                        <option value="2">CE</option>
                    </select>
                </div>
                <div class="field inline">
                    <input type="text" class="input-outline document-input" th:field="*{partnerDocNumber}"
                           pattern="[0-9]*"/>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block text-center">
                    <div class="errorContainer"></div>
                    <a href="#" class="text-lightblue" id="noPartner">No tengo c√≥nyugue/ conviviente</a>
                </div>
            </div>
        </form>
        <form id="resetProcess" method="POST"></form>
        <div style="font-size:60%;">
            <p><small>¬øNo eres <a href="#" th:text="${personName != null ? personName : ''}" id="reset"></a>?</small></p>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var docType = $('#partnerDocType'),
            docNumber = $('#partnerDocNumber');

        var firstOnChange = true;
        docType.on('change', function () {
            if (!firstOnChange) {
                docNumber.val('');
            } else {
                firstOnChange = false;
            }
            if ($(this).val() == 2) {
                $('#questionForm').data('validatorJson').rules.partnerDocNumber.maxlength = 9;
            } else {
                $('#questionForm').data('validatorJson').rules.partnerDocNumber.maxlength = 8;
            }
            $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
            $('#questionForm').data('validator').resetForm();
        });
        docType.change();

        $("#reset").on('click', function(e) {
            var url = "/"+questionFw.categoryUrl +'/reset/evaluacion/'+ questionFw.token;
            console.log(url);
            $("#resetProcess").attr('action', url);
            console.log($("#resetProcess").attr('action'));

            defaultAjax({
                url: url,
                type: 'POST',
                success: function (data) {
                    resetTimer();
                }
            });

            //$("#resetProcess").submit();
        });

        $('#nextButton').on('click', function (e) {
            e.preventDefault();
            var marriedStatus = /*[[${T(com.affirm.common.model.catalog.MaritalStatus).MARRIED}]]*/;
            var cohabitantStatus = /*[[${T(com.affirm.common.model.catalog.MaritalStatus).COHABITANT}]]*/;
            debugger;
            if($('#maritalStatus').val() == marriedStatus || $('#maritalStatus').val() == cohabitantStatus){
                $('#marital-status-block').addClass('block-hidden');
                $('#document-block').removeClass('block-hidden').addClass('fadeIn');

                $('#questionForm').data('validatorJson').rules.partnerDocType.required = true;
                $('#questionForm').data('validatorJson').rules.partnerDocNumber.required = true;
                $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
                $('#questionForm').data('validator').resetForm();
            }else{
                $('#questionForm').data('validatorJson').rules.partnerDocType.required = false;
                $('#questionForm').data('validatorJson').rules.partnerDocNumber.required = false;
                $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
                $('#questionForm').data('validator').resetForm();
                sendForm($(this));
            }
        });

        $('#noPartner').on('click', function (e) {
            e.preventDefault();
            $('#document-block').addClass('block-hidden');
            $('#marital-status-block').removeClass('block-hidden').addClass('fadeIn');
        });

        $('#sendButton').on('click', function (e) {
            e.preventDefault();
            sendForm($(this));
        });

        function sendForm(button) {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: button,
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        }
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_22">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms no-top">
            <th:block th:if="${@brandingService.isBrandedByEntityId(#httpServletRequest, T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                <p th:utext="#{questions.block.addressWithName(${person.getFirstName()})}"></p>
            </th:block>
            <th:block th:unless="${@brandingService.isBrandedByEntityId(#httpServletRequest, T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                <p th:if="${questionId == 22}" th:utext="#{questions.block.address}"></p>
                <p th:if="${questionId == 61 or questionId == 82}" th:utext="#{questions.block.companyAddress}"></p>
            </th:block>
            <form id="questionForm" th:object="${form}">
                <div class="g-maps" id="gmaps"></div>
                <div class="field inline mobile-100">
                    <input type="text" class="input-outline address-input" th:field="*{address}"
                           placeholder="Direcci&oacute;n"/>
                    <!-- If -->
                    <div class="display-block text-left" th:if="${questionId == 61}">
                        <label for="confirmAddress" class="custom-check">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                            <span class="check-label"> Est&aacute; localizado en mi domicilio.</span>
                            <input type="checkbox" class="real-check" id="confirmAddress"/>
                        </label>
                    </div>
                </div>
                <div class="field inline">
                    <input type="text" class="input-outline pin-input" th:field="*{department}"/>
                    <small class="input-help">Nro/ piso</small>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <script th:inline="javascript" th:if="${questionId == 22}">
        /*<![CDATA[*/
        // Browser geolocation
        var browserLocation = /*[[${browserLocation}]]*/;
        if (navigator.geolocation && !browserLocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    data: {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    }
                }, "navlocation");
            }, function (error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        console.log("User denied the request for Geolocation");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        console.log("Location information is unavailable");
                        break;
                    case error.TIMEOUT:
                        console.log("The request to get user location timed out");
                        break;
                    case error.UNKNOWN_ERROR:
                        console.log("Unknow geolocation error");
                        break;
                }
            });
        }
        /*]]>*/
    </script>
    <script th:inline="javascript" th:if="${questionId == 61}">
        /*<![CDATA[*/
        $('#confirmAddress').click(function () {
            if (this.checked) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "GET",
                    success: function (data) {
                        debugger;
                        var json = JSON.parse(data);
                        if (json.latitude != null)
                            map.setCenter(new google.maps.LatLng(json.latitude, json.longitude));
                        marker.setPosition(new google.maps.LatLng(json.latitude, json.longitude));
                        if (json.address != null)
                            $('#address').val(json.address);
                        autocompletedPlace = true;
                    }
                }, "homeAddress");
                $('#address').prop('readonly', true);
                $('#department').prop('readonly', true);
            } else {
                $('#address').prop('readonly', false);
                $('#department').prop('readonly', false);
            }
        });
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/

        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if (!autocompletedPlace) {
                showErrorModal("Debes escribir una direcci&oacute;n correcta.")
                return;
            }
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(),
                        {
                            latitude: mapLocation.lat,
                            longitude: mapLocation.lng
                        })
                }, "");
            }
        });

        var mapLocation;
        $('#gmaps').doOnce(function () {
            initMap();
        });

        var map;
        var marker;
        var autocomplete;
        var autocompletedPlace = false;
        function initMap() {
            mapLocation = {
                lat: /*[[${form.latitude != null ? form.latitude : -12.046469}]]*/,
                lng: /*[[${form.longitude != null ? form.longitude : -77.042788}]]*/
            };
            map = new google.maps.Map(document.getElementById('gmaps'), {
                zoom: 10,
                center: mapLocation,
                styles: [
                    {
                        "featureType": "administrative",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "color": "#444444"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.country",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.country",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.country",
                        "elementType": "geometry.fill",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.country",
                        "elementType": "geometry.stroke",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.province",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.locality",
                        "elementType": "labels",
                        "stylers": [
                            {
                                "hue": "#ffe500"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [
                            {
                                "color": "#f2f2f2"
                            },
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.landcover",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "geometry.fill",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "geometry.stroke",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "labels",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "labels.text",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "labels.text.fill",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "labels.text.stroke",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape.natural.terrain",
                        "elementType": "labels.icon",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.attraction",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.business",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.place_of_worship",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi.school",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "simplified"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": -100
                            },
                            {
                                "lightness": 45
                            },
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "simplified"
                            }
                        ]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "labels.icon",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "transit.station",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "simplified"
                            }
                        ]
                    },
                    {
                        "featureType": "transit.station.airport",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "all",
                        "stylers": [
                            {
                                "color": "#9bdffb"
                            },
                            {
                                "visibility": "on"
                            }
                        ]
                    }
                ]
            });
            marker = new google.maps.Marker({
                position: mapLocation,
                map: map
            });

            // Init the searchbox
            autocomplete = new google.maps.places.Autocomplete(
                (document.getElementById('address')), {
                    types: ['geocode']
                });

            autocomplete.setComponentRestrictions(
                {'country': ['pe']});


            autocomplete.addListener('place_changed', function () {
                mapLocation = null;
                marker.setVisible(false);

                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }

                // If the place has a geometry, then present it on a map.
                if (place.geometry.viewport) {
                    map.fitBounds(place.geometry.viewport);
                } else {
                    map.setCenter(place.geometry.location);
                    map.setZoom(17);  // Why 17? Because it looks good.
                }
                mapLocation = place.geometry.location;
                marker.setPosition(mapLocation);
                marker.setVisible(true);
                autocompletedPlace = true;
            });

        }

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_23">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:text="#{questions.block.propertyType}"></p>
            <div class="field inline" th:each="type : ${@catalogService.getHousingTypes(#locale)}">
                <label class="h-input-radio">
                    <input type="radio" name="housingType" th:value="${type.id}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline" th:text="${type.type}"></h5>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=housingType]:radio').change(function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {housingType: $(this).val()}
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_24">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form th:object="${form}" class="form" id="questionForm">
                <p th:utext="#{questions.block.educationLevel}"></p>
                <div class="field inline">
                    <select th:field="*{studyLevel}" data-width="245" data-placeholder="Nivel de estudios">
                        <th:block th:each="level : ${@catalogService.getStudyLevels(#locale)}">
                            <option disabled="disabled" selected="selected" value=""></option>
                            <option th:value="${level.id}" th:text="${level.level}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    data: {studyLevel: $('#studyLevel').val(), concludedStudies: $('#concludedStudies').prop('checked')}
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_25">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form th:object="${form}" id="questionForm">
                <p th:utext="#{questions.block.profession}"></p>
                <div class="field inline">
                    <select th:field="*{profession}" data-width="245" data-placeholder="Profesiones">
                        <th:block th:each="profession : ${@catalogService.getProfessionsActive(#locale)}">
                            <option value="" disabled="disabled" selected="selected"></option>
                            <option th:value="${profession.id}" th:text="${profession.profession}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    data: {profession: $('#profession').val()}
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_26">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms no-top" id="how-earn-block">
            <p th:utext="#{questions.block.whatDoYouDo}"></p>
            <div class="field inline">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="activityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).DEPENDENT}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-dependent"></i>
                            <h5>Dependiente</h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="activityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).INDEPENDENT}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-independent"></i>
                            <h5>Independiente</h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="activityType" value="others"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-others"></i>
                            <h5>Otros</h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
        <!--<div class="forms block-hidden" id="date-block">-->
        <!--<p>&iquest;Desde cu&aacute;ndo?</p>-->
        <!--<div class="field inline">-->
        <!--<input id="month" type="text" placeholder="mm" class="input-outline small-input" pattern="[0-9]*"/>-->
        <!--<small class="input-help">Mes</small>-->

        <!--</div>-->
        <!--<div class="field inline">-->
        <!--<input id="year" type="text" placeholder="yyyy" class="input-outline small-input" pattern="[0-9]{4}"/>-->
        <!--<small class="input-help">A&ntilde;o</small>-->
        <!--</div>-->
        <!--<div class="field inline">-->
        <!--<button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>-->
        <!--</div>-->
        <!--<div class="display-block">-->
        <!--<div class="errorContainer"></div>-->
        <!--</div>-->
        <!--</div>-->
        <div class="forms block-hidden" id="others-block">
            <div class="field inline">
                <label class="h-input-radio">
                    <input class="whatDoYouDo" type="radio" name="otherActivityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).STUDENT}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Soy estudiante</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input class="whatDoYouDo" type="radio" name="otherActivityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).PENSIONER}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Soy pensionista</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input class="whatDoYouDo" type="radio" name="otherActivityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).HOUSEKEEPER}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Soy empleado(a) del hogar</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input class="whatDoYouDo" type="radio" name="otherActivityType"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).UNEMPLOYED}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">No tengo ingresos</h5>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        //        var yearFrom = /*[[${yearFrom}]]*/;
        //        var yearTo = /*[[${yearTo}]]*/;
        //
        //        $('#month').forceIntegerOnly(true, 1, 12);
        //        $('#year').forceIntegerOnly(true, yearFrom, yearTo);
        //
        //        $('#month').keyup(function (event) {
        //            if ($(this).val().length == 2) {
        //                $('#year').focus();
        //            }
        //        });

        $('input[name=activityType]').on('change', function () {
            switch ($(this).val()) {
                case '[[${T(com.affirm.common.model.catalog.ActivityType).DEPENDENT}]]':
                case '[[${T(com.affirm.common.model.catalog.ActivityType).INDEPENDENT}]]':
                    if (questionFw.type == questionFw.TYPE_COMPARISON) {
                        questionFw.ajaxToCurrentQuestionController({
                            type: "POST",
                            data: {
                                activityType: $(this).val()
                            }
                        }, "");
                    } else {
                        questionFw.ajaxToCurrentQuestionController({
                            type: "POST",
                            data: {
                                activityType: $(this).val()
                            }
                        }, "");
                    }
                    break;
                case 'others':
                    $('#others-block').removeClass('block-hidden').addClass('fadeIn');
                    break;
            }
        });

        $('input[name=otherActivityType]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    activityType: $(this).val()
                }
            }, "");
        });

        //        $('#sendButton').click(function () {
        //            $('.errorContainer').html("");
        //
        //            var month = $("#month").val();
        //
        //            if(month.length < 2) month = "0" + month;
        //
        //            var date = moment(month + "/" + $('#year').val(), "MM/YYYY", true);
        //
        //            if (!date.isValid() || date.get('years') > yearTo || date.get('years') < yearFrom) {
        //                $('.errorContainer').html('<span class="help-block help-block-error">No es una fecha v&aacute;lida</span>');
        //            } else {
        //                questionFw.ajaxToCurrentQuestionController({
        //                    button: $('#sendButton'),
        //                    type: "POST",
        //                    error: function (xhr, data) {
        //                        if (data != null) {
        //                            $('.errorContainer').html('<span class="help-block help-block-error">' + data.message + '</span>');
        //                            return false;
        //                        }
        //                    },
        //                    data: {
        //                        activityType: $('input[name=activityType]:checked').val(),
        //                        startDate: date.format("MM/YYYY")
        //                    }
        //                }, "");
        //            }
        //        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_27">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.companyRUC}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline document-input-ruc" th:field="*{ruc}" pattern="[0-9]*"/>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <small class="display-block text-black">&iquest;No lo encuentras? Encu&eacute;ntralo <a
                        href="http://www.sunat.gob.pe/cl-ti-itmrconsruc/FrameCriterioBusquedaMovil.jsp"
                        class="text-lightblue"
                        target="_blank"
                        rel="no-referer">aqu&iacute;</a>
                </small>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_28">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.companyPhone}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline cellphone-input" th:field="*{phoneNumber}"
                           pattern="[0-9]*"/>
                    <small class="input-help">Tel&eacute;fono</small>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_29">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.whatIsYourOccupation}"></p>
                <div class="field inline">
                    <select data-width="245" th:field="*{ocupation}" data-placeholder="Selecciona tu ocupaci&oacute;n">
                        <th:block th:each="ocupation : ${@catalogService.getOcupations(#locale)}">
                            <option value="" disabled="disabled" selected="selected"></option>
                            <option th:value="${ocupation.id}" th:text="${ocupation.ocupation}"></option>
                        </th:block>

                    </select>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                button: $('#sendButton'),
                    questionFw.ajaxToCurrentQuestionController({
                        button: $('#sendButton'),
                        type: "POST",
                        form: $('#questionForm'),
                        data: $('#questionForm').serializeObject()
                    }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_30">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.netoIncome}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{income}"/>
                        <small class="input-help">Ingreso bruto</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
            <div class="terms">
                <label for="variableIncome" class="custom-check">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                    <span class="check-label"> Recibo adem&aacute;s un salario variable.</span>
                    <input type="checkbox" class="real-check" id="variableIncome"/>
                </label>
                <label for="otherIncome" class="custom-check">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                    <span class="check-label"> Recibo otros ingresos.</span>
                    <input type="checkbox" class="real-check" id="otherIncome"/>
                </label>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        //        $('#variableIncome').change(function () {
        //            if ($(this).is(':checked')) {
        //                $('#otherIncome').closest('label').hide();
        //            } else {
        //                $('#otherIncome').closest('label').show();
        //            }
        //        });

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        variableIncome: $('#variableIncome').is(':checked'),
                        otherIncome: $('#otherIncome').is(':checked')
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_31">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.variableIncome}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{variableIncome}"/>
                        <small class="input-help">Ingreso variable</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        otherIncome: $('#otherIncome').is(':checked')
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_32">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">

        <div class="forms">
            <p th:utext="#{questions.block.whatDoYouDo}"></p>
            <div class="field inline"
                 th:each="type : ${@catalogService.getSubActivityTypesByActivity(#locale, T(com.affirm.common.model.catalog.ActivityType).INDEPENDENT)}">
                <label class="h-input-radio">
                    <input type="radio" name="subActivity" th:value="${type.id}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline" th:text="${type.type}"></h5>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=subActivity]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST",
                data: {
                    subActivity: $('input[name=subActivity]:checked').val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_33">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.independentRUC}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline" th:field="*{ruc}" pattern="[0-9]*"/>
                    <div class="display-block text-left">
                        <label for="haventRUC" class="custom-check">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                            <span class="check-label"> No tengo</span>
                            <input type="checkbox" class="real-check" id="haventRUC"/>
                        </label>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $("#haventRUC").click(function () {
            if ($(this).is(':checked')) {
                $('#ruc').prop('disabled', true);
                $('#ruc').val('');
                $('#questionForm').data('validatorJson').rules.ruc.required = false;
                $('#questionForm').data('validatorJson').rules.ruc.maxlength = 0;
                $('#questionForm').data('validatorJson').rules.ruc.minlength = 0;
            } else {
                $('#ruc').prop('disabled', false);
                $('#questionForm').data('validatorJson').rules.ruc.required = true;
                $('#questionForm').data('validatorJson').rules.ruc.maxlength = 11;
                $('#questionForm').data('validatorJson').rules.ruc.minlength = 11;
            }
            $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
            $('#questionForm').data('validator').resetForm();
        });

        $('#sendButton').click(function () {
            var valid;
            if ($('#haventRUC').prop('checked')) {
                valid = true;
            } else {
                valid = $('#questionForm').valid();
            }
            if (valid) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {haventRuc: $('#haventRUC').prop('checked')})
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_34">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form th:object="${form}">
                <p th:utext="#{questions.block.services}"></p>
                <div class="field inline">
                    <select data-width="245" th:field="*{serviceType}" data-placeholder="Selecciona un servicio">
                        <th:block th:each="services : ${@catalogService.getServiceTypes(#locale)}">
                            <option value="" disabled="disabled" selected="selected"></option>
                            <option th:value="${services.id}" th:text="${services.serviceType}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST",
                data: {serviceType: $('#serviceType').val()}
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_35">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.customer1Ruc}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline document-input-ruc" th:field="*{ruc}" pattern="[0-9]*"/>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <label for="moreThan65" class="custom-check">
                                <span class="check-inner">
                                    <i class="icon icon-check"></i>
                                </span>
                        <span class="check-label"> Representa m√°s del 65% de mi facturaci√≥n total.</span>
                        <input type="checkbox" class="real-check" id="moreThan65"/>
                    </label>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        moreThan65: $('#moreThan65').prop('checked')
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_36">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <p th:utext="#{questions.block.customer2Ruc}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline document-input-ruc" th:field="*{ruc}" pattern="[0-9]*"/>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <label class="h-input-radio">
                        <input type="radio" name="clients" value="3"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Tengo entre 3 y 5 clientes.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="clients" value="5"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline"> Tengo m&aacute;s de 5 clientes.</h5>
                            </div>
                        </div>
                    </label>
                    <!--<label for="between3and5Customers" class="custom-check">-->
                    <!--<span class="check-inner">-->
                    <!--<i class="icon icon-check"></i>-->
                    <!--</span>-->
                    <!--<span class="check-label"> Tengo entre 3 y 5 clientes.</span>-->
                    <!--<input type="checkbox" class="real-check" id="between3and5Customers"/>-->
                    <!--</label>-->
                    <!--<label for="moreThan65" class="custom-check">-->
                    <!--<span class="check-inner">-->
                    <!--<i class="icon icon-check"></i>-->
                    <!--</span>-->
                    <!--<span class="check-label"> Tengo m&aacute;s de 5 clientes.</span>-->
                    <!--<input type="checkbox" class="real-check" id="moreThan65"/>-->
                    <!--</label>-->
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var $radio = null;

        $('input[type="radio"]').on('click', function (e) {//on click/change

            var remove = false;
            if ($radio == $(this).val()) {
                remove = true;
            }

            $radio = $(this).val();

            if(remove == false) {
                $(this).prop('checked', true).attr('checked', 'checked');
            }
            else {
                $(this).prop('checked', false).removeAttr('checked');
                $(".h-input-radio").removeClass("radio-selected");
            }
        });

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_37">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.provableIncome}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{monthlyIncome}"/>
                        <small class="input-help">Ingreso U6M</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="despite"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que disminuyan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="keeping"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que se mantengan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="grow"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero crecer en m&aacute;s del 15%.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio" th:if="${showOtherIncome}">
                        <input type="radio" name="hopeGrow" value="otherIncome"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Recibo otros ingresos.</h5>
                            </div>
                        </div>
                    </label>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        otherIncome: $('#otherIncome').length ? $('#otherIncome').is(':checked') : false
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_38">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.ownerBusinessRUC}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field inline">
                    <input type="text" class="input-outline document2-input" th:field="*{ruc}" pattern="[0-9]*"/>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <label for="imNotLegal" class="custom-check">
                                <span class="check-inner">
                                    <i class="icon icon-check"></i>
                                </span>
                        <span class="check-label"> No estoy constituido legalmente.</span>
                        <input type="checkbox" th:field="*{notLegal}" class="real-check" id="imNotLegal"/>
                    </label>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $("#imNotLegal").click(function () {
            if ($(this).is(':checked')) {
                $('#ruc').prop('disabled', true);
                $('#ruc').val('');
                $('#questionForm').data('validatorJson').rules.ruc.required = false;
                $('#questionForm').data('validatorJson').rules.ruc.maxlength = 0;
                $('#questionForm').data('validatorJson').rules.ruc.minlength = 0;
            } else {
                $('#ruc').prop('disabled', false);
                $('#questionForm').data('validatorJson').rules.ruc.required = true;
                $('#questionForm').data('validatorJson').rules.ruc.maxlength = 11;
                $('#questionForm').data('validatorJson').rules.ruc.minlength = 11;
            }
            $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
            $('#questionForm').data('validator').resetForm();
        });


        $('#sendButton').click(function () {
            if ($('#imNotLegal').is(':checked') || $('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_39">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.shareOptions}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-percentage inline">
                    <div class="wrap-field">
                        <input type="text" class="input-outline medium-input" th:field="*{shareholding}"/>
                        <div class="box-icon box-right prefix-box tiny-input">
                            <span class="subfix"><i class="icon icon-percent"></i></span>
                        </div>
                        <small class="input-help">Porcentaje de acciones</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_61">
    <th:block th:replace="this :: question_22"/>
</th:block>

<th:block th:fragment="question_40">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.lastTwelveMonthsIncome}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{sales}"/>
                        <small class="input-help">Ventas</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <div class="display-block">

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="despite"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que disminuyan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="keeping"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que se mantengan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="grow"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero crecer en m&aacute;s del 15%.</h5>
                            </div>
                        </div>
                    </label>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_41">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.lastResultExercise}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{exerciseOutcome}"/>
                        <small class="input-help">Resultado neto</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <div class="display-block">

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="despite"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que disminuyan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="keeping"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que se mantengan.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="hopeGrow" value="grow"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Espero que aumenten en m&aacute;s del 15%.</h5>
                            </div>
                        </div>
                    </label>

                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_42">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.percentUsedForCoveredCost}"></p>
            <div class="note">
                <small>(Ej. Alquileres + pago de servicios + salarios fijos, etc‚Ä¶)</small>
            </div>
            <form id="questionForm" th:object="${form}">
                <div class="field field-percentage inline">
                    <div class="wrap-field">
                        <input type="text" class="input-outline medium-input" th:field="*{salesPercentage}"/>
                        <div class="box-icon box-right prefix-box tiny-input">
                            <span class="subfix"><i class="icon icon-percent"></i></span>
                        </div>
                        <small class="input-help">Porcentaje</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_43">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.percentUsedForCoveredCostVariable}"></p>
            <div class="note">
                <small>(Ej. Costo de mercader√≠a + salarios variables, etc...)</small>
            </div>
            <form id="questionForm" th:object="${form}">
                <div class="field field-percentage inline">
                    <div class="wrap-field">
                        <input type="text" class="input-outline medium-input" th:field="*{salesPercentage}"/>
                        <div class="box-icon box-right prefix-box tiny-input">
                            <span class="subfix"><i class="icon icon-percent"></i></span>
                        </div>
                        <small class="input-help">Porcentaje</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_44">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.percentSales}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-percentage inline">
                    <div class="wrap-field">
                        <input type="text" class="input-outline medium-input" th:field="*{salesPercentage}"/>
                        <div class="box-icon box-right prefix-box tiny-input">
                            <span class="subfix"><i class="icon icon-percent"></i></span>
                        </div>
                        <small class="input-help">Porcentaje</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <div class="display-block">

                    <label class="h-input-radio">
                        <input type="radio" name="businessType" class="businessType" value="minor"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Mi negocio es al por menor.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="businessType" class="businessType" value="fiveCustomers"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Tengo menos de 5 clientes.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="businessType" class="businessType" value="minusFiveteenCustomers"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Tengo menos de 15 clientes.</h5>
                            </div>
                        </div>
                    </label>

                    <label class="h-input-radio">
                        <input type="radio" name="businessType" class="businessType" value="moreFiveteenCustomers"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Tengo m√°s de 15 clientes.</h5>
                            </div>
                        </div>
                    </label>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('.businessType').on('change', function () {
            $('#salesPercentage').attr('disabled', false);
            if ($(this).val() == 'minor') {
                $('#salesPercentage').attr('disabled', true);
            }

        });

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_45">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.fundsDaily}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{income}"/>
                        <small class="input-help">Dinero al final del d&iacute;a</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_46">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.compensation}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{income}"/>
                        <small class="input-help">Salario promedio</small>
                    </div>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <div class="display-block">
                    <label for="otherIncome" class="custom-check" th:if="${showOtherIncome}">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                        <span class="check-label"> Recibo otros ingresos.</span>
                        <input type="checkbox" class="real-check" id="otherIncome"/>
                    </label>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        otherIncome: $('#otherIncome').length ? $('#otherIncome').is(':checked') : false
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_47">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.rentierIncomes}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field field-amount inline">
                    <div class="wrap-field">
                        <div class="box-icon prefix-box tiny-input">
                            <span class="prefix">S/</span>
                        </div>
                        <input type="text" class="input-outline amount-input" th:field="*{rent}"/>
                        <small class="input-help">Neto</small>
                    </div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
                <div class="display-block">
                    <div class="field inline">
                        <label class="h-input-check" th:each="belonging : ${@catalogService.getBelongings(#locale)}">
                            <input type="checkbox" class="checkbox" th:value="${belonging.id}" name="belonging[]"/>
                            <div class="option-wrapper">
                                <div class="iconic-option-inner">
                                    <div class="radio inline"></div>
                                    <h5 class="inline" th:text="${belonging.name}"></h5>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="display-block">
                    <label for="otherIncome" class="custom-check" th:if="${showOtherIncome}">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                        <span class="check-label"> Recibo otros ingresos.</span>
                        <input type="checkbox" class="real-check" id="otherIncome"/>
                    </label>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $.extend($('#questionForm').serializeObject(), {
                        otherIncome: $('#otherIncome').length ? $('#otherIncome').is(':checked') : false
                    })
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_48">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.tellMeAboutAdditionalIncome}"></p>
            <div class="field inline">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="activity"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).DEPENDENT}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-dependent"></i>
                            <h5>Dependiente</h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="activity"
                           th:value="${T(com.affirm.common.model.catalog.ActivityType).INDEPENDENT}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon icon-independent"></i>
                            <h5>Independiente</h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
        <div class="forms block-hidden" id="since-block">
            <p>&iquest;Desde cu&aacute;ndo?</p>
            <div class="field inline">
                <input id="month" type="text" placeholder="mm" class="input-outline small-input" pattern="[0-9]*"/>
                <small class="input-help">Mes</small>

            </div>
            <div class="field inline">
                <input id="year" type="text" placeholder="yyyy" class="input-outline small-input" pattern="[0-9]*"/>
                <small class="input-help">A&ntilde;o</small>
            </div>
            <div class="field inline">
                <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
            </div>
            <div class="display-bock">
                <small class="errorContainer"></small>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('#month').forceIntegerOnly(true, 1, 12);
        $('#year').forceIntegerOnly(true, 1950, /*[[${actualYear}]]*/);
        $('.howEarnMoney').on('change', function () {

            $(this).closest('.forms').addClass('block-hidden');
            $('#since-block').removeClass('block-hidden').addClass('fadeIn');

            $('#sendButton').click(function () {
                $('.errorContainer').html("");

                var date = moment($('#month').val() + "/" + $('#year').val(), "MM/YYYY");
                if (!date.isValid()) {
                    $('.errorContainer').html('<span class="help-block help-block-error">no es una fecha v&aacute;lida</span>');
                } else {
                    questionFw.ajaxToCurrentQuestionController({
                        button: $('#sendButton'),
                        type: "POST",
                        data: {
                            activity: $('input[name=activity]:checked').val(),
                            startDate: date.format("MM/YYYY")
                        }
                    }, "");
                }
            });
        });

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_85">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <div class="actions">
                <p th:utext="#{questions.block.independentHasOtherIncome}"></p>
                <a href="#" class="anchor-button bg-black" data-target="no">No</a>
                <a href="#" class="anchor-button bg-red" data-target="yes">Si</a>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        //questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('.anchor-button').on('click', function (e) {
            e.preventDefault();
            console.log("clicked");
            switch ($(this).data('target')) {
                case 'yes':
                    questionFw.ajaxToCurrentQuestionController({
                        type: "POST",
                        data:  {'response': true}
                    }, "");
                    break;
                case 'no':
                    questionFw.ajaxToCurrentQuestionController({
                        type: "POST",
                        data: {'response': false}
                    }, "");
                    break;
            }
        });

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_49">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.demonstrableIncome}"></p>
            <div class="actions">
                <a href="#" class="anchor-button bg-black" data-target="#amount-block">No</a>
                <a href="#" class="anchor-button bg-red" data-target="yes">Si</a>
            </div>
            <div class="forms block-hidden" id="amount-block">
                <form id="questionForm" th:object="${form}">
                    <div class="field field-amount inline">
                        <div class="wrap-field">
                            <div class="box-icon prefix-box tiny-input">
                                <span class="prefix">S/</span>
                            </div>
                            <input type="text" class="input-outline amount-input" th:field="*{income}"/>
                            <small class="input-help">Ingreso no demostrable</small>
                        </div>
                    </div>
                    <div class="field inline">
                        <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                    </div>
                    <div class="errorContainer"></div>
                </form>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });

        $('.anchor-button').on('click', function (e) {
            e.preventDefault();
            switch ($(this).data('target')) {
                case 'yes':
                    questionFw.ajaxToCurrentQuestionController({
                        type: "POST"
                    }, "");
                    break;
                case '#amount-block':
                    $(this).closest('.actions').addClass('block-hidden');
                    $($(this).data('target')).removeClass('block-hidden').addClass('fadeIn');
                    break;
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_50">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <div id="form_date" th:if="${showFirstDueDate != null and showFirstDueDate}">
                <div class="offer-title">
                    <h2>Ingresa la fecha en la que te gustar&iacute;a pagar tu primera cuota</h2>
                    <span class="line"></span>
                </div>
                <div class="form-group">
                    <div class="field inline">

                        <input type="text" id="datetimepicker12" class="input-outline "/>
                        <button id="sendFirstDueDate" type="button" class="button bg-red" >Continuar</button>

                    </div>
                </div>
                <script th:inline="javascript">
                    /*<![CDATA[*/
                    var minDate = [[${minDate}]];
                    var maxDate = [[${maxDate}]];
                    var enableDates = [[${enableDates}]];

                    var jsonDatePicker = {
                        format:'DD/MM/YYYY',
                        inline: true,
                        sideBySide: false
                    };
                    if(minDate != null && maxDate != null) {
                        jsonDatePicker.minDate = moment(minDate, "DD/MM/YYYY");
                        jsonDatePicker.maxDate = moment(maxDate, "DD/MM/YYYY");
                        jsonDatePicker.defaultDate = moment(minDate, "DD/MM/YYYY");
                    }
                    if(enableDates != null){
                        for(i=0; i<enableDates.length; i++){
                            enableDates[i] = moment(enableDates[i], "DD/MM/YYYY");
                        }
                        jsonDatePicker.enabledDates = enableDates;
                        jsonDatePicker.defaultDate = enableDates[0];
                    }

                    $('#datetimepicker12').datetimepicker(jsonDatePicker);


                    $('#sendFirstDueDate').on('click', function (e) {
                        e.preventDefault();
                        questionFw.ajaxToCurrentQuestionController({
                            button: $('#sendFirstDueDate'),
                            type: "POST",
                            data: {
                                firstDueDate: $('#datetimepicker12').val()
                            },
                            success: function () {
                                questionFw.refreshQuestion();
                            }
                        }, "firstDueDate");
                    });
                    /*]]>*/
                </script>
            </div>
            <!-- pantalla de ofertas -->
            <div class="offer-container" th:if="${showFirstDueDate == null || !showFirstDueDate}">
                <div class="offer-title">
                    <h2 th:text="#{title.offer}"></h2>
                    <span class="line"></span>
                    <div class="call-offer-modal"><span>¬øC√≥mo elegimos la mejor oferta? </span><a href="#" id="show_offer"> Ent√©rate aqu√≠.</a></div>
                </div>
                <ul class="owl-carousel" id="offer-carousel">
                    <li class="best-offer" th:each="offer : ${offers}"
                        th:attr="data-offer-id=${offer.id}, data-offer-color=${offer.loanOfferOrder % 3 == 0 ? 'green':offer.loanOfferOrder % 3 == 1 ? 'red' : offer.loanOfferOrder % 3 == 2 ? 'blue':''}"
                        th:classappend="${offer.loanOfferOrder % 3 == 0? 'offer-green':(offer.loanOfferOrder % 3 == 1? 'offer-red' :(offer.loanOfferOrder % 3 == 2? 'offer-blue':''))}">
                        <a href="#" class="select-offer">
                            <div class="box-a">
                                <div class="bar-offer"></div>
                                <span class="bar-iso"><i class="icon icon-solven-iso"></i></span>
                            </div>
                            <div class="box-b">
                                <h3 th:text="${offer.loanOfferOrder % 3 == 0? '+ Plazo':(offer.loanOfferOrder % 3 == 1? '= Similar' :(offer.loanOfferOrder % 3 == 2? '+ Dinero':''))}">
                                    = Similar</h3>
                                <th:block th:switch="${offer.loanOfferOrder}">
                                    <span th:case="2" th:text="#{loanOffer.offer2}"></span>
                                    <span th:case="3" th:text="#{loanOffer.offer3}"></span>
                                    <span th:case="*" th:text="#{loanOffer.offer1}"></span>
                                </th:block>
                                <p>
                                    <span class="prefix-top">S/ </span>
                                    <span class="amount" th:text="${@utilService.integerOnlyMoney(offer?.ammount)}"></span>
                                </p>
                            </div>
                            <div class="box-c">
                                <ul class="offer-info">
                                    <li>
                                        <p class="small-text">
                                            <span class="big">S/ </span>
                                            <span class="big"
                                                  th:text="${@utilService.doubleMoneyFormat(offer?.installmentAmountAvg, null)}"></span>
                                            <span>/mes</span>
                                        </p>
                                        <p class="small-text">
                                            <span th:text="${offer.installments}"></span>
                                            <span th:text="#{label.months}"></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p class="small-text">
                                            <span>TEA </span>
                                            <span th:text="${@utilService.percentFormat(offer.effectiveAnualRate)}"></span>
                                        </p>
                                        <p class="small-text">
                                            <span>TCEA</span>
                                            <span th:text="${@utilService.percentFormat(offer.effectiveAnnualCostRate)}"></span>
                                        </p>
                                    </li>
                                </ul>
                            </div>
                            <div class="box-d">
                                <div class="btn btn-offer calendar-button" th:attr="data-offer-order=${offer?.loanOfferOrder}">
                                    <span class="circle-inner" >
                                        <i class="icon icon-calendar"></i>
                                        <small>Ver cronograma</small>
                                    </span>
                                </div>
                                <span href="#" class="check icon icon-check"></span>
                            </div>
                        </a>
                    </li>
                </ul>
                <div class="sponsored-by first">
                    <hr class="divisor-thin"/>
                    <div class="box-sponsor">
                        <small>Financiado por</small>
                        <img th:src="${offers?.get(0).entity.logoUrl}"/>
                        <small th:if="${entityProductParam.disbursementType == entityProductParam.DISBURSEMENT_TYPE_DEPOSIT}"
                               class="online" th:text="#{label.processType.online}"></small>
                        <small th:if="${entityProductParam.disbursementType == entityProductParam.DISBURSEMENT_TYPE_RETIREMNT}"
                               class="online" th:text="#{label.processType.manualAgencia}"></small>
                    </div>
                </div>
                <div class="sponsored-by" th:if="${entityProductParam.offerLegalFooter != null}">
                    <small th:utext="${entityProductParam.getOfferLegalFooterReplaced(null, null)}"></small>
                </div>
            </div>
        </div>
    </div>
    <div th:each="offer : ${offers}" th:id="'offerScheduleModal' + ${offer?.loanOfferOrder}" class="modal fade"
         tabindex='-1' th:attr="data-offer-id=${offer.id}">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <h4 class="title-modal">Cronograma de pagos preliminar</h4>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>

                <div class="modal-middle">
                    <th:block th:replace="fragments/modalScheduleFragment :: modalSchedule(laoanApplication=${loanAppplication}, offer=${offer}, person=${person})"></th:block>
                </div>
                <div class="actions text-center" style="padding: 0 0 1.5em 0">
                    <button type="button" class="button red-button schedule-modal-accept-offer"
                            data-dismiss="modal">
                        Aceptar Oferta
                    </button>
                    <button type="button" class="button black-button"
                            data-dismiss="modal">
                        Volver
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $('.calendar-button').click(function (e) {
            e.stopPropagation();
            //debugger;
            $('#offerScheduleModal' + $(this).data('offer-order')).modal('show');
        });
        if ($('.offer-container').length) {
            $('.select-offer').click(function () {
                $(this).closest('.best-offer').addClass('offer-selected-' + $(this).closest('.best-offer').data('offer-color'));
                selectOffer($(this).closest('.best-offer').data('offer-id'));
            });
            $('.schedule-modal-accept-offer').click(function () {
                var offerId = $(this).closest('.modal').data('offer-id');
                var bestOfferElement = $(".best-offer[data-offer-id='"+offerId+"']")
                bestOfferElement.addClass('offer-selected-' + bestOfferElement.data('offer-color'));
                selectOffer(offerId);
            });
        }

        function selectOffer(offerId){
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    selectedOffer: offerId
                },
                success: function () {
                    questionFw.refreshQuestion();
                }
            }, "");
        }

        /*marioccarloss*/
        $('#show_offer').on('click', function (event) {
            event.preventDefault();
            self.openOfferModal();
        });
        this.openOfferModal = function () {
            //$('#offer_modal').modal({backdrop: 'static', keyboard: false, show: true});
            $("#offer_modal").modal('show');
            //$('#offer_modal').html('');
        };

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_51">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}" class="form">
                <div class="block" id="social-networks">
                    <p th:text="#{questions.block.athenticateWithEmails}"></p>
                    <!-- outline-box-active -->
                    <a id="gmail" class="outline-box" th:classappend="${gmail != null ? 'outline-box-active' : ''}"
                       onclick="login('google')"><i class="icon icon-gmail"></i></a>
                    <a id="windows" class="outline-box" th:classappend="${windows != null ? 'outline-box-active' : ''}"
                       onclick="login('windows')"><i class="icon icon-outlook"></i></a>
                    <a id="yahoo" class="outline-box" th:classappend="${yahoo != null ? 'outline-box-active' : ''}"
                       onclick="login('yahoo')"><i class="icon icon-yahoo"></i></a>
                    <div class="display-block">
                        <a href="#" class="change-block text-lightblue" data-target="#block-manual">Ingresar correo
                            manual.</a>
                    </div>
                </div>
                <div class="block block-hidden" id="block-manual">
                    <p th:text="#{questions.block.joinWithEmail}"></p>
                    <div class="field inline">
                        <input type="text" class="input-outline fullname-input" th:field="*{email}" autocorrect="off"
                               autocapitalize="none"/>
                    </div>
                    <div class="field inline">
                        <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                    </div>
                    <div class="display-block">
                        <div class="errorContainer"></div>
                        <a href="#" class="change-block text-lightblue" data-target="#social-networks">Prefiero con mis
                            redes sociales</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('.change-block').on('click', function (e) {

            e.preventDefault();

            switch ($(this).data('target')) {
                case '#block-manual':
                    $(this).closest('.block').addClass('block-hidden');
                    $($(this).data('target')).removeClass('block-hidden');
                    break;
                case '#social-networks':
                    $(this).closest('.block').addClass('block-hidden');
                    $($(this).data('target')).removeClass('block-hidden');
                    break;
            }

        });

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });

        oauthy.setupNetwork('google',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).GOOGLE.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('windows',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).WINDOWS.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('yahoo',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).YAHOO.getDefaultPermission()}]]*/null);


        function login(network) {
            oauthy.login(network, function (code) {
                questionFw.ajaxToCurrentQuestionController({
                    type: 'POST',
                    data: {
                        networkProvider: network == 'google' ? 'G' : network == 'windows' ? 'W' : network == 'yahoo' ? 'Y' : null,
                        authCode: code
                    }
                }, "");
            }, function () {
                showErrorModal('Se produjo un error al intentar vincular tus redes, <br/>por favor int&eacute;ntalo nuevamente o cont&aacute;ctanos.');
            });
        }
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_52">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:text="#{questions.block.athenticateWithSocials}"></p>
            <div class="block" id="social-networks">
                <!-- outline-box-active -->
                <a id="facebook" class="outline-box" th:classappend="${facebook != null ? 'outline-box-active' : ''}"
                   onclick="login('facebook')"><i class="icon icon-facebook"></i></a>
                <a id="linkedin" class="outline-box" th:classappend="${linkedin != null ? 'outline-box-active' : ''}"
                   onclick="login('linkedin')"><i class="icon icon-linkedin"></i></a>
                <a id="mercadolibre" class="outline-box"
                   th:classappend="${mercadolibre != null ? 'outline-box-active' : ''}"
                   onclick="login('mercadolibre')"><i class="icon icon-mercadolibre"></i></a>
            </div>
            <div class="display-block">
                <a href="#" class="text-lightblue" id="skipButton">Omitir</a>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        oauthy.setupNetwork('facebook',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).FACEBOOK.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('linkedin',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).LINKEDIN.getDefaultPermission()}]]*/null);
        oauthy.setupNetwork('mercadolibre',
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).MERCADOLIBRE.getClientId()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).MERCADOLIBRE.getRedirectUri()}]]*/null,
            /*[[${T(com.affirm.system.configuration.Configuration.OauthNetwork).MERCADOLIBRE.getDefaultPermission()}]]*/null);

        $('#skipButton').on('click', function (e) {
            e.preventDefault();
            questionFw.ajaxToCurrentQuestionController({
                type: 'POST'
            }, "skip");
        });

        function login(network) {
            oauthy.login(network, function (code) {
                questionFw.ajaxToCurrentQuestionController({
                    type: 'POST',
                    data: {
                        networkProvider: network == 'facebook' ? 'F' : network == 'linkedin' ? 'L' : network == 'mercadolibre' ? 'M' : null,
                        authCode: code
                    }
                }, "");
            }, function () {
                showErrorModal('Se produjo un error al intentar vincular tus redes, <br/>por favor int&eacute;ntalo nuevamente o cont&aacute;ctanos.');
            });
        }
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_53">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:if="${isSelfEvaluation}" th:text="#{questions.block.yourPhoneNumber.selfEvaluation}"></p>
            <p th:if="${isEvaluation}" th:text="#{questions.block.yourPhoneNumber}"></p>
            <form id="questionForm" th:object="${form}">
                <th:block th:if="${@countryContextService.isCountryContextInArgentina(#httpServletRequest)}">
                    <div class="field inline">
                        <div class="wrap-field">
                            <input type="text" class="input-outline tiny-input" th:field="*{areaCode}"/>
                            <small class="input-help">Cod. Area</small>
                        </div>
                    </div>
                    <div class="field inline">
                        <div class="wrap-field">
                            <input type="text" class="input-outline cellphone-input" th:field="*{phoneNumber}"/>
                            <small class="input-help">Nro. Celular</small>
                        </div>
                    </div>
                </th:block>
                <th:block th:if="${@countryContextService.isCountryContextInPeru(#httpServletRequest)}">
                    <div class="field inline">
                        <input type="text" class="input-outline cellphone-input" th:field="*{phoneNumber}"/>
                    </div>
                </th:block>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <div class="errorContainer"></div>
                </div>
                <div th:if="${isSelfEvaluation}" class="display-block">
                    <a href="#" class="text-lightblue" id="skipButton">Omitir</a>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));
        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        $('#skipButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST",
                form: $('#questionForm')
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_54">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:text="#{questions.block.validatePIN}"></p>
            <form id="questionForm" th:object="${form}">
                <div class="field inline">
                    <input type="text" class="input-outline pin-input" placeholder="PIN" th:field="*{pin}"
                           pattern="[0-9]*"/>
                    <small th:class="input-help"><a href="#" class="text-lightblue" id="resendToken"><i
                            class="icon icon-reload"></i>
                        Reenviar</a>
                    </small>
                    <div class="errorContainer"></div>
                </div>
                <div class="field inline">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var url = /*[[@{/loanapplication}]]*/;
        var loanApplicationToken;

        $('#resendToken').on('click', function (e) {
            e.preventDefault();
            var resendButton = $(this);
            resendButton.hide();
            setTimeout(function () {
                resendButton.fadeIn();
            }, 30000);
        });
        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_55">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:text="#{questions.block.referenceNumber}"></p>
            <div class="dynamic-field"></div>
            <div class="text-small display-block text-center"><a href="#" class="button text-lightblue" id="addField"><i
                    class="icon icon-plus"></i>Agregar otra referencia</a></div>
            <div class="actions text-center">
                <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/

        $('.input-outline.fullname-input').forceLettersOnly('^[a-zA-Z0-9. ()]+$', true, 5, 50);
        $('.input-outline.cellphone-input').forceLettersOnly('^[0-9 ()]+$', true, 7, 9);

        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));
        questionFw.validateForm($('#questionForm_2'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var relationshipArray = new Array();
        $('select').each(function() {
            relationshipArray.push($(this).val());
        });

        var relationshipsList = /*[[ ${@catalogService.getRelationships(#locale)} ]]*/;
        var blackList = [];

        var WIFE = /*[[${T(com.affirm.common.model.catalog.Relationship).WIFE}]]*/;
        var COHABITANT = /*[[${T(com.affirm.common.model.catalog.Relationship).COHABITANT}]]*/;

        var MOTHER = /*[[${T(com.affirm.common.model.catalog.Relationship).MOTHER}]]*/;
        var FATHER = /*[[${T(com.affirm.common.model.catalog.Relationship).FATHER}]]*/

        var mapBlackList = {};

        mapBlackList[WIFE] = COHABITANT;
        mapBlackList[COHABITANT] = WIFE;

        var reverseMap = {};

        var uniqueList = [
            WIFE, COHABITANT, MOTHER, FATHER
        ];

        var selectedOptions = [null, null, null];
        var total = 0;

        function updateOptions(index) {
            var selected = selectedOptions[index];

            var options = '';
            var iterator = 0;

            for(var relationshipIndex = 0 ; relationshipIndex < 11 ; ++relationshipIndex) {
                relationship = relationshipsList[relationshipIndex];

                if(reverseMap[relationship.id] != index) {
                    if(selected != relationship.id && blackList.indexOf(relationship.id) > -1) {
                        continue;
                    }
                }

                var select = "";

                if(relationship.id == selected || (selected == null && iterator == 0)) {
                    select = 'selected="selected"';

                    if(uniqueList.indexOf(relationship.id) > -1) {
                        blackList.push(relationship.id);
                    }

                    selectedOptions[index] = relationship.id;
                    selected = relationship.id;
                }

                var option = '<option value="'+ relationship.id+ '" ' + select + '>'+ relationship.relationship +'</option>';
                options += option;

                iterator++;
            }

            if (mapBlackList[selected] !== undefined) {
                blackList.push(mapBlackList[selected]);
                reverseMap[mapBlackList[selected]] = index;
            }

            var idx = "#"+(index);
            $(idx).empty().append(options);
        }

        function updateAllOptions() {
            for(var index = 0 ; index < total ; ++index) {
                updateOptions(index);
            }
        }

        function optionSelected(index) {
            var value = $("#" + index).val();
        }

        function addField(del) {
            var idx = "#"+total;
            var id = 0 + total;

            var eliminar = '<a href="#" class="button text-red" id="removeField"><i class="icon icon-trash"></i>Eliminar</a>';
            var html = $('<div class="dynamic-field"><form class="relationshipForm" id="questionForm_' + total + '"><div class="field inline"><input type="text" class="input-outline fullname-input" name="fullname" placeholder="Nombre"/></div><div class="field inline"><input type="text" class="input-outline cellphone-input" name="phoneNumber" placeholder="Tel/ Cel" pattern="[0-9]*"/></div><div class="field inline"><select id="' + total +'" name="referenceId"  class="kindred" data-width="100"></select></div><small class="display-block text-left">' + (del ? eliminar : '') + '</small><div class="display-block"> <div class="errorContainer"></div></div></form></div>');
            if($('.dynamic-field').size() > 0){
                html.insertAfter($('.dynamic-field').last());
            }
            else {
                $(".forms").append(html);
            }

            $(idx).change(function() {
                var value = selectedOptions[id];
                selectedOptions[id] = $(idx).val();

                var blackListIndex = blackList.indexOf(value);

                while(blackListIndex > -1) {
                    blackList.splice(blackListIndex, 1);
                    blackListIndex = blackList.indexOf(value);
                }

                blackListIndex = blackList.indexOf(mapBlackList[value]);

                while(blackListIndex > -1) {
                    blackList.splice(blackListIndex, 1);
                    blackListIndex = blackList.indexOf(mapBlackList[value]);
                }

                for(var index in reverseMap) {
                    if(reverseMap[index] == id) {
                        delete reverseMap[index];
                    }
                }


                updateOptions(id);
                updateAllOptions();
            });

            questionFw.validateForm($('#questionForm_' + total), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));
            total++;

            $(idx).select2({
                minimumResultsForSearch: -1,
                placeholder: $(this).data('placeholder'),
                width: $(this).data('width') + 'px'
            });

            updateOptions(id);
            updateAllOptions();
        }

        addField(false);
        addField(false);

        $(function () {
            var i = $('.dynamic-field').size() + 1;

            $('#addField').on('click', function(){
                if(total == 3){
                    return;
                }
                addField(true)
            });

            $('.forms').on('click', '#removeField', function (e) {
                e.preventDefault();
                if (i > 2) {
                    $(this).closest('.relationshipForm').remove();
                    i--;
                }
                return false;
            });
        });

        $('#sendButton').click(function () {
            //debugger;
            var valid = true;
            var forms = [];
            $('.relationshipForm').each(function () {
                if (!$(this).valid()) {
                    valid = false;
                }
            });
            if (valid) {
                $('.relationshipForm').each(function () {
                    forms.push($(this).serializeObject());
                });
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    data: {referrals: JSON.stringify(forms)}
                }, "");
            }
        });

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_56">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:utext="#{questions.block.partnerName}"></p>

        <div class="forms">
            <div class="field inline" th:each="alternative : ${alternatives}">
                <label class="h-input-radio">
                    <input type="radio" name="partner" th:value="${alternative}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline" th:text="${alternative}"></h5>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=partner]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    partner: $('input[name=partner]:checked').val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_57">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <p th:utext="#{questions.block.lastAddress}"></p>
            <form id="questionForm">
                <div class="display-block">
                    <div class="field inline">
                        <label class="h-input-check">
                            <input type="checkbox" class="checkbox" name="housingType"/>
                            <div class="option-wrapper">
                                <div class="iconic-option-inner">
                                    <div class="radio inline"></div>
                                    <h5 class="inline">Direcci&oacute;n 1</h5>
                                </div>
                            </div>
                        </label>
                        <label class="h-input-check">
                            <input type="checkbox" class="checkbox" name="housingType"/>
                            <div class="option-wrapper">
                                <div class="iconic-option-inner">
                                    <div class="radio inline"></div>
                                    <h5 class="inline">Direcci&oacute;n 2</h5>
                                </div>
                            </div>
                        </label>
                        <label class="h-input-check">
                            <input type="checkbox" class="checkbox" name="housingType"/>
                            <div class="option-wrapper">
                                <div class="iconic-option-inner">
                                    <div class="radio inline"></div>
                                    <h5 class="inline">Dinero</h5>
                                </div>
                            </div>
                        </label>
                        <label class="h-input-check">
                            <input type="checkbox" class="checkbox" name="housingType"/>
                            <div class="option-wrapper">
                                <div class="iconic-option-inner">
                                    <div class="radio inline"></div>
                                    <h5 class="inline">Direcci&oacute;n 3</h5>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="actions text-center">
                    <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST"
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_58">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:utext="#{questions.block.bankProduct}"></p>

        <div class="forms">
            <div class="field inline">
                <label class="h-input-radio">
                    <input type="radio" name="bank" class="bank" value="Banco Falabella"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Banco Falabella</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input type="radio" name="bank" class="bank" value="BCP"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Banco de la Naci&oacute;n</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input type="radio" name="bank" class="bank" value="Interbank"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Interbank</h5>
                        </div>
                    </div>
                </label>
            </div>
            <div class="field inline">
                <label class="h-input-radio">
                    <input type="radio" name="bank" class="bank" value="ninguno"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <div class="radio inline"></div>
                            <h5 class="inline">Ninguno</h5>
                        </div>
                    </div>
                </label>
            </div>
        </div>
        <form id="product-block" class="block-hidden">
            <div class="display-block">
                <div class="field inline">
                    <label class="h-input-check">
                        <input type="checkbox" class="checkbox" name="housingType"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Direcci&oacute;n 1</h5>
                            </div>
                        </div>
                    </label>
                    <label class="h-input-check">
                        <input type="checkbox" class="checkbox" name="housingType"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Direcci&oacute;n 2</h5>
                            </div>
                        </div>
                    </label>
                    <label class="h-input-check">
                        <input type="checkbox" class="checkbox" name="housingType"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Dinero</h5>
                            </div>
                        </div>
                    </label>
                    <label class="h-input-check">
                        <input type="checkbox" class="checkbox" name="housingType"/>
                        <div class="option-wrapper">
                            <div class="iconic-option-inner">
                                <div class="radio inline"></div>
                                <h5 class="inline">Direcci&oacute;n 3</h5>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            <div class="actions text-center">
                <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
            </div>
        </form>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('.bank').on('change', function () {
            if ($(this).val() != 'ninguno') {
                $('#product-block').removeClass('block-hidden').addClass('fadeIn');
            } else {
                $('#product-block').addClass('block-hidden');
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST"
                }, "");
            }
        });

        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST"
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_59">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:utext="#{questions.block.selfie}"></p>
        <br/>
        <div id="selfie"></div>
        <div class="actions">
            <button id="sendButton" class="button bg-red block-hidden" type="button" th:text="#{button.next}"></button>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var files = [{
            id: /*[[${T(com.affirm.common.model.catalog.UserFileType).SELFIE}]]*/,
            name: "selfie",
            maxFiles: 1,
            required: true
        }];
        var tp = new Tp({container: '#selfie', userFileConfig: files});
        tp.init();

        $('#sendButton').click(function () {
            $('#sendButton').loading('', 2);
            tp.uploadPictures();
            questionFw.ajaxToCurrentQuestionController({
                button: $('#sendButton'),
                type: "POST"
            }, "");
        });

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_60">
    <th:block th:replace="this :: question_config"></th:block>


    <div id="modal_msg_question60" class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="offerModal">
        <div class="modal-dialog" role="help">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <span class="circle"></span>
                        <span class="text" id="modalTituloQuestion_60"></span>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-middle">
                    <div class="block-content">
                        <p id="modalMessageQuestion_60"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="questions-section animated fadeInRight">
        <!--<div class="note">-->
        <!--(Subir el &uacute;ltimo recibo de servicios vigente)-->
        <!--</div>-->

        <div id="documents"></div>
        <div class="tk-small">
            <small>Los formatos de archivo permitidos son : jpg, jpeg, png y pdf</small>
            <br/>
            <small>El tama√±o m√°ximo de las im√°genes es : 10Mb</small>
        </div>
        <div class="actions main-buttons">
            <a href="#" id="uploadButton" class="anchor-button bg-gris tpAction" data-target="upload">Sube la foto</a>
            <a href="#" id="takeButton" class="anchor-button bg-red tpAction" data-target="take">Saca la foto</a>

            <button id="skipButton" class="button bg-red block-hidden bg-t" type="button" th:text="Omitir"></button>
            <button id="nextButton" class="button bg-red block-hidden" type="button" th:text="#{button.next}"></button>
            <button id="sendButton" class="button bg-red block-hidden" type="button" th:text="#{button.next}"></button>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var files = JSON.parse(/*[[${jsonTakePictureConfig}]]*/);
        var tp = new Tp({
            container: '#documents',
            userFileConfig: files
        });

        tp.init();

        $('#sendButton').click(function () {
            $('#sendButton').loading('', 2);
            tp.uploadPictures(function () {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST"
                }, "");
            });
        });

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_69">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <h3 class="title-home" th:utext="#{questions.block.salaryAdvance.offer}"></h3>
        <div class="forms">
            <div class="offer-container">
                <div class="salary-advance-offer box-a">
                    <div class="box-b">
                        <h4 class="amount"><span class="currency">S/ </span> <span class="amount-value">1 011.25</span>
                        </h4>
                        <small th:text="#{label.offer.totalAmount}"></small>
                    </div>
                    <div class="box-c">
                        <div class="box-d">
                            <div class="input-controls">
                                <h3 class="input-outline"><span class="currency">S/ </span> 1 000</h3>
                            </div>
                            <input type="text" class="input-outline medium-input"/>
                            <small th:text="#{label.offer.amount}"></small>
                        </div>
                        <div class="box-e">
                            <span class="plus">+</span>
                        </div>
                        <div class="box-f">
                            <div class="input-controls">
                                <h3><span class="currency">S/ </span> <span class="amount">11.25</span></h3>
                                <div class="controls">
                                    <button class="up"></button>
                                    <button class="down"></button>
                                </div>
                            </div>
                            <small th:text="#{label.offer.commission}"></small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="terms-block">
                <label for="contract-check" class="custom-check">
                    <span class="check-inner">
                        <i class="icon icon-check"></i>
                    </span>
                    <span class="check-label" th:text="#{label.offer.contract}"></span>
                    <input type="checkbox" class="real-check" id="contract-check"/>
                </label>
                <br/>
                <label for="terms-check" class="custom-check">
                            <span class="check-inner">
                                <i class="icon icon-check"></i>
                            </span>
                    <span class="check-label" th:utext="#{label.terms}"></span>
                    <input type="checkbox" class="real-check" id="terms-check"/>
                </label>
            </div>
            <div class="actions-center">
                <button class="button bg-red" th:text="#{button.next}"></button>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="question_65">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:utext="#{questions.block.amountAndInstallments}"></p>
        <div class="forms">
            <form action="" id="questionForm">
                <div class="field inline">
                    <select id="bank" data-width="245">
                        <option value="1">Banco</option>
                        <option value="2">CE</option>
                    </select>
                </div>
                <div class="field inline">
                    <input name="bankAccount" type="text" class="input-outline bankAccount-input"
                           placeholder="Nro. cuenta bancaria" pattern="[0-9]*"/>
                </div>
                <div class="clear"><br/></div>
                <div class="field inline">
                    <select id="bankAccountType" data-width="245">
                        <option value="1">Banco</option>
                        <option value="2">CE</option>
                    </select>
                </div>
                <div class="field inline">
                    <select id="bankAccountPlace" data-width="245">
                        <option value="1">Banco</option>
                        <option value="2">CE</option>
                    </select>
                </div>
                <div class="terms-block">
                    <label for="contract-check" class="custom-check">
                        <span class="check-inner">
                            <i class="icon icon-check"></i>
                        </span>
                        <span class="check-label" th:text="#{label.offer.contract}"></span>
                        <input type="checkbox" class="real-check" id="contract-check"/>
                    </label>
                    <br/>
                    <label for="terms-check" class="custom-check">
                        <span class="check-inner">
                            <i class="icon icon-check"></i>
                        </span>
                        <span class="check-label" th:utext="#{label.terms}"></span>
                        <input type="checkbox" class="real-check" id="terms-check"/>
                    </label>
                </div>
                <div class="actions-center">
                    <button type="button" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="errorContainer"></div>
            </form>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_62">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.block.awaiting}"></p>
        <div class="note" th:text="#{loanOffer.waitingApprovalDetail}"></div>
        <div class="note">
            ¬øQuieres aprender m&aacute;s de finanzas? <br/>Visita nuestro blog <a th:href="@{/blog}"
                                                                                  class="text-lightblue">aqu√≠</a>.
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_70">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.whatForCredit}"></p>
        <div class="note">
            <span th:text="#{questions.compare.willFoundForYou}"></span>
        </div>
        <div class="field inline">
            <label class="input-radio"
                   th:with="comparisonGroupId = ${T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_CREDIT_HISTORY}">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${comparisonGroupId}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon icon-document-dollar"></i>
                        <h5 th:utext="${@catalogService.getComparisonReasonsByGroupId(comparisonGroupId, #locale).get(0).reason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
        <div class="field inline">
            <label class="input-radio"
                   th:with="comparisonGroupId = ${T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_BETTER_CARD}">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${comparisonGroupId}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon icon-credit-billiant"></i>
                        <h5 th:utext="${@catalogService.getComparisonReasonsByGroupId(comparisonGroupId, #locale).get(0).reason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
        <div class="field inline">
            <label class="input-radio"
                   th:with="comparisonGroupId = ${T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_LOAN}">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${comparisonGroupId}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon icon-money-bag"></i>
                        <h5 th:utext="${@catalogService.getComparisonReasonsByGroupId(comparisonGroupId, #locale).get(0).reason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
        <div class="field inline">
            <label class="input-radio"
                   th:with="comparisonGroupId = ${T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_URGENCY}">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${comparisonGroupId}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon icon-fast-time"></i>
                        <h5 th:utext="${@catalogService.getComparisonReasonsByGroupId(comparisonGroupId, #locale).get(0).reason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=reason]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    reason: $(this).val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_71">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.urgent}"></p>
        <div class="note">
            <span th:text="#{questions.compare.willHelpYou}"></span>
        </div>

        <div class="field inline"
             th:each="reason : ${@catalogService.getComparisonReasonsByGroupId(T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_URGENCY, #locale)}">
            <label class="input-radio">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${reason.id}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon" th:classappend="'icon-credit-' + ${reason.id}"></i>
                        <h5 th:text="${reason.subreason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=reason]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    reason: $(this).val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_72">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.whatForLoan}"></p>
        <div class="note">
            <span th:text="#{questions.compare.use}"></span>
        </div>
        <div class="owl-carousel" id="reason-carousel">
            <div class="field inline"
                 th:each="reason : ${@catalogService.getComparisonReasonsByGroupId(T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_LOAN, #locale)}">
                <label class="input-radio">
                    <input type="radio" class="howEarnMoney" name="reason" th:value="${reason.id}"/>
                    <div class="option-wrapper">
                        <div class="iconic-option-inner">
                            <i class="icon" th:classappend="'icon-reason-' + ${reason.id}"></i>
                            <h5 th:text="${reason.subreason}"></h5>
                            <div class="radio"></div>
                        </div>
                    </div>
                </label>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=reason]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    reason: $(this).val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_73">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.importance}"></p>
        <div class="note">
            <span th:text="#{questions.compare.mainForMe}"></span>
        </div>
        <div class="field inline"
             th:each="reason : ${@catalogService.getComparisonReasonsByGroupId(T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_BETTER_CARD, #locale)}">
            <label class="input-radio">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${reason.id}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon" th:classappend="'icon-main-' + ${reason.id}"></i>
                        <h5 th:text="${reason.subreason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=reason]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    reason: $(this).val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_74">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.beginScore}"></p>
        <div class="note">
            <span th:text="#{questions.compare.interestedOn}"></span>
        </div>
        <div class="field inline"
             th:each="reason : ${@catalogService.getComparisonReasonsByGroupId(T(com.affirm.common.model.catalog.ComparisonReason).REASON_GROUP_CREDIT_HISTORY, #locale)}">
            <label class="input-radio">
                <input type="radio" class="howEarnMoney" name="reason" th:value="${reason.id}"/>
                <div class="option-wrapper">
                    <div class="iconic-option-inner">
                        <i class="icon" th:classappend="'icon-reason-' + ${reason.id}"></i>
                        <h5 th:text="${reason.subreason}"></h5>
                        <div class="radio"></div>
                    </div>
                </div>
            </label>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $('input[name=reason]').on('change', function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    reason: $(this).val()
                }
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_75">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.salary}"></p>
        <div class="note">
            <span th:text="#{questions.compare.minIncome}"></span>
        </div>
        <form id="questionForm" th:object="${form}">
            <div class="field field-amount inline">
                <div class="wrap-field">
                    <div class="box-icon prefix-box tiny-input">
                        <span class="prefix">S/</span>
                    </div>
                    <input type="text" class="input-outline amount-input" th:field="*{income}"/>
                    <small class="input-help">Ingreso bruto</small>
                </div>
            </div>
            <div class="field inline">
                <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
            </div>
            <div class="errorContainer"></div>
        </form>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    button: $('#sendButton'),
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_76">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:if="${creditCardType != null}" th:text="#{questions.compare.creditLineYouNeed}"></p>
        <p th:if="${creditCardType == null}" th:text="#{questions.compare.moneyYouNeed}"></p>
        <form id="questionForm" th:object="${form}">
            <div class="field field-amount inline">
                <div class="wrap-field">
                    <div class="box-icon prefix-box tiny-input">
                        <span class="prefix">S/</span>
                    </div>
                    <input type="text" class="input-outline amount-input" th:field="*{amount}"/>
                    <small class="input-help">Monto a solicitar</small>
                </div>
            </div>
            <div class="field inline">
                <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
            </div>
            <div class="errorContainer"></div>
        </form>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    button: $('#sendButton'),
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_77">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="#{questions.compare.autoEvaluationTitle}"></p>
        <div class="note">
            <span th:utext="#{questions.compare.autoEvaluationNote}"></span>
        </div>
        <div class="forms">
            <form id="questionForm" th:object="${form}">
                <div class="field inline">
                    <select data-width="70" th:field="*{docType}">
                        <option value="1">DNI</option>
                        <option value="2">CE</option>
                    </select>
                </div>
                <div class="field inline">
                    <input type="text" class="input-outline document-input" th:field="*{docNumber}"/>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-lightblue"
                            th:text="#{button.selfEvaluation}"></button>
                </div>
                <div class="display-block">
                    <div class="errorContainer"></div>
                </div>
            </form>
        </div>
        <div class="block text-center">
            <hr class="or-divisor"/>
            <small><a id="skipButton" href="javascript:;" class="text-lightblue">Omitir</a></small>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        var docType = $('#docType');
        var docNumber = $('#docNumber');

        var firstOnChange = true;
        docType.on('change', function () {
            if (!firstOnChange) {
                docNumber.val('');
            } else {
                firstOnChange = false;
            }
            if ($(this).val() == 2) {
                $('#docNumber').removeClass('document-input').addClass('document-input-ce');
                $('#questionForm').data('validatorJson').rules.docNumber.maxlength = 9;
                $('')
            } else {
                $('#docNumber').removeClass('document-input-ce').addClass('document-input');
                $('#questionForm').data('validatorJson').rules.docNumber.maxlength = 8;
            }
            $('#questionForm').validateForm($('#questionForm').data('validatorJson'));
            $('#questionForm').data('validator').resetForm();
        });
        docType.change();

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    button: $('#sendButton'),
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });

        $('#skipButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST"
            }, "");
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_78">
    <th:block th:replace="this :: question_config"></th:block>
    <div id="assessment" style="display: none;height: 80vh;max-height: 90%;margin-top: 80px;position:relative;"></div>
    <div class="questions-section animated fadeInRight">
        <div class="iframe-content-container">
            <div class="row iframe-row">
                <div class="span12 iframe-span12" ng-controller="getTokenCtrl as token">
                    <div id="container" class="iframe-hero-unit hero-unit transparent text-center">
                        <div id="personal-loan">
                            <p data-l10n-id="personal">Tenemos el cr√©dito para ti</p>
                            <div class="note">
                                <p data-l10n-id="access">El financiador necesita conocer un poco m√°s acerca tuyo.</p>
                                <p data-l10n-id="interest">La siguiente serie de juegos le ayudar√° a conocerte mejor
                                    (puede demorar hasta 15 minutos). </p>
                                <p data-l10n-id="credit">¬øDe acuerdo?</p>
                            </div>
                            <div class="actions">
                                <button id="comeBack2" type="button" class="button bg-black">&iexcl;Regreso luego!
                                </button>
                                <button id="apply2Button" type="button" class="button bg-red">&iexcl;Estoy listo!
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            (function () {
                window.addEventListener('message', handlePostMessage, false);
            })();

            function reziseIframe(obj) {
                obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
            }

            var homeUrl = /*[[ ${T(com.affirm.system.configuration.Configuration).getClientDomain()} ]]*/null;
            var eflHostedPlayer = /*[[ ${@configuration.getEFLHostedPlayer(loanApplication.id)} ]]*/null;

            $('#comeBack2').on('click', function (e) {
                e.preventDefault();
                window.location.href = homeUrl;
            });

            $('#apply2Button').on('click', function () {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#apply2Button'),
                    type: "POST",
                    success: function (data) {
                        questionFw.showHideAgent(false);
                        var data = JSON.parse(data);
                        var sessionUid = data.uid;
                        $('#personal-loan').hide();
                        $('#assessment').show();
                        $('#container').addClass('with-iframe');
                        $('#assessment').append('<iframe src="' + eflHostedPlayer + "=" + b64EncodeUnicode(sessionUid) + '" height="100%" width="100%" style="border: 0;"></iframe>');
                        var containerHeight = parseInt($('#container').css('min-height'), 10);
                        $('#assessment iframe').css('min-height', containerHeight);
                        $('#assessment iframe').load(function () {
                            sendInitPostMessage();
                        });
                    }
                }, "");
            });

            function b64EncodeUnicode(str) {
                return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {
                    return String.fromCharCode('0x' + p1);
                }));
            }

            function sendInitPostMessage() {
                var iframeWindow = $('#assessment iframe')[0].contentWindow;
                sendPostMessage(iframeWindow, 'INIT_CONTAINER');
            }

            function sendPostMessage(window, type, data) {
                var domain = /*[[ ${T(com.affirm.system.configuration.Configuration).getEFLDomain()} ]]*/null;
                if (window !== undefined && type !== undefined) {
                    var eventData = {
                        type: type
                    };
                    if (data !== undefined) {
                        eventData.data = data;
                    }
                    window.postMessage(JSON.stringify(eventData), domain);
                }
            }

            function handlePostMessage(event) {
                if (event.data != undefined) {
                    var eventData = JSON.parse(event.data);
                    if (eventData.type != undefined) {
                        switch (eventData.type) {
                            case 'JOURNEY_END':
                                console.log('Call JOURNEY_END');
                                journeyFinished(eventData);
                                var eflId;
                                if (eventData.data) {
                                    eflId = eventData.data.eflId;
                                }
                                console.log('EFL ID: ' + eflId);
                                break;
                            case 'JOURNEY_STARTED':
                                var sessionUid;
                                if (eventData.data) {
                                    sessionUid = eventData.data.sessionUid;
                                }
                                console.log('Session Uid: ' + sessionUid);
                                break;
                            default:
                                break;
                        }
                    }
                }
            }

            function journeyFinished(eventData) {
                console.log('Call FINISHED TEST');
                $('#assessment').hide();
                $('#container').removeClass('with-iframe');
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    data: {info: eventData}
                }, "journeyFinished");
            }
            /*]]>*/
        </script>
        <th:block th:if="${canSkip != null and canSkip}">
            <div class="display-block">
                <a href="#" class="text-lightblue" id="skipButton">Omitir</a>
            </div>
            <script th:inline="javascript">
                /*<![CDATA[*/
                $('#skipButton').click(function () {
                    questionFw.ajaxToCurrentQuestionController({
                        type: "POST"
                    }, "skipped");
                });
                /*]]>*/
            </script>
        </th:block>
    </div>
</th:block>

<th:block th:fragment="question_80">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="'¬øCu√°ntos dependientes tienes?'"></p>
        <div class="forms">
            <form id="questionForm">
                <div class="field inline">
                    <select data-width="130" id="dependents" name="dependents">
                        <option value="0">Ninguno</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">M&aacute;s de 4</option>
                    </select>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
                <div class="display-block">
                    <div class="errorContainer"></div>
                </div>
            </form>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/

        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));


        var keytop = $('.keypress-top'),
            keydown = $('.keypress-down'),
            inputNumber = $('#dependents'),
            limit = [[${form.validator.dependents.maxValue}]];

        keytop.on('click', function (e) {
            e.preventDefault();
            var val = inputNumber.val();

            if( inputNumber.val() < limit ){
                inputNumber.val(parseInt(inputNumber.val()) + 1);
            }
        });

        keydown.on('click', function(e) {
            e.preventDefault();
            var val = inputNumber.val();
            if( inputNumber.val() > 0 ){
                inputNumber.val(parseInt(inputNumber.val()) - 1);
            }
        });
        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: {
                        dependents: inputNumber.val()
                    }
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_81">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="wrap-progressbar">
            <ul role="progressbar" aria-busy="true" aria-label="Loading domino shop" class="g-progressbar">
                <li role="presentation"></li>
                <li role="presentation"></li>
                <li role="presentation"></li>
                <li role="presentation"></li>
                <li role="presentation"></li>
                <li role="presentation"></li>
                <li role="presentation"></li>
            </ul>
            <p>Estamos revisando cu√°l es la mejor oferta de cr√©dito disponible para tu pr√≥ximo auto.<span> Esto puede demorar hasta 30 segundos...</span></p>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        sendPost();
        function sendPost() {
            questionFw.ajaxToCurrentQuestionController({
                type: "GET",
                showLoadingBar: false,
                success: function (data) {
                    if (data == null || data == '') {
                        setTimeout(function () {
                            sendPost();
                        }, 1000);
                    }else{
                        questionFw.replaceQuestionContent(data);
                        questionFw.refreshAmountAndInstallments();
                    }
                }
            }, "offers");
        }
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_81_offers">
    <div id="offer_car" class="questions-section animated fadeInRight">
        <div class="forms">
            <div class="offer-container wrap-offer-car">
                <ul class="owl-carousel" id="offer-carousel">
                    <li th:each="offer,iter : ${offers}" class="best-offer" th:attr="data-offer-id=${offer.id}"
                        th:classappend="${iter.index == 0 ? 'offer-red' : (iter.index == 1 ? 'offer-green' : 'offer-blue')}">
                        <div class="box-a">
                            <div class="bar-offer"></div>
                            <span class="bar-iso">
                                <img th:src="${loanApplication?.vehicle?.brand?.image}" alt=""/>
                            </span>
                            <a class="btn-download-credit" target="_blank" th:href="@{/__${@evaluationController.URL}__/question/81/certificadoPreaprobacion/__${offer.id}__(token=${token})}">
                                <i class="icons-s-download"></i>
                            </a>
                        </div>

                        <div class="box-b">
                            <div class="cnt-img">
                                <img th:src="${loanApplication?.vehicle?.vehicleDetails[0]?.image[0]}" alt=""/>
                            </div>
                            <div class="cnt-price">
                                <span class="amount" th:text="${@utilService.doubleMoneyFormat(offer?.installmentAmountAvg, offer?.currency?.symbol)}"></span>
                                <span class="month" th:text="${'/' + offer.installments + ' meses'}"></span>
                            </div>
                            <div class="cnt-prom">
                                <span class="month"> Monto de cr√©dito : </span>
                                <span th:text="${offer?.currency?.symbol + ' '}"></span>
                                <span class="month" th:text="${@utilService.integerOnlyMoney(offer?.ammount)}"></span>
                            </div>
                        </div>

                        <div class="box-c">
                            <ul class="offer-info">
                                <li>
                                    <p class="regular-text">
                                        <span>Couta inicial - </span>
                                        <span th:text="${offer?.downPaymentCurrency?.symbol}"></span>
                                        <span th:text="${@utilService.integerOnlyMoney(offer.downPayment)}"></span></p>
                                </li>
                                <li>
                                    <p class="small-text">
                                        <span>TEA </span>
                                        <span th:text="${@utilService.percentFormat(offer.effectiveAnualRate)}"></span>
                                    </p>
                                    <p class="small-text">
                                        <span>TCEA</span>
                                        <span th:text="${@utilService.percentFormat(offer.effectiveAnnualCostRate)}"></span>
                                    </p>
                                </li>
                            </ul>
                        </div>

                        <div class="box-d">
                            <div class="btn btn-offer calendar-button" th:attr="data-offer-order=${offer?.loanOfferOrder}">
                                <span class="circle-inner" >
                                    <i class="icon icon-calendar"></i>
                                    <small>Ver cronograma</small>
                                </span>
                            </div>
                            <span href="#" class="check icon icon-check"></span>
                        </div>
                    </li>
                </ul>
                <div class="wrap-sponsored">
                    <div class="sponsored-by">
                        <hr class="divisor-thin"/>
                        <div class="box-sponsor">
                            <small>Financiado por</small>
                            <img th:src="${offers?.get(0).entity.logoUrl}" alt=""/>
                            <small th:if="${entityProductParam.signatureType == entityProductParam.CONTRACT_TYPE_DIGITAL}"
                                   class="online" th:text="#{label.processType.online}"></small>
                            <small th:if="${entityProductParam.signatureType == entityProductParam.CONTRACT_TYPE_MANUAL}"
                                   class="online" th:text="#{label.processType.manual}"></small>
                        </div>
                    </div>
                    <div class="sponsored-by" th:if="${entityProductParam.offerLegalFooter != null}">
                        <small th:utext="${entityProductParam.getOfferLegalFooterReplaced(offers[0], @utilService)}"></small>
                    </div>
                    <div class="error" th:if="${false and downPayment > loanApplication?.downPayment}">
                        <p>La inicial debe ser de al menos de : <span th:text="${downPayment}"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:each="offer : ${offers}" th:id="'offerScheduleModal' + ${offer?.loanOfferOrder}" class="modal fade" tabindex='-1'>
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <h4 class="title-modal">Cronograma de pagos preliminar</h4>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>

                <div class="modal-middle">
                    <th:block
                            th:replace="fragments/modalScheduleFragment :: modalSchedule(laoanApplication=${loanAppplication}, offer=${offer}, person=${person})"></th:block>
                </div>
                <div class="actions text-center" style="padding: 0 0 1.5em 0">
                    <button type="button" class="button black-button"
                            data-dismiss="modal">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/

        $('.btn-download-credit').on('click', function (e) {
            e.stopPropagation();
        });

        $('.calendar-button').click(function (e) {
            e.stopPropagation();
            //debugger;
            $('#offerScheduleModal' + $(this).data('offer-order')).modal('show');
        });

        if ($('.offer-container').length) {
            $('.best-offer').click(function () {
                questionFw.ajaxToCurrentQuestionController({
                    type: "POST",
                    data: {
                        selectedOffer: $(this).data('offer-id')
                    },
                    success: function () {
                        questionFw.refreshQuestion();
                    }
                }, "");
            });
        }



        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_82">
    <th:block th:replace="this :: question_22"/>
</th:block>

<th:block th:fragment="question_83">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <p th:text="'&iquest;A qu&eacute; cuenta te enviamos tu dinero?'"></p>
        <div class="note">
            <span>(Recuerda que debes ser titular de la misma, caso contrario no podremos realizar la transferencia)</span>
        </div>
        <div class="forms">
            <form id="questionForm" th:object="${form}" autocomplete="off">

                <div class="field inline">
                    <small th:text="#{form.field.bank}" class="input-help"></small>
                    <select th:value="*{bankId}" name="bankId" id="bankId" data-placeholder="Selecciona el banco" data-width="220" >
                        <option value="" hidden="hidden"></option>
                        <th:block th:each="bank : ${@catalogService.getBanks(0, true)}">
                            <option value="" disabled="disabled" selected="selected"></option>
                            <option  th:value="${bank.id}" th:text="${bank.name}"></option>
                        </th:block>

                    </select>
                    <div class="errorContainer text-left"></div>
                </div>
                <div class="field inline">
                    <small th:text="#{form.field.bankAccountType}" class="input-help"></small>
                    <select th:value="*{bankAccountType}" name="bankAccountType" id="bankAccountType" data-placeholder="Seleccione el tipo de cuenta" data-width="230" >
                        <option value="" hidden="hidden" selected="selected" disabled="disabled"></option>
                        <option value="S" th:text="#{form.field.bankAccountType.saving}"></option>
                        <option value="C" th:text="#{form.field.bankAccountType.current}"></option>
                    </select>
                    <div class="errorContainer text-left"></div>
                </div>
                <div class="field"/>
                <div class="field inline">
                    <small th:text="#{form.field.bankAccountNumber}" class="input-help"></small>
                    <input type="text" th:value="*{bankAccountNumber}" name="bankAccountNumber" id="bankAccountNumber" class="input-outline" />
                    <div class="errorContainer text-left"></div>
                </div>
                <div class="field inline">
                    <small th:text="#{loanApplicationSignature.bankAccountDepartment}" class="input-help"></small>
                    <select th:value="*{bankAccountDepartment}" id="bankAccountDepartment" name="bankAccountDepartment" data-placeholder="Seleccione el lugar" data-width="250" >
                        <th:block th:each="department : ${@catalogService.getDepartments()}">
                            <option value="" hidden="hidden" disabled="disabled" selected="selected"></option>
                            <option th:value="${department.id}" th:text="${department.name}"></option>
                        </th:block>
                    </select>
                    <div class="errorContainer text-left"></div>
                </div>
                <div class="field">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>

            </form>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));


        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_86">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="process-loading-container" style="min-height:200px">
            <div id="loading-ajax" class="loading-red loading-content">
                <div class="sk-fading-circle">
                    <div class="sk-circle1 sk-circle"></div>
                    <div class="sk-circle2 sk-circle"></div>
                    <div class="sk-circle3 sk-circle"></div>
                    <div class="sk-circle4 sk-circle"></div>
                    <div class="sk-circle5 sk-circle"></div>
                    <div class="sk-circle6 sk-circle"></div>
                    <div class="sk-circle7 sk-circle"></div>
                    <div class="sk-circle8 sk-circle"></div>
                    <div class="sk-circle9 sk-circle"></div>
                    <div class="sk-circle10 sk-circle"></div>
                    <div class="sk-circle11 sk-circle"></div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        console.log('INIT i');
        window.io_global_object_name = "IGLOO"
        window.IGLOO = window.IGLOO || {
            "install_flash" : false,
            "bb_callback" : function (bb, complete ) {
                if ( complete ) {
                    sendBB( bb );
                }
            },
            "loader" : {
                "version" : "5.1.0",
                "tp_host" : /*[[${@userService.tpHost()}]]*/null
            }
        };
        var sent = false;
        function sendBB( bb ) {
            if (sent) return;
            var mybb = bb;
            if ( bb === undefined )
                try {
                    mybb = window["IGLOO"].getBlackbox().blackbox;
                } catch(e) { }
            sent = true;
            console.log( "Sending something...." + mybb);
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: {
                    ioBlackbox: mybb
                },
                success: function (data) {
                    console.log("I finished: " +  data );
                }
            }, "");
        }
        setTimeout(sendBB, 3000);
        /*]]>*/
    </script>
    <script th:src="@{__${static}__}"></script>
</th:block>

<th:block th:fragment="question_88">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms" id="date-block">
            <p>&iquest;Desde cu&aacute;ndo?</p>
            <div class="field inline">
                <input id="month" type="text" placeholder="mm" class="input-outline small-input" pattern="[0-9]*"/>
                <small class="input-help">Mes</small>

            </div>
            <div class="field inline">
                <input id="year" type="text" placeholder="yyyy" class="input-outline small-input" pattern="[0-9]{4}"/>
                <small class="input-help">A&ntilde;o</small>
            </div>
            <div class="field inline">
                <button id="sendButton" type="button" class="button bg-red" th:text="#{button.next}"></button>
            </div>
            <div class="display-block">
                <div class="errorContainer"></div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var yearFrom = /*[[${yearFrom}]]*/;
        var yearTo = /*[[${yearTo}]]*/;

        $('#month').forceIntegerOnly(true, 1, 12);
        $('#year').forceIntegerOnly(true, yearFrom, yearTo);

        $('#month').keyup(function (event) {
            if ($(this).val().length == 2) {
                $('#year').focus();
            }
        });

        $('#sendButton').click(function () {
            $('.errorContainer').html("");

            var month = $("#month").val();

            if(month.length < 2) month = "0" + month;

            var date = moment(month + "/" + $('#year').val(), "MM/YYYY", true);

            if (!date.isValid() || date.get('years') > yearTo || date.get('years') < yearFrom) {
                $('.errorContainer').html('<span class="help-block help-block-error">No es una fecha v&aacute;lida</span>');
            } else {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    error: function (xhr, data) {
                        if (data != null) {
                            $('.errorContainer').html('<span class="help-block help-block-error">' + data.message + '</span>');
                            return false;
                        }
                    },
                    data: {
                        activityType: $('input[name=activityType]:checked').val(),
                        startDate: date.format("MM/YYYY")
                    }
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_89">
    <th:block th:replace="this :: question_88"></th:block>
</th:block>

<th:block th:fragment="question_90">
    <th:block th:replace="this :: question_88"></th:block>
</th:block>

<th:block th:fragment="question_91">
    <th:block th:replace="this :: question_88"></th:block>
</th:block>

<th:block th:fragment="question_92">
    <th:block th:replace="this :: question_33"></th:block>
</th:block>

<th:block th:fragment="question_93">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="forms">
            <form id="questionForm" th:object="${form}" class="form">
                <p th:text="#{questions.block.joinWithEmail}"></p>
                <div class="field inline">
                    <input type="text" class="input-outline fullname-input" th:field="*{email}" autocorrect="off"
                           autocapitalize="none"/>
                </div>
                <div class="field inline">
                    <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
                </div>
            </form>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.validateForm($('#questionForm'), JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/));

        $('#sendButton').click(function () {
            if ($('#questionForm').valid()) {
                questionFw.ajaxToCurrentQuestionController({
                    button: $('#sendButton'),
                    type: "POST",
                    form: $('#questionForm'),
                    data: $('#questionForm').serializeObject()
                }, "");
            }
        });
        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_94">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight wrap-consolidation">
        <div class="forms">
            <p th:utext="#{static.question.title.94}"></p>
            <a id="noDebtsButton" href="#" class="btn-next">No tengo deudas</a>
            <ul class="list-consolidation-detail">
                <li class="item-consolidation-detail" th:each="debt : ${debts}" th:classappend="${debt.selected ? 'active':''}"
                    th:attr="data-debt-account-type=${debt.consolidationAccounttype},data-debt-entity-code=${debt.entity.code}">
                    <form>
                        <div class="w-logo">
                            <img th:if="${debt?.entity?.bank != null}" th:src="${debt?.entity?.bank?.logoUrl}"/>
                        </div>
                        <div class="w-amount">
                            <div class="w-title">
                                <strong th:text="${debt?.entity?.shortName}"></strong>
                                <small th:if="${debt.consolidationAccounttype == T(com.affirm.common.model.catalog.ConsolidationAccountType).CREDITO_CONSUMO}" class="text-lightblue">(Cr&eacute;dito personal)</small>
                                <small th:if="${debt.consolidationAccounttype == T(com.affirm.common.model.catalog.ConsolidationAccountType).TARJETA_CREDITO}" class="text-lightblue">(Tarjeta de cr&eacute;dito)</small>
                            </div>
                            <div class="field field-amount inline">
                                <small class="input-help">Saldo Pdte.</small>
                                <div class="wrap-field">
                                    <div class="box-icon prefix-box tiny-input">
                                        <span class="prefix" th:text="#{static.queston.currency}"></span>
                                    </div>
                                    <input type="text" class="input-outline amount-input" id="balance" name="balance" th:value="${debt.balance}" th:attr="data-previous=${debt.balance}"/>
                                </div>
                            </div>
                            <div class="field field-amount inline">
                                <small class="input-help">TEA</small>
                                <input type="text" class="input-outline tiny-input" id="rate" name="rate" th:value="${debt.rate}" th:attr="data-previous=${debt.rate}"/>
                            </div>
                            <div class="field field-amount inline" th:if="${debt.consolidationAccounttype != T(com.affirm.common.model.catalog.ConsolidationAccountType).TARJETA_CREDITO}">
                                <small class="input-help">Cuotas Pendientes</small>
                                <input type="text" class="input-outline tiny-input" id="installments" name="installments" th:value="${debt.installments}" th:attr="data-previous=${debt.installments}"/>
                            </div>
                            <div class="errorContainer"></div>
                        </div>
                        <div class="w-buttons ask-wrap">
                            <div class="ask-wrap">
                                <small id="askConsolidate" class="text-small" th:text="${debt.selected ? 'Consolidado':'¬øConsolidar?'}" th:classappend="${debt.selected ? 'active-consolidate':''}"></small>
                                <button type="button" class="btn-action button-small bg-red-3 tiny no-consolidate-button" th:classappend="${debt.selected ? 'btn-enabled':'btn-disabled'}" data-action="not"><i class="icon icon-close"></i></button>
                                <button type="button" class="btn-action button-small bg-lightblue tiny consolidate-button" th:classappend="${debt.selected ? 'btn-disabled':''}" data-action="yes"><i class="icon icon-check"></i></button>
                            </div>
                            <div class="last-info hidden" th:if="${debt.consolidationAccounttype == T(com.affirm.common.model.catalog.ConsolidationAccountType).TARJETA_CREDITO}">
                                <button class="close close-last-info close-button" type="button"><i class="icon icon-close"></i></button>
                                <div class="field">
                                    <input id="creditCardNumber" name="creditCardNumber" type="text" class="input-outline-small" placeholder="Nro. Tarjeta"
                                           th:value="${debt.accountCardNumber}"/>
                                </div>
                                <div class="field select2-small">
                                    <select id="creditCardBrand" name="creditCardBrand" data-width="200" data-placeholder="Marca">
                                        <option value="" disabled="disabled" selected="selected"></option>
                                        <option th:each="brand : ${@catalogService.getBrands()}"
                                                th:value="${brand.id}" th:text="${brand.name}" th:selected="${debt.brandId == brand.id}"></option>
                                    </select>
                                </div>
                                <div class="field select2-small">
                                    <select id="creditCardDepartment" name="creditCardDepartment" data-width="200" data-placeholder="Lugar de emisi&oacute;n">
                                        <option value="" disabled="disabled" selected="selected"></option>
                                        <option th:each="department : ${@catalogService.getDepartments()}"
                                                th:value="${department.id}" th:text="${department.name}" th:selected="${debt.departmentUbigeo == department.id}"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </li>
            </ul>
        </div>
        <div class="field inline confirm_button">
            <button type="button" id="sendButton" class="button bg-red" th:text="#{button.next}"></button>
        </div>
    </div>
    <hr class="divisor-bottom"/>
    <script th:inline="javascript">
        /*<![CDATA[*/

        $('li.item-consolidation-detail').each(function(){
            var validator = /*[[${form.validator.toJson(#locale)}]]*/;
            $(this).find('form').validateForm(createFormValidationJson(JSON.parse(validator), $(this).find('form')));

            $(this).find('input[name=balance]').blur(function(){
                if ($(this).data('previous') != null) {
                    if ($(this).data('previous') != $(this).val()) {
                        updateConsolidableDebt(
                            $(this).closest('li').data('debt-entity-code'),
                            $(this).closest('li').data('debt-account-type'),
                            $(this).val());
                        $(this).data('previous', $(this).val());
                    }
                } else {
                    updateConsolidableDebt(
                        $(this).closest('li').data('debt-entity-code'),
                        $(this).closest('li').data('debt-account-type'),
                        $(this).val());
                    $(this).data('previous', $(this).val());
                }

            });

            $(this).find('input[name=rate]').blur(function(){
                if ($(this).data('previous') != null) {
                    if ($(this).data('previous') != $(this).val()) {
                        updateConsolidableDebt(
                            $(this).closest('li').data('debt-entity-code'),
                            $(this).closest('li').data('debt-account-type'),
                            null, $(this).val());
                        $(this).data('previous', $(this).val());
                    }
                } else {
                    updateConsolidableDebt(
                        $(this).closest('li').data('debt-entity-code'),
                        $(this).closest('li').data('debt-account-type'),
                        null, $(this).val());
                    $(this).data('previous', $(this).val());
                }

            });
            $(this).find('input[name=installments]').blur(function(){
                if ($(this).data('previous') != null) {
                    if ($(this).data('previous') != $(this).val()) {
                        updateConsolidableDebt(
                            $(this).closest('li').data('debt-entity-code'),
                            $(this).closest('li').data('debt-account-type'),
                            null, null, $(this).val());
                        $(this).data('previous', $(this).val());
                    }
                } else {
                    updateConsolidableDebt(
                        $(this).closest('li').data('debt-entity-code'),
                        $(this).closest('li').data('debt-account-type'),
                        null, null, $(this).val());
                    $(this).data('previous', $(this).val());
                }
            });

            $(this).find('.no-consolidate-button').click(function(){
                var buttonClicked = $(this);
                if(!buttonClicked.hasClass('btn-disabled')) {
                    var thisSelf = $(this);
                    updateConsolidableDebt(
                        $(this).closest('li').data('debt-entity-code'),
                        $(this).closest('li').data('debt-account-type'),
                        null, null, null, false, null, null, null, function(){
                            paintSelectedDebt($(thisSelf).closest('li'), false)
                        });
                }

            });

            $(this).find('.consolidate-button').click(function(){
                var buttonClicked = $(this);
                if(!buttonClicked.hasClass('btn-disabled')) {
                    if ($(this).closest('.w-buttons').find('.last-info').length) {
                        $(this).closest('.ask-wrap').addClass('hidden');
                        $(this).closest('.w-buttons').find('.last-info').removeClass('hidden');
                        updateCreditCardDebtIfOk($(this).closest('li'));
                    }else {
                        var thisSelf = $(this);
                        updateConsolidableDebt(
                            $(this).closest('li').data('debt-entity-code'),
                            $(this).closest('li').data('debt-account-type'),
                            null, null, null, true, null, null, null, function(){
                                paintSelectedDebt($(thisSelf).closest('li'), true)
                            });

                    }
                }
            });

            $(this).find('input[name=creditCardNumber]').blur(function(){
                updateCreditCardDebtIfOk($(this).closest('li'));
            });
            $(this).find('select[name=creditCardBrand]').change(function(){
                updateCreditCardDebtIfOk($(this).closest('li'));
            });
            $(this).find('select[name=creditCardDepartment]').change(function(){
                updateCreditCardDebtIfOk($(this).closest('li'));
            });

            $(this).find('.close-last-info').on('click', function(e){
                $(this).closest('.last-info').addClass('hidden');
                $(this).closest('.w-buttons').find('.ask-wrap').removeClass('hidden');
            });

        });

        $('#sendButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                button: $(this)
            }, "");
        });

        $('#noDebtsButton').click(function () {
            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                button: $(this)
            }, "nodebts");
        });

        function updateConsolidableDebt(entityCode, consolidationAccountType, balance, rate, installments, consolidable,  creditCardNumber, creditCardBrand, creditCardDepartment, successFunc){
            var dataJson = {};
            if(balance != null)
                dataJson.balance = balance;
            if(rate != null)
                dataJson.rate = rate;
            if(installments != null)
                dataJson.installments = installments;
            if(consolidable != null)
                dataJson.consolidable = consolidable;
            if(creditCardNumber != null)
                dataJson.creditCardNumber = creditCardNumber;
            if(creditCardBrand != null)
                dataJson.creditCardBrand = creditCardBrand;
            if(creditCardDepartment != null)
                dataJson.creditCardDepartment = creditCardDepartment;

            questionFw.ajaxToCurrentQuestionController({
                type: "POST",
                data: $.extend(dataJson, {
                    entityCode: entityCode,
                    consolidationAccountType: consolidationAccountType
                }),
                success: function(){
                    if(successFunc != null) {
                        successFunc();
                    }
                }
            }, "updateConsolidableDebt");
        }

        function updateCreditCardDebtIfOk(element){
            var cardNum = element.find('input[name=creditCardNumber]').val();
            var cardBrand = element.find('select[name=creditCardBrand]').val();
            var cardDept = element.find('select[name=creditCardDepartment]').val();
            if(cardNum != '' && cardBrand != null && cardDept != null) {
                updateConsolidableDebt(
                    element.data('debt-entity-code'),
                    element.data('debt-account-type'),
                    null, null, null, true, cardNum, cardBrand, cardDept, function(){
                        paintSelectedDebt(element, true)
                        element.find('.last-info').addClass('hidden');
                        element.find('.ask-wrap').removeClass('hidden');
                    });
            }
        }

        function paintSelectedDebt(liElement, selected){
            if(selected){
                liElement.addClass('active');
                liElement.find('.no-consolidate-button').removeClass('btn-disabled').addClass('btn-enabled').prop('disabled', false);
                liElement.find('.consolidate-button').removeClass('btn-enabled').addClass('btn-disabled').prop('disabled', true);
                liElement.find('#askConsolidate').text('Consolidado').addClass('active-consolidate');
            }else{
                liElement.removeClass('active');
                liElement.find('.no-consolidate-button').removeClass('btn-enabled').addClass('btn-disabled').prop('disabled', true);
                liElement.find('.consolidate-button').removeClass('btn-enabled').removeClass('btn-disabled').prop('disabled', false);
                liElement.find('#askConsolidate').text('¬øConsolidar?').removeClass('active-consolidate');
            }
        }

        /*]]>*/
    </script>
</th:block>

<th:block th:fragment="question_95">
    <th:block th:replace="this :: question_config"></th:block>
    <div class="questions-section animated fadeInRight">
        <div class="process-loading-container" style="min-height:200px">
            <div id="loading-ajax" class="loading-red loading-content">
                <div class="sk-fading-circle">
                    <div class="sk-circle1 sk-circle"></div>
                    <div class="sk-circle2 sk-circle"></div>
                    <div class="sk-circle3 sk-circle"></div>
                    <div class="sk-circle4 sk-circle"></div>
                    <div class="sk-circle5 sk-circle"></div>
                    <div class="sk-circle6 sk-circle"></div>
                    <div class="sk-circle7 sk-circle"></div>
                    <div class="sk-circle8 sk-circle"></div>
                    <div class="sk-circle9 sk-circle"></div>
                    <div class="sk-circle10 sk-circle"></div>
                    <div class="sk-circle11 sk-circle"></div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        questionFw.ajaxToCurrentQuestionController({
            type: "POST"
        }, "");
        /*]]>*/
    </script>
</th:block>

</body>
</html>