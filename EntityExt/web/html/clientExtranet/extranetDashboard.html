<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/extranetTemplate">
<head>

    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>

    <!--Drop Zone-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}"
          rel="stylesheet"/>

    <!--Ekko Lightbox For Images-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}"
          rel="stylesheet"/>

    <!-- CounterUp -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.waypoints.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.counterup.min.js'}"
            type="text/javascript"></script>

    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet"
          type="text/css"/>


    <!-- Swipebox -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}"
          rel="stylesheet"/>

    <!-- Owl. Carousel -->
    <link rel="stylesheet"
          th:href="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.js'}"></script>

    <!-- Flot -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.resize.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.categories.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.pie.min.js'}"
            type="text/javascript"></script>

    <script th:inline="javascript">
        Dropzone.autoDiscover = false;
    </script>

    <script>
        $(document).ready(function () {

            $(".account").click(function () {

                var X = $(this).attr('id');
                if (X == 1) {
                    $(".s-menu").hide();
                    $(this).attr('id', '0');
                } else {
                    $(".s-menu").show();
                    $(this).attr('id', '1');
                }
            });

            $(".s-menu").mouseup(function () {
                return false
            });

            $(".account").mouseup(function () {
                return false
            });

            $(document).mouseup(function () {
                $(".s-menu").hide();
                $(".account").attr('id', '');
            });

            var sizeDocuments = $('.image-box').length;

            switch (sizeDocuments) {
                case 1:
                    $('.image-box').addClass('col-lg-12');
                    break;
                case 2:
                    $('.image-box').addClass('col-lg-6 col-md-6 col-sm-12');
                    break;
                case 3:
                    $('.image-box').addClass('col-lg-4 col-md-4 col-sm-12');
                    break;
                default:
                    $('.image-box').addClass('col-lg-4 col-md-4 col-sm-12');
                    break;
            }

            $('.counter').counterUp({
                delay: 10,
                time: 1000
            });

        });
    </script>
    <script th:inline="javascript"
            th:if="${loanApplication != null and loanApplication?.status?.id == T(com.affirm.common.model.catalog.LoanApplicationStatus).WAITING_APPROVAL}">
        /*<![CDATA[*/
        var uploadedSuccess = false;
        function openUploadUserFileModal(userFileType) {
            uploadedSuccess = false;
            var url = /*[[ @{/file/userFile} ]]*/;
            var userId = /*[[ ${loanApplication?.userId} ]]*/;
            $("#uploadUserFile").dropzone({
                url: url,
                params: {userId: userId, userFileType: userFileType},
                paramName: 'file',
                maxFilesize: 2, // MB
                maxFiles: 5,
                dictDefaultMessage: 'Arrastra una imagen aqu&iacute; para subirla, o haz click para seleccionar una.',
                acceptedFiles: 'image/*',
                headers: addCsrfToJsonHeaders({
                    'x-request-sender-type': 'ajax'
                }),
                init: function () {
                    this.on("success", function () {
                        debugger;
                        uploadedSuccess = true;
                        closeUploadUserFileModal();
                    });
                }
            });

            $('#uploadUserFileModal').modal({
                backdrop: 'static',
                keyboard: false
            });
        }

        function closeUploadUserFileModal() {
            $('#uploadUserFileModal').modal('hide');
            Dropzone.forElement("div#uploadUserFile").destroy()
            if (uploadedSuccess) {
                var baseUrl = /*[[ @{/extranet/dashboard/documentation/panel} ]]*/;
                $('#docSection').load(baseUrl + ' #docSection > *', function () {
                    initializeUserFileSection();
                });
            }
        }

        function initializeUserFileSection() {
            debugger;
            $('#docSection').find('.fileImage').click(function () {
                $(this).ekkoLightbox();
            });
        }
        /*]]>*/
    </script>
</head>
<body>
<th:block layout:fragment="header">
    <th:block th:replace="fragments/headers :: dashboardHeader "></th:block>
    <!-- BEGIN HEADER & CONTENT DIVIDER -->
    <div class="clearfix"></div>
    <!-- END HEADER & CONTENT DIVIDER -->
</th:block>

<th:block layout:fragment="content">

    <!-- Sidebar -->
    <th:block th:replace="fragments/extranetSidebarFragments :: extranetSidebar(currentPage='dashboard')"></th:block>
    <!-- / Sidebar -->

    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                     th:if="${loanApplication != null and (loanApplication.status.id == T(com.affirm.common.model.catalog.LoanApplicationStatus).PRE_EVAL_APPROVED or loanApplication.status.id == T(com.affirm.common.model.catalog.LoanApplicationStatus).EVAL_APPROVED)}">
                    <div class="note note-success">
                        <h4 class="block">Finaliza tu solicitud de cr&eacute;dito para <span
                                th:text="${loanApplication.reason.mailingReplacement2}"></span> haciendo click <a
                                target="_blank"
                                rel="noopener noreferrer"
                                th:href="${@utilService.createLoanApplicationClientUrl(loanApplication?.userId, loanApplication?.id, loanApplication?.personId)}"
                                class="btn btn-outline red">aqu&iacute;</a></h4>
                    </div>
                </div>
            </div>
            <!-- / Notification -->

            <!-- Notification -->
            <div class="row" th:if="${loanApplication != null}">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                     th:if="${loanApplication.status.id == T(com.affirm.common.model.catalog.LoanApplicationStatus).APPROVED}">
                    <div class="note note-success">
                        <h4 class="block">Est&aacute;s a un paso de <span
                                th:text="${loanApplication.reason.mailingReplacement2}"/>,
                            firma tu solicitud de cr&eacute;dito digitalmente haciendo click <a rel="noopener noreferrer" target="_blank"
                                                                                                th:href="${@utilService.createLoanApplicationClientUrl(loanApplication?.userId, loanApplication?.id, loanApplication?.personId)}"
                                                                                                class="btn btn-outline red">aqu&iacute;</a>.
                        </h4>
                    </div>
                </div>
            </div>
            <!-- / Notification -->

            <!-- Top summary -->
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-green-sharp">
                                    <span data-counter="counterup"
                                          th:attr="data-value=${activeLoanApplicationSize > 0 ? activeLoanApplicationSize : 0}">0</span>
                                </h3>
                                <small>Solicitudes vigentes <a th:href="@{/client/mis-solicitudes}"
                                                               class="font-green-sharp">Detalles</a></small>
                            </div>
                            <div class="icon">
                                <i class="icon-pie-chart"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-red-haze">
                                    <span data-counter="counterup"
                                          th:attr="data-value=${activeCreditSize > 0 ? activeCreditSize : 0}">0</span>
                                </h3>
                                <small>Cr&eacute;ditos vigentes <a th:href="@{/client/mis-creditos}" class="font-red-haze">Detalles</a>
                                </small>
                            </div>
                            <div class="icon">
                                <i class="icon-like"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12" th:if="${totalPendingAmount != null}">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-blue-sharp">
                                    <small class="font-blue-sharp">S/</small>
                                    <span data-counter="counterup"
                                          th:attr="data-value=${@utilService.doubleFormat(totalPendingAmount)}"></span>
                                </h3>
                                <small>Monto pendiente</small>
                            </div>
                            <div class="icon">
                                <i class="icon-basket"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12" th:if="false">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-purple-soft">
                                    <span data-counter="counterup" data-value="276">276</span>
                                </h3>
                                <small>Cliente Optimo</small>
                            </div>
                            <div class="icon">
                                <i class="icon-user"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- / Top summary -->
        </div>
        <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
    <div id="uploadUserFileModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div id="uploadUserFile" class="dropzone"></div>
                    <br/>
                    <div class="actions">
                        <button type="button" class="button black-button" onclick="closeUploadUserFileModal()">
                            Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).on('ready', function () {
            $('.swipebox-video').swipebox();
            $('.info-payment').owlCarousel({
                items: 3,
                navigation: true,
                navigationText: ['<i class="icon control-prev-icon"></i>', '<i class="icon control-next-icon"></i>'],
                responsive: true,
                itemsDesktop: [1199, 3],
                itemsDesktopSmall: [979, 2],  //As above.
                itemsTablet: [768, 1],  //As above.
                itemsMobile: [479, 1]  //As above
            });
        });
        /*]]>*/
    </script>
</th:block>

<th:block layout:fragment="footer">
    <th:block th:replace="fragments/footers :: footerDefault"></th:block>
</th:block>

</body>
</html>