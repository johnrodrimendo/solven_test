<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorator="templates/extranetTemplate(sidebarClosed=true)"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}">
    </script>
    <script
        th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}">
    </script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}"
        rel="stylesheet" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}">
    </script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}"
        rel="stylesheet" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.waypoints.min.js'}"
        type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.counterup.min.js'}"
        type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet"
        type="text/css" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}"
        rel="stylesheet" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.min.js'}"
        type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.resize.min.js'}"
        type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.categories.min.js'}"
        type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.pie.min.js'}"
        type="text/javascript"></script>
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/css/bootstrap-datepicker3.min.css'}" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/js/bootstrap-datepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/locales/bootstrap-datepicker.es.min.js'}"></script>

    <style>

        #noteFragment .dataTables_wrapper .dataTables_processing{
            margin-left: 0px !important;
            margin-top: 0px !important;
        }
        #tableNote{
            table-layout: fixed;
            word-wrap: break-word;
        }

        .dataTable th:first-child, .dataTable td:first-child{
            text-align: center;
        }

        .dataTable th, .dataTable td{
            height: 33px !important;
        }
        .modal-content .dropdown-toggle.btn-default {
            margin-top: 0px;
        }

        .all-trapezoid-container{
            width : 80%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: auto;
            margin-right: auto;
        }

        .trapezoid-container{
            display : flex;
            flex-direction: row;
            justify-content: center;
            margin-bottom: 0.5rem;
        }

        .right-trapezoid{
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 50px 1rem 0 0;
        }

        .left-trapezoid{
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 1rem 50px 0;
        }

        .center-trapezoid{
            width: 90%;
            height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .trapezoid-1{
            width : 100%;
        }

        .trapezoid-2{
            width : calc(100% - 2.5rem);
        }

        .trapezoid-3{
            width : calc(100% - 5rem);
        }

        .trapezoid-4{
            width : calc(100% - 7.5rem);
        }

        .trapezoid-5{
            width : calc(100% - 10rem);
        }

        .trapezoid-6{
            width : calc(100% - 12.5rem);
        }

        .trapezoid-7{
            width : calc(100% - 15rem);
        }

        .trapezoid-8{
            width : calc(100% - 17.5rem);
        }

        .trapezoid-9{
            width : calc(100% - 20rem);
        }

        .trapezoid-10{
            width : calc(100% - 22.5rem);
        }

        .trapezoid-11{
            width : calc(100% - 25rem);
        }

        .trapezoid-12{
            width : calc(100% - 27.5rem);
        }

        .trapezoid-13{
            width : calc(100% - 30rem);
        }

        .trapezoid-14{
            width : calc(100% - 32.5rem);
        }

        .trapezoid-15{
            width : calc(100% - 35rem);
        }

        .center-trapezoid > h4, .center-trapezoid > h5{
            margin: 0px;
            color: white;
            text-align: center;
        }


        .inactive-trapezoid > .right-trapezoid{
            border-color: #d9d8d8 transparent transparent transparent !important;
        }

        .inactive-trapezoid > .center-trapezoid{
            background-color: #d9d8d8 !important;
        }

        .inactive-trapezoid > .left-trapezoid{
            border-color: transparent #d9d8d8 transparent !important;
        }

        div.trapezoid-1 > .right-trapezoid{
            border-color: var(--primary-color-funnel-0) transparent transparent transparent;
        }

        div.trapezoid-1 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-0) transparent;
        }

        div.trapezoid-1 > .center-trapezoid{
            background-color: var(--primary-color-funnel-0);
        }

        div.trapezoid-2 > .right-trapezoid{
            border-color: var(--primary-color-funnel-1) transparent transparent transparent;
        }

        div.trapezoid-2 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-1) transparent;
        }

        div.trapezoid-2 > .center-trapezoid{
            background-color: var(--primary-color-funnel-1);
        }

        div.trapezoid-3 > .right-trapezoid{
            border-color: var(--primary-color-funnel-2) transparent transparent transparent;
        }

        div.trapezoid-3 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-2) transparent;
        }

        div.trapezoid-3 > .center-trapezoid{
            background-color: var(--primary-color-funnel-2);
        }

        div.trapezoid-4 > .right-trapezoid{
            border-color: var(--primary-color-funnel-3) transparent transparent transparent;
        }

        div.trapezoid-4 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-3) transparent;
        }

        div.trapezoid-4 > .center-trapezoid{
            background-color: var(--primary-color-funnel-3);
        }


        div.trapezoid-5 > .right-trapezoid{
            border-color: var(--primary-color-funnel-4) transparent transparent transparent;
        }

        div.trapezoid-5 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-4) transparent;
        }

        div.trapezoid-5 > .center-trapezoid{
            background-color: var(--primary-color-funnel-4);
        }

        div.trapezoid-6 > .right-trapezoid{
            border-color: var(--primary-color-funnel-5) transparent transparent transparent;
        }

        div.trapezoid-6 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-5) transparent;
        }

        div.trapezoid-6 > .center-trapezoid{
            background-color: var(--primary-color-funnel-5);
        }

        div.trapezoid-7 > .right-trapezoid{
            border-color: var(--primary-color-funnel-6) transparent transparent transparent;
        }

        div.trapezoid-7 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-6) transparent;
        }

        div.trapezoid-7 > .center-trapezoid{
            background-color: var(--primary-color-funnel-6);
        }

        div.trapezoid-8 > .right-trapezoid{
            border-color: var(--primary-color-funnel-7) transparent transparent transparent;
        }

        div.trapezoid-8 > .left-trapezoid{
            border-color: transparent var(--primary-color-funnel-7) transparent;
        }

        div.trapezoid-8 > .center-trapezoid{
            background-color: var(--primary-color-funnel-7);
        }

        div.trapezoid-9 > .right-trapezoid{
                 border-color: var(--primary-color-funnel-8) transparent transparent transparent;
             }

        div.trapezoid-9 > .left-trapezoid{
                 border-color: transparent var(--primary-color-funnel-8) transparent;
             }

        div.trapezoid-9 > .center-trapezoid{
                 background-color: var(--primary-color-funnel-8);
             }

        div.trapezoid-10 > .right-trapezoid{
                 border-color: var(--primary-color-funnel-9) transparent transparent transparent;
             }

        div.trapezoid-10 > .left-trapezoid{
                 border-color: transparent var(--primary-color-funnel-9) transparent;
             }

        div.trapezoid-10 > .center-trapezoid{
                 background-color: var(--primary-color-funnel-9);
             }

        div.trapezoid-11 > .right-trapezoid{
                  border-color: var(--primary-color-funnel-10) transparent transparent transparent;
              }

        div.trapezoid-11 > .left-trapezoid{
                  border-color: transparent var(--primary-color-funnel-10) transparent;
              }

        div.trapezoid-11 > .center-trapezoid{
                  background-color: var(--primary-color-funnel-10);
              }

        div.trapezoid-12 > .right-trapezoid{
                  border-color: var(--primary-color-funnel-11) transparent transparent transparent;
              }

        div.trapezoid-12 > .left-trapezoid{
                  border-color: transparent var(--primary-color-funnel-11) transparent;
              }

        div.trapezoid-12 > .center-trapezoid{
                  background-color: var(--primary-color-funnel-11);
              }

        div.trapezoid-13 > .right-trapezoid{
                  border-color: var(--primary-color-funnel-12) transparent transparent transparent;
              }

        div.trapezoid-13 > .left-trapezoid{
                  border-color: transparent var(--primary-color-funnel-12) transparent;
              }

        div.trapezoid-13 > .center-trapezoid{
                  background-color: var(--primary-color-funnel-12);
              }

        .row-filter-group  div.form-group {
            padding: 0px;
        }

        .row-filter-group-button{
            display: flex;
            align-items: flex-end;
        }

        .row-filter{
            display: flex;
            flex-direction: row;
            width: 100%;
            padding: 1rem 1rem;
            align-items: flex-end;
            justify-content: flex-start;
        }

        .row-filter > div{
            padding: 0rem 1rem;
        }

        .col-div-3{
            width: 22%;
            max-width: 22%;
            padding-right: 2px;
        }

        .col-div-2{
            width: 18%;
            max-width: 18%;
            padding-right: 2px;
        }

        .jc-sb{
            justify-content: space-between;
        }

        .col-div-1-5{
            width: 14%;
            max-width: 14%;
            padding-right: 2px;
        }

        .col-div-1{
            width: 10%;
            max-width: 10%;
            min-width: 10%;
            padding-right: 2px;
        }

        .row-flex{
            display: flex;
            flex-direction: row;
            width: 100%;
        }

        .row-column{
            display: flex;
            flex-direction: column;
            width: 100%;
        }


        .bootstrap-select button.dropdown-toggle{
            height: 100%;
        }

        .spinner-border {
            display: inline-block;
            width: 17px;
            height: 17px;
            vertical-align: text-bottom;
            border: .25em solid white;
            border-right-color: white;
            border-right-color: transparent;
            border-radius: 50%;
            -webkit-animation: spinner-border .75s linear infinite;
            animation: spinner-border .75s linear infinite;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        @-webkit-keyframes spinner-border {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spinner-border {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


    /*    Select2*/

        .select2-container{
            height: 40px !important;
        }

        .select2-selection--multiple{
            position: relative;
            height: 40px !important;
            display: flex;
            padding: 0px 5px !important;
            border-radius: 6px !important;
            border-color: #c2cad8 !important;
            transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s, -webkit-box-shadow ease-in-out 0.15s;
        }

        .select2-container .select2-dropdown .select2-results .select2-results__options .select2-results__option--highlighted{
            color: black;
        }

        .select2-search--inline{
            display: none;
        }

        .invalid-select2{
            border: 1px solid #d54c4c !important;
        }

        .errorContainer{
            position: absolute;
            font-size: 9px;
            color: red;
            display: none;
        }

        button#filterBtn > div.loading-ajax-visible {
            max-height: 17px;
            max-width: 17px;
            margin-left: 0rem;
        }

        #loader-container .circle-progress-question{
            background-color: transparent;
        }

        #loader-container{
            margin-bottom: 10px;
        }
    </style>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var
            primaryColorFunnel = /*[[${@brandingService.getEntityBrandingPrimaryColor(#httpServletRequest, '#094e9c')}]]*/ ;
        function hexToRGB(hex, alpha) {
            var r = parseInt(hex.slice(1, 3), 16),
                g = parseInt(hex.slice(3, 5), 16),
                b = parseInt(hex.slice(5, 7), 16);

            if (alpha) {
                return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
            } else {
                return "rgb(" + r + ", " + g + ", " + b + ")";
            }
        }

        function setFunnelConfiguration(funnelConfiguration){
            let totalToDivide = (funnelConfiguration != null && funnelConfiguration.steps != null) ? funnelConfiguration.steps.length : 8;
            let percentageToDivide =  0.7  / totalToDivide;
            $("#funnelCss").remove();
            let styleBrandingFunnel = document.createElement('style');
            styleBrandingFunnel.type = 'text/css';
            styleBrandingFunnel.id = "funnelCss";
            for (let i = 0; i <= 12; i++) {
                if(i == 0 ) styleBrandingFunnel.innerHTML = `:root{\n`;
                if(funnelConfiguration != null &&
                    funnelConfiguration.steps != null &&
                    Array.isArray(funnelConfiguration.steps) &&
                    funnelConfiguration.steps[i] &&
                    funnelConfiguration.steps[i].color
                ) styleBrandingFunnel.innerHTML += `--primary-color-funnel-${i} : ${funnelConfiguration.steps[i].color}; \n`
                else styleBrandingFunnel.innerHTML += `--primary-color-funnel-${i} : ${hexToRGB(primaryColorFunnel, 1-(((i > 9 ? (9+(i*0.1)) : i)+1)*percentageToDivide))}; \n`
                if(i == 12 ) styleBrandingFunnel.innerHTML += `}\n`;
            }
            document.getElementsByTagName('head')[0].appendChild(styleBrandingFunnel);
        }

        var maxDays = [[${maxDays}]];

        function getFormData(){

            let requestData = $('#formContainer').serializeObject();

            if(requestData.entityProductParam){
                if(!Array.isArray(requestData.entityProductParam)) {
                    if(!requestData.entityProductParam.length) requestData.entityProductParam = [];
                    else requestData.entityProductParam = [requestData.entityProductParam]
                }
                requestData.entityProductParam = JSON.stringify(requestData.entityProductParam.filter(x => x != -1));
            }

            if(requestData.utmSource){
                if(!Array.isArray(requestData.utmSource)) {
                    if(!requestData.utmSource.length) requestData.utmSource = [];
                    else requestData.utmSource = [requestData.utmSource]
                }
                requestData.utmSource = JSON.stringify(requestData.utmSource.filter(x => x != -1));
            }

            if(requestData.utmMedium){
                if(!Array.isArray(requestData.utmMedium)) {
                    if(!requestData.utmMedium.length) requestData.utmSource = [];
                    else requestData.utmMedium = [requestData.utmMedium]
                }
                requestData.utmMedium = JSON.stringify(requestData.utmMedium.filter(x => x != -1));
            }

            if(requestData.utmCampaign){
                if(!Array.isArray(requestData.utmCampaign)) {
                    if(!requestData.utmCampaign.length) requestData.utmSource = [];
                    else requestData.utmCampaign = [requestData.utmCampaign]
                }
                requestData.utmCampaign = JSON.stringify(requestData.utmCampaign.filter(x => x != -1));
            }

            if(requestData.utmContent){
                if(!Array.isArray(requestData.utmContent)) {
                    if(!requestData.utmContent.length) requestData.utmSource = [];
                    else requestData.utmContent = [requestData.utmContent]
                }
                requestData.utmContent = JSON.stringify(requestData.utmContent.filter(x => x != -1));
            }

            return requestData;
        }

        $(document).ready(function (){
            $('#creationFromFilter').datepicker({
                autoclose: true,
                format: "dd/mm/yyyy",
                focusOnShow: true,
                endDate: "today"
            });
            $('#creationToFilter').datepicker({
                autoclose: true,
                format: "dd/mm/yyyy",
                focusOnShow: true,
                endDate: "today"
            });
            $('#creationFromFilterPeriod2').datepicker({
                autoclose: true,
                format: "dd/mm/yyyy",
                focusOnShow: true,
                endDate: "today"
            });
            $('#creationToFilterPeriod2').datepicker({
                autoclose: true,
                format: "dd/mm/yyyy",
                focusOnShow: true,
                endDate: "today"
            });

            $('#analysis').on('change', function () {
                $("input[name='analysis']").val($(this).val());
                if($(this).val() == "period"){
                    $(".date-filter-period-2").show();
                    $("#firstDateFilteLabel").text("Fecha 1");
                }
                else if($(this).val() == "champion"){
                    $(".date-filter-period-2").hide();
                    $("#firstDateFilteLabel").text("Fecha");
                }
            })

            function convertDateToFormat(date, format){
                if(!date || !format) return null;
                let momentDate = moment(date);
                if(momentDate.isValid()) return momentDate.format(format);
                return date;
            }

            $('#creationFromFilter').on('change', function () {
                let date = $('#creationFromFilter').datepicker('getDate');
                date.setDate(date.getDate() + maxDays);
                if(date > new Date()) date = new Date();
                let dateToCompare = $('#creationToFilter').datepicker('getDate');
                $('#creationToFilter').datepicker('setStartDate', $('#creationFromFilter').val());
                $('#creationToFilter').datepicker('setEndDate', date);
                $('#creationToFilter').datepicker('setMaxDate', date);
                if(dateToCompare != null){
                    if(dateToCompare > date) $('#creationToFilter').datepicker('setDate', convertDateToFormat(date, 'DD/MM/YYYY'));
                }
            });
            $('#creationFromFilterPeriod2').on('change', function () {
                let date = $('#creationFromFilterPeriod2').datepicker('getDate');
                date.setDate(date.getDate() + maxDays);
                if(date > new Date()) date = new Date();
                let dateToCompare = $('#creationToFilterPeriod2').datepicker('getDate');
                $('#creationToFilterPeriod2').datepicker('setStartDate', $('#creationFromFilterPeriod2').val());
                $('#creationToFilterPeriod2').datepicker('setEndDate', date);
                $('#creationToFilterPeriod2').datepicker('setMaxDate', date);
                if(dateToCompare != null){
                    if(dateToCompare > date) $('#creationToFilterPeriod2').datepicker('setDate', convertDateToFormat(date, 'DD/MM/YYYY'));
                }
            });



            $(document.body).on("change","#product-selector",function(){
                let requestData = getFormData();
                if(!requestData.producto){
                    $(".errorContainer").css("display","block");
                }
                else{
                    $(".errorContainer").css("display","none");
                }
            });

            $('#filterBtn').click(function(e){
                e.preventDefault();
                let requestData = getFormData();
                if(!requestData.producto){
                    $(".errorContainer").css("display","block");
                    $(".select2-selection--multiple").addClass("invalid");
                    return;
                }
                $("#loader-container").show();
                $("#reportDataContainer").hide();
                var self = $(this);
                // self.find(".spinner-border").show();
                defaultAjax({
                    url: /*[[ @{/funnelv3/list} ]]*/,
                    type: 'POST',
                    data: requestData,
                    success: function (data) {
                        // self.find(".spinner-border").show();
                        $("#loader-container").hide();
                        $('#reportDataContainer').html(data);
                        $("#reportDataContainer").show();
                    },
                    error: function(){
                        // self.find(".spinner-border").hide();
                        $("#loader-container").hide();
                    }
                });
            });

            $('#analysis').change();


            let todayDate = new Date();
            todayDate.setDate(todayDate.getDate() - maxDays);
            $('#creationFromFilter').datepicker('setDate', todayDate);
            $('#creationFromFilter').change();
            $('#creationToFilter').datepicker('setDate', convertDateToFormat(new Date(), 'DD/MM/YYYY'));
            let toFilterDate = new Date(todayDate.getTime());
            toFilterDate.setDate(toFilterDate.getDate() - maxDays);
            $('#creationFromFilterPeriod2').datepicker('setDate', toFilterDate);
            $('#creationFromFilterPeriod2').change();
            $('#creationToFilterPeriod2').datepicker('setDate', convertDateToFormat(todayDate, 'DD/MM/YYYY'));


            $('#product-selector').selectpicker();
            $('#entity-product-selector').selectpicker({
                noneSelectedText: 'Todos'
            });
            $('#analisis').selectpicker();
            $('#edad').selectpicker();
            $('#medio').selectpicker();
            $('#tipoPlastico').selectpicker();
            $('#base').selectpicker();
            //
            // $(".select2-selection--multiple").css("cssText", "height: 40px !important");
            //
            // $(".select2-selection__rendered").css("cssText", "overflow-y: auto !important;height: 35px !important");

            $('select').on('select2:opening select2:closing', function( event ) {
                var $searchfield = $(this).parent().find('.select2-search__field');
                $searchfield.prop('disabled', true);
                $searchfield.attr('inputmode','none')
            });

           setTimeout(()=>{
               $('#filterBtn').click();
           },1000)
        });

        function exportToExcel(){
            let requestData = getFormData();

            defaultAjax({
                url: /*[[@{/funnelv3/report/export}]]*/null,
                type: 'POST',
                data: requestData,
                success: function (data) {
                    swal({
                        title: "¡Operación exitosa!",
                        text: "Solicitud de generación de reporte",
                        type: "success"
                    });
                }, error: function(data) {
                    // btnGenerateReport.unloading();
                }
            });
        }

        function reloadResultsLoansLightList() {
            defaultAjax({
                url: /*[[@{/funnelv3/report/list}]]*/,
                type: 'POST',
                showLoading: false,
                success: function (data) {
                    $('#loansLightResultTable').html(data);
                },
                error: function(data){
                    return false;
                }
            });
            setTimeout(reloadResultsLoansLightList, 5000);
        }

        setTimeout(reloadResultsLoansLightList, 5000);
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function (){
            $("#createNote").click(function (e){
                clearExtranetNoteForm();
                $('#noteForm').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            })
            setEventDetail();

        });

        function setEventDetail(){
            $(".open-detail-note").click(function(e){
                let data = JSON.parse($(e.delegateTarget).attr("data"));
                renderDetail(data);
            })
        }
        function createNewNote(note, type, id){
            $("#createNoteSubmit").loading('',2);
            defaultAjax({
                url: /*[[@{/funnelv3/notes}]]*/null,
                type: 'POST',
                data: {note,type, id},
                success: function (data) {
                    resetCustomTable($("#tableNote"));
                    $("#createNoteSubmit").unloading();
                    $('#noteForm').modal('hide');
                    setEventDetail();
                    setTimeout(()=>{
                        setEventDetail();
                    },1000)
                }, error: function(data) {
                    $("#createNoteSubmit").unloading();
                }
            });
        }

        function renderDetail(data){
            if(data.type == 'P') $("#typeNote").addClass('label-warning');
            else if(data.type == 'D') $("#typeNote").addClass('label-success');
            $("#typeNote").text(data.type_description);
            $("#userNote").text(data.user);
            $("#descriptionNote").text(data.note);
            $("#dateNote").text(data.date);

            fillExtranetNoteForm(data.note, data.type, data.id);

            $('#noteForm').modal({
                backdrop: 'static',
                keyboard: false
            });
        }
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var url = /*[[ @{/funnelv3/notes} ]]*/;
        var totalCount = [[${totalCount}]];
        var limitPaginator =  [[${limitPaginator}]];

        $(document).on('ready', function () {
            enableTableOptions($("#tableNote"), url+"/list", url+"/count", false, null);
            $("select[name='producto']").on("changed.bs.select",
                function(e, clickedIndex, newValue, oldValue) {
                    getEntityProducts(e.target.value);
                })
            if($("select[name='producto']").val()) getEntityProducts($("select[name='producto']").val())
        });


        function getUTMValues(){
            defaultAjax({
                url: /*[[@{/__${@entityExtranetFunnelFinController.URL}__/utm_values}]]*/null,
                type: 'GET',
                data: {},
                success: function (data) {
                    if(data != null) data = JSON.parse(data);
                    if(data.sources) fillOptionsFromSelect($("select[name='utmSource']"), data.sources);
                    if(data.mediums) fillOptionsFromSelect($("select[name='utmMedium']"), data.mediums);
                    if(data.campaigns) fillOptionsFromSelect($("select[name='utmCampaign']"), data.campaigns);
                    if(data.contents) fillOptionsFromSelect($("select[name='utmContent']"), data.contents);
                },
                error: function(data) {

                }
            });
        }

        function getEntityProducts(product){
            defaultAjax({
                url: /*[[@{/__${@entityExtranetFunnelFinController.URL}__/entity_products}]]*/null,
                type: 'GET',
                data: {
                    product
                },
                success: function (data) {
                    if(data != null) {
                        data = JSON.parse(data);
                        let element = $("select[name='entityProductParam']");
                        fillOptionsFromSelect(element, data);
                    }
                },
                error: function(data) {

                }
            });
        }

        function fillOptionsFromSelect(element, options){
            let optionsTemplate = "<option value=\"{{value}}\">{{text}}</option>";
            let optionsData = "<option value=\"-1\">Todos</option>";
            options.forEach(x =>{
                optionsData += optionsTemplate.replace("{{value}}",x.value).replace("{{text}}",x.text);
            });
            options.unshift({
                value : -1,
                text : "Todos",
            })
            element.empty();
            element.append(optionsData);
            element.val(-1);
            element.selectpicker('destroy');
            element.selectpicker();
            element.selectpicker('refresh');
            element.on("changed.bs.select",
                function(e, clickedIndex, newValue, oldValue) {
                    let values = element.val();
                    if(Array.isArray(values)){
                        if(this.options[clickedIndex].value == -1) {
                            element.val([-1])
                            element.selectpicker('refresh');
                        }
                        else if(this.options[clickedIndex].value != -1){
                            let actualValues = values.filter(x => x != -1);
                            if(actualValues.length == options.length - 1) actualValues = [-1]
                            element.val(actualValues);
                            element.selectpicker('refresh');
                        }
                    }
                    else{
                        element.val([-1])
                        element.selectpicker('refresh');
                    }
                });
        }

        function setOnChangeEventToElement(element){
            element.on("changed.bs.select",
                function(e, clickedIndex, newValue, oldValue) {
                    let values = element.val();
                    if(Array.isArray(values)){
                        if(this.options[clickedIndex].value == -1) {
                            element.val([-1])
                            element.selectpicker('refresh');
                        }
                        else if(this.options[clickedIndex].value != -1){
                            let actualValues = values.filter(x => x != -1);
                            if(actualValues.length == options.length) actualValues = [-1]
                            element.val(actualValues);
                            element.selectpicker('refresh');
                        }
                    }
                });
        }

        getUTMValues();

        /*]]>*/
    </script>

</head>

<body>

    <th:block layout:fragment="header">
<!--        <th:block th:replace="fragments/headers :: entityDashboardHeader "></th:block>-->
        <div class="clearfix"></div>
    </th:block>

    <th:block layout:fragment="content">
        <th:block th:replace="fragments/extranetSidebarFragments :: extranetEntitySidebar(currentPage='funnelv3')">
        </th:block>
        <div class="page-content-wrapper">
            <div class="page-content">
                <div class="row row-filter-group">
                    <th:block th:replace="fragments/headers :: entityContentHeader(title='Funnel')"></th:block>
                    <div class="col-xs-12 col-sm-12">
                        <form class="row-filter row-column" id="formContainer">
                            <th:block th:replace="this :: defaultFunnelFiltersWithAnalysis"></th:block>
<!--                            <th:block th:if="${funnelConfiguration} != null and ${funnelConfiguration.filterFragment} != null">-->
<!--                                <span th:text="${funnelConfiguration.filterFragment}" style="display:none;"></span>-->
<!--                                <th:block th:if="${funnelConfiguration.filterFragment == 'banbifTcFunnelFilters'}">-->
<!--                                    <th:block th:replace="this :: banbifTcFunnelFilters"></th:block>-->
<!--                                </th:block>-->
<!--                                <th:block th:if="${funnelConfiguration.filterFragment == 'defaultFunnelFiltersWithAnalysis'}">-->
<!--                                    <th:block th:replace="this :: defaultFunnelFiltersWithAnalysis"></th:block>-->
<!--                                </th:block>-->
<!--                                <th:block th:if="${funnelConfiguration.filterFragment != 'banbifTcFunnelFilters'} and ${funnelConfiguration.filterFragment != 'defaultFunnelFiltersWithAnalysis'}">-->
<!--                                    <th:block th:replace="this :: defaultFunnelFilters"></th:block>-->
<!--                                </th:block>-->
<!--                            </th:block>-->
<!--                            <th:block th:unless="${funnelConfiguration} != null and ${funnelConfiguration.filterFragment} != null">-->
<!--                                <span style="display:none;">Valor por defecto</span>-->
<!--                                <th:block th:replace="this :: defaultFunnelFilters"></th:block>-->
<!--                            </th:block>-->
                        </form>
                    </div>
                    <div id="loader-container">
                        <div class="process-loading-container circle-progress-question" style="height: auto !important; position: initial !important;">
                            <div class="loading-content">
                                <div class="sk-circle">
                                    <div class="sk-circle1 sk-child"></div>
                                    <div class="sk-circle2 sk-child"></div>
                                    <div class="sk-circle3 sk-child"></div>
                                    <div class="sk-circle4 sk-child"></div>
                                    <div class="sk-circle5 sk-child"></div>
                                    <div class="sk-circle6 sk-child"></div>
                                    <div class="sk-circle7 sk-child"></div>
                                    <div class="sk-circle8 sk-child"></div>
                                </div>
                                <span class="loading-text">Cargando<span>.</span><span>.</span><span>.</span></span>
                            </div>
                        </div>
                    </div>
                    <div id="reportDataContainer">
                        <th:block th:replace="this :: reportData"></th:block>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title" style="display: flex;align-items: center;">
                                <b>Notas</b>
                                <button  id="createNote" type="button" style="margin-left: auto" class="btn btn-circle btn-default principal-button-action">Nueva nota</button>
                            </div>
                            <div class="portlet-body">
                                <div id="creditsTable" class="tablefilter-table table-container">
                                    <div class="table-responsive" id="noteFragment">
                                        <th:block th:replace="entityExtranet/fragments/extranetNoteFragment :: noteFragment"></th:block>
                                        <th:block th:replace="fragments/footers :: paginatorFooter "></th:block>
                                    </div>
                                </div>
                                <th:block th:replace="entityExtranet/fragments/extranetNoteFragment :: noteFormFragment"></th:block>
                                <th:block th:replace="entityExtranet/fragments/extranetNoteFragment :: noteFormDetailFragment"></th:block>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <b>Reporte Funnel</b>
                                <br/>
                                <span>&Uacute;ltimos reportes descargados</span>
                            </div>
                            <div class="portlet-body">
                                <div class="table-responsive" id="loansLightResultTable">
                                    <th:block th:replace="this :: results"></th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

    <th:block th:fragment="loansLightResults">
        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <th>Fec. Registro</th>
                <th>Fec. Procesamiento</th>
                <th>Estatus</th>
                <th>Fec. Solicitud</th>
                <th>Url</th>
            </tr>
            </thead>
            <tbody>
            <th:block th:if="${not #lists.isEmpty(loansLightHistoricReports)}" th:each="report : ${loansLightHistoricReports}">
                <tr>
                    <td th:text="${@utilService.datetimeShortFormat(report.registerDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(report?.registerDate)}"></td>
                    <td th:text="${@utilService.datetimeShortFormat(report.processDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(report?.processDate)}"></td>
                    <th:block th:switch="${report.status}">
                        <td th:case="'P'"><span class="label label-xs label-warning">Pendiente</span></td>
                        <td th:case="'F'"><span class="label label-xs label-danger">Fallido</span></td>
                        <td th:case="'S'"><span class="label label-xs label-success">Procesada</span></td>
                    </th:block>
                    <td th:text="${(!report.params.isNull('startDate') and !report.params.isNull('endDate')) ? report.params.get('startDate').toString() + ' - ' + report.params.get('endDate').toString() : ''}"></td>
                    <td>
                        <a th:if="${report.url != null}" th:href="${@reportsService.createReportDownloadUrl(report.id)}" target="_blank">Descargar</a>
                    </td>
                </tr>
            </th:block>
            <th:block th:if="${#lists.isEmpty(loansLightHistoricReports)}">
                <tr>
                    <td colspan="4">
                        No hay resultados.
                    </td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </th:block>

    <th:block th:fragment="reportData">
        <th:block th:if="${data}">
            <div class="col-xs-12 col-sm-6">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <b th:text="${data.leftReport.name}"></b>
                                <br/>
                                <th:block th:text="${data.leftReport.getFromToDateFormatted()}"></th:block>
                            </div>
                            <div class="portlet-body">
                                <th:block th:replace="this :: trapezoidContainer(report=${data.leftReport})"></th:block>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <b th:text="${data.leftReport.name}"></b>
                                <br/>
                                <th:block th:text="${data.leftReport.getFromToDateFormatted()}"></th:block>
                            </div>
                            <div class="portlet-body">
                                <div class="table-responsive" id="championFirstPeriod">
                                    <th:block th:replace="this :: championTable(report=${data.leftReport})"></th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-sm-6">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <b th:text="${data.rightReport.name}"></b>
                                <br/>
                                <th:block th:text="${data.rightReport.getFromToDateFormatted()}"></th:block>
                            </div>
                            <div class="portlet-body">
                                <th:block th:replace="this :: trapezoidContainer(report=${data.rightReport})"></th:block>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <b th:text="${data.rightReport.name}"></b>
                                <br/>
                                <th:block th:text="${data.rightReport.getFromToDateFormatted()}"></th:block>
                            </div>
                            <div class="portlet-body">
                                <div class="table-responsive" id="championSecondPeriod">
                                    <th:block th:replace="this :: championTable(report=${data.rightReport})"></th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </th:block>

        <script th:inline="javascript">
            /*<![CDATA[*/
            $(document).ready(function(){
                let funnelConfiguration = /*[[${funnelConfiguration}]]*/null;
                setFunnelConfiguration(funnelConfiguration);
            })
            /*]]>*/
        </script>
    </th:block>

    <th:block th:fragment="championTable">
        <th:block th:if="${data}">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>STEP</th>
                    <th>USUARIOS</th>
                    <th>STEP-BY-STEP</th>
                    <th>ACUMULADO</th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="step,itr : ${report.steps}">
                    <tr th:if="${step.active}">
                        <td th:text="${#numbers.formatInteger(itr.index,1)}"></td>
                        <td th:text="${step.step}"></td>
                        <td th:text="${step.users}"></td>
                        <td th:text="${@utilService.percentFormat(step.stepPerc)}"></td>
                        <td th:text="${@utilService.percentFormat(step.accumulatedPerc)}"></td>
                    </tr>
                </th:block>
                </tbody>
            </table>
        </th:block>
    </th:block>
    <th:block th:fragment="trapezoidContainer">
        <th:block th:if="${data}">
            <div class="all-trapezoid-container">
                <th:block th:each="step, iter : ${report.getStepsWithoutVisits()}">

                    <div class="trapezoid-container"
                         th:classappend="${(!report.getStepStatus(step.number) ? 'inactive-trapezoid ' : ' ') + ('trapezoid-')+(iter.index + 1)}">
                        <div class="left-trapezoid"></div>
                        <div class="center-trapezoid">
                            <h4 th:text="${@utilService.percentFormat(report.getStepPercentage(step.number))}"></h4>
                            <h5>Step <th:block th:text="${iter.index + 1} + ''"></th:block> - <th:block th:text="${step.step}"></th:block></h5>
                        </div>
                        <div class="right-trapezoid"></div>
                    </div>

                </th:block>
            </div>
        </th:block>
    </th:block>

    <th:block th:fragment="defaultFunnelFilters">
        <div class="col-div-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />Producto</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="product-selector" name="producto">
                    <th:block th:if="${not #lists.isEmpty(products)}" th:each="product : ${products}">
                        <option th:value="${product.id}" th:text="${product.name}" th:selected="${product.id == productSelected ? true : false}"></option>
                    </th:block>
                </select>
                <div class="errorContainer">Campo es requerido</div>
            </div>
        </div>
        <div class="col-div-2">
            <div class="form-group">
                <label class="control-label"><b></b><br/>Análisis</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="analysis" name="analisis" disabled="true">
                    <option value="champion" disabled="true">Champion/ Challenger</option>
                    <option value="period" selected="true">Por períodos</option>
                </select>
                <input type="hidden" name="analisis"/>
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />Edad</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="edad" name="edad">
                    <option value="0">Todos</option>
                    <option value="1">Hasta 34</option>
                    <option value="2">35-44</option>
                    <option value="3">45-54</option>
                    <option value="4">Más de 55</option>
                </select>
            </div>
        </div>
<!--        <div class="col-div-1-5">-->
<!--            <div class="form-group">-->
<!--                <label class="control-label"><b></b><br />Medio</label>-->
<!--                <select class="form-control input-sm form-control-sm selectpicker" id="medio" name="medio">-->
<!--                    <option value="0">Todos</option>-->
<!--                    <option value="1">Online</option>-->
<!--                    <option value="2">Banca Telefónica</option>-->
<!--                </select>-->
<!--            </div>-->
<!--        </div>-->
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br /><span id="firstDateFilteLabel">Fec. Periodo 1</span></label>
                <input id="creationFromFilter" name="fromDate1" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Desde" />
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />&nbsp;</label>
                <input id="creationToFilter" name="toDate1" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Hasta" />
            </div>
        </div>
        <div class="col-div-1-5 date-filter-period-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />Fecha 2</label>
                <input id="creationFromFilterPeriod2" name="fromDate2" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Desde" />
            </div>
        </div>
        <div class="col-div-1-5 date-filter-period-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />&nbsp;</label>
                <input id="creationToFilterPeriod2" name="toDate2" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Hasta" />
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />Base</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="base" name="base" disabled="true">
                    <option value="0" selected="true">Pre-Aprobada</option>
                </select>
                <input type="hidden" name="base"/>
            </div>
        </div>
        <script>
            $(document).ready(function (){
                $("input[name='analisis']").val($("select#analysis").val());
                $("input[name='base']").val($("select#base").val());
            })
        </script>
    </th:block>

    <th:block th:fragment="defaultFunnelFilters">
        <div class="col-div-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />Producto</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="product-selector" name="producto">
                    <th:block th:if="${not #lists.isEmpty(products)}" th:each="product : ${products}">
                        <option th:value="${product.id}" th:text="${product.name}" th:selected="${product.id == productSelected ? true : false}"></option>
                    </th:block>
                </select>
                <div class="errorContainer">Campo es requerido</div>
            </div>
        </div>
        <div class="col-div-2">
            <div class="form-group">
                <label class="control-label"><b></b><br/>Análisis</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="analysis" name="analisis" disabled="true">
                    <option value="champion" disabled="true">Champion/ Challenger</option>
                    <option value="period" selected="true">Por períodos</option>
                </select>
                <input type="hidden" name="analisis"/>
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />Edad</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="edad" name="edad">
                    <option value="0">Todos</option>
                    <option value="1">Hasta 34</option>
                    <option value="2">35-44</option>
                    <option value="3">45-54</option>
                    <option value="4">Más de 55</option>
                </select>
            </div>
        </div>
        <!--        <div class="col-div-1-5">-->
        <!--            <div class="form-group">-->
        <!--                <label class="control-label"><b></b><br />Medio</label>-->
        <!--                <select class="form-control input-sm form-control-sm selectpicker" id="medio" name="medio">-->
        <!--                    <option value="0">Todos</option>-->
        <!--                    <option value="1">Online</option>-->
        <!--                    <option value="2">Banca Telefónica</option>-->
        <!--                </select>-->
        <!--            </div>-->
        <!--        </div>-->
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br /><span id="firstDateFilteLabel">Fec. Periodo 1</span></label>
                <input id="creationFromFilter" name="fromDate1" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Desde" />
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />&nbsp;</label>
                <input id="creationToFilter" name="toDate1" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Hasta" />
            </div>
        </div>
        <div class="col-div-1-5 date-filter-period-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />Fecha 2</label>
                <input id="creationFromFilterPeriod2" name="fromDate2" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Desde" />
            </div>
        </div>
        <div class="col-div-1-5 date-filter-period-2">
            <div class="form-group">
                <label class="control-label"><b></b><br />&nbsp;</label>
                <input id="creationToFilterPeriod2" name="toDate2" type="text"
                       class="form-control input-sm form-control-sm"
                       placeholder="Hasta" />
            </div>
        </div>
        <div class="col-div-1-5">
            <div class="form-group">
                <label class="control-label"><b></b><br />Base</label>
                <select class="form-control input-sm form-control-sm selectpicker" id="base" name="base" disabled="true">
                    <option value="0" selected="true">Pre-Aprobada</option>
                </select>
                <input type="hidden" name="base"/>
            </div>
        </div>
        <script>
            $(document).ready(function (){
                $("input[name='analisis']").val($("select#analysis").val());
                $("input[name='base']").val($("select#base").val());
            })
        </script>
    </th:block>

    <th:block th:fragment="defaultFunnelFiltersWithAnalysis">
        <div class="row-flex">
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />Producto</label>
                    <select class="form-control input-sm form-control-sm selectpicker" id="product-selector" name="producto">
                        <th:block th:if="${not #lists.isEmpty(products)}" th:each="product : ${products}">
                            <option th:value="${product.id}" th:text="${product.name}" th:selected="${product.id == productSelected ? true : false}"></option>
                        </th:block>
                    </select>
                    <div class="errorContainer">Campo es requerido</div>
                </div>
            </div>
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />Sub-producto</label>
                    <select class="form-control input-sm form-control-sm selectpicker" multiple="true" id="entity-product-selector" name="entityProductParam">
                        <option value="-1" selected="true">Todos</option>
                        <th:block th:if="${not #lists.isEmpty(entityProductParams)}" th:each="entityProductParam : ${entityProductParams}">
                            <option th:value="${entityProductParam.id}" th:text="${entityProductParam.entityProduct}"></option>
                        </th:block>
                    </select>
                </div>
            </div>
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br/>Análisis</label>
                    <select class="form-control input-sm form-control-sm selectpicker" id="analysis" name="analisis">
                        <option value="champion">Champion/ Challenger</option>
                        <option value="period" selected="true">Por períodos</option>
                    </select>
                    <input type="hidden" name="analisis"/>
                </div>
            </div>
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br /><span id="firstDateFilteLabel">Fec. Periodo 1</span></label>
                    <input id="creationFromFilter" name="fromDate1" type="text"
                           class="form-control input-sm form-control-sm"
                           placeholder="Desde" />
                </div>
            </div>
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />&nbsp;</label>
                    <input id="creationToFilter" name="toDate1" type="text"
                           class="form-control input-sm form-control-sm"
                           placeholder="Hasta" />
                </div>
            </div>
            <div class="col-div-1 date-filter-period-2">
                <div class="form-group">
                    <label class="control-label"><b></b><br />Fecha 2</label>
                    <input id="creationFromFilterPeriod2" name="fromDate2" type="text"
                           class="form-control input-sm form-control-sm"
                           placeholder="Desde" />
                </div>
            </div>
            <div class="col-div-1 date-filter-period-2">
                <div class="form-group">
                    <label class="control-label"><b></b><br />&nbsp;</label>
                    <input id="creationToFilterPeriod2" name="toDate2" type="text"
                           class="form-control input-sm form-control-sm"
                           placeholder="Hasta" />
                </div>
            </div>
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />Base</label>
                    <select class="form-control input-sm form-control-sm selectpicker" id="base" name="base" disabled="true">
                        <option value="0" selected="true">Pre-Aprobada</option>
                    </select>
                    <input type="hidden" name="base"/>
                </div>
            </div>
            <div class="col-div-2" style="margin-left: auto;">
                <div class="" style="width: 100%;display:flex;">
                    <div class="form-group" style="width: 50%;margin-bottom: 0px;">
                        <label class="control-label"><b></b><br /><br /></label>
                        <button id="filterBtn" type="button" class="filter-btn principal-button" style="display: flex;padding: 1rem 0rem;width: 100%;justify-content: center;margin-bottom: 0px">
                            Filtrar</button>
                    </div>
                    <div class="form-group" style="width: 50%;margin-bottom: 0px;">
                        <label class="control-label"><b></b><br /><br /></label>
                        <button id="downloadBtn" type="button" class="download-btn principal-button-modal" style="padding: 1rem 0rem;width: 100%;margin-bottom: 0px" onclick="exportToExcel();">Descargar</button></div>
                </div>
            </div>
        </div>
        <div class="row-flex">
            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />UTM Source</label>
                    <select data-none-selected-text="Todos" class="form-control input-sm form-control-sm selectpicker" multiple="true" name="utmSource">
                    </select>
                </div>
            </div>

            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />UTM Medium</label>
                    <select data-none-selected-text="Todos" class="form-control input-sm form-control-sm selectpicker" multiple="true" name="utmMedium">
                    </select>
                </div>
            </div>

            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />UTM Campaigns</label>
                    <select data-none-selected-text="Todos" class="form-control input-sm form-control-sm selectpicker" multiple="true" name="utmCampaign">
                    </select>
                </div>
            </div>

            <div class="col-div-1">
                <div class="form-group">
                    <label class="control-label"><b></b><br />UTM Content</label>
                    <select data-none-selected-text="Todos" class="form-control input-sm form-control-sm selectpicker" multiple="true" name="utmContent">
                    </select>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function (){
                $("input[name='base']").val($("select#base").val());
            })
        </script>
    </th:block>

    <th:block th:replace="entityExtranet/fragments/extranetNoteFragment :: noteFormFragment"></th:block>
</body>
</html>