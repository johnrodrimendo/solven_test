<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/extranetTemplate"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet" type="text/css"/>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}" rel="stylesheet"/>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}" rel="stylesheet"/>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/select2/css/select2.min.css'}" rel="stylesheet" type="text/css"/>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/select2/css/select2-bootstrap.min.css'}" rel="stylesheet" type="text/css"/>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}" rel="stylesheet"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datetimepicker-4.17/bootstrap-datetimepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.waypoints.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.counterup.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.resize.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.categories.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.pie.min.js'}" type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/select2/js/select2.full.min.js'}" type="text/javascript"></script>
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/css/bootstrap-datepicker3.min.css'}" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/js/bootstrap-datepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/locales/bootstrap-datepicker.es.min.js'}"></script>

    <script th:src="@{/js/bo_tablefilter.js}"></script>
    <script th:inline="javascript">
        Dropzone.autoDiscover = false;
    </script>
    <script>
        function resetTimer() {
            endTime = (+new Date) + 1000 * (60*defaultMin) + 500;
        }
    </script>
    <th:block th:replace="components/tracking :: social" />
    <script th:inline="javascript">
        /*<![CDATA[*/
        function gtag_report_conversion(id, url) {
            dataLayer.push({
                'event': 'conversion',
                'transaction_id': id+''
            });
            return false;
        }
        /*]]>*/
    </script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var trayReport =/*[[${@entityExtranetService.canShowDownloadTrayReport(tray,#httpServletRequest,#locale)}]]*/null;
        var tray = /*[[${tray}]]*/null;
        var idDownloadButton =  "#downloadTrayReport";
        function executeDownloadReport() {
            let requestData = getDataFromForm('#form-termitated-list');
            let downloadButton = $(idDownloadButton);
            downloadButton.loading();
            defaultAjax({
                url: /*[[ @{/__${@entityExtranetTrayReportsController.URL}__}]]*/null,
                type: 'POST',
                data:{
                    tray,
                    trayReport,
                    creationFrom :  requestData.creationFrom || null,
                    creationTo :  requestData.creationTo || null,
                    search : requestData.searchValue || null,
                },
                success: function (data) {
                    downloadButton.unloading();
                    if(data != null) {
                        data = JSON.parse(data);
                        if(data.id) getReportStatus(data.id);
                    }
                },
                error: function(){
                    downloadButton.unloading();
                }
            });
        }

        function getReportStatus(reportId){
            let downloadButton = $(idDownloadButton);
            downloadButton.loading();
            defaultAjax({
                url: /*[[ @{/__${@entityExtranetTrayReportsController.URL}__}]]*/null,
                type: 'GET',
                data:{
                    reportId
                },
                success: function (data) {
                    downloadButton.unloading();
                    if(data != null) {
                        data = JSON.parse(data);
                        if(data.status == 'P' || data.status == "Q") {
                            downloadButton.loading();
                            setTimeout(()=>{getReportStatus(reportId);},3000);
                        }
                        else if(data.status == 'S'){
                            //DESCARGAR REPORTE
                            createElementToClick(reportId,data.url);
                        }
                        else if(data.status == 'F'){
                            swal({
                                title: "Oops...",
                                text: "Ha ocurrido un error al procesar la descarga",
                                imageUrl: "/img/icon-modal-error.svg",
                                confirmButtonColor: '#F7323F',
                                cancelButtonColor: '#3F3B3B',
                                imageSize: "66x66"
                            });
                        }
                    }
                },
                error: function(){
                    downloadButton.unloading();
                }
            });
        }

        function createElementToClick(id,url){
            if(!url) return;
            window.location.href = url;
            // let aElement= document.createElement('a');
            // aElement.setAttribute('href', url);
            // aElement.setAttribute('target', "_blank");
            // aElement.setAttribute('id', "report"+id);
            // aElement.style.display = "none";
            // document.body.appendChild(aElement);
            // document.getElementById("report"+id).click();
        }

        $(document).ready(function(){
            $(idDownloadButton).off('click').on('click', function(e){
                e.preventDefault();
                executeDownloadReport();
            })
        })
        /*]]>*/
    </script>
    <style>
        .dataTables_wrapper{
            width: 97% !important;
        }

        .table > thead > tr > th, .table > thead > tr > td, .table > tbody > tr > th, .table > tbody > tr > td, .table > tfoot > tr > th, .table > tfoot > tr > td{
            padding: 6px !important;
        }
    </style>
</head>
<body>
<th:block layout:fragment="header">
<!--    <th:block th:replace="fragments/headers :: entityDashboardHeader "></th:block>-->
    <div class="clearfix"></div>
</th:block>
<th:block layout:fragment="content">
    <th:block th:replace="fragments/extranetSidebarFragments :: extranetEntitySidebar(currentPage=${page})"></th:block>
    <div class="page-content-wrapper">
        <div class="page-content">
            <div class="row w-creditos-procesados">

                <th:block th:replace="fragments/headers :: entityContentHeaderWithFiltersBDS"></th:block>

                <div class="col-lg-12">
                    <div class="portlet light bordered tablefilter">
                        <div class="portlet-body">
                            <div id="creditsTable" class="tablefilter-table">
                                <div class="table-responsive" style="overflow: auto; display: flex; justify-content: center">
                                    <table id="tableResults" class=" table table-striped table-bordered table-hover table-checkable order-column dataTable">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Fecha<br/>Generación</th>
                                                <th>Crédito</th>
                                                <th>Producto</th>
                                                <th:block th:if="${!((page == 'generated' or page == 'callcenter') and @entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL))}">
                                                    <th>Tipo Doc.</th>
                                                </th:block>
                                                <th>Número Doc.</th>
                                                <th>Nombres</th>
                                                <th:block th:if="${page == 'terminated' or page == 'generated'}">
                                                    <th>Apellidos</th>
                                                </th:block>
                                                <th:block th:unless="${page == 'terminated' or page == 'generated'}">
                                                    <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                                                        <th>Apellidos</th>
                                                    </th:block>
                                                    <th:block th:unless="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                                                        <th>Apellido<br/>Paterno</th>
                                                        <th>Apellido<br/>Materno</th>
                                                    </th:block>
                                                </th:block>
                                                <th:block th:if="${page == 'callcenter'}">
                                                    <th>Email</th>
                                                    <th>Celular</th>
                                                </th:block>
                                                <th>Monto</th>
                                                <th>Cuotas</th>
                                                <th>Tasa</th>
                                                <th>Documentos</th>

                                                <th:block th:if="${page == 'terminated' or page == 'generated'}">
                                                    <th>Responsable<br/>Generación</th>
                                                </th:block>

                                                <th:block th:if="${page == 'terminated'}">
                                                    <th>Analista<br/>Desembolso</th>
                                                </th:block>
                                                <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).ABACO)}">
                                                    <th>Empleador</th>
                                                </th:block>

                                                <th:block th:if="${page != 'terminated'} and ${page != 'callcenter'}">
                                                    <th:block th:switch="${page}">
                                                        <th shiro:hasPermission="credit:pending:validate" th:case="pending">Acciones</th>
                                                    </th:block>
                                                    <th:block th:switch="${page}">
                                                        <th shiro:hasPermission="credit:toUpload:upload" th:case="toUpload">Acciones</th>
                                                    </th:block>
                                                    <th:block th:switch="${page}">
                                                        <th shiro:hasPermission="credit:generated:disbursement" th:case="generated">Acciones</th>
                                                        <th shiro:hasPermission="credit:generated:disbursement" th:case="callcenter">Acciones</th>
                                                    </th:block>
                                                </th:block>
                                                <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                                                    <th th:if="${page == 'generated' or page == 'terminated' or page == 'callcenter'}">Estado interno</th>
                                                </th:block>
                                                <th></th><!--BOTON EXPIRAR-->
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <th:block th:replace="this :: list"></th:block>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="setCreditObservationModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmSetCreditObservationModal" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="creditObservationReason">Razón de
                                        observación</label>
                                    <select class="form-control" name="creditObservationReason"
                                            id="creditObservationReason"></select>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="closeCreditObservationReasonButton" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="creditObservationReasonButton" type="button" class="btn btn-danger">Observar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="registerCreditRejectionModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmRegisterCreditRejectionModal" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="creditRejectionReason">Razón de rechazo</label>
                                    <select class="form-control" name="creditRejectionReason" id="creditRejectionReason"></select>
                                    <label class="control-label" for="creditRejectionComment">Comentarios</label>
                                    <textarea class="form-control" name="creditRejectionComment" id="creditRejectionComment" maxlength="200"></textarea>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="registerCreditRejectionButton" type="button" class="btn btn-danger">Rechazar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="registerCreditUploadModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmRegisterCreditUploadModal" method="post">
                        <div class="row">
                            <div class="col-md-12" th:if="${@entityExtranetService.shouldRegisterEntityApplicationCode()}">
                                <div class="form-group">
                                    <label class="control-label">Código de Solicitud</label>
                                    <input type="text" class="form-control" name="loanUploadReferenceNumber" id="loanUploadReferenceNumber" />
                                    <label for="loan_complete_info" class="custom-check">
                                        <span class="check-inner"><i class="icon icon-check"></i></span>
                                        <span class="check-label">Omitir</span>
                                        <input type="checkbox" class="real-check" id="loan_complete_info"/>
                                    </label>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        $('#loan_complete_info').click(function () {
                                            if (this.checked) {
                                                $('#loanUploadReferenceNumber').val('');
                                                $('#loanUploadReferenceNumber').prop('disabled', true);
                                                $('#loan_complete_info').prop('checked', true);
                                                $('#loan_complete_info').checked();
                                            }else{
                                                $('#loanUploadReferenceNumber').prop('disabled', false);
                                                $('#loan_complete_info').prop('checked', false);
                                                $('#loan_complete_info').checked();
                                            }
                                        });
                                        /*]]>*/
                                    </script>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label">Código de Crédito</label>
                                    <input type="text" class="form-control" name="creditUploadReferenceNumber" id="creditUploadReferenceNumber" />
                                    <label for="complete_info" class="custom-check">
                                        <span class="check-inner"><i class="icon icon-check"></i></span>
                                        <span class="check-label">Omitir</span>
                                        <input type="checkbox" class="real-check" id="complete_info"/>
                                    </label>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        $('#complete_info').click(function () {
                                            if (this.checked) {
                                                $('#creditUploadReferenceNumber').val('');
                                                $('#creditUploadReferenceNumber').prop('disabled', true);
                                                $('#complete_info').prop('checked', true);
                                                $('#complete_info').checked();
                                            }else{
                                                $('#creditUploadReferenceNumber').prop('disabled', false);
                                                $('#complete_info').prop('checked', false);
                                                $('#complete_info').checked();
                                            }
                                        });
                                        /*]]>*/
                                    </script>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="registerCreditUploadModalButton" type="button" class="btn btn-danger">Cargar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="registerCreditDisbursementModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <h4 class="title-modal">Desembolsar</h4>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <form id="frmRegisterCreditDisbursementModal" method="post" class="modal-body">
                    <div class="col-md-6 field">
                        <label >Fecha de Desembolso</label>
                        <input type="text" class="form-control" name="disbursementDate" id="disbursementDate" />
                        <div class="errorContainer">
                            <span class="help-block form-field-error-message"></span>
                        </div>
                        <div id="datetimepicker12"></div>
                    </div>
                    <div class="col-md-6 field">
                        <label>Monto</label>
                        <input id="amount" name="amount" type="text" class="form-control" />
                        <div class="errorContainer">
                            <span class="help-block form-field-error-message"></span>
                        </div>
                    </div>
                    <div class="col-md-6 field">
                        <label>Plazo</label>
                        <input id="installments" name="installments" type="text" class="form-control" />
                        <div class="errorContainer">
                            <span class="help-block form-field-error-message"></span>
                        </div>
                    </div>
                    <div class="col-md-6 field">
                        <label>Tasa</label>
                        <input id="tea" name="tea" type="text" class="form-control" />
                        <div class="errorContainer">
                            <span class="help-block form-field-error-message"></span>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="registerCreditDisbursementModalButton" type="button" class="btn btn-danger">Desembolsar</button>
                </div>
            </div>
            <script th:inline="javascript">
                /*<![CDATA[*/
                function showCalendar(){
                    if($('#registerCreditDisbursementModal').data("minDate")){
                        year = $('#registerCreditDisbursementModal').data("minDate")[0];
                        month = $('#registerCreditDisbursementModal').data("minDate")[1];
                        day = $('#registerCreditDisbursementModal').data("minDate")[2];
                    }
                    var jsonDatePicker = {
                        format:'DD/MM/YYYY',
                        inline: false,
                        sideBySide: true,
                        maxDate: new Date(),
                        minDate: new Date(year,month,day)
                    };
                    $('#disbursementDate').datetimepicker(jsonDatePicker);
                    $('#datetimepicker12').on('dp.change', function(event) {
                        var formatted_date = event.date.format("DD/MM/YYYY");
                        $('#disbursementDate').val(formatted_date);
                        $('#form_date .offer-title h2').text('Haz seleccionado');
                        if(event.date){console.log('Date chosen: ' + event.date.format() );}
                    });


                    var $table = $('#tableResults');
                    dataTable($table, true, false, true, true);
                }
                /*]]>*/
            </script>
            <script th:inline="javascript" th:if="${registerDisbursementForm != null}">
                /*<![CDATA[*/
                var validator = /*[[${registerDisbursementForm.validator.toJson(#locale)}]]*/null;
                if (validator != null) {
                    var jsonValidator = JSON.parse(validator);
                    $('#frmRegisterCreditDisbursementModal').validateForm(createFormValidationJson(jsonValidator, $('#frmRegisterCreditDisbursementModal')));
                }
                /*]]>*/
            </script>
        </div>
    </div>

    <div id="registerGeneratedCreditRejectionModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmRegisterGeneratedCreditRejectionModal" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="creditGeneratedRejectionReason">Razón de rechazo</label>
                                    <select class="form-control" name="creditGeneratedRejectionReason" id="creditGeneratedRejectionReason"></select>
                                    <select class="form-control" name="creditGeneratedRejectionReason" id="creditDisbursementRejectionReason"></select>
                                    <label class="control-label" for="creditGeneratedRejectionComment">Comentarios</label>
                                    <textarea class="form-control" name="creditGeneratedRejectionComment" id="creditGeneratedRejectionComment" maxlength="200"></textarea>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button id="registerGeneratedCreditRejectionButton" type="button" class="btn btn-danger">Rechazar</button>
                </div>
            </div>
        </div>
    </div>

    <th:block shiro:hasPermission="credit:generated:uploadRipleyFinalSchedule">
        <div id="uploadFinalShceduleModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            function openUploadFinalScheduleModal(creditId) {
                var url = /*[[ @{/uploadRipleyFinalSchedule} ]]*/;
                $('#uploadFinalShceduleModal').find('.modal-body').html('');
                $('#uploadFinalShceduleModal').find('.modal-body').append("<div id=\"uploadFile\" class=\"dropzone\"></div>")
                var dropzone = $("#uploadFile").dropzone({
                    url: url,
                    params: {
                        creditId: creditId
                    },
                    paramName: 'file',
                    maxFilesize: 10, // MB
                    maxFiles: 1, //HU1
                    dictDefaultMessage: 'Arrastra el archivo aquí para subirlo, o haz click para seleccionar uno.',
                    acceptedFiles: 'image/*,application/pdf',
                    headers: addCsrfToJsonHeaders({
                        'x-request-sender-type': 'ajax'
                    }),
                    init: function () {
                        this.on("success", function () {
                            location.reload();
                        });
                        this.on('error', function (file, response) {
                            this.removeFile(file);
                            if (response.constructor == Object) {
                                if (response.type == "message")
                                    showErrorModal(response.message);
                            } else {
                                if (response != null && response != '')
                                    showErrorModal(response);
                                else
                                    showErrorModal('Se produjo un error inesperado, <br/>por favor inténtalo nuevamente o contáctanos.');
                            }
                        });
                    }
                });
                $('#uploadFinalShceduleModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            }
            /*]]>*/
        </script>
    </th:block>

    <th:block shiro:hasPermission="credit:generated:deleteRipleyFinalSchedule">
        <script th:inline="javascript">
            /*<![CDATA[*/
            function removeFinalSchedule(creditId, button){
                var self = $(button);
                self.loading();
                defaultAjax({
                    url: /*[[ @{/removeRipleyFinalSchedule} ]]*/,
                    type: 'POST',
                    data:{
                        creditId: self.data('id')
                    },
                    success: function (data) {
                        location.reload();
                    },
                    error: function(){
                        self.unloading();
                    }
                });
            }
            /*]]>*/
        </script>
    </th:block>

    <th:block th:if="${showAccesoScheduleAppointmentModal}">
        <div id="registerScheduleAppointmentModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-top">
                        <div class="title-wrap">
                            <h4 class="title-modal">Seleccionar horario para agendar cita con el Procurador</h4>
                        </div>
                        <div class="corner-close">
                            <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="frmRegisterScheduleAppointmentModal" method="post" class="modal-body">
                            <div class="col-md-6 field">
                                <label>Fecha</label>
                                <div class='input-group' id='datetimepicker2'>
                                    <input type='text' class="form-control" name="appointmentDate" id="appointmentDate"/>
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                                <div class="errorContainer">
                                    <span class="help-block form-field-error-message"></span>
                                </div>
                            </div>

                            <div class="col-md-6 field">
                                <label>Horario</label>
                                <select name="appointmentScheduleId" id="appointmentScheduleId" data-placeholder="Horario">
                                    <option value="" disabled="true">Horario</option>
                                </select>
                                <div class="errorContainer">
                                    <span class="help-block form-field-error-message"></span>
                                </div>
                            </div>

                            <div class="col-md-12 field">
                                <label>Lugar</label>
                                <textarea id="appointmentPlace" name="appointmentPlace" rows="2" cols="30" class="form-control"></textarea>
                                <div class="errorContainer">
                                    <span class="help-block form-field-error-message"></span>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                        <button id="registerScheduleAppointmentButton" type="button" class="btn btn-danger">Agendar cita</button>
                    </div>
                </div>
            </div>
            <script th:inline="javascript">
                /*<![CDATA[*/
                $(function () {
                    var hour = $('#appointmentScheduleId');
                    hour.select2();

                    var scheduleJson = JSON.parse(/*[[${jsonSchedulesMap}]]*/);
                    function renderHours(date) {
                        var options = "<option value=''>Horario</option>";
                        try {
                            for (i = 0; i < scheduleJson[date].length; i++) {
                                options += '<option value="' + scheduleJson[date][i].appointmentScheduleId + '">' + scheduleJson[date][i].appointmentSchedule + '</option>';
                            }
                            hour.html(options);
                        } catch (e) {
                            hour.html(options);
                        }
                    }

                    $('input[name=appointmentDate]').on('blur', function (e) {
                        renderHours($(this).val());
                        $('#appointmentScheduleId').select2('open');
                    });

                    $(function () {
                        $('#datetimepicker2').datetimepicker({
                            format: 'DD/MM/YYYY',
                            minDate: moment(Object.keys(scheduleJson)[0], ["DD/MM/YYYY"]).toDate(),
                            enabledDates: /*[[${availableDates}]]*/
                        });
                    });

                    $('document').ready(function () {
                        renderHours($('input[name=appointmentDate]').val());
                        $('#appointmentScheduleId').select2('open');
                        console.log($('input[name=appointmentDate]').val());
                    });
                });

                function showScheduleAppointmentModal(creditId){
                    $('#registerScheduleAppointmentModal').modal();
                    $('#registerScheduleAppointmentModal .loading').hide();
                    $('#registerScheduleAppointmentModal .content').show();
                    $('#registerScheduleAppointmentModal #registerScheduleAppointmentButton').data('id', creditId);
                    $('#registerScheduleAppointmentModal #registerScheduleAppointmentButton').click(function () {
                        scheduleAppointment($(this).data('id'));
                    });
                }

                $('#registerScheduleAppointmentModal').on('hidden.bs.modal', function (e) {
                    //RESET LIST OF HOURS
                    $('#appointmentScheduleId').html("<option value=''>Horario</option>");
                });

                function scheduleAppointment(creditId) {
                    console.log(creditId);
                    var form = $('#frmRegisterScheduleAppointmentModal').serializeObject();

                    if(Object.keys(form).length && form.appointmentDate && form.appointmentPlace && form.appointmentPlace !== '' && form.appointmentScheduleId && form.appointmentScheduleId !== '') {
                        swal({
                                title: "¿Está seguro de agendar la cita para la fecha y lugar indicados?",
                                type: "warning",
                                html: true,
                                showCancelButton: true,
                                confirmButtonColor: "#36c6d3",
                                confirmButtonText: "¡Sí, seguro!",
                                cancelButtonText: "Cancelar"
                            },
                            function (proceed) {
                                if(proceed){
                                    $('#registerScheduleAppointmentButton').loading('', 2);
                                    defaultAjax({
                                        url: /*[[@{/updateStatus/appointment}]]*/null,
                                        type: 'POST',
                                        data: $.extend($('#frmRegisterScheduleAppointmentModal').serializeObject(), {
                                            creditId: creditId
                                        }),
                                        success: function (data) {
                                            location.reload();
                                        },
                                        error: function (data) {
                                            $('#registerScheduleAppointmentButton').unloading();
                                        }
                                    });
                                }
                            });
                    } else {
                        if($('input[name=appointmentDate]').val() == '') {
                            $('#appointmentDate').parent().next().children().html("<span>Seleccione la fecha.</span>");
                        } else {
                            $('#appointmentDate').parent().next().children().html("");
                        }
                        if($('#appointmentScheduleId').val() == '') {
                            $('#appointmentScheduleId').parent().find('.errorContainer').children().html("<span>Seleccione el horario.</span>");
                        } else {
                            $('#appointmentScheduleId').parent().find('.errorContainer').children().html("");
                        }
                        if($('#appointmentPlace').val() == '') {
                            $('#appointmentPlace').next().children().html("<span>Ingrese el lugar.</span>");
                        } else {
                            $('#appointmentPlace').next().children().html("");
                        }
                    }
                }
                /*]]>*/
            </script>
        </div>
    </th:block>

    <th:block th:if="${showFinalDocumentationModal}">
        <div id="uploadFinalDocumentationModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-top">
                        <div class="title-wrap">
                            <h4 class="title-modal">Subir Documentaci&oacute;n Final</h4>
                        </div>
                        <div class="corner-close">
                            <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <p>Debes subir un archivo comprimido que contenga toda la documentaci&oacute;n final. Solo podr&aacute;s hacer este proceso una vez.</p>
                        <br/>
                        <div class="uploader-container"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            function showUploadFinalDocumentationModal(creditId) {
                var url = /*[[ @{/uploadFinalDocumentation} ]]*/;
                $('#uploadFinalDocumentationModal').find('.uploader-container').html('');
                $('#uploadFinalDocumentationModal').find('.uploader-container').append("<div id=\"uploadFile\" class=\"dropzone\"></div>")
                var dropzone = $("#uploadFile").dropzone({
                    url: url,
                    params: {
                        creditId: creditId
                    },
                    paramName: 'file',
                    maxFilesize: 10, // MB
                    maxFiles: 1, //HU1
                    dictDefaultMessage: 'Arrastra el archivo aquí para subirlo, o haz click para seleccionar uno.',
                    //acceptedFiles: 'image/*,application/pdf',
                    autoProcessQueue:false,
                    headers: addCsrfToJsonHeaders({
                        'x-request-sender-type': 'ajax'
                    }),
                    init: function () {
                        this.on("addedfile", function (file) {
                            var dZone = Dropzone.forElement("#uploadFile");
                            if(true || dZone.options.acceptedFiles.search(file.type) > -1) {
                                swal({
                                        title: "¿Estás seguro que es la documentación final del crédito?",
                                        text: "No la podrás volver a subir",
                                        type: "warning",
                                        html: true,
                                        showCancelButton: true,
                                        confirmButtonColor: "#36c6d3",
                                        confirmButtonText: "Si, seguro", cancelButtonText: "Cancelar",
                                        closeOnConfirm: true
                                    },
                                    function(agree) {
                                        if(!agree) {
                                            dZone.removeFile(file);
                                        } else {
                                            dZone.processQueue();
                                        }
                                    });
                            }
                        });
                        this.on("success", function () {
                            location.reload();
                        });
                        this.on('error', function (file, response) {
                            this.removeFile(file);
                            if (response.constructor == Object) {
                                if (response.type == "message")
                                    showErrorModal(response.message);
                            } else {
                                if (response != null && response != '')
                                    showErrorModal(response);
                                else
                                    showErrorModal('Se produjo un error inesperado, <br/>por favor inténtalo nuevamente o contáctanos.');
                            }
                        });
                    }
                });
                $('#uploadFinalDocumentationModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            }
            /*]]>*/
        </script>
    </th:block>

    <th:block th:if="${showAeluInternalDisbursementModal}">
        <script th:inline="javascript">
            /*<![CDATA[*/
            function askInternalDisbursement(creditId) {
                swal({
                        title: "&iquest;Est&aacute;s seguro de registrar el desembolso interno?",
                        text: "No podr&aacute;s revertir el cambio.",
                        type: "warning",
                        html: true,
                        showCancelButton: true,
                        confirmButtonColor: "#36c6d3",
                        confirmButtonText: "¡Si, registrar!",
                        closeOnConfirm: true
                    },
                    function () {
                        defaultAjax({
                            url: /*[[@{/registerCreditInternalDisbursement}]]*/null,
                            type: 'POST',
                            data: {
                                creditId: creditId
                            },
                            success: function (data) {
                                swal("Registrado", "El desembolso interno se ha registrado correctamente.", "success");
                                window.location.reload();
                            }
                        })
                    });
            }
            /*]]>*/
        </script>
    </th:block>

    <script th:inline="javascript">
        /*<![CDATA[*/

        var url = /*[[ @{/extranet-paginator/} ]]*/;
        var totalCount = [[${totalCount}]];
        var pageName = [[${page}]];
        var limitPaginator =  [[${limitPaginator}]];
        if(limitPaginator == null) limitPaginator = -1;
        url += pageName;
        var excludeSetTotals = /*[[${excludeSetTotals}]]*/null;
        var skipAjxCall = false;
        var htmlBaseTableAux = null;
        var tableIDAux= "tableAux";
        function getResponsePaginator(obj, requestUri, page, limit, draw, callback){
            if(page < 0) page = 0;
            if(limit < 0) limit = null;
            let requestData = getDataFromForm('#form-termitated-list');
            if(!skipAjxCall){
                defaultAjax({
                    url: requestUri,
                    type: 'POST',
                    data: {
                        page,
                        limit,
                        creationFrom :  requestData.creationFrom || null,
                        creationTo :  requestData.creationTo || null,
                        search : requestData.searchValue || null
                    },
                    success: function (data) {
                        if(htmlBaseTableAux){
                            excludeSetTotals = true;
                            $("#container-table-aux").remove();
                            obj.parent().append("<div style='width: 100%;max-width: 100%; visibility:hidden;max-height: 5px;overflow-y: auto;' id='container-table-aux'>"+htmlBaseTableAux+"</div>");
                            $(`#${tableIDAux} > tbody:nth-child(2)`).html(data);
                            dataTableAuxRender($(`#${tableIDAux}`));
                            let dataTableRows = $(`#${tableIDAux}`).DataTable().rows().data();
                            callback({data : dataTableRows,recordsTotal : totalCount,draw, recordsFiltered: totalCount});
                            obj.DataTable().responsive.rebuild()
                            obj.DataTable().responsive.recalc()
                            Object.keys(dataTableRows).filter(x => !isNaN(x)).map(x => {
                                let rowExists = obj.find(`tbody:nth-child(2) > tr:nth-child(${parseInt(x)+1})`);
                                if(typeof dataTableRows[x] === 'object' && dataTableRows[x] !== null && rowExists.length){
                                    Object.keys(dataTableRows[x]).map(y => {
                                        let rowColumnExists = rowExists.find(`> td:nth-child(${parseInt(y)+1})`);
                                        if(typeof dataTableRows[x][y] === 'object' && dataTableRows[x][y] !== null && rowColumnExists.length){
                                            if(dataTableRows[x][y].display && (!rowColumnExists.text().trim().length || rowColumnExists.text() == "[object Object]") ) rowColumnExists.text(dataTableRows[x][y].display)
                                        }
                                    })
                                }
                            })
                        }
                    },
                    error: function(){

                    }
                });
            }

        }
        function dataTableServerRender(obj, filtro, info_footer, sorting , pagination, requestUri, startPage){
            let additionalOptions = {};
            if(requestUri){
                additionalOptions = {
                    "processing": true,
                    "serverSide": true,
                    ajax : function (data, callback, settings) {
                        if(!skipAjxCall){
                            limitPaginator = data.length;
                            getResponsePaginator(obj, requestUri,obj.dataTable().api().page(),data.length,data.draw,callback);
                        }
                    },
                    deferLoading : totalCount,
                };
            }
            if( obj.length ){
                let addAuxTable = false;
                if(!htmlBaseTableAux){
                    htmlBaseTableAux = obj[0].outerHTML;
                    htmlBaseTableAux = htmlBaseTableAux.replace(obj[0].id, tableIDAux);
                    addAuxTable = true;
                }
                obj.DataTable( Object.assign(additionalOptions, {
                        responsive: true,
                        autoWidth: false,
                        aLengthMenu: [
                            [50, 100,200, -1],
                            [50, 100,200, "Todos"]
                        ],
                        // displayStart:startPage,
                        iDisplayLength: limitPaginator,
                        pageLength:limitPaginator,
                        deferLoading : totalCount,
                        retrieve: true,
                        bFilter : filtro,
                        paging:   pagination,
                        info:     info_footer,
                        ordering: sorting,
                        language: {
                            "sProcessing":     "Procesando...",
                            "sLengthMenu":     "Mostrar _MENU_ registros",
                            "sZeroRecords":    "No se encontraron resultados",
                            "sEmptyTable":     "Ningún dato disponible en esta tabla",
                            "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                            "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
                            "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
                            "sInfoPostFix":    "",
                            "sSearch":         "Buscar:",
                            "sUrl":            "",
                            "sInfoThousands":  ",",
                            "sLoadingRecords": "Cargando...",
                            "oPaginate": {
                                "sFirst":    "Primero",
                                "sLast":     "Último",
                                "sNext":     "Siguiente",
                                "sPrevious": "Anterior"
                            },
                            "oAria": {
                                "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                                "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                            }
                        }
                    })
                );
                if(addAuxTable) obj.parent().append("<div style='width: 100%;height: 5px;visibility: hidden;overflow-y: auto;' id='container-table-aux'>"+htmlBaseTableAux+"</div>");
            }
        }
        function dataTableAuxRender(obj){
            if( obj.length ){
                obj.DataTable( Object.assign({
                        responsive: true,
                        autoWidth: false,
                        aLengthMenu: [
                            [ -1],
                            ["Todos"]
                        ],
                        iDisplayLength: -1,
                        retrieve: true,
                        bFilter : false,
                        paging:   true,
                        info:     false,
                        ordering: false,
                        language: {
                            "sProcessing":     "Procesando...",
                            "sLengthMenu":     "Mostrar _MENU_ registros",
                            "sZeroRecords":    "No se encontraron resultados",
                            "sEmptyTable":     "Ningún dato disponible en esta tabla",
                            "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                            "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
                            "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
                            "sInfoPostFix":    "",
                            "sSearch":         "Buscar:",
                            "sUrl":            "",
                            "sInfoThousands":  ",",
                            "sLoadingRecords": "Cargando...",
                            "oPaginate": {
                                "sFirst":    "Primero",
                                "sLast":     "Último",
                                "sNext":     "Siguiente",
                                "sPrevious": "Anterior"
                            },
                            "oAria": {
                                "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                                "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                            }
                        }
                    })
                );
            }
        }

        function getCountPaginatorAndResetTable(requestUri, creationFrom, creationTo, search, element){
            if(creationFrom == "") creationFrom = null;
            if(creationTo == "") creationTo = null;
            defaultAjax({
                url: requestUri+"/count",
                type: 'POST',
                data: {
                    creationFrom : creationFrom || null,
                    creationTo : creationTo || null,
                    search : search || null
                },
                success: function (data) {
                    if(data != null) data = JSON.parse(data);
                    if(data.sumCredits != null) {
                        if (document.querySelector("#sumCredits")) {
                            $('#sumCredits').text('Total de Desembolsos : ' + data.sumCredits);
                        }
                    }
                    if(data.count != null){
                        excludeSetTotals = true;
                        if (document.querySelector("#totalCredits")) {
                            $('#totalCredits').text('Total de Créditos : ' + data.count);
                        }
                        totalCount = data.count;
                        element.dataTable().fnClearTable();
                        element.dataTable().fnDestroy();
                        dataTableServerRender(element,false,false,false,true,requestUri,0);
                        element.DataTable().responsive.rebuild()
                        element.DataTable().responsive.recalc()
                        element.dataTable().api().draw("full-page");
                    }
                },
                error: function(){

                }
            });
        }

        $(document).ready( function () {
            $('[data-toggle="tooltip"]').tooltip();
            setTimeout(()=>{

                $("#apply-filter").off('click').on('click', function(e){
                    e.preventDefault();
                    // $("#actions-show-filter").css("display","block");
                    // $("#actions-filter").css("display","none");
                    // $(".tablefilter-filters").css("display","none");
                    let requestData = getDataFromForm('#form-termitated-list');
                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                })

                $("#searchValueFilter").keypress(function(e) {
                    let keyCode = (e.keyCode ? e.keyCode : e.which);
                    if(keyCode==13){
                        let requestData = getDataFromForm('#form-termitated-list');
                        getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                    }
                });

                $("#searchValueFilter").parent().find("i.search").click(function(e) {
                    let requestData = getDataFromForm('#form-termitated-list');
                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                });

                $("#actions-show-filter > .actions-show-filter").off('click').on('click', function(e){
                    e.preventDefault();
                    if($(".tablefilter-filters").is(":visible")){
                        $("body").removeClass("filter-showed");
                        $(".tablefilter-filters").css("display","none");
                    }
                    else{
                        $("body").addClass("filter-showed");
                        $(".tablefilter-filters").css("display","block");
                    }

                })

                $("#cancel-filter").off('click').on('click', function(e){
                    e.preventDefault();
                    $("body").removeClass("filter-showed");
                    $(".tablefilter-filters").css("display","none");
                    $('#form-termitated-list').trigger("reset");
                    $("#searchValueFilter").val(null);
                    getCountPaginatorAndResetTable(url, null, null ,null , $("#tableResults"));
                })

                $("#executeFilter").off('click').on('click', function (e){
                    e.preventDefault();
                    // $("#actions-show-filter").css("display","none");
                    // $("#actions-filter").css("display","block");
                    // $(".tablefilter-filters").css("display","block");
                })
            },1000)

            var $table = $('#tableResults');
            // dataTable($table, true, false, true, true);
            dataTableServerRender($table,false,false,false,true,url,0);


        });
        /*]]>*/
    </script>

</th:block>

<th:block th:fragment="list">

    <tr th:each="credit, iterCredit : ${credits}"
        th:style="${credit?.observationReason?.id != null }? 'background-color:#FFFFCC'">
        <td th:text="${iterCredit.count + (offset != null ? offset : 0)}"></td>
        <td th:text="${@utilService.dateFormat(credit?.inactiveWOScheduleDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(credit?.inactiveWOScheduleDate)}"></td>
        <td>
            <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).AZTECA)}">
                <th:block th:text="${credit?.code}"></th:block>
            </th:block>
            <th:block th:unless="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).AZTECA)}">
                <a th:href="@{/credit/__${credit?.id}__}" th:text="${credit?.code}" target="_blank"></a>
            </th:block>
        </td>
        <td th:text="${credit?.entityProductParams?.entityProduct}"></td>
        <th:block th:if="${!((page == 'generated' or page == 'callcenter') and @entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL))}">
            <td th:text="${credit?.personDocumentType?.name}"></td>
        </th:block>
        <td th:text="${credit?.personDocumentNumber}"></td>
        <td th:text="${credit?.personName}"></td>

        <th:block th:if="${page == 'terminated' or page == 'generated'}">
            <td th:text="${credit?.personFullSurnames}"></td>
        </th:block>
        <th:block th:unless="${page == 'terminated' or page == 'generated'}">
            <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                <td th:text="${credit?.personFirstSurname}"></td>
            </th:block>
            <th:block th:unless="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
                <td th:text="${credit?.personFirstSurname}"></td>
                <td th:text="${credit?.personLastSurname}"></td>
            </th:block>
        </th:block>
        <th:block th:if="${page == 'callcenter'}">
            <td th:text="${credit?.email}"></td>
            <td th:text="${credit?.phoneNumber}"></td>
        </th:block>
        <td th:text="${@utilService.doubleMoneyFormat(credit?.loanCapital, credit?.currency)}"></td>
        <td th:text="${credit?.installments}"></td>

        <th:block th:switch="${credit?.country?.id}">
            <td th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}" th:text="${@utilService.percentFormat(credit?.nominalAnualRate, credit?.currency)}"></td>
            <td th:case="*" th:text="${@utilService.percentFormat(credit?.effectiveAnnualRate, credit?.currency)}"></td>
        </th:block>

        <td>
            <a target="_blank" th:if="${showButton == true}"
               th:href="${@entityExtranetService.generateUserFilesLink(credit?.id)}" class="link_files">
                Descargar
            </a>
        </td>
        <th:block th:if="${page == 'terminated' or page == 'generated'}">
            <td th:text="${credit?.entityExtranetUser} != null ? ${credit?.entityExtranetUser?.userName} : ''" />
        </th:block>
        <th:block th:if="${page == 'terminated'}">
            <td th:if="${credit?.getGeneratedOnEntity() == true and credit?.getDisbursedOnEntity() == true}">
                <span th:text="${credit?.disbursementEntityUser}"></span>
            </td>
            <td th:unless="${credit?.getGeneratedOnEntity() == true and credit?.getDisbursedOnEntity() == true}"></td>
        </th:block>

        <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).ABACO)}">
            <td th:text="${credit?.employer?.name}"/>
        </th:block>

        <!--        ACCIONES-->
        <th:block th:if="${page == 'pending'}">
            <td>
                <button th:if="${credit.showPendingToValidateButton  and showButton == true}" id="validateCredit" type="button"
                        class="btn blue btn-sm" style="width:100px;"
                        th:onclick="'validateCredit('+${credit?.id}+', this)'">
                    <i class="fa fa-check"></i> Verificado
                </button>
                <button th:if="${credit.showPendingObservations  and showButton == true}" id="creditObservations"
                        th:disabled="${credit?.observationReason?.id != null}" type="button" class="btn grey btn-sm"
                        style="width:100px;" th:onclick="'showCreditObservationsModal('+${credit?.id}+')'">
                    <i class="fa fa-search"></i> Observado
                </button>
                <button th:if="${credit.showPendingRejectButton  and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn red btn-sm openRejectCreditModal" th:onclick="'showRegisterCreditRejectionModal('+${credit?.id}+')'">
                    <i class="fa fa-ban"></i> Rechazado
                </button>
                <button th:if="${credit.showAccesoScheduleAppointmentButton  and showButton == true}" id="scheduleAppointment" type="button" class="btn blue btn-sm scheduleAppointmentModal" th:onclick="'showScheduleAppointmentModal('+${credit?.id}+')'">
                    <i class="fa fa-check"></i> Agendar cita
                </button>
                <button th:if="${credit.showAccesoReScheduleAppointmentButton  and showButton == true}" id="rescheduleAppointment" type="button" class="btn blue btn-sm scheduleAppointmentModal" th:onclick="'showScheduleAppointmentModal('+${credit?.id}+')'">
                    <i class="fa fa-check"></i> Reagendar cita
                </button>
            </td>
        </th:block>

        <!--        ACCIONES-->
        <th:block th:if="${credit?.subStatus?.id == T(com.affirm.common.model.catalog.CreditSubStatus).PENDING_ENTIY_LOAD} and ${page != 'callcenter'}">
            <th:block th:if="${@catalogService.getEntityProductParam(credit?.entity?.id, credit?.product?.id)?.showDisbursement == true}">

                <td shiro:hasPermission="credit:toUpload:upload">
                    <button shiro:hasPermission="credit:toUpload:upload" th:if="${showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm loadCredit" th:onclick="'showRegisterGeneratedCreditUploadModal('+${credit?.id}+')'">
                        <i class="fa fa-check"></i> Cargado
                    </button>
                    <button shiro:hasPermission="credit:toUpload:reject"  th:if="${showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn red btn-sm openRejectCreditModal"
                            th:onclick="'showRegisterGeneratedCreditRejectionModal('+${credit?.id}+')'">
                        <i class="fa fa-ban"></i> Rechazado
                    </button>
                </td>
            </th:block>
            <th:block th:unless="${@catalogService.getEntityProductParam(credit?.entity?.id, credit?.product?.id)?.showDisbursement == true}">
                <td></td>
            </th:block>
        </th:block>
        <!--        <th:block th:unless="${credit?.subStatus?.id == T(com.affirm.common.model.catalog.CreditSubStatus).PENDING_ENTIY_LOAD}">-->
        <!--            <td></td>-->
        <!--        </th:block>-->

        <!--        ACCIONES-->
        <th:block th:if="${page == 'generated'}">
            <td th:if="${credit.showAeluInternalDisbursementButton or credit.showAeluUploadFinalDocumentationButton or credit.showAccesoUploadFinalDocumentationButton or credit.showGeneratedDisbursementButton or credit.showGeneratedRejectButton or credit.showUploadRipleyFinalSchedule or credit.showRemoveRipleyFinalSchedule}">
                <button th:if="${credit.showAeluInternalDisbursementButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm internalDisbursement" th:onclick="'askInternalDisbursement('+${credit?.id}+')'">
                    Desembolso Interno
                </button>
                <button th:if="${credit.showAeluUploadFinalDocumentationButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm uploadFinalDocumentation" th:onclick="'showUploadFinalDocumentationModal('+${credit?.id}+')'">
                    Subir Doc. Final
                </button>
                <button th:if="${credit.showAccesoUploadFinalDocumentationButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm uploadFinalDocumentation" th:onclick="'showUploadFinalDocumentationModal('+${credit?.id}+')'">
                    Subir Documentación
                </button>
                <button th:if="${credit.showGeneratedDisbursementButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm disbursmentCredit" th:onclick="'showRegisterGeneratedCreditDisbursementModal('+${credit?.id}+','+${credit?.amount}+','+${credit?.installments}+','+${credit?.effectiveAnnualRate}+')'">
                    <i class="fa fa-check"></i> Desembolsado
                </button>
                <button th:if="${credit.showGeneratedRejectButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn red btn-sm openRejectCreditModal" th:onclick="'showRegisterDisbursementCreditRejectionModal('+${credit?.id}+')'">
                    <i class="fa fa-ban"></i> Rechazado
                </button>
                <button th:if="${credit.showUploadRipleyFinalSchedule and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm uploadFinalSchedule" th:onclick="'openUploadFinalScheduleModal('+${credit?.id}+')'">
                    Subir Cronograma Final
                </button>
                <button th:if="${credit.showRemoveRipleyFinalSchedule and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm removeFinalSchedule" th:onclick="'removeFinalSchedule('+${credit?.id}+', this)'">
                    Eliminar Cronograma Final
                </button>
            </td>
        </th:block>
        <th:block th:if="${page == 'generatedtc'}">
            <!--            <td>-->
            <!--                <button th:if="${credit.showGeneratedDisbursementButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn blue btn-sm disbursmentCredit" th:onclick="'showRegisterGeneratedCreditDisbursementModal('+${credit?.id}+','+${credit?.amount}+','+${credit?.installments}+','+${credit?.effectiveAnnualRate}+')'">-->
            <!--                    <i class="fa fa-check"></i> Desembolsado-->
            <!--                </button>-->
            <!--                <button th:if="${credit.showGeneratedRejectButton and showButton == true}" th:attr="data-id=${credit?.id}" type="button" class="btn red btn-sm openRejectCreditModal" th:onclick="'showRegisterDisbursementCreditRejectionModal('+${credit?.id}+')'">-->
            <!--                    <i class="fa fa-ban"></i> Rechazado-->
            <!--                </button>-->
            <!--            </td>-->
        </th:block>

        <th:block th:if="${@entityExtranetService.getLoggedUserEntity().containsEntityId(T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL)}">
            <td th:if="${page == 'generated' or page == 'terminated' or page == 'callcenter'}">
                <select class="form-control  internal-status-select" th:attr="data-credit-id=${credit.id}" name="internalStatus" onchange="updateInternalStatus(this)">
                    <option value="Doc. por enviar"
                            th:if="${userHierarchy eq null or (not userHierarchy.isNull('level1') and not userHierarchy.isNull('level2') and not userHierarchy.isNull('level3'))}"
                            th:selected="'Doc. por enviar' == ${credit.getEntityCustomDataBancoDelSolInternalStatus()}">Doc. por enviar</option>
                    <option value="Doc. enviada"
                            th:if="${userHierarchy eq null or (not userHierarchy.isNull('level1') and not userHierarchy.isNull('level2') and not userHierarchy.isNull('level3'))}"
                            th:selected="'Doc. enviada' == ${credit.getEntityCustomDataBancoDelSolInternalStatus()}">Doc. enviada</option>
                    <option value="Doc. recibida"
                            th:if="${userHierarchy eq null}"
                            th:selected="'Doc. recibida' == ${credit.getEntityCustomDataBancoDelSolInternalStatus()}">Doc. recibida</option>
                    <option value="Doc. a revisar"
                            th:if="${userHierarchy eq null}"
                            th:selected="'Doc. a revisar' == ${credit.getEntityCustomDataBancoDelSolInternalStatus()}">Doc. a revisar</option>
                </select>
            </td>
        </th:block>
        <th:block>
            <td th:if="${page != 'terminated' and page != 'callcenter' and (credit?.status?.id == T(com.affirm.common.model.catalog.CreditStatus).INACTIVE_WO_SCHEDULE or credit?.status?.id == T(com.affirm.common.model.catalog.CreditStatus).INACTIVE_W_SCHEDULE)}">
                <button th:if="${showButton == true}" shiro:hasPermission="loan:expire" type="button" class="btn blue btn-sm expire-loan" th:onclick="'expireLoanApplication(this,' + ${credit?.loanApplicationId} + ')'">
                    Expirar solicitud
                </button>
            </td>
            <th:block th:unless="${page != 'terminated' and page != 'callcenter' and (credit?.status?.id == T(com.affirm.common.model.catalog.CreditStatus).INACTIVE_WO_SCHEDULE or credit?.status?.id == T(com.affirm.common.model.catalog.CreditStatus).INACTIVE_W_SCHEDULE)}">
                <td th:if="${page != 'callcenter'}"></td>
            </th:block>

        </th:block>
    </tr>

    <script th:inline="javascript">
        /*<![CDATA[*/

        function updateInternalStatus(selectElement){
            defaultAjax({
                url: /*[[@{/updateInternalStatus}]]*/null,
                type: 'POST',
                data: {
                    creditId: $(selectElement).data('credit-id'),
                    internalStatus: $(selectElement).val()
                },
                success: function (data) {

                },
                error: function (data) {
                }
            });
        }

        function validateCredit(creditId, button) {
            var btn = $(button);
            btn.loading('', 2);
            defaultAjax({
                url: /*[[@{/updateStatus/__${page}__}]]*/null,
                type: 'POST',
                data: {
                    creditId: creditId
                },
                success: function (data) {
                    resetTimer();
                    // $('#tableResults > tbody').html(data);
                    //
                    // var $table = $('.table');
                    // dataTable($table, true, false, true, true);
                    let requestData = getDataFromForm('#form-termitated-list');
                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                },
                error: function (data) {
                    console.log('entro');
                    $('#validateCredit').unloading();
                }
            });
        }

        $('.waitingCredit').on('click', function(event) {
            event.preventDefault();
            var creditId = $(this).data('id');
            var btn = $(this);
            btn.loading('', 2);
            defaultAjax({
                url: /*[[@{/updateStatus/__${page}__}]]*/null,
                type: 'POST',
                data: {
                    creditId: creditId
                },
                success: function (data) {
                    resetTimer();
                    // $('#tableResults > tbody').html(data);
                    //
                    // var $table = $('.table');
                    // dataTable($table, true, false, true, true);
                    let requestData = getDataFromForm('#form-termitated-list');
                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                }
            });
        });

        $('.generateCredit').on('click', function(event) {
            event.preventDefault();
            var creditId = $(this).data('id');
            var btn = $(this);
            btn.loading('', 2);
            defaultAjax({
                url: /*[[@{/updateStatus/__${page}__}]]*/null,
                type: 'POST',
                data: {
                    creditId: creditId
                },
                success: function (data) {
                    resetTimer();
                    // $('#tableResults > tbody').html(data);
                    //
                    // var $table = $('.table');
                    // dataTable($table, true, false, true, true);
                    let requestData = getDataFromForm('#form-termitated-list');
                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                }
            });
        });


        function showCreditObservationsModal(creditId) {

            $('#setCreditObservationModal').modal();
            $('#setCreditObservationModal .loading').hide();
            $('#setCreditObservationModal .content').show();
            $('#setCreditObservationModal').find('option').remove();
            defaultAjax({
                url: /*[[@{/observationReasons}]]*/null,
                type: 'GET',
                data: {
                    creditId: creditId
                },
                success: function (data) {
                    var arr = JSON.parse(data);
                    var len = arr.length;
                    if(len==0){
                        $('#creditObservationReason').append($('<option>', {
                            value: -1,
                            text: 'No se encontraron motivos de observación'
                        }));

                        $('#creditObservationReasonButton').disableButton();
                    }else{
                        $('#creditObservationReasonButton').enableButton();
                    }
                    for (var i = 0; i < len; i++) {
                        $('#creditObservationReason').append($('<option>', {
                            value: arr[i].id,
                            text: arr[i].reason
                        }));
                    }
                }
            });
            $('#creditObservationReasonButton').click(function () {
                promptObserveCredit(creditId, $('#creditObservationReason').val());
            });
        }
        function promptObserveCredit(creditId, observationReasonId){

            swal({
                    title: "&iquest;Est&aacute;s seguro de observar el cr&eacute;dito?",
                    text: "No podr&aacute;s revertir el cambio.",
                    html: true,
                    showCancelButton: true,
                    confirmButtonColor: "#36c6d3",
                    confirmButtonText: "¡Si, Observar!",
                    closeOnConfirm: true
                },
                function () {
                    defaultAjax({
                        url: /*[[@{/observationReason/}]]*/null,
                        type: 'POST',
                        data: {
                            creditId: creditId,
                            observationReasonId: observationReasonId
                        },
                        success: function (data) {
                            swal("Observado", "El crédito ha sido observado correctamente.", "success");
                            $('#setCreditObservationModal').modal('toggle');
                            resetTimer();
                            // $('#tableResults > tbody').html(data);
                            // var $table = $('.table');
                            // dataTable($table, true, false, true, true);
                            let requestData = getDataFromForm('#form-termitated-list');
                            getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                        }
                    })
                });
        }

        function showRegisterCreditRejectionModal(creditId) {
            $('#registerCreditRejectionModal').modal();
            $('#registerCreditRejectionModal .loading').hide();
            $('#registerCreditRejectionModal .content').show();
            $('#creditRejectionReason').find('option').remove();
            defaultAjax({
                url: /*[[@{/rejectionReasons}]]*/null,
                type: 'GET',
                data: {
                    creditId: creditId,
                    rejectionReasonlistTypeId:/*[[${T(com.affirm.common.model.catalog.CreditRejectionReason).ONLY_VERIFICATION_LIST_TYPE}]]*/null
                },
                success: function (data) {
                    var arr = JSON.parse(data);
                    var len = arr.length;
                    if(len==0){
                        $('#creditRejectionReason').append($('<option>', {
                            value: -1,
                            text: 'No se encontraron motivos de rechazo'
                        }));

                        $('#registerCreditRejectionButton').disableButton();
                    }else{
                        $('#registerCreditRejectionButton').enableButton();
                    }
                    for (var i = 0; i < len; i++) {
                        $('#creditRejectionReason').append($('<option>', {
                            value: arr[i].id,
                            text: arr[i].reason
                        }));
                    }
                }
            });
            $('#registerCreditRejectionButton').click(function () {
                askRejectCredit(creditId, $('#creditRejectionReason').val(), $('#creditRejectionComment').val());
            });
        }

        function askRejectCredit(creditId, creditRejectionReason, creditRejectionComment) {
            swal({
                    title: "&iquest;Est&aacute;s seguro de rechazar el cr&eacute;dito?",
                    text: "No podr&aacute;s revertir el cambio.",
                    type: "warning",
                    html: true,
                    showCancelButton: true,
                    confirmButtonColor: "#36c6d3",
                    confirmButtonText: "¡Si, Rechazar!",
                    closeOnConfirm: true
                },
                function () {
                    defaultAjax({
                        url: /*[[@{/rejectCredit/__${page}__}]]*/null,
                        type: 'POST',
                        data: {
                            creditId: creditId,
                            creditRejectionReasonId: creditRejectionReason,
                            creditRejectionReasonComment: creditRejectionComment,
                        },
                        success: function (data) {
                            resetTimer();
                            // $('#tableResults > tbody').html(data);
                            swal("Eliminada", "El crédito ha sido eliminado correctamente.", "success");
                            $('#registerCreditRejectionModal').modal('toggle');
                            $('#creditRejectionComment').val(null);

                            // var $table = $('.table');
                            // dataTable($table, true, false, true, true);
                            let requestData = getDataFromForm('#form-termitated-list');
                            getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                        }
                    })
                });
        }

        function showRegisterGeneratedCreditRejectionModal(creditId) {
            $('#registerGeneratedCreditRejectionModal').modal();
            $('#registerGeneratedCreditRejectionModal .loading').hide();
            $('#registerGeneratedCreditRejectionModal .content').show();

            $('#creditGeneratedRejectionReason').show();
            $('#creditDisbursementRejectionReason').hide();
            $('#creditGeneratedRejectionReason').find('option').remove();

            defaultAjax({
                url: /*[[@{/rejectionReasons}]]*/null,
                type: 'GET',
                data: {
                    creditId: creditId,
                    rejectionReasonlistTypeId:/*[[${T(com.affirm.common.model.catalog.CreditRejectionReason).REGULAR_LIST_TYPE}]]*/null
                },
                success: function (data) {
                    var arr = JSON.parse(data);
                    var len = arr.length;
                    if(len==0){
                        $('#creditGeneratedRejectionReason').append($('<option>', {
                            value: -1,
                            text: 'No se encontraron motivos de rechazo'
                        }));

                        $('#registerGeneratedCreditRejectionButton').disableButton();
                    }else{
                        $('#registerGeneratedCreditRejectionButton').enableButton();
                    }
                    for (var i = 0; i < len; i++) {
                        $('#creditGeneratedRejectionReason').append($('<option>', {
                            value: arr[i].id,
                            text: arr[i].reason
                        }));
                    }
                }
            });
            $('#registerGeneratedCreditRejectionButton').click(function () {
                askGeneratedRejectCredit(creditId, $('#creditGeneratedRejectionReason').val(), $('#creditGeneratedRejectionComment').val());
            });
        }

        function showRegisterDisbursementCreditRejectionModal(creditId) {
            $('#registerGeneratedCreditRejectionModal').modal();
            $('#registerGeneratedCreditRejectionModal .loading').hide();
            $('#registerGeneratedCreditRejectionModal .content').show();

            $('#creditGeneratedRejectionReason').hide();
            $('#creditDisbursementRejectionReason').show();
            $('#creditDisbursementRejectionReason').find('option').remove();

            defaultAjax({
                url: /*[[@{/rejectionReasons}]]*/null,
                type: 'GET',
                data: {
                    creditId: creditId,
                    rejectionReasonlistTypeId:/*[[${T(com.affirm.common.model.catalog.CreditRejectionReason).REGULAR_LIST_TYPE}]]*/null
                },
                success: function (data) {
                    var arr = JSON.parse(data);
                    var len = arr.length;
                    if(len==0){
                        $('#creditDisbursementRejectionReason').append($('<option>', {
                            value: -1,
                            text: 'No se encontraron motivos de rechazo'
                        }));

                        $('#registerGeneratedCreditRejectionButton').disableButton();
                    }else{
                        $('#registerGeneratedCreditRejectionButton').enableButton();
                    }
                    for (var i = 0; i < len; i++) {
                        $('#creditDisbursementRejectionReason').append($('<option>', {
                            value: arr[i].id,
                            text: arr[i].reason
                        }));
                    }
                }
            });
            $('#registerGeneratedCreditRejectionButton').click(function () {
                askGeneratedRejectCredit(creditId, $('#creditDisbursementRejectionReason').val(), $('#creditGeneratedRejectionComment').val());
            });
        }

        function showRegisterGeneratedCreditUploadModal(creditId){
            $('#registerCreditUploadModal').modal();
            $('#registerCreditUploadModal .loading').hide();
            $('#registerCreditUploadModal .content').show();
            $('#registerCreditUploadModalButton').click(function () {
                askGeneratedUploadCredit(creditId, $('#creditUploadReferenceNumber').val(), $('#loanUploadReferenceNumber').val());
            });
        }

        var minDate;

        function showRegisterGeneratedCreditDisbursementModal(creditId, amount, installmets, tea){
            defaultAjax({
                url: /*[[@{/getSignatureDate}]]*/null,
                type: 'POST',
                data: {
                    creditId: creditId
                },
                success: function (data) {
                    minDate = $.parseJSON(data);
                    if(amount != null)
                        $('#registerCreditDisbursementModal input[name=amount]').val(amount);
                    if(installmets != null)
                        $('#registerCreditDisbursementModal input[name=installments]').val(installmets);
                    if(tea != null)
                        $('#registerCreditDisbursementModal input[name=tea]').val(tea);

                    $('#registerCreditDisbursementModal').data("minDate", minDate);
                    showCalendar();
                    $('#registerCreditDisbursementModal').modal();
                    $('#registerCreditDisbursementModal .loading').hide();
                    $('#registerCreditDisbursementModal .content').show();
                    $('#registerCreditDisbursementModalButton').click(function () {
                        askGeneratedDisbursementCredit(creditId);
                    });
                }
            });
        }

        function askGeneratedUploadCredit(creditId, creditDisbursementReferenceNumber, loanDisbursementReferenceNumber) {
            if ($('#creditUploadReferenceNumber').val().replace(/\s/g,"") == "" && !$('#complete_info').prop('checked')){
                swal({
                    title: "",
                    text: "Se debe ingresar el número de referencia",
                    type: "error",
                    html: true,
                    showCancelButton: false,
                    confirmButtonColor: "#36c6d3",
                    confirmButtonText: "OK",
                    closeOnConfirm: true
                });
            }else{
                if ($('#loanUploadReferenceNumber').length && $('#loanUploadReferenceNumber').val().replace(/\s/g,"") == "" && !$('#loan_complete_info').prop('checked')){
                    swal({
                        title: "",
                        text: "Se debe ingresar el número de referencia",
                        type: "error",
                        html: true,
                        showCancelButton: false,
                        confirmButtonColor: "#36c6d3",
                        confirmButtonText: "OK",
                        closeOnConfirm: true
                    });
                }else{
                    swal({
                            title: "&iquest;Est&aacute;s seguro de cargar el cr&eacute;dito?",
                            text: "No podr&aacute;s revertir el cambio.",
                            type: "warning",
                            html: true,
                            showCancelButton: true,
                            confirmButtonColor: "#36c6d3",
                            confirmButtonText: "¡Si, Cargar!",
                            closeOnConfirm: true
                        },
                        function () {
                            $('#registerCreditUploadModalButton').loading('', 2);
                            defaultAjax({
                                url: /*[[@{/updateStatus/__${page}__}]]*/null,
                                type: 'POST',
                                data: {
                                    creditId: creditId,
                                    creditDisbursementReferenceNumber: creditDisbursementReferenceNumber != null ? creditDisbursementReferenceNumber : '',
                                    loanDisbursementReferenceNumber: loanDisbursementReferenceNumber != null ? loanDisbursementReferenceNumber : ''
                                },
                                success: function (data) {
                                    resetTimer();
                                    // $('#tableResults > tbody').html(data);
                                    swal("Cargado", "El crédito ha sido cargado correctamente.", "success");
                                    $('#registerCreditUploadModal').modal('toggle');


                                    // var $table = $('.table');
                                    // dataTable($table, true, false, true, true);
                                    let requestData = getDataFromForm('#form-termitated-list');
                                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                                },
                                error: function(){
                                    $('#registerCreditUploadModalButton').unloading();
                                }
                            })
                        });
                }
            }
        }

        function askGeneratedDisbursementCredit(creditId) {
            if($('#frmRegisterCreditDisbursementModal').valid()){
                swal({
                        title: "&iquest;Est&aacute;s seguro de desembolsar el cr&eacute;dito generado?",
                        text: "No podr&aacute;s revertir el cambio.",
                        type: "warning",
                        html: true,
                        showCancelButton: true,
                        confirmButtonColor: "#36c6d3",
                        cancelButtonText: "Cancelar",
                        confirmButtonText: "¡Si, Desembolsar!",
                        closeOnConfirm: true
                    },
                    function () {
                        if($('#frmRegisterCreditDisbursementModal').valid()){
                            $('#registerCreditDisbursementModalButton').loading('', 2);
                            defaultAjax({
                                url: /*[[@{/updateStatus/__${page}__}]]*/null,
                                type: 'POST',
                                data: $.extend($('#frmRegisterCreditDisbursementModal').serializeObject(), {
                                    creditId: creditId,
                                }),
                                success: function (data) {
                                    resetTimer();
                                    // $('#tableResults > tbody').html(data);
                                    let requestData = getDataFromForm('#form-termitated-list');
                                    getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                                    swal("Desembolsado", "El crédito ha sido desembolsado correctamente.", "success");
                                    $('#registerCreditDisbursementModal').modal('toggle');
                                },
                                error: function (data) {
                                    $('#registerCreditDisbursementModalButton').unloading();
                                }
                            })
                        }
                    });
            }
        }

        function askGeneratedRejectCredit(creditId, creditRejectionReason, creditRejectionComment) {
            swal({
                    title: "&iquest;Est&aacute;s seguro de rechazar el cr&eacute;dito generado?",
                    text: "No podr&aacute;s revertir el cambio.",
                    type: "warning",
                    html: true,
                    showCancelButton: true,
                    confirmButtonColor: "#36c6d3",
                    confirmButtonText: "¡Si, Rechazar!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: true
                },
                function () {
                    defaultAjax({
                        url: /*[[@{/rejectCredit/__${page}__}]]*/null,
                        type: 'POST',
                        data: {
                            creditId: creditId,
                            page : /*[[${page}]]*/null,
                            creditRejectionReasonId: creditRejectionReason,
                            creditRejectionReasonComment: creditRejectionComment
                        },
                        success: function (data) {
                            resetTimer();
                            // $('#tableResults > tbody').html(data);
                            swal("Eliminada", "El crédito ha sido eliminado correctamente.", "success");
                            $('#registerGeneratedCreditRejectionModal').modal('toggle');
                            $('#creditGeneratedRejectionComment').val(null);

                            // var $table = $('.table');
                            // dataTable($table, true, false, true, true);
                            let requestData = getDataFromForm('#form-termitated-list');
                            getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                        }
                    })
                });
        }

        $(document).ready(function(){
            let totalCredits = /*[[${totalCredits}]]*/null;
            if(typeof excludeSetTotals === 'undefined') var excludeSetTotals = null;
            if(totalCredits != null && !excludeSetTotals){
                $('#totalCredits').text('Total de Créditos : ' + totalCredits);
                $('#sumCredits').text('Total de Desembolsos : ' + /*[[${@utilService.doubleMoneyFormat(sumCredits, currency)}]]*/null);
            }
        })

        function expireLoanApplication(event, loanId) {
            var btnRef = $(event);

            swal({
                    title: "",
                    text: "¿Está seguro que desea expirar la solicitud?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "¡Sí, expirar!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function (expire) {
                    swal.close();

                    if (expire) {
                        btnRef.loading();
                        defaultAjax({
                            url: /*[[@{/loanApplication/__${page}__/expire}]]*/null,
                            type: 'POST',
                            data: {
                                loanId: loanId
                            },
                            success: function (data) {
                                resetTimer();
                                // $('#tableResults').DataTable().destroy();
                                // $('#tableResults > tbody').html(data);
                                // var $table = $('.table');
                                // dataTable($table, true, false, true, true);
                                let requestData = getDataFromForm('#form-termitated-list');
                                getCountPaginatorAndResetTable(url, requestData.creationFrom, requestData.creationTo ,requestData.searchValue , $("#tableResults"));
                                swal("Expirada", "La solicitud fue expirada.", "success");
                            },
                            complete: function () {
                                btnRef.unloading();
                            }
                        });
                    }

                });
        }
        /*]]>*/
    </script>
</th:block>
</body>
</html>