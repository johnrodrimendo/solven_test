<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/extranetTemplate(sidebarClosed=true)">
<head>

    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>

    <!--Drop Zone-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}"
          rel="stylesheet"/>

    <!--Ekko Lightbox For Images-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}"
          rel="stylesheet"/>

    <!-- CounterUp -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.waypoints.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.counterup.min.js'}"
            type="text/javascript"></script>

    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet"
          type="text/css"/>


    <!-- Swipebox -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}"
          rel="stylesheet"/>

    <!-- Owl. Carousel -->
    <link rel="stylesheet"
          th:href="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.js'}"></script>

    <!-- Flot -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.resize.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.categories.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.pie.min.js'}"
            type="text/javascript"></script>

    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/css/bootstrap-datepicker3.min.css'}" />
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/js/bootstrap-datepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker-1.9/dist/locales/bootstrap-datepicker.es.min.js'}"></script>

    <!--Jquery Mask-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-mask/dist/jquery.mask.min.js'}"></script>

    <script th:inline="javascript">
        Dropzone.autoDiscover = false;
    </script>

    <!--TOKY-->
    <script th:if="${@configuration.TOKY_ACTIVE()}">(function (v, p) {
        var s = document.createElement('script');
        s.src = 'https://app.toky.co/resources/widgets/toky-widget.js?v=' + v;
        s.onload = function () {
            Toky.load(p);
        };
        document.head.appendChild(s);
    })('6800f1c', {
        "$lang": "es",
        "$username": "Solven",
        "$bubble": false,
        "$text": "Ll√°manos Gratis",
        "$color": "#00aabb,#f7323f,#ffffff"
    })
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/

        $(document).on('ready', function () {

            var jsonValidator = createFormValidationJson(JSON.parse(/*[[${form.validator.toJson(#locale)}]]*/), $('#createLoanForm'));
            $('#createLoanForm').validateForm(jsonValidator);

            // Set dinamic validation
            $('#docType').change(function () {
                var dniValidator = /*[[${T(com.affirm.common.util.ValidatorUtil).DOC_NUMBER_DNI.toJson(#locale).toString()}]]*/null;
                var ceValidator = /*[[${T(com.affirm.common.util.ValidatorUtil).DOC_NUMBER_CE.toJson(#locale).toString()}]]*/null;
                var dniValidatorJson = JSON.parse(dniValidator);
                var ceValidatorJson = JSON.parse(ceValidator);

                if ($(this).val() == '1') {
                    jsonValidator.rules.docNumber.maxlength = dniValidatorJson.maxCharacters;
                } else if ($(this).val() == '2') {
                    jsonValidator.rules.docNumber.maxlength = ceValidatorJson.maxCharacters;
                }
                $('#createLoanForm').validateForm(jsonValidator);
            });

            $('#createLoanButton').click(function (event) {
                if(!$('#createLoanForm').valid()){
                    return;
                }
                var baseUrl = /*[[@{/}]]*/null;
                var customEndpoint = $(this).data('endpoint') ? $(this).data('endpoint') : 'createLoanApplication';
                $('#createLoanButton').loading();
                defaultAjax({
                    url: baseUrl + customEndpoint,
                    type: 'POST',
                    data: $('#createLoanForm').serializeObject(),
                    success: function (data) {
                        $('#createLoanButton').unloading();
                    },
                    error: function (error) {
                        $('#createLoanButton').unloading();
                    }
                });
            });

            $("select").keyup(function (e) {
                if(e.keyCode == 13) $("#createLoanButton").click();
            });

            $("#docNumber").keyup(function (e) {
                e.preventDefault();
                if(e.keyCode == 13) $("#createLoanButton").click();
            });
        });
        /*]]>*/
    </script>
</head>
<body>
<th:block layout:fragment="header">
<!--    <th:block th:replace="fragments/headers :: entityDashboardHeader "></th:block>-->
    <div class="clearfix"></div>
</th:block>
<th:block layout:fragment="content" th:with="userEntityId = ${@entityExtranetService.getLoggedUserEntity().getEntities().get(0).getId()}">
    <th:block th:replace="fragments/extranetSidebarFragments :: extranetEntitySidebar(currentPage='dashboard')"></th:block>

    <th:block th:if="${userEntityId == T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL}">
        <th:block th:replace="entityExtranet/fragments/extranetDashboardFragments :: bdsBranding"></th:block>
    </th:block>
    <th:block th:unless="${userEntityId == T(com.affirm.common.model.catalog.Entity).BANCO_DEL_SOL}">
        <th:block th:replace="entityExtranet/fragments/extranetDashboardFragments :: peBranding"></th:block>
    </th:block>

</th:block>


</body>
</html>