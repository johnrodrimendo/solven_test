<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="question_client">
</th:block>

<th:block th:fragment="question_backoffice">
    <form class="question-form" th:object="${form}" th:attr="data-random-id=${randomId}">
        <div class="row">
            <p th:utext="#{questions.block.customProfession}"></p>
            <div class="form-group">
                <select name="customProfession" class="form-control">
                    <option value="" hidden="hidden"></option>
                    <th:block th:each="profession : ${customProfessions}">
                        <option th:value="${profession.id}" th:text="${profession.custom_profession}"></option>
                    </th:block>
                </select>
                <div class="errorContainer"></div>
            </div>
        </div>
    </form>
    <script th:inline="javascript">
        /*<![CDATA[*/
        (function() {
            var questionFlow = new QuestionFlow([[${questionId}]], [[${randomId}]]);
            questionFlow.initializeFormValidation(/*[[${form.validator.toJson(#locale)}]]*/);
            questionFlow.getFormValuesJson = function(){
                return $.extend(questionFlow.getFormElement().serializeObject(), {
                    activityTypeId: $('div[data-question-id=26]').find('select[name=activityType]').val(),
                    subActivityTypeId: $('div[data-question-id=32]').find('select[name=subActivity]').val()});
            };

            questionFlow.find('select[name=customProfession]').on('change', function () {
                questionFlow.loadNextQuestions();
            });

            questionFlow.callCustomMethod('getCustomProfessions', {
                activityTypeId: $('div[data-question-id=26]').find('select[name=activityType]').val(),
                subActivityTypeId: $('div[data-question-id=32]').find('select[name=subActivity]').val()
            }, function (data) {
                var arr = JSON.parse(data);
                var html = '<option value="" hidden="hidden"></option>';
                var len = arr.length;
                for (var i = 0; i < len; i++) {
                    html += '<option value="' + arr[i].id + '">' + arr[i].custom_profession + '</option>';
                }
                questionFlow.find('select[name=customProfession]').html(html);
            }, function (data) {
                showErrorModal('Hubo un problema al obtener las provincias.');
            });

        })();
        /*]]>*/
    </script>
</th:block>
</html>