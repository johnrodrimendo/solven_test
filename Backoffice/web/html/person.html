<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/defaultTemplate">
<head>
    <meta charset="ISO-8859-1"/>
    <title>Person</title>

    <!--Ekko Lightbox For Images-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}" rel="stylesheet"/>
    <!--Drop Zone-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}" rel="stylesheet"/>
    <!--JPlayer-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jPlayer/dist/jplayer/jquery.jplayer.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/jPlayer/dist/skin/blue.monday/css/jplayer.blue.monday.min.css'}" rel="stylesheet"/>
    <!--Json Viewer-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/json-viewer/jquery.json-viewer.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/json-viewer/jquery.json-viewer.css'}" rel="stylesheet"/>
    <!--X-Editable-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/x-editable/dist/bootstrap3-editable/css/bootstrap-editable.css'}" rel="stylesheet"/>
    <!-- Moment -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/moment/min/moment.min.js'}"></script>
    <!--Range slider-->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/ion.rangeSlider/css/ion.rangeSlider.css'}"/>
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/ion.rangeSlider/css/ion.rangeSlider.skinNice.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ion.rangeSlider/js/ion.rangeSlider.min.js'}"></script>
    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>
    <!--Jquery Numeric-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/numeric/jquery.numeric.min.js'}"></script>
    <!--Google Maps

    <script th:src="'https://maps.googleapis.com/maps/api/js?key='+${T(com.affirm.system.configuration.Configuration).GOOGLE_API_KEY}"
            async="async" defer="defer"></script>
    -->
    <script async="true" defer="defer"
            th:src="${'https://maps.googleapis.com/maps/api/js?libraries=places&amp;key=' + T(com.affirm.system.configuration.Configuration).GOOGLE_API_KEY}"></script>

    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/js/bootstrap-datepicker.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/locales/bootstrap-datepicker.es.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datetimepicker/bootstrap-datetimepicker.js'}"></script>
    <!-- Own -->
    <script th:src="@{/js/QuestionFrameworkBO.js}"></script>
    <style>
        #lstLoanActions>li>a {
            padding: 5px 16px !important;
        }
        .errorContainer.form-bo {
            font-size: 80%;
            color: #F7323F;
        }
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $.fn.editable.defaults.mode = 'popup';

        var personId = /*[[${person?.id}]]*/;
        var userId = /*[[${person?.userId}]]*/;
        var personDocType = /*[[${person?.documentType}]]*/;
        var personDocNumber = /*[[${person?.documentNumber}]]*/;
        var creditCode = /*[[${creditCode}]]*/;
        var creditId = /*[[${creditId}]]*/;
        var applicationCode = /*[[${applicationCode}]]*/;
        var applicationId = /*[[${applicationId}]]*/;

        $(document).ready(function () {

            $('a[data-toggle="tab"][role="personTab"]').on('shown.bs.tab', function (e) {
                        var $targetDiv = $($(e.target).attr("href")); // activated tab
                        console.log($targetDiv.selector);

                        $('a[data-toggle="tab"][role="personTab"]').data("selected", false);
                        $(this).data("selected", true);

                        // Now everything is refreshed when clicked
                        refreshTabAjax($(e.target).attr("href").split("_")[1]);
                    }
            );

            //Fire the load of the selected tab
            $('ul.nav-tabs li.active a').trigger('shown.bs.tab');

            $('#maritalStatus').on('change', function () {
                if (this.value == '2' || this.value == '4') {
                    $('#companionContainer').show(300);
                    if (this.value == '2') {
                        $('#companionContainerTittle').html(/*[[#{registerLoanForm1.companionData.tittle.married}]]*/);
                    } else if (this.value == '4') {
                        $('#companionContainerTittle').html(/*[[#{registerLoanForm1.companionData.tittle.cohabitant}]]*/);
                    }
                } else {
                    $('#companionContainer').hide(300);
                }
            });

            $(('[id*="downPaymentAmount_"]')).forceIntegerOnly(true, 0, 999999);

        });

        function bankAccountVerified(verified, personId){
            defaultAjax({
                url: /*[[@{/person/verifyBankAccount}]]*/null,
                type: 'POST',
                data: {
                    personId: personId,
                    verified: verified
                },
                success: function (data) {
                    // Refresh the applications tab
                    refreshTabAjax('bankAccount');
                }
            })
        }

        function getDefaultXEditableJson() {
            return {
                viewformat: 'DD/MM/YYYY',
                format: 'DD/MM/YYYY',
                showbuttons: 'bottom',
                send: 'always',
                emptytext: 'Sin Asignar',
                params: {
                    personId: /*[[ ${person?.id} ]]*/
                },
                ajaxOptions: {
                    type: 'post',
                    headers: addCsrfToJsonHeaders({'x-request-sender-type':'ajax'})
                },
                error: function (response, newValue) {
                    ajaxError(response, null);
                }
            }
        }

        function refreshPanelAjax(panel) {
            var baseUrl = /*[[@{/person/panel/}]]*/;
                console.log("refrescando el mapa");
            if (panel == 'partner') {
                $('#personPartnerPanelContainer').load(baseUrl + "partner?personId=" + personId + "&userId=" + userId, null, function () {
                });
            } else if (panel == 'contact') {
                $('#personContactPanelContainer').load(baseUrl + "contact?personId=" + personId + "&userId=" + userId, null, function () {
                });
            } else if (panel == 'income') {
                $('#personIncomePanelContainer').load(baseUrl + "income?personId=" + personId + "&userId=" + userId, null, function () {
                });
            }
        }

        function refreshCurrentTabAjax() {
            var tabSelected = $('a[data-toggle="tab"][role="personTab"]').filter(function() {
                return $(this).data("selected") == true;
            });
            if(tabSelected.length){
                refreshTabAjax(tabSelected[0].href.split("_")[1]);
            }
        }

        function refreshTabAjax(tabName) {
            var baseUrl = /*[[@{/person/}]]*/;
            var $targetDiv = $('#tab_' + tabName);

            //Hide data
            if ($targetDiv.find("#tabData").length) {
                $targetDiv.find("#tabData").hide();
            }

            //Show loading
            $targetDiv.find("#tabLoading").show();

            // Load the fragment
            var url = baseUrl + tabName + "?personId=" + personId + "&userId=" + userId;

            if(applicationCode) {
                url += "&applicationCode=" + applicationCode;
            }
            if(applicationId) {
                url += "&applicationId=" + applicationId;
            }

            if(creditCode) {
                url += "&creditCode=" + creditCode;
            }
            if(creditId) {
                url += "&creditId=" + creditId;
            }

            $targetDiv.defaultLoad(url, null, function () {
            });
        }

        function approveLoanApplication(loanApplicationId) {
            defaultAjax({
                url: /*[[@{/loanApplication/approve}]]*/null,
                type: 'POST',
                data: {
                    loanApplicationId: loanApplicationId,
                    personId: personId
                },
                success: function (data) {
                    var response = JSON.parse(data);
                    if(response.ok){
                        refreshTabAjax('applications');
                        swal("Aprobada", "La solicitud fue aprobada.", "success");
                    }else if(response.canSkip){
                        swal({
                            title: "",
                            text: response.message + "<br/><br/>¿Deseas aprobarlo de todas maneras?",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Sí, aprobar!",
                            closeOnConfirm: false,
                            html: true
                        },
                        function(){
                            swal.close();
                            defaultAjax({
                                url: /*[[@{/loanApplication/approve}]]*/null,
                                type: 'POST',
                                showLoading: true,
                                data: {
                                    loanApplicationId: loanApplicationId,
                                    personId: personId,
                                    approveAnyway: true,
                                },
                                success: function (data) {
                                    refreshTabAjax('applications');
                                    swal("Aprobada", "La solicitud fue aprobada.", "success");
                                }
                            });
                        });
                    }else{
                        swal({
                            title: "",
                            text: data.message,
                            type: "warning"
                        });
                    }


                }
            });
        }

        function assignAnalyst(loanApplicationId) {
            defaultAjax({
                url: /*[[@{/loanApplication/assign/analyst}]]*/null,
                type: 'POST',
                data: {
                    loanApplicationId: loanApplicationId
                },
                success: function (data) {
                    // Refresh the applications tab
                    refreshTabAjax('applications');
                }
            })
        }

        function runFraudAlerts(loanApplicationId) {
            defaultAjax({
                url: /*[[@{/loanApplication/runFraudAlerts}]]*/null,
                type: 'POST',
                data: {
                    loanApplicationId: loanApplicationId
                },
                success: function (data) {
                    swal({
                        title: '',
                        text: 'Se mandó a correr las alertas de fraude.',
                        type: "info",
                        showConfirmButton: false,
                        timer: 1500
                    }, function () {
                        swal.close();
                        if ($('#fraudToggle' + loanApplicationId).hasClass('expand')) {
                            $('#fraudToggle' + loanApplicationId).click();
                        } else {
                            $('#fraudReload' + loanApplicationId).click();
                        }
                    });
                }
            })
        }

        function expire(loanApplicationId) {
            swal({
                    title: "",
                    text: "¿Está seguro que desea expirar la solicitud?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "!Sí, expirar!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function(){
                    swal.close();
                    defaultAjax({
                        url: /*[[@{/loanApplication/expire}]]*/null,
                        type: 'POST',
                        showLoading: true,
                        data: {
                            loanApplicationId: loanApplicationId
                        },
                        success: function (data) {
                            refreshTabAjax('applications');
                            swal("Expirada", "La solicitud fue expirada.", "success");
                        }
                    });
                });
        }

        function generateOriginalSchedule(creditId) {
            defaultAjax({
                url: /*[[@{/credit/originalSchedule}]]*/null,
                type: 'POST',
                data: {
                    creditId: creditId,
                    personId: personId
                },
                success: function (data) {
                    var json = JSON.parse(data);
                    if (json.result == 'ok') {
                        // Refresh the applications tab
                        refreshTabAjax('applications');
                    } else {
                        //TODO: Cambiar el alert por algo mejor
                        alert(json.errorMessage != null ? json.errorMessage : /*[[#{system.error.default}]]*/null)
                    }
                }
            })
        }

        function showCreateLoanOffer(loanApplicationId) {
            var url = /*[[@{/loanOffer/modal/create/}]]*/;
            $('#createLoanOfferModal').modal();
            $('#createLoanOfferModal .loading').show();
            $('#createLoanOfferModal .content').hide();
            $('#createLoanOfferModal .content').defaultLoad(url + "?loanApplicationId=" + loanApplicationId, null, function () {
                $('#createLoanOfferModal .loading').hide(300);
                $('#createLoanOfferModal .content').show(300);
            }, "GET", null, function(){
                $('#createLoanOfferModal').modal('hide');
            });
        }

        function createLoanOffer(loanApplicationId) {
            var baseUrl = /*[[@{/loanOffer/create/}]]*/;
            defaultAjax({
                url: baseUrl,
                type: 'POST',
                data: $('#frmCreateLoanOfferModal').serialize(),
                success: function (data) {
                    $('#createLoanOfferModal').modal('hide');
                    refreshTabAjax('applications');
                }
            })
        }

        function selectLoanOffer(loanOfferId, loanApplicationId) {
            var baseUrl = /*[[@{/loanOffer/}]]*/;
            defaultAjax({
                url: baseUrl + loanOfferId + "/select",
                data: {
                    loanId: loanApplicationId
                },
                type: 'POST',
                success: function (data) {
                    refreshTabAjax('applications');
                }
            })
        }

        function notifyOffer(loanOfferId, loanApplicationId) {
            var baseUrl = /*[[@{/loanOffer/}]]*/;
            defaultAjax({
                url: baseUrl + loanOfferId + "/notify",
                data: {
                    loanId: loanApplicationId
                },
                type: 'POST',
                success: function (data) {
                    refreshTabAjax('applications');
                }
            })
        }

        function selectConsolidableDebt(loanApplicationId, entityId, consolidationAccounttype, entityCode, balance, installments,  rate, accountCardNumber, active, brandId, departmentUbigeo){
            var baseUrl = /*[[@{/loanOffer/consolidableDebt}]]*/;
            defaultAjax({
                url: baseUrl + "/select",
                data: {
                    accountType : consolidationAccounttype,
                    entityCode : entityCode,
                    loanId: loanApplicationId,
                    balance : balance,
                    installments : installments == null ? 0 : installments,
                    rate : rate,
                    accountCardNumber: accountCardNumber,
                    active : active,
                    brandId : brandId,
                    departmentUbigeo : departmentUbigeo,
                    entityId : entityId

                },
                type: 'POST',
                success: function (data) {
                    refreshTabAjax('applications');
                }
            })
        }

        function runPendingBots() {
            var baseUrl = /*[[@{/bot/runPending}]]*/;
            defaultAjax({
                url: baseUrl,
                type: 'POST',
                data: {
                    userId: userId,
                    personId: personId,
                    docType: personDocType.id,
                    docNumber: personDocNumber
                },
                success: function (data) {
                    toastr.info(data);
                    refreshTabAjax('data');
                }
            });
            $('#personAlertsDiv').hide();
            $('#divFaltanBots').hide();
        }

        function sendVerificationEmail(loanApplicationId) {
            var baseUrl = /*[[@{/loanApplication/verificationEmail}]]*/;
            defaultAjax({
                url: baseUrl,
                type: 'POST',
                data: {
                    loanApplicationId
                },
                success: function (data) {
                    swal({
                        title: "",
                        text: "Se envi\u00f3 un correo de verificaci\u00f3n",
                        type: "success"
                    });
                }
            });
        }

        function showLoanApplicationMapModal(loanApplicationId) {
            var url = /*[[@{/loanApplication/locationMap/modal/}]]*/;
            $('#loanApplicationLocationMapModal').modal();
            $('#loanApplicationLocationMapModal .loading').show();
            $('#loanApplicationLocationMapModal .content').hide();
            $('#loanApplicationLocationMapModal .content').load(url + "?loanApplicationId=" + loanApplicationId, null, function () {
                $('#loanApplicationLocationMapModal .loading').hide(300);
                $('#loanApplicationLocationMapModal .content').show(300);
            });
        }
        function showUpdatePersonAddressModal() {
            var url = /*[[@{/person/address/update/modal}]]*/;
            $('#updatePersonAddressModal').modal();
            $('#updatePersonAddressModal .loading').show();
            $('#updatePersonAddressModal .content').hide();
            $('#updatePersonAddressModal .content').load(url + "?personId=" + personId, null, function () {
                $('#updatePersonAddressModal .loading').hide(300);
                $('#updatePersonAddressModal .content').show(300);
            });
        }
        function showOccupationalPhoneNumberModal() {
            var url = /*[[@{/person/job-phone/update/modal}]]*/;
            $('#updateOccupationalPhoneNumberModal').modal();
            $('#updateOccupationalPhoneNumberModal .loading').show();
            $('#updateOccupationalPhoneNumberModal .content').hide();
            $('#updateOccupationalPhoneNumberModal .content').load(url + "?personId=" + personId, null, function () {
                $('#updateOccupationalPhoneNumberModal .loading').hide(300);
                $('#updateOccupationalPhoneNumberModal .content').show(300);
            });
        }
        function showUpdatePersonJobAddressModal() {
            var url = /*[[@{/person/jobaddress/update/modal}]]*/;
            $('#updatePersonAddressModal').modal();
            $('#updatePersonAddressModal .loading').show();
            $('#updatePersonAddressModal .content').hide();
            $('#updatePersonAddressModal .content').load(url + "?personId=" + personId, null, function () {
                $('#updatePersonAddressModal .loading').hide(300);
                $('#updatePersonAddressModal .content').show(300);
            });
        }
        function updatePersonAddress() {
            var baseUrl = /*[[@{/person/}]]*/;
            defaultAjax({
                url: baseUrl + "address",
                type: 'POST',
                formValidation: $('#frmUpdatePersonAddressModal').data('validator'),
                data: $('#frmUpdatePersonAddressModal').serialize() + "&personId=" + personId,
                success: function (data) {
                    $('#updatePersonAddressModal').modal('hide');
                    refreshPanelAjax("contact")
                    refreshTabAjax("contact")
                }
            })
        }
        function updateOccupationalPhoneNumber() {
            var baseUrl = /*[[@{/person/}]]*/;
            defaultAjax({
                url: baseUrl + "jobPhone",
                type: 'POST',
                formValidation: $('#frmUpdateOccupationalPhoneNumber').data('validator'),
                data: $('#frmUpdateOccupationalPhoneNumber').serialize() + "&personId=" + personId,
                success: function (data) {
                    $('#updateOccupationalPhoneNumberModal').modal('hide');
                    refreshPanelAjax("income");
                    refreshTabAjax("contact");
                }
            })
        }
        function showRegisterCreditRejectionModal(creditId) {
            $('#registerCreditRejectionModal').modal();
            $('#registerCreditRejectionModal .loading').hide();
            $('#registerCreditRejectionModal .content').show();
            $('#registerCreditRejectionButton').click(function () {
                registerCreditRejectionModal(creditId, $('#creditRejectionReason').val(), $('#creditRejectionComment').val());
            });
        }
        function registerCreditRejectionModal(creditId, creditRejectionReason, creditRejectionComment) {
            var baseUrl = /*[[@{/credit/}]]*/;
            defaultAjax({
                url: baseUrl + creditId + "/reject/",
                type: 'POST',
                data: {
                    creditRejectionReasonId: creditRejectionReason,
                    creditRejectionComment: creditRejectionComment
                },
                success: function (data) {
                    $('#registerCreditRejectionModal').modal('hide');
                    refreshPanelAjax("credits")
                }
            })
        }
        function showRegisterApplicationRejectionModal(loanApplicationId) {
            $('#registerApplicationRejectionModal').modal();
            $('#registerApplicationRejectionModal .loading').hide();
            $('#registerApplicationRejectionModal .content').show();
            $('#registerApplicationRejectionButton').click(function () {
                rejectLoanApplication(loanApplicationId, $('#applicationRejectionReason').val(), $('#applicationRejectionComment').val());
            });
        }
        function rejectLoanApplication(loanApplicationId, applicationRejectionReason, applicationRejectionComment) {
            defaultAjax({
                url: /*[[@{/loanApplication/reject}]]*/null,
                type: 'POST',
                data: {
                    loanApplicationId: loanApplicationId,
                    applicationRejectionReasonId: applicationRejectionReason,
                    applicationRejectionComment: applicationRejectionComment
                },
                success: function (data) {
                    // Refresh the applications tab
                    $('#registerApplicationRejectionModal').modal('hide');
                    refreshTabAjax('applications');
                },
                complete: function() {
                    $('#frmRegisterApplicationRejectionModal').trigger('reset')
                }
            })
        }
        function validateOcupationalInformation(validated) {
            var baseUrl = /*[[@{/person/}]]*/null;
            defaultAjax({
                url: baseUrl + personId + '/validateOcupationalInformation',
                type: 'POST',
                data: {
                    validated: validated
                },
                success: function (data) {
                    $('#personOcupationaInformationValidate').prop('checked', validated);
                    if (isJsonString(data)) {
                        if (JSON.parse(data).updateApplications) {
                            refreshTabAjax('applications')
                        }
                    }
                }
            })
        }
        function invalidateUserFile(userFileId, validated, loanApplicationId){
            if (!validated) {
                //action for dismiss documentation appear //style="display:none;"
                console.log('Invalidando documento');
                $('#markDocumentMissingAction').attr('style','display:true');
                markDocumentsMissing(loanApplicationId, false);
            }
            validateUserFile(userFileId, validated);
        }
        function validateUserFile(userFileId, validated) {
            var baseUrl = /*[[@{/file/userFile/}]]*/null;
            defaultAjax({
                url: baseUrl + userFileId + '/validate',
                type: 'POST',
                data: {
                    validated: validated
                },
                success: function (data) {
                    var fileUserContainer = $('#file_'+userFileId);
                    if (validated) {
                        // Add style to image
                        fileUserContainer.find('img').css('border-color', '#26C281');
                        fileUserContainer.find('a[title="Validar archivo"]').remove();
                    } else {
                        // Move container to deletedFiles
                        fileUserContainer.find('.buttons-wrap').children('.btn').remove();
                        fileUserContainer.find('li').remove();
                        var parentContainer = fileUserContainer.parent();
                        if (parentContainer.find('.fileContent').length == 1) {
                            parentContainer.html('No se ha subido ningún archivo.');
                        }
                        $('#deletedFiles').append(fileUserContainer);
                        fileUserContainer.find('img').css('border-color', '#ed6b75');
                        fileUserContainer.find('.fileHoverDiv').hide();
                    }
                }
            })
        }
        function validateAllUserFiles(loanApplicationId) {
            var baseUrl = /*[[@{/file/userFile/all/validate}]]*/null;
            defaultAjax({
                url: baseUrl,
                type: 'POST',
                data: {
                    userId: userId,
                    loanApplicationId: loanApplicationId
                },
                success: function (data) {
                    refreshCurrentTabAjax()
                }
            })
        }
        function requestMissingDocumentation(loanApplicationId) {
            var baseUrl = /*[[@{/file/userFile/requestMissingDocumentation}]]*/null;
            defaultAjax({
                url: baseUrl,
                type: 'POST',
                data: {
                    userId: userId,
                    loanApplicationId: loanApplicationId
                },
                success: function (data) {
                    refreshCurrentTabAjax()
                }
            })
        }
        function updateUserFileType(userFileId, userFileTypeId) {
            var baseUrl = /*[[@{/file/userFile/}]]*/null;
            defaultAjax({
                url: baseUrl + userFileId + '/updateUserFileType',
                type: 'POST',
                data: {
                    userFileTypeId: userFileTypeId
                },
                success: function (data) {
                    refreshTabAjax('applications');
                }
            })
        }
        function rotateImage(jsonEncrypt, orientation) {
            var baseUrl = /*[[@{/file/userFile/}]]*/null;
            defaultAjax({
                url: baseUrl + jsonEncrypt + '/rotate/' + orientation,
                type: 'POST',
                data: {},
                success: function (data) {
                    $('[data-accordion=documentation] > .portlet > .portlet-title').find('.tools a.reload').click();
                }
            })
        }
        function resendInteraction(interactionId) {
            var baseUrl = /*[[@{/interaction/}]]*/null;
            defaultAjax({
                url: baseUrl + interactionId + '/resend',
                type: 'POST',
                success: function (data) {
                    refreshTabAjax('interactions')
                }
            })
        }
        var contactResultCatalog = JSON.parse(/*[[${@utilService.toJson(@catalogService.getContactResults())}]]*/);
        function saveCreditCollectionContactResult(creditId, contactResultId) {
            for (i = 0; i < contactResultCatalog.length; i++) {
                if (contactResultCatalog[i].id == contactResultId) {
                    if (contactResultCatalog[i].dateRequired) {
                        $('#collectionContactResultDate').datepicker({
                            autoclose: true,
                            toggleActive: true,
                            format: "dd/mm/yyyy",
                            endDate: "0d",
                            defaultDate: new Date(),
                        });
                        $('#collectionContactResultDateModal').modal();
                        $('#collectionContactResultDateModalSaveButton').click(function () {
                            registerCreditCollectionContactResult(creditId, contactResultId);
                        });

                    } else {
                        registerCreditCollectionContactResult(creditId, contactResultId);
                    }
                    return;
                }
            }
        }
        function registerCreditCollectionContactResult(creditId, contactResultId) {
            var baseUrl = /*[[@{/credit/}]]*/;
            defaultAjax({
                url: baseUrl + creditId + "/registerCollectionContactResult/",
                type: 'POST',
                data: {
                    contactResultId: contactResultId,
                    date: $('#collectionContactResultDate').val()
                },
                success: function (data) {
                    toastr.success("Se registró la acci�n");
                    $('#collectionContactResultDate').val("")
                    $('#collectionContactResultDateModal').modal('hide');
                }
            })
        }
        function saveContactResult(contactResultId, creditId) {
            for (i = 0; i < contactResultCatalog.length; i++) {
                if (contactResultCatalog[i].id == contactResultId) {
                    openContactResultModal(creditId, contactResultId, contactResultCatalog[i].dateRequired, contactResultCatalog[i].amountRequired);
                    return;
                }
            }
        }
        function openContactResultModal(creditId, contactResultId, dateRequired, amountRequired) {
            // Clean values
            $('#contactResultModalDate').val("")
            $('#contactResultModalAmount').val("")
            $('#contactResultModalComment').val("")
            // Init Daepicker
            $('#contactResultModalDate').datepicker({
                autoclose: true,
                toggleActive: true,
                format: "dd/mm/yyyy",
                startDate: "0d",
                defaultDate: new Date(),
            });
            // Show or hide
            dateRequired ? $('#contactResultModalDateDiv').show() : $('#contactResultModalDateDiv').hide();
            amountRequired ? $('#contactResultModalAmountDiv').show() : $('#contactResultModalAmountDiv').hide();
            // Open
            $('#contactResultModal').modal();
            $('#contactResultModalSaveButton').click(function () {
                registerContactResult(creditId, contactResultId);
            });
        }
        function registerContactResult(creditId, contactResultId) {
            var baseUrl = /*[[@{/credit/}]]*/;
            defaultAjax({
                url: baseUrl + creditId + "/registerCollectionContactResult/",
                type: 'POST',
                data: {
                    contactResultId: contactResultId,
                    date: $('#contactResultModalDate').val(),
                    amount: $('#contactResultModalAmount').val(),
                    comment: $('#contactResultModalComment').val()
                },
                success: function (data) {
                    toastr.success("Se registró la acción");
                    $('#contactResultModal').modal('hide');
                }
            })
        }

        //TODO
        function loadOnDemand(elem, isReload, message, fn) {
            console.log('loadOnDemand');
            var container = elem.closest('.portlet-title').next();

            if (elem.data('isdisabled')) {
                return;
            }

            if (isReload) {
                container.html('<ul class="fa-ul"><li><i class="fa-li fa fa-spinner fa-spin"></i>' + message + '</li></ul>');
            }

            fn(container, elem);
        }

        //TODO
        function loadAccordionOnDemand(laOrCreditCode, accordion) {
            console.log('loadAccordionOnDemand');
            $('#' + laOrCreditCode).first().find('[data-accordion=' + accordion + ']').find('.tools').find('.reload').click();
            //    TODO HERE IS THE THING
            //    ONLY DANIEL ACCORDIONS HAVE DATA-ACCORDION
            //    TO CALL JOSE ACCORDIONS YOU SHOULD CALL AN AJAX
        }

        function showChangeFirstDueDateModal(loanApplicationId) {
            var url = /*[[@{/loanApplication/changeFirstDueDate/modal}]]*/;
            $('#changeFirstDueDateModal').modal();
            $('#changeFirstDueDateModal .loading').show();
            $('#changeFirstDueDateModal .content').hide();
            $('#changeFirstDueDateModal .content').load(url + "?loanApplicationId=" + loanApplicationId, null, function () {
                $('#changeFirstDueDateModal .loading').hide(300);
                $('#changeFirstDueDateModal .content').show(300);
            });
        }

        function returnToContract(loanApplicationId) {
            swal({
                    title: "",
                    text: "¿Está seguro que desea volver la solicitud a la pregunta de contrato?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "!Sí, volver!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function(){
                    swal.close();
                    defaultAjax({
                        url: /*[[@{/loanApplication/returnToContract}]]*/null,
                        type: 'POST',
                        showLoading: true,
                        data: {
                            loanApplicationId: loanApplicationId
                        },
                        success: function (data) {
                            refreshTabAjax('applications');
                            swal("Ok", "La solicitud ha vuelto a la pregunta de contrato.", "success");
                        }
                    });
                });
        }

        function reevaluate(loanApplicationId) {
            swal({
                    title: "",
                    text: "¿Está seguro que desea reevaluar la solicitud?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "!Sí, reevaluar!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function(){
                    swal.close();
                    defaultAjax({
                        url: /*[[@{/loanApplication/reevaluate}]]*/null,
                        type: 'POST',
                        showLoading: true,
                        data: {
                            loanApplicationId: loanApplicationId
                        },
                        success: function (data) {
                            refreshTabAjax('applications');
                            swal("Reevaluada", "La solicitud fue reevaluada.", "success");
                        }
                    });
                });
        }

        function returnToEvaluationList(loanApplicationId) {
            swal({
                    title: "",
                    text: "¿Está seguro que desea volver la solicitud a Bandeja Evaluar?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "!Sí, volver!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function(){
                    swal.close();
                    defaultAjax({
                        url: /*[[@{/loanApplication/returnToEvaluationList}]]*/null,
                        type: 'POST',
                        showLoading: true,
                        data: {
                            loanApplicationId: loanApplicationId
                        },
                        success: function (data) {
                            refreshTabAjax('applications');
                            swal("Ok", "La solicitud ha vuelto a Bandeja Evaluar.", "success");
                        }
                    });
                });
        }

        function returnToManagementList(loanApplicationId) {
            swal({
                    title: "",
                    text: "¿Está seguro que desea volver la solicitud a Bandeja Gestionar?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "!Sí, volver!",
                    cancelButtonText: "Cancelar",
                    closeOnConfirm: false,
                    html: true
                },
                function(){
                    swal.close();
                    defaultAjax({
                        url: /*[[@{/loanApplication/returnToManagementList}]]*/null,
                        type: 'POST',
                        showLoading: true,
                        data: {
                            loanApplicationId: loanApplicationId
                        },
                        success: function (data) {
                            refreshTabAjax('applications');
                            swal("Ok", "La solicitud ha vuelto a Bandeja Gestionar.", "success");
                        }
                    });
                });
        }

        function renderTotalEmployeesByRuc(ruc, el) {
            if (!ruc || ruc === '') {
                el.hide();
                return;
            }

            el.html('Cargando ...');
            el.addClass('label-primary');
            el.removeClass('label-danger');
            el.removeClass('label-success');

            defaultAjax({
                url: /*[[@{/person/occupationalInfo/employees}]]*/null,
                type: 'GET',
                data: {
                    ruc
                },
                success: function (data) {
                    if (+data && data > 0) {
                        el.addClass('label-success');
                        el.html(data);
                    } else {
                        el.addClass('label-danger');
                        el.html('No hay registros');
                    }
                }, error: function (data) {
                    el.addClass('label-danger');
                    el.html('Hubo un error');
                }, complete: function () {
                    el.removeClass('label-primary');
                }
            });
        }
        /*]]>*/
    </script>
</head>
<body>
<th:block layout:fragment="head">
</th:block>
<th:block layout:fragment="content">
    <div class="page-head"></div>
    <div class="page-content">
        <div class="container">
            <ul class="page-breadcrumb breadcrumb">
                <li>
                    <a th:href="@{/loanApplication/offer}">Home</a>
                    <i class="fa fa-circle"></i>
                </li>
                <li>
                    <span>Person</span>
                </li>
            </ul>
            <div class="page-content-inner">
                <div class="row">
                    <div class="col-md-3">
                        <div id="personClientPanelContainer">
                            <div id="personClientPanel" th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"> Cliente</span>
                                        <span class="label label-sm label-danger" th:if="${person.negativeBase}">Base Negativa</span>
                                    </div>
                                    <div class="choose-country">
                                        <span th:class="'c-language c' + ${person?.documentType?.countryId}"></span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <table class="table table-striped dl-horizontal">
                                        <thead th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">
                                            <tr>
                                                <th></th>
                                                <th>Declarado</th>
                                                <th>Nosis</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <th>Nombres</th>
                                                <td><span th:text="${person?.name}"></span>
                                                    <span th:if="${person?.pep == true}" class="label label-xs label-danger">PEP</span></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}" th:text="${nosisXml?.getDatos()?.get(0).getNombre()}"></td>
                                            </tr>
                                            <tr>
                                                <th:block th:switch="${personCountry}">
                                                    <th th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">Apellido</th>
                                                    <th th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">A. Paterno</th>
                                                </th:block>
                                                <td th:text="${person?.firstSurname}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}" th:text="${nosisXml?.getDatos()?.get(0).getApellido()}"></td>
                                            </tr>
                                            <tr th:if="${personCountry} == ${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                                <th>A. Materno</th>
                                                <td th:text="${person?.lastSurname}"></td>
                                            </tr>
                                            <tr>
                                                <th>Tipo de Doc.</th>
                                                <td th:text="${person?.documentType?.name}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}" th:text="${nosisXml?.getDatos()?.get(0).getDocTipo()}"></td>
                                            </tr>
                                            <tr>
                                                <th>N&uacute;mero de Doc.</th>
                                                <td th:text="${person?.documentNumber}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}" th:text="${nosisXml?.getDatos()?.get(0).getDoc()}"></td>
                                            </tr>
                                            <tr>
                                                <th>F. Nacimiento</th>
                                                <td th:text="${@utilService.dateFormat(person?.birthday)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(person?.birthday)}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}" th:text="${@utilService.getDateFormatFromNumericValue(nosisXml?.getDatos()?.get(0).getFecNac())}"></td>
                                            </tr>
                                            <tr th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                                <th>Ubigeo de Nacimiento</th>
                                                <td><a href="#" id="personBirthUbigeo" th:text="${person?.birthUbigeo?.getUbigeo()}"></a>
                                                    <script th:inline="javascript" th:if="${!onlyView}">
                                                        /*<![CDATA[*/
                                                        var editableJson = getDefaultXEditableJson();
                                                        editableJson.type = 'text';
                                                        editableJson.url = /*[[ @{/person/birthUbigeo} ]]*/;
                                                        editableJson.title = 'Ubigeo de Nacimiento';
                                                        editableJson.value = /*[[ ${person?.birthUbigeo?.getUbigeo()} ]]*/;
                                                        $('#personBirthUbigeo').editable(editableJson);
                                                        /*]]>*/
                                                    </script>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr th:if="${person?.documentType?.countryId != T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                                <th>Nacionalidad</th>
                                                <td><a href="#" id="personNationality" th:text="${person?.nationality?.name}"></a>
                                                    <script th:inline="javascript" th:if="${!onlyView}">
                                                        /*<![CDATA[*/
                                                        var editableJson = getDefaultXEditableJson();
                                                        editableJson.type = 'select';
                                                        editableJson.url = /*[[ @{/person/nationality} ]]*/;
                                                        editableJson.title = 'Nacionalidad';
                                                        editableJson.value = /*[[ ${person?.nationality?.id} ]]*/;
                                                        editableJson.source = function () {
                                                            var nationalities;
                                                            $.ajax({
                                                                url: /*[[@{/catalog/nationalities/json}]]*/null,
                                                                type: 'GET',
                                                                async: false,
                                                                global: false,
                                                                success: function (data) {
                                                                    var result = JSON.parse(data);
                                                                    nationalities = [];

                                                                    for (i = 0; i < result.length; i++) {
                                                                        nationalities[i] = {
                                                                            value: result[i].id,
                                                                            text: result[i].name
                                                                        };
                                                                    }
                                                                }
                                                            })
                                                            return nationalities;
                                                        };
                                                        $('#personNationality').editable(editableJson);
                                                        /*]]>*/
                                                    </script>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Estado civil</th>
                                                <td>
                                                    <a href="#" id="personMaritalStatus"
                                                       th:text="${person?.maritalStatus?.status}"></a>
                                                    <script th:inline="javascript" th:if="${!onlyView}">
                                                        /*<![CDATA[*/
                                                        var editableJson = getDefaultXEditableJson();
                                                        editableJson.type = 'select';
                                                        editableJson.url = /*[[ @{/person/maritalStatus} ]]*/;
                                                        editableJson.title = 'Estado Civil';
                                                        editableJson.value = /*[[ ${person?.maritalStatus?.id} ]]*/;
                                                        editableJson.source = function () {
                                                            var maritalStatuses;
                                                            $.ajax({
                                                                url: /*[[@{/catalog/maritalStatus/json}]]*/null,
                                                                type: 'GET',
                                                                async: false,
                                                                global: false,
                                                                success: function (data) {
                                                                    var result = JSON.parse(data);
                                                                    maritalStatuses = [];

                                                                    for (i = 0; i < result.length; i++) {
                                                                        maritalStatuses[i] = {
                                                                            value: result[i].id,
                                                                            text: result[i].status
                                                                        };
                                                                    }
                                                                }
                                                            })
                                                            return maritalStatuses;
                                                        };
                                                        editableJson.success = function (response, newValue) {
                                                            console.log("Success: " + response + " - " + newValue);
                                                            if (newValue == '2' || newValue == '4') {
                                                                $('#personPartnerPanel').show(300);
                                                            } else {
                                                                $('#personPartnerPanel').hide(300);
                                                            }
                                                        };
                                                        $('#personMaritalStatus').editable(editableJson);
                                                        /*]]>*/
                                                    </script>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Dependientes</th>
                                                <td>
                                                    <th:block th:if="${person?.dependents == 5}">
                                                        <a href="#" id="personDependents" th:text="${'4+'}"></a>
                                                    </th:block>
                                                    <th:block th:unless="${person?.dependents == 5}">
                                                        <a href="#" id="personDependents" th:text="${person?.dependents}"></a>
                                                    </th:block>
                                                    <script th:inline="javascript" th:if="${!onlyView}">
                                                        /*<![CDATA[*/
                                                        var editableJson = getDefaultXEditableJson();
                                                        editableJson.type = 'text';
                                                        editableJson.url = /*[[ @{/person/dependents} ]]*/;
                                                        editableJson.title = 'Dependientes';
                                                        editableJson.value = /*[[ ${person?.dependents} ]]*/;
                                                        $('#personDependents').editable(editableJson);
                                                        /*]]>*/
                                                    </script>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr th:if="${personCountry} == ${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                                <th>Estado civil EFX</th>
                                                <td id="efxMaritalStatus" th:text="${person?.efxMaritalStatus}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Ultimo acceso extranet</th>
                                                <td id="lastSessionLog">
                                                    <th:block th:if="${lastSessionLog != null}">
                                                        <span th:text="${@utilService.datetimeShortFormat(lastSessionLog.signInDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(lastSessionLog?.signInDate)}"/>
                                                        <span th:if="${lastSessionLog.signOutDate!=null}" style="color: #ed6b75"
                                                              th:text="${'Duró '+lastSessionLog.getDurationInMinutes()+' minuto(s)'}"/>
                                                        <span th:if="${lastSessionLog.signOutDate==null}" style="color: green"
                                                              th:text="${'Conectado'}"/>
                                                    </th:block>
                                                    <span th:if="${lastSessionLog == null}">No existe</span>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Resultado Autoevaluaci&oacute;n</th>
                                                <td id="stars">
                                                    <th:block th:if="${person?.selfEvaluationResult != null}">
                                                        <div class="stars">
                                                            <!-- positive, negative -->
                                                            <i class="fa fa-star star-1" style="color: #bac3d0;"></i>
                                                            <i class="fa fa-star star-2" style="color: #bac3d0;"></i>
                                                            <i class="fa fa-star star-3" style="color: #bac3d0;"></i>
                                                            <i class="fa fa-star star-4" style="color: #bac3d0;"></i>
                                                            <i class="fa fa-star star-5" style="color: #bac3d0;"></i>
                                                            <script th:inline="javascript">
                                                                /*<![CDATA[*/
                                                                var calification = /*[[ ${person?.selfEvaluationResult/2} ]]*/;
                                                                $(function () {
                                                                    for (var i = 0; i <= calification; i++) {
                                                                        $('.star-' + i).css({color: '#26CAD3'});
                                                                    }
                                                                });
                                                                /*]]>*/
                                                            </script>
                                                        </div>
                                                    </th:block>
                                                </td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Cargo</th>
                                                <td th:text="${personPrincipalOcupationalInfo?.ocupation?.getOcupation()}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Sector econ&oacute;mico</th>
                                                <td th:text="${person?.profession?.getProfession()}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Nivel de Estudios</th>
                                                <td th:text="${person?.studyLevel?.getLevel()}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Profesi&oacute;n/ Ocupaci&oacute;n</th>
                                                <td th:text="${person?.professionOccupation?.occupation}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                            <tr>
                                                <th>Pep</th>
                                                <td th:text="${person?.pep != null ? (person?.pep ? 'Si' + (person?.pepDetail != null ? ' - ' + person?.pepDetail : '') : 'No') : ''}"></td>
                                                <td th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and nosisXml != null}">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="personPartnerPanelContainer">
                            <div id="personPartnerPanel" th:class="${@frontEndService.getDefaultPortletClass()}"
                                 th:style="${person?.maritalStatus?.hasPartner()} ? '' : 'display: none'">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"> Datos del C&oacute;nyugue/ Conviviente</span>
                                        <span th:if="${person?.partner?.name == null}" class="label label-sm label-danger">No identificado</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-user-data">
                                        <dt>Tipo de Doc.</dt>
                                        <dd>
                                            <a href="#" id="personPartnerDocumentType"
                                               th:text="${person?.partner?.documentType?.name}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'select';
                                                editableJson.title = 'Tipo de Doc.';
                                                editableJson.value = /*[[ ${person?.partner?.documentType?.id} ]]*/;

                                                editableJson.source = function () {
                                                    var documentTypes;
                                                    $.ajax({
                                                        url: /*[[@{/catalog/documentType/json}]]*/null,
                                                        type: 'GET',
                                                        async: false,
                                                        global: false,
                                                        success: function (data) {
                                                            var result = JSON.parse(data);
                                                            documentTypes = [];

                                                            for (i = 0; i < result.length; i++) {
                                                                documentTypes[i] = {
                                                                    value: result[i].id,
                                                                    text: result[i].name
                                                                };
                                                            }
                                                        }
                                                    })
                                                    return documentTypes;
                                                };
                                                $('#personPartnerDocumentType').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>N&uacute;mero de Doc.</dt>
                                        <dd>
                                            <a href="#" id="personPartnerDocumentNumber"
                                               th:text="${person?.partner?.documentNumber}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/partnerDocument} ]]*/;
                                                editableJson.params.partnerDocumentType = function () {
                                                    return $('#personPartnerDocumentType').editable('getValue', true);
                                                }
                                                editableJson.title = 'Numero de Doc.';
                                                editableJson.value = /*[[ ${person?.partner?.documentNumber} ]]*/;
                                                editableJson.success = function (response, newValue) {
                                                    console.log('response: ' + response);
                                                    if (isJsonString(response)) {
                                                        var responseJson = JSON.parse(response);
                                                        if (!responseJson.partnerEvaluation) {
                                                            refreshTabAjax('applications');
                                                        }
                                                    }
                                                    refreshPanelAjax('partner');
                                                };
                                                $('#personPartnerDocumentNumber').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>Nombres</dt>
                                        <dd>
                                            <a href="#" id="personPartnerName" th:text="${person?.partner?.name}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/partnerName} ]]*/;
                                                editableJson.title = 'Nombre';
                                                editableJson.value = /*[[ ${person?.partner?.name} ]]*/;
                                                $('#personPartnerName').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>A. Paterno</dt>
                                        <dd>
                                            <a href="#" id="personPartnerFirstSurname"
                                               th:text="${person?.partner?.firstSurname}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/partnerFirstSurname} ]]*/;
                                                editableJson.title = 'Ape. Paterno';
                                                editableJson.value = /*[[ ${person?.partner?.firstSurname} ]]*/;
                                                $('#personPartnerFirstSurname').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>A. Materno</dt>
                                        <dd>
                                            <a href="#" id="personPartnerLastSurname"
                                               th:text="${person?.partner?.lastSurname}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/partnerLastSurname} ]]*/;
                                                editableJson.title = 'Ape. Materno';
                                                editableJson.value = /*[[ ${person?.partner?.lastSurname} ]]*/;
                                                $('#personPartnerLastSurname').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>F. Nacimiento</dt>
                                        <dd>
                                            <a href="#" id="personPartnerBirthday"
                                               th:text="${@utilService.dateFormat(person?.partner?.birthday)}"></a>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/partnerBirthday} ]]*/;
                                                editableJson.title = 'F. Nacimiento (dd/MM/yyyy)';
                                                editableJson.value = /*[[ ${@utilService.dateFormat(person?.partner?.birthday)} ]]*/;
                                                $('#personPartnerBirthday').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt th:if="${person.validatedPartner != null}">Valid&oacute; en Formulario</dt>
                                        <dd th:if="${person.validatedPartner != null}">
                                            <span class="label label-sm label-success" th:if="${person.validatedPartner == true}">Acert&oacute;</span>
                                            <span class="label label-sm label-danger" th:if="${person.validatedPartner == false}">No Acert&oacute;</span>
                                        </dd>
                                        <dt th:if="${person.validatedPartner != null}">Alertas</dt>
                                        <dd th:if="${person.validatedPartner != null}">
                                            <span class="label label-sm label-danger" th:if="${person?.partner?.hasDebt == true}">Deuda Pendiente</span>
                                            <span class="label label-sm label-danger" th:if="${person?.partner?.negativeBase == true}">Base Negativa</span>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div id="personContactPanelContainer">
                            <div id="personContactPanel" th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"> Contacto</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-user-data">
                                        <dt>E-mail</dt>
                                        <dd>
                                            <a href="#" id="personContactInfoEmail"
                                               th:text="${personContactInfo?.email}"></a>
                                            <span th:if="${personContactInfo?.emailVerified != null and personContactInfo?.emailVerified}"
                                                  class="label label-xs label-primary">Verificado</span>
                                            <span th:if="${personContactInfo?.emailVerified != null and !personContactInfo?.emailVerified}"
                                                  class="label label-xs label-danger">No Verificado</span>
                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/email} ]]*/;
                                                editableJson.title = 'Email';
                                                editableJson.value = /*[[ ${personContactInfo?.email} ]]*/;
                                                editableJson.params.loanId = /*[[${applicationId}]]*/;
                                                editableJson.success = function(data) {
                                                    swal({
                                                        title: "",
                                                        text: "Se envi\u00f3 un correo de verificaci\u00f3n",
                                                        type: "success"
                                                    });
                                                };
                                                $('#personContactInfoEmail').editable(editableJson);
                                                /*]]>*/
                                            </script>
                                        </dd>
                                        <dt>Celular</dt>
                                        <dd>
                                            <span th:text="${personContactInfo?.phoneNumber != null} ? '('+${personContactInfo?.phoneCountryCode}+') '"/>
                                            <a href="#" id="personContactInfoPhoneNumber"
                                               th:text="${personContactInfo?.phoneNumber}"></a>
                                            <span id="phoneVerified"
                                                  th:if="${personContactInfo?.phoneVerified != null and personContactInfo?.phoneVerified}"
                                                  class="label label-xs label-primary">Verificado</span>
                                            <span id="phoneNotVerified"
                                                  th:if="${personContactInfo?.phoneVerified != null and !personContactInfo?.phoneVerified}"
                                                  class="label label-xs label-danger">No Verificado</span>
                                            <span th:if="${personContactInfo?.phoneIndicator != null}" class="label label-xs label-warning" th:text="${personContactInfo?.phoneIndicator}"></span>
                                            <a th:if="${personContactInfo?.phonePreviouslyUsed}"
                                               th:href="@{/search(query=${personContactInfo?.phoneNumber})}">
                                                <span id="phonePreviouslyUsed"
                                                   class="label label-xs label-warning">
                                                    Reutilizado
                                                </span>
                                            </a>

                                            <script th:inline="javascript" th:if="${!onlyView}">
                                                /*<![CDATA[*/
                                                var isArgentina = /*[[${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}]]*/;
                                                var editableJson = getDefaultXEditableJson();
                                                editableJson.type = 'text';
                                                editableJson.url = /*[[ @{/person/phone} ]]*/;
                                                editableJson.title = 'Celular';
                                                editableJson.success = function (response, newValue) {
                                                    refreshPanelAjax('contact')
                                                };
                                                editableJson.value = /*[[ ${personContactInfo?.phoneNumber} ]]*/;

                                                if(isArgentina){
                                                    editableJson.tpl = '<input type="text" class="real-input" style="display: none"><input type="text" class="code-editor" placeholder="Cod. area"><br/><input type="text" class="celphone-editor" placeholder="Teléfono">';
                                                    $('#personContactInfoPhoneNumber').editable(editableJson).on('shown',function(){
                                                        $(".celphone-editor").closest('form').find('button[type=submit]').click(function(){
                                                            $('.real-input').val('('+$(".code-editor").val()+')'+$(".celphone-editor").val());
                                                        });
                                                        var phoneNumber = /*[[ ${personContactInfo?.getPhoneNumberWithoutCode()} ]]*/;
                                                        var phoneCode = /*[[ ${personContactInfo?.getPhoneCode()} ]]*/;
                                                        $(".code-editor").val(phoneCode != null ? phoneCode : "");
                                                        $(".celphone-editor").val(phoneNumber != null ? phoneNumber : "");
                                                        $(".celphone-editor").mask('9999-9999');
                                                    });
                                                }else{
                                                    $('#personContactInfoPhoneNumber').editable(editableJson);
                                                }
                                                /*]]>*/
                                            </script>

                                        </dd>
                                        <dt>Direcci&oacute;n</dt>
                                        <dd>
                                            <div class="row">
                                                <div class="col-md-12 col-sm-6">
                                                    <a href="javascript:;"
                                                       th:utext="${personContactInfo?.getFullAddressBO()}"
                                                       class="editable editable-click"
                                                       onclick="showUpdatePersonAddressModal()"></a>
                                                </div>
                                                <div class="col-md-12 col-sm-6" th:if="${personContactInfo?.addressLatitude} != null and ${personContactInfo?.addressLongitude} != null">
                                                    <img th:src="'https://maps.googleapis.com/maps/api/staticmap?center='+
                                                ${personContactInfo?.addressLatitude}+','+${personContactInfo?.addressLongitude}+
                                                '&amp;zoom=14&amp;size=300x150&amp;maptype=roadmap&amp;markers=color:blue%7C'+
                                                ${personContactInfo?.addressLatitude}+','+${personContactInfo?.addressLongitude}+
                                                '&amp;key='+${T(com.affirm.system.configuration.Configuration).GOOGLE_API_KEY}"
                                                         onclick="showUpdatePersonAddressModal()"
                                                         style="width: 100%;max-width: 300px;"/>
                                                </div>
                                                <div class="col-md-12 col-sm-6"
                                                     th:if="${personContactInfo?.addressLatitude} == null or ${personContactInfo?.addressLongitude} == null">
                                                    <img th:src="'https://maps.googleapis.com/maps/api/staticmap?center=-12.046465,-77.042767&amp;zoom=14&amp;size=300x150&amp;maptype=roadmap&amp;key='+${T(com.affirm.system.configuration.Configuration).GOOGLE_API_KEY}"
                                                         onclick="showUpdatePersonAddressModal()"
                                                         style="width: 100%;max-width: 300px;"/>
                                                    <span class="label label-xs label-danger">No se ha ubicado la direcci&oacute;n en el mapa.</span>
                                                </div>
                                            </div>
                                        </dd>
                                        <dt>Tipo de Vivienda</dt>
                                        <dd th:text="${personContactInfo?.housingType?.type}"></dd>
                                    </dl>
                                    <div class="portlet transparent">
                                        <div class="portlet-title">
                                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                <th:block th:switch="${personCountry}">
                                                    <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}" th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Direcciones EFX</span>
                                                    <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}" th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Direcciones</span>
                                                </th:block>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <th:block th:switch="${personCountry}">
                                                <dl th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}" class="dl-horizontal dl-user-data">
                                                    <dt>Domicilio fiscal </dt>
                                                    <dd th:text="${afip?.df1 + ', ' + afip?.df2 + ((afip?.df3 == '') ? '' : ', ' + afip?.df3)}"></dd>
                                                    <div th:unless="${#strings.isEmpty(afip?.df1)}">

                                                    </div>

                                                </dl>
                                                <dl th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}" class="dl-horizontal dl-user-data">
                                                    <dt>Direcciones</dt>
                                                    <dd id="efxIncomePredictor" th:text="${person?.efxAddresses}"></dd>
                                                    <script th:inline="javascript">
                                                        /*<![CDATA[*/
                                                        if ($('#efxAddresses').html() != null && $('#efxAddresses').html() != "") {
                                                            $('#efxAddresses').jsonViewer(JSON.parse($('#efxAddresses').html()), {collapsed: true});
                                                        }
                                                        /*]]>*/
                                                    </script>
                                                </dl>
                                            </th:block>
                                        </div>
                                    </div>
                                    <div class="portlet transparent">
                                        <div class="portlet-title">
                                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"> Referencias</span>
                                            </div>
                                        </div>
                                        <div class="portlet-body" th:switch="${#lists.isEmpty(personReferrals)}">
                                            <div th:case="true">
                                                <p>No hay referencias confirmadas</p>
                                            </div>
                                            <table th:case="false" class="table">
                                                <tr th:each="referral : ${personReferrals}">
                                                    <td style="border-top: 0px"
                                                        th:text="${referral?.fullName}+' ('+${referral?.relationship?.relationship}+')'"></td>
                                                    <td style="border-top: 0px" th:text="${referral?.phoneNumber}"></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="personIncomePanelContainer">
                            <div id="personIncomePanel" th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"> Ingresos</span>
                                    </div>
                                    <div style="font-weight: bold;display: inline-block;margin:1em;vertical-align: top;" th:if="${person?.efxIncomePredictor != null}">
                                        <span>Predictor de Ingresos EFX</span>
                                        <span id="efxIncomePredictord"
                                              th:text="${person?.efxIncomePredictor}"></span>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            if ($('#efxIncomePredictor').html() != null && $('#efxIncomePredictor').html() != "") {
                                                $('#efxIncomePredictor').jsonViewer(JSON.parse($('#efxIncomePredictor').html()));
                                            }
                                            /*]]>*/
                                        </script>
                                    </div>
                                    <div class="actions" th:if="${!onlyView}">
                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                            <input id="personOcupationaInformationValidate" type="checkbox"
                                                   th:checked="${(personPrincipalOcupationalInfo == null or personPrincipalOcupationalInfo?.validated) and (personSecundaryOcupationalInfo == null or personSecundaryOcupationalInfo?.validated) and (personOtherOcupationalInfo == null or personOtherOcupationalInfo?.validated)}"/>
                                            Confirmar
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <div class="container">
                                        <div class="row">
                                            <div>
                                                <!-- Principal -->
                                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Actividad Principal</span>
                                                </div>
                                                <dl class="dl-horizontal dl-user-data">
                                                    <th:block th:switch="${personCountry}">
                                                        <dt th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">Actividad Declarada</dt>
                                                        <dt th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">Actividad</dt>
                                                        <dt th:case="*">Actividad</dt>
                                                    </th:block>
                                                    <dd>
                                                        <a href="#" id="personPrincipalActivityType"
                                                           th:text="${personPrincipalOcupationalInfo?.activityType?.type}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalActivityType} ]]*/;
                                                            editableJson.title = 'Actividad Principal';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.activityType?.id} ]]*/;
                                                            editableJson.source = function () {
                                                                var activityTypes;
                                                                $.ajax({
                                                                    url: /*[[@{/catalog/activityType/json}]]*/null,
                                                                    type: 'GET',
                                                                    data: {
                                                                        principal: true,
                                                                        countryId: /*[[${person?.documentType?.countryId}]]*/
                                                                    },
                                                                    async: false,
                                                                    global: false,
                                                                    success: function (data) {
                                                                        var result = JSON.parse(data);
                                                                        activityTypes = [];

                                                                        for (i = 0; i < result.length; i++) {
                                                                            activityTypes[i] = {
                                                                                value: result[i].id,
                                                                                text: result[i].type
                                                                            };
                                                                        }
                                                                    }
                                                                })
                                                                return activityTypes;
                                                            };
                                                            editableJson.success = function (response, newValue) {
                                                                paintPrincipalActivity(newValue);
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#personPrincipalActivityType').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <th:block th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA and personPrincipalOcupationalInfo?.activityType?.id !=null}">
                                                        <dt class="personPrincipalValidate">Validado</dt>
                                                        <th:block th:switch="${personPrincipalOcupationalInfo?.activityType?.id}">
                                                            <dd th:case="1" class="personPrincipalValidate" th:text="${validacionDependent}"></dd>
                                                            <dd th:case="2" class="personPrincipalValidate" th:text="${validacionAutonomo}"></dd>
                                                            <dd th:case="6" class="personPrincipalValidate" th:text="${validacionPensionist}"></dd>
                                                            <dd th:case="9" class="personPrincipalValidate" th:text="${validacionMonotributista}"></dd>
                                                        </th:block>
                                                    </th:block>
                                                    <dt class="personPrincipalSubActivityType">Categor&iacute;a</dt><!--CON ALERTA-->
                                                    <dd class="personPrincipalSubActivityType">
                                                        <a href="#" id="personPrincipalSubActivityType"
                                                           th:text="${personPrincipalOcupationalInfo?.subActivityType?.type}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalSubActivityType} ]]*/;
                                                            editableJson.title = 'Categoría';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.subActivityType?.id} ]]*/;
                                                            editableJson.source = function () {
                                                                var subActivityTypes;
                                                                $.ajax({
                                                                    url: /*[[@{/catalog/subActivityType/json}]]*/null,
                                                                    type: 'GET',
                                                                    async: false,
                                                                    global: false,
                                                                    success: function (data) {
                                                                        var result = JSON.parse(data);
                                                                        subActivityTypes = [];

                                                                        for (i = 0; i < result.length; i++) {
                                                                            subActivityTypes[i] = {
                                                                                value: result[i].id,
                                                                                text: result[i].type
                                                                            };
                                                                        }
                                                                    }
                                                                })
                                                                return subActivityTypes;
                                                            };
                                                            editableJson.success = function (response, newValue) {
                                                                paintPrincipalSubActivity(newValue);
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#personPrincipalSubActivityType').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalDependentRuc" th:text="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA ? 'CUIT' : 'RUC'}"></dt><!--CON ALERTA-->
                                                    <dd class="principalDependentRuc">
                                                        <a href="#" id="principalDependentRuc"
                                                           th:text="${personPrincipalOcupationalInfo?.ruc}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getRUCAlert() != null}">
                                                            <span th:if="${personPrincipalOcupationalInfo?.getRUCAlert() == T(com.affirm.common.model.transactional.PersonOcupationalInformation).NORMAL}" th:text="${personPrincipalOcupationalInfo?.getRUCAlert()}"
                                                                  class="label label-xs label-primary">Alerta</span>
                                                            <span th:if="${personPrincipalOcupationalInfo?.getRUCAlert() != T(com.affirm.common.model.transactional.PersonOcupationalInformation).NORMAL}" th:text="${personPrincipalOcupationalInfo?.getRUCAlert()}"
                                                                  class="label label-xs label-danger"></span>
                                                        </span>
                                                        <span th:unless="${personPrincipalOcupationalInfo?.getRUCAlert() != null}">
                                                            <span class="label label-xs label-danger">NO EN RCC</span>
                                                        </span>
                                                        <span class="person-ruc-total-employees" title="Empleados en ESSALUD">
                                                            <span class="label label-xs label-primary">Cargando ...</span>
                                                        </span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentRuc} ]]*/;
                                                            editableJson.title = 'Ruc';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.ruc} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();

                                                                renderTotalEmployeesByRuc(newValue, $('.person-ruc-total-employees span'));
                                                            };
                                                            $('#principalDependentRuc').editable(editableJson);

                                                            renderTotalEmployeesByRuc(/*[[ ${personPrincipalOcupationalInfo?.ruc} ]]*/null, $('.person-ruc-total-employees span'));
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalDependentCompany">Empresa</dt>
                                                    <!--CON ACTIVO Y ESSA-->
                                                    <dd class="principalDependentCompany">
                                                        <a href="#" id="principalDependentCompany"
                                                           th:text="${personPrincipalOcupationalInfo?.companyName}"></a>

                                                        <span th:if="${personPrincipalOcupationalInfo?.essa() != null and personPrincipalOcupationalInfo?.essa() }"
                                                              class="label label-xs label-primary">ESSA</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.essa() != null and !personPrincipalOcupationalInfo?.essa()}"
                                                              class="label label-xs label-danger">ESSA</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.ruc_active() != null and personPrincipalOcupationalInfo?.ruc_active()}"
                                                              class="label label-xs label-primary">Activo</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.ruc_active() != null and !personPrincipalOcupationalInfo?.ruc_active()}"
                                                              class="label label-xs label-danger">Inactivo</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentCompany} ]]*/;
                                                            editableJson.title = 'Empresa';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.companyName} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentCompany').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalDependentCiiu">CIIU</dt>
                                                    <dd class="principalDependentCiiu">
                                                        <a href="#" id="principalDependentCiiu"
                                                           th:text="${personPrincipalOcupationalInfo?.ciiu}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentCiiu} ]]*/;
                                                            editableJson.title = 'CIIU';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.ciiu} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentCiiu').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalDependentSector">Sector</dt>
                                                    <dd class="principalDependentSector">
                                                        <a href="#" id="principalDependentSector"
                                                           th:text="${personPrincipalOcupationalInfo?.sector?.name}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalSector} ]]*/;
                                                            editableJson.title = 'Sector';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.sector?.name} ]]*/;
                                                            editableJson.source = function () {
                                                                var ocupations;
                                                                $.ajax({
                                                                    url: /*[[@{/catalog/sector/json}]]*/null,
                                                                    type: 'GET',
                                                                    async: false,
                                                                    global: false,
                                                                    success: function (data) {
                                                                        var result = JSON.parse(data);
                                                                        ocupations = [];

                                                                        for (i = 0; i < result.length; i++) {
                                                                            ocupations[i] = {
                                                                                value: result[i].id,
                                                                                text: result[i].name
                                                                            };
                                                                        }
                                                                    }
                                                                })
                                                                return ocupations;
                                                            };
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentSector').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalDependentOcupation">Ocupaci&oacute;n</dt>
                                                    <dd class="principalDependentOcupation">
                                                        <a href="#" id="principalDependentOcupation"
                                                           th:text="${personPrincipalOcupationalInfo?.ocupation?.ocupation}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalOcupation} ]]*/;
                                                            editableJson.title = 'Ocupación';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.ocupation?.ocupation} ]]*/;
                                                            editableJson.source = function () {
                                                                var ocupations;
                                                                $.ajax({
                                                                    url: /*[[@{/catalog/ocupation/json}]]*/null,
                                                                    type: 'GET',
                                                                    async: false,
                                                                    global: false,
                                                                    success: function (data) {
                                                                        var result = JSON.parse(data);
                                                                        ocupations = [];

                                                                        for (i = 0; i < result.length; i++) {
                                                                            ocupations[i] = {
                                                                                value: result[i].id,
                                                                                text: result[i].ocupation
                                                                            };
                                                                        }
                                                                    }
                                                                })
                                                                return ocupations;
                                                            };
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentOcupation').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>


                                                    <dt class="principalDependentWorkplace">Direcci&oacute;n</dt>
                                                    <dd class="principalDependentWorkplace">
                                                        <span th:text="${personPrincipalOcupationalInfo?.address}"></span>
                                                    </dd>
                                                    <dt class="principalDependentPhone">Tel&eacute;fono laboral</dt>
                                                    <dd class="principalDependentPhone">
                                                        <a href="javascript:void(0)" id="occupationalPhoneNumber" class="editable editable-click" onclick="showOccupationalPhoneNumberModal()"
                                                           th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} != null and
                                                           ${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} != ''"
                                                           th:text="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber}"></a>
                                                        <a href="javascript:void(0)" id="occupationalPhoneNumber" class="editable editable-click editable-empty" onclick="showOccupationalPhoneNumberModal()"
                                                           th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} == null or
                                                                    ${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} == ''"
                                                           >Sin asignar</a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.phoneNumberType == 'L'}"
                                                              class="label label-xs label-primary">Fijo</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.phoneNumberType == 'M'}"
                                                              class="label label-xs label-primary">Celular</span>
                                                    </dd>

                                                    <dt class="principalDependentTime">Tiempo laboral</dt>
                                                    <dd class="principalDependentTime">
                                                        <a href="#" id="principalDependentTime"
                                                           th:text="${personPrincipalOcupationalInfo?.employmentTime}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentTime} ]]*/;
                                                            editableJson.title = 'Tiempo laboral';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.employmentTime} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                                refreshPanelAjax('income');
                                                            };
                                                            $('#principalDependentTime').editable(editableJson);
                                                            /*]]>*/
                                                        </script> meses
                                                    </dd>
                                                    <dt class="principalDependentGrossIncome" th:text="'Ingreso Fijo (' + ${person?.country?.currency?.symbol} + ')'"></dt>
                                                    <dd class="principalDependentGrossIncome">
                                                        <a href="#" id="principalDependentGrossIncome" th:text="${@utilService.doubleMoneyFormat(personPrincipalOcupationalInfo?.fixedGrossIncome,person?.country?.currency)}"></a>
                                                        <th:block th:if="${employee != null}">
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and employee?.fixedGrossIncome == personPrincipalOcupationalInfo?.fixedGrossIncome}"
                                                                  class="label label-xs label-primary">&#8730;</span>
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and employee?.fixedGrossIncome != personPrincipalOcupationalInfo?.fixedGrossIncome}"
                                                                   class="label label-xs label-danger"><span th:text="${employee?.fixedGrossIncome != null ? employee?.fixedGrossIncome : 'Sin información'}"></span></span>
                                                        </th:block>
                                                        <th:block th:unless="${employee != null}">
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and fixedGrossIncomeESSalud == personPrincipalOcupationalInfo?.fixedGrossIncome}"
                                                                  class="label label-xs label-primary">&#8730;</span>
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and fixedGrossIncomeESSalud != personPrincipalOcupationalInfo?.fixedGrossIncome}"
                                                                  class="label label-xs label-danger"><span th:text="${fixedGrossIncomeESSalud != null ? fixedGrossIncomeESSalud : 'Sin información'}"></span></span>
                                                        </th:block>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentGrossIncome} ]]*/;
                                                            editableJson.title = 'Ingreso Fijo';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.fixedGrossIncome} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentGrossIncome').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalCategoryAfip" th:text="'Categoría AFIP'"></dt>
                                                    <dd class="principalCategoryAfip">
                                                        <span href="#" id="principalCategoryAfip" th:text="${afip?.getControlCategoria()}"></span>
                                                    </dd>

                                                    <dt class="principalActivityAfip" th:text="'Actividad AFIP'"></dt>
                                                    <dd class="principalActivityAfip">
                                                        <span href="#" id="principalActivityAfip" th:text="${afip?.getControlActividad()}"></span>
                                                    </dd>

                                                    <dt class="principalDependentVariableGrossIncome" th:text="'Ingreso Variable (' + ${person?.country?.currency?.symbol} + ')'"></dt>
                                                    <dd class="principalDependentVariableGrossIncome">
                                                        <a href="#" id="principalDependentVariableGrossIncome" th:text="${personPrincipalOcupationalInfo?.variableGrossIncome}"></a>
                                                        <th:block th:if="${employee != null}">
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and employee?.variableGrossIncome == personPrincipalOcupationalInfo?.variableGrossIncome}"
                                                                  class="label label-xs label-primary">&#8730;</span>
                                                            <span th:if="${personPrincipalOcupationalInfo?.getActivityType()?.id == T(com.affirm.common.model.catalog.ActivityType).DEPENDENT and employee?.variableGrossIncome != personPrincipalOcupationalInfo?.variableGrossIncome}"
                                                                  class="label label-xs label-danger"><span th:text="${employee?.variableGrossIncome != null ? employee?.variableGrossIncome : 'Sin información'}"></span></span>
                                                        </th:block>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentVariableGrossIncome} ]]*/;
                                                            editableJson.title = 'Ingreso Variable';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.variableGrossIncome} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalDependentVariableGrossIncome').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalDependentMonthlyDeduction" th:text="'Descuentos (' + ${person?.country?.currency?.symbol} + ')'"></dt>
                                                    <dd class="principalDependentMonthlyDeduction"> <span th:text="${employee?.monthlyDeduction != null ? employee?.monthlyDeduction : 'Sin descuentos'}"></span> </dd>

                                                    <dt class="principalDependentFrequencySalaryType">Frecuencia salarial</dt>
                                                    <dd class="principalDependentFrequencySalaryType"> <span th:text="${personPrincipalOcupationalInfo?.frequencySalary?.getFrequency()}"></span> </dd>

                                                    <dt class="principalDependentFrequencySalaryDays">Dias</dt>
                                                    <dd class="principalDependentFrequencySalaryDaysy"> <span th:text="${personPrincipalOcupationalInfo?.frequencySalary?.getFrequencyDays()}"></span> </dd>

                                                    <dt class="principalIndependentRuc">Ruc</dt><!--CON ALERTA-->
                                                    <dd class="principalIndependentRuc">
                                                        <a href="#" id="principalIndependentRuc"
                                                           th:text="${personPrincipalOcupationalInfo?.ruc}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.ruc_alert() != null and personPrincipalOcupationalInfo?.ruc_alert()}"
                                                              class="label label-xs label-danger">Alerta</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.ruc_alert() == null}"
                                                              class="label label-xs label-warning">No Encontrado</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentRuc} ]]*/;
                                                            editableJson.title = 'Ruc';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.ruc} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentRuc').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalIndependentRegime">R&eacute;gimen</dt>
                                                    <dd class="principalIndependentRegime">
                                                        <a href="#" id="principalIndependentRegime"
                                                           th:text="${personPrincipalOcupationalInfo?.taxRegime?.description}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalIndependentRegime} ]]*/;
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.taxRegime?.code} ]]*/;
                                                            editableJson.title = 'Régimen';
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            editableJson.source = function () {
                                                                var regimeTypes = [];
                                                                var result = /*[[${regimes}]]*/;
                                                                console.log(result);
                                                                for (i = 0; i < result.length; i++) {
                                                                    regimeTypes[i] = {
                                                                        value: result[i].code,
                                                                        text: result[i].description
                                                                    };
                                                                }

                                                                return regimeTypes;
                                                            };
                                                            $('#principalIndependentRegime').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalIndependentVouchers">Comprobante de pago</dt>
                                                    <dd class="principalIndependentVouchers">
                                                        <a href="#" id="principalIndependentVouchers"
                                                           th:text="${personPrincipalOcupationalInfo?.voucherType?.name}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'select';
                                                            editableJson.url = /*[[ @{/person/principalIndependentVouchers} ]]*/;
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.voucherType?.id} ]]*/;
                                                            editableJson.title = 'Banco';
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            editableJson.source = function () {
                                                                var voucherTypes;
                                                                $.ajax({
                                                                    url: /*[[@{/catalog/voucherTypes/json}]]*/null,
                                                                    type: 'GET',
                                                                    async: false,
                                                                    global: false,
                                                                    success: function (data) {
                                                                        var result = JSON.parse(data);
                                                                        voucherTypes = [];

                                                                        for (i = 0; i < result.length; i++) {
                                                                            voucherTypes[i] = {
                                                                                value: result[i].id,
                                                                                text: result[i].name
                                                                            };
                                                                        }
                                                                    }
                                                                })
                                                                return voucherTypes;
                                                            };
                                                            $('#principalIndependentVouchers').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentTime">Tiempo laboral</dt>
                                                    <dd class="principalIndependentTime">
                                                        <a href="#" id="principalIndependentTime"
                                                           th:text="${personPrincipalOcupationalInfo?.employmentTime}"></a> <span>meses</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentTime} ]]*/;
                                                            editableJson.title = 'Tiempo laboral';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.employmentTime} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                                refreshPanelAjax('income');
                                                            };
                                                            $('#principalIndependentTime').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentGrossIncome" th:text="'Ingreso Fijo (' + ${person?.country?.currency?.symbol} + ')'"></dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentGrossIncome">
                                                        <a href="#" id="principalIndependentGrossIncome"
                                                           th:text="${personPrincipalOcupationalInfo?.fixedGrossIncome}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getFixedGrossIncomeIncreasal() == 1}"
                                                              class="label label-xs label-danger">&#8595;</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getFixedGrossIncomeIncreasal() == 2}"
                                                              class="label label-xs label-warning">=</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getFixedGrossIncomeIncreasal() == 3}"
                                                              class="label label-xs label-success">&#8593;</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalDependentGrossIncome} ]]*/;
                                                            editableJson.title = 'Ingreso Fijo';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.fixedGrossIncome} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentGrossIncome').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentPrincipalClient">RUC Cliente Principal</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentPrincipalClient">
                                                        <a href="#" id="principalIndependentPrincipalClient"
                                                           th:text="${personPrincipalOcupationalInfo?.client1Ruc}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getClient1Ruc65()}"
                                                              class="label label-xs label-success"> >65% </span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentPrincipalClient} ]]*/;
                                                            editableJson.title = 'RUC Cliente Principal';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.client1Ruc} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentPrincipalClient').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentShareholding">Participaci&oacute;n</dt>
                                                    <dd class="principalIndependentShareholding">
                                                        <a href="#" id="principalIndependentShareholding"
                                                           th:text="${personPrincipalOcupationalInfo?.shareholderShareholding}"></a> <span>%</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentShareholding} ]]*/;
                                                            editableJson.title = 'Participación';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.shareholderShareholding} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentShareholding').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>

                                                    <dt class="principalIndependentLastYearsSellings">Ventas U12M</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentLastYearsSellings">
                                                        <a href="#" id="principalIndependentLastYearsSellings"
                                                           th:text="${personPrincipalOcupationalInfo?.lastYearSellings}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getLastYearSellingsIncreasal() == 1}"
                                                              class="label label-xs label-danger">&#8595;</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getLastYearSellingsIncreasal() == 2}"
                                                              class="label label-xs label-warning">=</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getLastYearSellingsIncreasal() == 3}"
                                                              class="label label-xs label-success">&#8593;</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentLastYearsSellings} ]]*/;
                                                            editableJson.title = 'Ventas U12M';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.lastYearSellings} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentLastYearsSellings').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentExerciseOutcome">Resultado Ejer. Anterior</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentExerciseOutcome">
                                                        <a href="#" id="principalIndependentExerciseOutcome"
                                                           th:text="${personPrincipalOcupationalInfo?.exerciseOutcome}"></a>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getExerciseOutcomeIncreasal() == 1}"
                                                              class="label label-xs label-danger">&#8595;</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getExerciseOutcomeIncreasal() == 2}"
                                                              class="label label-xs label-warning">=</span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getExerciseOutcomeIncreasal() == 3}"
                                                              class="label label-xs label-success">&#8593;</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentExerciseOutcome} ]]*/;
                                                            editableJson.title = 'Resultado Ejer. Anterior';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.exerciseOutcome} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentExerciseOutcome').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentSalesPercentageFixedCosts">Gasto Costos Fijos</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentSalesPercentageFixedCosts">
                                                        <a href="#" id="principalIndependentSalesPercentageFixedCosts"
                                                           th:text="${personPrincipalOcupationalInfo?.salesPercentageFixedCosts}"></a> <span>%</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentSalesPercentageFixedCosts} ]]*/;
                                                            editableJson.title = 'Gasto Costos Fijos';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.salesPercentageFixedCosts} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentSalesPercentageFixedCosts').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentSalesPercentageVariableCosts">Gasto Costos Variables</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentSalesPercentageVariableCosts">
                                                        <a href="#" id="principalIndependentSalesPercentageVariableCosts"
                                                           th:text="${personPrincipalOcupationalInfo?.salesPercentageVariableCosts}"></a> <span>%</span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentSalesPercentageVariableCosts} ]]*/;
                                                            editableJson.title = 'Gasto Costos Variables';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.salesPercentageVariableCosts} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentSalesPercentageVariableCosts').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentSalesPercentajeBestClient">Mejor Cliente (%)</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentSalesPercentajeBestClient">
                                                        <a href="#" id="principalIndependentSalesPercentajeBestClient"
                                                           th:text="${personPrincipalOcupationalInfo?.salesPercentageBestClient}"></a>  <span>% </span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getSalesPercentageBestClientIndicator() == 1}"
                                                              class="label label-xs label-success"> Minorista </span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getSalesPercentageBestClientIndicator() == 2}"
                                                              class="label label-xs label-success"> &#61;5 </span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getSalesPercentageBestClientIndicator() == 3}"
                                                              class="label label-xs label-success"> &#60;5 </span>
                                                        <span th:if="${personPrincipalOcupationalInfo?.getSalesPercentageBestClientIndicator() == 4}"
                                                              class="label label-xs label-success"> &#62;5 </span>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentSalesPercentajeBestClient} ]]*/;
                                                            editableJson.title = 'Mejor Cliente (%)';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.salesPercentageBestClient} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentSalesPercentajeBestClient').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentDailyIncome">Flujo Diario</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentDailyIncome">
                                                        <a href="#" id="principalIndependentDailyIncome"
                                                           th:text="${personPrincipalOcupationalInfo?.averageDailyIncome}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentDailyIncome} ]]*/;
                                                            editableJson.title = 'Flujo Diario';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.averageDailyIncome} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentDailyIncome').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentLastYearCompensation">Compensaci&oacute;n U12M</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentLastYearCompensation">
                                                        <a href="#" id="principalIndependentLastYearCompensation"
                                                           th:text="${personPrincipalOcupationalInfo?.lastYearCompensation}"></a>
                                                        <script th:inline="javascript" th:if="${!onlyView}">
                                                            /*<![CDATA[*/
                                                            var editableJson = getDefaultXEditableJson();
                                                            editableJson.type = 'text';
                                                            editableJson.url = /*[[ @{/person/principalIndependentLastYearCompensation} ]]*/;
                                                            editableJson.title = 'Compensación U12M';
                                                            editableJson.value = /*[[ ${personPrincipalOcupationalInfo?.lastYearCompensation} ]]*/;
                                                            editableJson.success = function (response, newValue) {
                                                                onChangeOcupationalInformation();
                                                            };
                                                            $('#principalIndependentLastYearCompensation').editable(editableJson);
                                                            /*]]>*/
                                                        </script>
                                                    </dd>
                                                    <dt class="principalIndependentBelongings">Bienes en renta</dt>
                                                    <!--RANGO BRUTO-->
                                                    <dd class="principalIndependentBelongings">
                                                        <span id="principalIndependentBelongings"
                                                           th:text="${personPrincipalOcupationalInfo?.getBelongingToString()}"></span>
                                                    </dd>

                                                    <dt class="retirementDate">Fecha de Jubilacion</dt>
                                                    <dd class="retirementDate">
                                                        <a href="#" id="retirementDate" th:text="${@utilService.dateFormat(personPrincipalOcupationalInfo?.retirementDate)}"></a>
                                                    </dd>

                                                    <dt class="retirementScheme">R&eacute;gimen de Jubilacion</dt>
                                                    <dd class="retirementScheme">
                                                        <a href="#" id="retirementScheme"
                                                           th:text="${personPrincipalOcupationalInfo?.retirementScheme?.scheme}"></a>
                                                    </dd>


                                                    <script th:inline="javascript">
                                                        /*<![CDATA[*/

                                                        function onChangeOcupationalInformation() {
                                                            $('#personOcupationaInformationValidate').prop('checked', false);
                                                            refreshTabAjax('applications')
                                                        }
                                                        $('#personOcupationaInformationValidate').click(function (e) {
                                                            validateOcupationalInformation($(this).is(":checked"))
                                                            e.preventDefault();
                                                        });
                                                        function hideIndependent(){
                                                            $('.principalIndependentRuc').hide(300);
                                                            $('.principalIndependentRegime').hide(300);
                                                            $('.principalIndependentVouchers').hide(300);
                                                            $('.principalIndependentTime').hide(300);
                                                            $('.principalIndependentGrossIncome').hide(300);
                                                            $('.principalIndependentPrincipalClient').hide(300);
                                                            $('.principalIndependentShareholding').hide(300);
                                                            $('.principalIndependentLastYearsSellings').hide(300);
                                                            $('.principalIndependentExerciseOutcome').hide(300);
                                                            $('.principalIndependentSalesPercentageFixedCosts').hide(300);
                                                            $('.principalIndependentSalesPercentageVariableCosts').hide(300);
                                                            $('.principalIndependentSalesPercentajeBestClient').hide(300);
                                                            $('.principalIndependentDailyIncome').hide(300);
                                                            $('.principalIndependentLastYearCompensation').hide(300);
                                                            $('.principalIndependentBelongings').hide(300);
                                                        }

                                                        function hideDependent(){
                                                            $('.principalDependentRuc').hide(300);
                                                            $('.principalDependentCompany').hide(300);
                                                            $('.principalDependentTime').hide(300);
                                                            $('.principalDependentGrossIncome').hide(300);
                                                        }

                                                        function hideMonotributista() {
                                                            $('.principalCategoryAfip').hide(300);
                                                            $('.principalActivityAfip').hide(300);
                                                        }

                                                        function hidePensioner() {
                                                            $('.principalDependentGrossIncome').hide(300);
                                                            $('.retirementDate').hide(300);
                                                            $('.retirementScheme').hide(300);
                                                        }

                                                        function hideAllPrincipal() {
                                                            console.log("Hiding All Elements");
                                                            $('.personPrincipalSubActivityType').hide(300);
                                                            hideDependent();
                                                            hideIndependent();
                                                            hideMonotributista();
                                                            hidePensioner();
                                                        }

                                                        function paintPrincipalSubActivity(subActivityTypeId) {
                                                            console.log("paintPrincipalActivity: " + subActivityTypeId);
                                                            var professionalServices = /*[[ ${T(com.affirm.common.model.catalog.SubActivityType).PROFESSIONAL_SERVICE} ]]*/;
                                                            var ownBusiness = /*[[ ${T(com.affirm.common.model.catalog.SubActivityType).OWN_BUSINESS} ]]*/;
                                                            var rentist = /*[[ ${T(com.affirm.common.model.catalog.SubActivityType).RENT} ]]*/;

                                                            hideDependent();
                                                            hideIndependent();
                                                            if (subActivityTypeId == professionalServices) {
                                                                console.log("professionalServices");
                                                                $('.principalIndependentRuc').show(300);
                                                                $('.principalDependentCompany').show(300);
                                                                $('.principalIndependentRegime').show(300);
                                                                $('.principalIndependentPrincipalClient').show(300);
                                                                $('.principalIndependentGrossIncome').show(300);
                                                            } else if (subActivityTypeId == ownBusiness) {
                                                                console.log("ownBusiness");
                                                                $('.principalIndependentRuc').show(300);
                                                                $('.principalDependentCompany').show(300);
                                                                $('.principalIndependentRegime').show(300);
                                                                $('.principalIndependentTime').show(300);
                                                                $('.principalIndependentLastYearsSellings').show(300);
                                                                $('.principalIndependentExerciseOutcome').show(300);
                                                                $('.principalIndependentSalesPercentageFixedCosts').show(300);
                                                                $('.principalIndependentShareholding').show(300);
                                                                $('.principalIndependentSalesPercentageVariableCosts').show(300);
                                                                $('.principalIndependentSalesPercentajeBestClient').show(300);
                                                                $('.principalIndependentDailyIncome').show(300);
                                                                $('.principalIndependentLastYearCompensation').show(300);
                                                                $('.principalIndependentGrossIncome').show(300);
                                                            } else if (subActivityTypeId == rentist) {
                                                                console.log("rentist");
                                                                $('.principalIndependentRuc').show(300);
                                                                $('.principalDependentCompany').show(300);
                                                                $('.principalIndependentRegime').show(300);
                                                                $('.principalIndependentGrossIncome').show(300);
                                                                $('.principalIndependentBelongings').show(300);
                                                            }
                                                        }

                                                        function paintPrincipalActivity(activityTypeId) {
                                                            console.log("paintPrincipalActivity: " + activityTypeId);

                                                            console.log("Call Hiding Function");
                                                            hideAllPrincipal();

                                                            var dependentType = /*[[ ${T(com.affirm.common.model.catalog.ActivityType).DEPENDENT} ]]*/;
                                                            var independentType = /*[[ ${T(com.affirm.common.model.catalog.ActivityType).INDEPENDENT} ]]*/;
                                                            var monotributista = /*[[ ${T(com.affirm.common.model.catalog.ActivityType).MONOTRIBUTISTA} ]]*/;
                                                            var pensioner = /*[[ ${T(com.affirm.common.model.catalog.ActivityType).PENSIONER} ]]*/;

                                                            if (activityTypeId == dependentType) {
                                                                console.log("Dependent");
                                                                $('.principalDependentRuc').show(300);
                                                                $('.principalDependentCompany').show(300);
                                                                $('.principalDependentTime').show(300);
                                                                $('.principalDependentGrossIncome').show(300);
                                                            } else if (activityTypeId == independentType) {
                                                                console.log("Independent");
                                                                $('.personPrincipalSubActivityType').show(300);
                                                                paintPrincipalSubActivity(/*[[ ${personPrincipalOcupationalInfo?.subActivityType?.id} ]]*/);
                                                                $('.principalIndependentTime').show(300);
                                                                $('.principalCategoryAfip').show(300);
                                                            } else if (activityTypeId == monotributista) {
                                                                console.log("monotributista");
                                                                $('.principalCategoryAfip').show(300);
                                                                $('.principalActivityAfip').show(300);
                                                                $('.principalDependentTime').show(300);
                                                            }else if (activityTypeId == pensioner) {
                                                                console.log("pensioner");
                                                                $('.principalDependentGrossIncome').show(300);
                                                                $('.retirementDate').show(300);
                                                                $('.retirementScheme').show(300);
                                                            }
                                                        }
                                                        paintPrincipalActivity(/*[[ ${personPrincipalOcupationalInfo?.activityType?.id} ]]*/);

                                                        /*]]>*/
                                                    </script>
                                                </dl>
                                                <dl class="dl-horizontal dl-user-data" th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                                    <dt>NSE</dt>
                                                    <dd th:with="categoryLevelId = ${nosisXml?.getDatos()?.get(1)?.getCalculoCDA()?.getItems()?.get(1)?.getValor()}">
                                                        <th:block th:if="${categoryLevelId != null}" th:with="categoryLevel = ${@catalogService.getSocioEconomicLevelByLevel(categoryLevelId)}">
                                                            <th:block th:if="${categoryLevel != null}" th:text="${categoryLevel.getDescriptionWithMaxMinAvg(@utilService, @catalogService)}"></th:block>
                                                        </th:block>
                                                    </dd>
                                                </dl>
                                                <dl class="dl-horizontal dl-user-data" th:if="${personCountry == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                                    <dt th:text="'Total Ingresos (' + ${person?.country?.currency?.symbol} + ')'"></dt>
                                                    <dd th:text="${@utilService.doubleMoneyFormat(fixedGrossIncome,person?.country?.currency)}"></dd>
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div id="personAlertsDiv">
                            <div class="alert alert-danger alert-dismissable" th:if="${personErrorMsgBot != null}">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                                <span th:utext="${personErrorMsgBot}"></span>
                            </div>
                        </div>

                        <!-- TABS -->
                        <ul class="nav nav-tabs" role="tablist">
                            <li th:class="${tab == null or tab == 'credits'} ? 'active':''">
                                <a href="#tab_credits"
                                   role="personTab"
                                   data-toggle="tab">Cr&eacute;dito</a>
                            </li>
                            <li th:class="${tab == 'applications'} ? 'active':''">
                                <a href="#tab_applications"
                                   role="personTab"
                                   data-toggle="tab">Solicitud</a>
                            </li>
                            <li th:class="${tab == 'rcc'} ? 'active':''">
                                <a href="#tab_rcc" role="personTab" data-toggle="tab">
                                    <th:block th:switch="${personCountry}">
                                        <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">SBS</span>
                                        <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">BCRA</span>
                                        <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">SBS</span>
                                        <span th:case="*">???</span>
                                    </th:block>
                                </a>
                            </li>
                            <th:block th:switch="${personCountry}">
                            <li th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}" th:class="${tab == 'data'} ? 'active':''">
                                <a href="#tab_bureaus"
                                   role="personTab"
                                   data-toggle="tab">Bureau</a>
                            </li>
                            <li th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}" th:class="${tab == 'data'} ? 'active':''">
                                <a href="#tab_bureaus"
                                   role="personTab"
                                   data-toggle="tab">NOSIS</a>
                            </li>
                            </th:block>
                            <li th:class="${tab == 'data'} ? 'active':''">
                                <a href="#tab_data"
                                   role="personTab"
                                   data-toggle="tab">Data</a>
                            </li>
                            <li th:class="${tab == 'data'} ? 'active':''">
                                <a href="#tab_email"
                                   role="personTab"
                                   data-toggle="tab">Seguridad</a>
                            </li>
                            <li th:class="${tab == 'socialNetworks'} ? 'active':''">
                                <a href="#tab_socialNetworks"
                                   role="personTab"
                                   data-toggle="tab">Redes Sociales</a>
                            </li>
                            <li th:class="${tab == 'contact'} ? 'active':''">
                                <a href="#tab_contact"
                                   role="personTab"
                                   data-toggle="tab">Contacto</a>
                            </li>
                            <li th:class="${tab == 'interactions'} ? 'active':''">
                                <a href="#tab_interactions"
                                   role="personTab"
                                   data-toggle="tab">Interacciones</a>
                            </li>
                            <li th:class="${tab == 'bankAccount'} ? 'active':''">
                                <a href="#tab_bankAccount"
                                   role="personTab"
                                   data-toggle="tab">Cuenta bancaria</a>
                            </li>
                        </ul>
                        <!-- TAB CONTENT TAKEN FROM html/fragments/personFragments.html (:: partial by th:fragment) -->
                        <div id="myTabContent" class="tab-content">

                            <div id="tab_credits" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == null or tab == 'credits'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-credits(firstCall=true)"/>
                            </div>
                            <div id="tab_applications" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'applications'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-applications(firstCall=true)"/>
                            </div>
                            <div id="tab_bureaus" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'bureaus'} ? 'active in':'')">
                                <div th:replace="fragments/person/bureaus :: bureaus(firstCall=true)"/>
                            </div>
                            <div id="tab_data" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'data'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-data(firstCall=true)"/>
                            </div>
                            <div id="tab_email" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'email'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-email(firstCall=true)"/>
                            </div>
                            <div id="tab_socialNetworks" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'socialNetworks'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-socialNetworks(firstCall=true)"/>
                            </div>
                            <div id="tab_interactions" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'interactions'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-interactions(firstCall=true)"/>
                            </div>
                            <div id="tab_bankAccount" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'bankAccount'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-bankAccount(firstCall=true)"/>
                            </div>
                            <div id="tab_rcc" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'rcc'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-rcc(firstCall=true)"/>
                            </div>
                            <div id="tab_contact" role="tabpanel"
                                 th:class="'tab-pane fade '+(${tab == 'contact'} ? 'active in':'')">
                                <div th:replace="fragments/personFragments :: tab-contact(firstCall=true)"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="updLoanApplicationModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

    <div id="createLoanOfferModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

    <div id="loanApplicationLocationMapModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

    <div id="updatePersonAddressModal" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

    <div id="updateOccupationalPhoneNumberModal" class="modal fade">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

    <div id="registerCreditRejectionModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmRegisterCreditRejectionModal" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="creditRejectionReason">Raz&oacute;n de rechazo</label>
                                    <select class="form-control" name="creditRejectionReason"
                                            id="creditRejectionReason">
                                        <option th:each="reason : ${@catalogService.getCreditRejectionReasons(false)}"
                                                th:value="${reason.id}" th:text="${reason.reason}"></option>
                                    </select>
                                    <label class="control-label" for="creditRejectionComment">Comentarios</label>
                                    <textarea class="form-control" name="creditRejectionComment" id="creditRejectionComment" maxlength="200"></textarea>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button id="registerCreditRejectionButton" type="button" class="btn btn-info">
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="registerApplicationRejectionModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form" action="#" id="frmRegisterApplicationRejectionModal" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="applicationRejectionReason">Raz&oacute;n de
                                        rechazo</label>
                                    <select class="form-control" name="applicationRejectionReason"
                                            id="applicationRejectionReason">
                                        <option th:each="reason : ${@catalogService.getApplicationRejectionReasons()}"
                                                th:value="${reason.id}" th:text="${reason.reason}"></option>
                                    </select>
                                    <label class="control-label" for="applicationRejectionComment">Comentarios</label>
                                    <textarea class="form-control" name="applicationRejectionComment" id="applicationRejectionComment" maxlength="200"></textarea>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button id="registerApplicationRejectionButton" type="button" class="btn btn-info">
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="contactResultModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6" id="contactResultModalDateDiv">
                                <div class="form-group">
                                    <label class="control-label" for="contactResultModalDate">Seleccione la fecha de la
                                        promesa de pago</label>
                                    <input type="text" id="contactResultModalDate" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-6" id="contactResultModalAmountDiv">
                                <div class="form-group">
                                    <label class="control-label" for="contactResultModalAmount">Monto promesa de
                                        pago</label>
                                    <input type="text" id="contactResultModalAmount" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="contactResultModalComment">Comentarios</label>
                                    <textarea cols="2" id="contactResultModalComment" class="form-control"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                        <button id="contactResultModalSaveButton" type="button" class="btn btn-info">
                            Guardar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block th:replace="fragments/questionProcessFragments :: questionsModalShell"></th:block>

    <div id="changeFirstDueDateModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="loading">
                    <div class="modal-body">
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                        <span> &nbsp;&nbsp;Loading... </span>
                    </div>
                </div>
                <div class="content">
                </div>
            </div>
        </div>
    </div>

</th:block>
</body>
</html>