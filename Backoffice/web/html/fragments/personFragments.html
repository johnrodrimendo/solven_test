<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"/>
</head>
<body>
<div>
    <!-- TAB CREDITS -->
    <div th:fragment="tab-credits" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Créditos
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" th:switch="${#lists.isEmpty(credits)}"
             id="tabData">
            <div th:case="true">
                La persona no tiene Créditos
            </div>
            <div th:case="false" th:remove="tag">
                <div th:each="credit, iter : ${credits}" th:remove="tag">
                    <div th:replace="fragments/personFragmentsCredit :: credit(onlyView=false)"/>
                </div>

            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            $(document).ready(function () {
                var url = /*[[ @{/credit} ]]*/null;
                var onLoadMessage = 'Cargando crédito ...';
                var fn = function (container, elem) {
                    defaultAjax({
                        url: url + '/' + elem.data('creditid') + '/onDemand',
                        data: {
                            'personId': elem.data('personid')
                        },
                        type: 'GET',
                        success: function (data) {
                            if (data !== null && data.trim() !== '') {
                                container.children().first().replaceWith(data);
                            }
                        },
                        error: function (err) {
                            console.error(err);
                        }
                    });
                };

                $('#tab_credits > #tabData div[id].portlet.light > .portlet-title').find('.tools a.expand').one('click', function () {
                    var elem = $(this);
                    loadOnDemand(elem, false, onLoadMessage, fn);
                });
                $('#tab_credits > #tabData div[id].portlet.light > .portlet-title').find('.tools a.reload').click(function () {
                    var elem = $(this);
                    loadOnDemand(elem, true, onLoadMessage, fn);
                });
                // CARGAR EL PRIMER CREDIT POR DEFECTO EN EL CASO DE LISTADO
                // SI SOLO HAY UN ITEM EN EL LISTADO Y LA URL TIENE QUERYSTRING creditId
                // $('#tab_credits #tabData').find('#' + creditCode)
                // window.location.search.indexOf('creditId') > -1
                if ($('#tab_credits #tabData').first().children().length > 1) {
                    $('#tab_credits #tabData').first().children().first().find('.tools a.expand').click();
                }
            });
            /*]]>*/
        </script>
    </div>

    <!-- TAB LOAN APPLICATIONS -->
    <div th:fragment="tab-applications" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Solicitudes
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}"
             th:switch="${#lists.isEmpty(loanApplications)}" id="tabData">
            <div th:case="true">
                La persona no tiene solicitudes de crédito
            </div>
            <div th:case="false" th:remove="tag">
                <div th:each="loanApplication, iter : ${loanApplications}" th:remove="tag">
                    <div th:id="${loanApplication?.code}" class="portlet light">
                        <div class="portlet-title">
                            <div th:class="${@frontEndService.getDefaultCaptionClass()}" style="width: 95%;">
                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"
                                      th:text="'Loan Application '+${loanApplication?.code}"></span>
                                <span th:if="${loanApplication?.status?.status} != null and (${loanApplication?.status?.id} != 6 and ${loanApplication?.status?.id} != 7)"
                                      class="label label-sm label-success"
                                      th:text="${loanApplication?.status?.status}"></span>
                                <span th:if="${loanApplication?.status?.status} != null and (${loanApplication?.status?.id} == 6 or ${loanApplication?.status?.id} == 7)"
                                      class="label label-sm label-danger"
                                      th:text="${loanApplication?.status?.status}"></span>
                                <span>
                                    <a target="_blank" class="label label-sm label-info"
                                       th:href="@{/loanApplication/viewasclient(loanApplicationId=${loanApplication?.id},userId=${loanApplication?.userId},personId=${loanApplication?.personId})}">Ver
                                        como cliente</a>
                                </span>
                                <span>
                                    <a target="_blank" class="label label-sm label-info"
                                       th:href="@{/person/viewextranet(userId=${loanApplication?.userId})}">Ver extranet</a>
                                </span>
                                <span>
                                    <a target="_blank" class="label label-sm label-warning"
                                       th:href="${'https://insights.hotjar.com/sites/' + @configuration.HOTJAR_ACCOUNT_ID + '/playbacks/list?tag_names=' + loanApplication?.code}">Ver Filmaci&oacute;n</a>
                                </span>
                                <span class="label label-sm label-success" th:text="${loanApplication.getApplicantType()}"></span>
                                <span th:if="${loanApplication?.observed}" th:title="${loanApplication?.observedComment}" style="cursor: pointer"
                                      class="label label-sm label-info">Reasignado</span>
                            </div>
                            <div class="tools" style="width: 5%;">
                                <a href="javascript:;" class="reload"
                                   th:attr="data-personId=${loanApplication.personId}, data-userId=${loanApplication.userId}, data-applicationId=${loanApplication.id}"></a>
                                <a href="javascript:;"
                                   th:classappend="${iter.size eq 1 ? 'collapse' : 'expand'}"
                                   th:attr="data-personId=${loanApplication.personId}, data-userId=${loanApplication.userId}, data-applicationId=${loanApplication.id}, data-isDisabled=${iter.index == 0 and iter.size eq 1}" ></a>
                            </div>
                        </div>
                        <div class="portlet-body" style="display:none" th:style="${iter.size gt 1} ? 'display:none'">
                            <ul class="fa-ul" th:if="${iter.size gt 1}">
                                <li>
                                    <i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Solicitud
                                </li>
                            </ul>
                            <th:block th:if="${iter.size eq 1}">
                                <div th:replace="fragments/personFragmentsLoanApplication :: loan-application"></div>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="registerModalLoanApplicationFraudAlertLoan" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <form role="form" action="#" id="frmRegisterApplicationRejectionModalLoan" method="post">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label" for="fraudFlagIdLoan">Flag de Fraude</label>
                                        <select class="form-control" name="fraudFlagId"
                                                id="fraudFlagIdLoan">
                                            <option th:each="flag : ${@catalogService.getFraudFlags()}"
                                                    th:value="${flag.id}" th:text="${flag.flag}"></option>
                                        </select>
                                        <label class="control-label" for="commentaryLoan">
                                            Comentarios / Detalles
                                        </label>
                                        <textarea class="form-control" name="fraudFlagCommetary"
                                                  id="commentaryLoan"></textarea>
                                        <input type="hidden" id="loanApplicationIdLoan"/>
                                        <div class="errorContainer">
                                            <span class="help-block form-field-error-message"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-info"
                           th:onclick="'closeLoanApplicationFraudAlertModalLoan()'">Cancelar</a>
                        <a class="btn btn-info"
                           th:onclick="'rejectLoanApplicationFraudAlertModalLoan()'">Guardar</a>
                    </div>
                </div>
            </div>
        </div>
        <div id="answerWhoCallModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="content">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="control-label">¿Contestó el titular?</label>
                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                            <input id="personAnswerCall" type="checkbox" checked="checked"/>
                                            Contestó
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-8" id="contactRelationshipModalDiv">
                                    <div class="form-group">
                                        <label>Parentesco</label>
                                        <select name="relationshipId" class="form-control form-control-sm">
                                            <option value="" disabled="disabled" selected="selected">----------</option>
                                            <option th:each="relationship : ${@catalogService.getRelationships(#locale)}" th:value="${relationship.id}" th:text="${relationship.relationship}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                            <button id="answerWhoCallModalSaveButton" type="button" class="btn btn-info">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            $(document).ready(function() {
                var url = /*[[ @{/application} ]]*/null;
                var onLoadMessage = 'Cargando solicitud ...';
                var fn = function (container, elem) {
                    defaultAjax({
                        url: url + '/' + elem.data('applicationid') + '/onDemand',
                        type: 'GET',
                        success: function (data) {
                            if (data !== null && data.trim() !== '') {
                                container.children().first().replaceWith(data);
                            }
                        },
                        error: function (err) {
                            console.error(err);
                        }
                    });
                };

                $('#tab_applications > #tabData div[id].portlet.light > .portlet-title').find('.tools a.expand').one('click', function() {
                    var elem = $(this);
                    loadOnDemand(elem, false, onLoadMessage, fn);
                });
                $('#tab_applications > #tabData div[id].portlet.light > .portlet-title').find('.tools a.reload').click(function() {
                    var elem = $(this);
                    loadOnDemand(elem, true, onLoadMessage, fn);
                });
                // CARGAR EL PRIMER LA POR DEFECTO EN EL CASO DE LISTADO
                // SI SOLO HAY UN ITEM EN EL LISTADO Y LA URL TIENE QUERYSTRING applicationId
                // $('#tab_applications #tabData').find('#' + loanApplicationCode)
                // window.location.search.indexOf('applicationId') > -1
                if($('#tab_applications #tabData').first().children().length > 1) {
                    $('#tab_applications #tabData').first().children().first().find('.tools a.expand').click();
                }
            });

            function closeLoanApplicationFraudAlertModalLoan() {
                $('#registerModalLoanApplicationFraudAlertLoan').modal('hide');
            }
            function assignLoanApplicationFraudFlagLoan(loanApplicationId, fraudFlagId, commentary) {
                defaultAjax({
                    url: /*[[@{/person/assign/loanApplicationFraudFlag}]]*/null,
                    type: 'POST',
                    data: {
                        loanApplicationId: loanApplicationId,
                        fraudFlagId: fraudFlagId,
                        commentary: commentary
                    },
                    success: function (data) {
                        // Refresh the applications tab
                        refreshTabAjax('applications');
                    }
                })
            }
            function showModalLoanApplicationFraudAlertLoan(loanApplicationId) {
                $("#loanApplicationIdLoan").val(loanApplicationId);
                $('#registerModalLoanApplicationFraudAlertLoan').modal();
            }
            function openWhoAnswerCallModal(loanId, contactResultId){
                // Open
                $('#contactRelationshipModalDiv').hide();
                $('#answerWhoCallModal').modal();
                $('#answerWhoCallModal #personAnswerCall').click(function(){
                    if(!$(this).is(':checked')) {
                        $('#answerWhoCallModal select[name=relationshipId]').val('');
                        $('#contactRelationshipModalDiv').show();
                    } else {
                        $('#contactRelationshipModalDiv').hide();
                    }
                });
                $('#answerWhoCallModalSaveButton').off("click");
                $('#answerWhoCallModalSaveButton').click(function () {
                    if(!$('#answerWhoCallModal #personAnswerCall').is(':checked') && ($('#answerWhoCallModal select[name=relationshipId]').val() == '' || $('#answerWhoCallModal select[name=relationshipId]').val() == null)){
                        swal({
                            title: "",
                            text: "Debes seleccionar el parentesco de la persona que contestó",
                            type: "error"
                        });
                    }else{
                        registerContactResult(loanId, contactResultId, $('#answerWhoCallModal #personAnswerCall').is(':checked'), $('#answerWhoCallModal select[name=relationshipId]').val());
                    }
                });
            }
            function registerContactResult(loanId, contactResultId) {
                var baseUrl = /*[[@{/loanApplication/}]]*/null;
                defaultAjax({
                    url: baseUrl + loanId + "/registerContactResult/",
                    type: 'POST',
                    data: {
                        contactResultId: contactResultId,
                        date: $('#contactResultModalDate').val(),
                        detailReason: $('#details').val(),
                        assistedProcess: window.assistedProcess
                    },
                    success: function (data) {
                        toastr.success("Se registró la acción");
                        $('#answerWhoCallModal').modal('hide');
                        refreshTabAjax('applications');
                    }
                })
            }
            function markDocumentsMissing(loanApplicationId, refreshTab) {
                defaultAjax({
                    url: /*[[@{/person/assign/documentsMissingFlag}]]*/null,
                    type: 'POST',
                    data: {
                        loanApplicationId: loanApplicationId
                    },
                    success: function (data) {
                        // Refresh the applications tab
                        if (refreshTab) {
                            refreshTabAjax('applications');
                        }
                    }
                });
            }
            function unassignAnalyst(loanApplicationId, refreshTab) {
                defaultAjax({
                    url: /*[[@{/loanApplication/unassign/analyst/}]]*/null,
                    type: 'POST',
                    data: {
                        loanApplicationId: loanApplicationId
                    },
                    success: function (data) {
                        // Refresh the applications tab
                        if (refreshTab) {
                            refreshTabAjax('applications');
                        }
                    }
                });
            }
            function rejectLoanApplicationFraudAlertModalLoan() {
                $('#registerModalLoanApplicationFraudAlertLoan').modal('hide');
                assignLoanApplicationFraudFlag($("#loanApplicationIdLoan").val(), $("#fraudFlagIdLoan").val(), $("#commentaryLoan").val());
            }
            /*]]>*/
        </script>
    </div>

    <!-- TAB DATA -->
    <div th:fragment="tab-data" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Fuentes Externas
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData">

            <div th:if="${personCountry==T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                <div id="divFaltanBots" class="alert alert-danger" th:if="${(
            (sunatState != null and !sunatState?.result) or
            (essaludState != null and !essaludState?.result) or
            (bitelState != null and !bitelState?.result) or
            (reniecState != null and !reniecState?.result) or
            (redamState != null and !redamState?.result) or
            (movistarState != null and !movistarState?.result) or
            (claroState != null and !claroState?.result) or
            (entelState != null and !entelState?.result) or
            (sisState != null and !sisState?.result) or
            (satState != null and !satState?.result) or
            (satPlateState != null and !satPlateState?.result) or
            (soatState != null and !soatState?.result) or
            (virginState != null and !virginState?.result)
            ) and !botsRunning and stateProductAllowsBot}">
                    <div class="row">
                        <div class="col-md-12">
                            Faltan correr algunos bots
                            <a href="javascript:;" class="btn btn-circle btn-default btn-xs pull-right"
                               onclick="runPendingBots()">
                                Correr pendientes </a>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${personCountry==T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                <div id="divFaltanBots" class="alert alert-danger" th:if="${anses == null}">
                    <div class="row">
                        <div class="col-md-12">
                            Faltan correr algunos bots
                            <a href="javascript:;" class="btn btn-circle btn-default btn-xs pull-right"
                               onclick="runPendingBots()">
                                Correr pendientes </a>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <th:block th:switch="${personCountry}">
                    <th:block th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Sunat</span>
                                        <span th:if="${sunatState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${sunatState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${sunatState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${sunatState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>RUC</dt>
                                        <dd th:text="${sunat?.ruc}"></dd>
                                        <dt>Nombre comercial</dt>
                                        <dd th:text="${sunat?.tradeName}"></dd>
                                        <dt>Ubicación</dt>
                                        <dd th:text="${sunat?.located}"></dd>
                                        <dt>Estado</dt>
                                        <dd th:text="${sunat?.status}"></dd>
                                        <dt>Tipo Contribuyente</dt>
                                        <dd th:text="${sunat?.taxpayerType}"></dd>
                                        <dt>Fec. de Inscripción</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(sunat?.registerDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(sunat?.registerDate)}"></dd>
                                        <!--<dt>Startup Date</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(sunat?.startupDate)}"></dd>-->
                                        <dt>Condición Contribuyente</dt>
                                        <dd th:text="${sunat?.taxpayerCondition}"></dd>
                                        <dt>Domicilio Fiscal</dt>
                                        <dd th:text="${sunat?.fiscalAddress}"></dd>
                                        <dt>Sist. Emisión Electrónica</dt>
                                        <dd th:text="${sunat?.voucherEmittingSystem}"></dd>
                                        <dt>Activ. Comercio Exterior</dt>
                                        <dd th:text="${sunat?.externalCommerceActivity}"></dd>
                                        <dt>Sis. de Contabilidad</dt>
                                        <dd th:text="${sunat?.accountingSystem}"></dd>
                                        <dt>Ocupación</dt>
                                        <dd th:text="${sunat?.ocupation}"></dd>
                                        <dt>Act. Económica(s)</dt>
                                        <dd th:text="${sunat?.economicActivities}"></dd>
                                        <dt>Comprobantes de Pago</dt>
                                        <dd th:text="${sunat?.voucher}"></dd>
                                        <dt>Sist. Emisión Electrónica</dt>
                                        <dd th:text="${sunat?.digitalEmissionSystem}"></dd>
                                        <dt>Emisor electrónico desde</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(sunat?.digitalEmitterSince)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(sunat?.digitalEmitterSince)}"></dd>
                                        <dt>Comprobante Electrónico</dt>
                                        <dd th:text="${sunat?.digitalVouchers}"></dd>
                                        <dt>Afiliado al PLE desde</dt>
                                        <dd th:text="${sunat?.pleJoinedSince}"></dd>
                                        <dt>Padrones</dt>
                                        <dd th:text="${sunat?.padron}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div><!-- SUNAT -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Essalud</span>
                                        <span th:if="${essaludState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${essaludState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${essaludState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${essaludState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Nombre Completo</dt>
                                        <dd th:text="${essalud?.fullName}"></dd>
                                        <dt>Número de Doc.</dt>
                                        <dd th:text="${essalud?.documentNumber}"></dd>
                                        <dt>Tipo de Asegurado</dt>
                                        <dd th:text="${essalud?.inssuredType}"></dd>
                                        <dt>Código Autogenerado</dt>
                                        <dd th:text="${essalud?.autogeneratedID}"></dd>
                                        <dt>Tipo de Seguro</dt>
                                        <dd th:text="${essalud?.inssuranceType}"></dd>
                                        <dt>Centro Asistencial</dt>
                                        <dd th:text="${essalud?.healthCenter}"></dd>
                                        <dt>Dir. Centro Asistencial</dt>
                                        <dd th:text="${essalud?.healthCenterAddress}"></dd>
                                        <dt>Desde</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(essalud?.since)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(essalud?.since)}"></dd>
                                        <dt>Hasta</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(essalud?.until)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(essalud?.until)}"></dd>
                                        <dt>Afiliado(a) a</dt>
                                        <dd th:text="${essalud?.afiliatedTo}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div><!-- ESSALUD -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Bitel</span>
                                        <span th:if="${bitelState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${bitelState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${bitelState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${bitelState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Cantidad</dt>
                                        <dd th:text="${bitel?.cantidad}"></dd>
                                        <dt>Lineas</dt>
                                        <dd id="jsonLineasBitel" th:text="${bitel?.lineas}"></dd>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonLineasBitel').html() != null && $('#jsonLineasBitel').html() != "") {
                                            $('#jsonLineasBitel').jsonViewer(JSON.parse($('#jsonLineasBitel').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div><!-- BITEL -->
                        <div class="col-md-6" th:if="${showMigraciones}">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Migraciones</span>
                                        <span th:if="${migracionesState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${migracionesState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${migracionesState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${migracionesState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Nombre Completo</dt>
                                        <dd th:text="${migraciones?.fullName}"></dd>
                                        <dt>Nacionalidad</dt>
                                        <dd th:text="${migraciones?.nationality}"></dd>
                                        <dt>Residencia</dt>
                                        <dd th:text="${migraciones?.residence}"></dd>
                                        <dt>Tasa Anual de Extranjería</dt>
                                        <dd th:text="${migraciones?.tae}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div><!-- MIGRACIONES-->

                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reniec</span>
                                        <span th:if="${reniecState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${reniecState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${reniecState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${reniecState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Nombre Completo</dt>
                                        <dd th:text="${reniec?.full_name}"></dd>
                                        <dt>Número de Doc.</dt>
                                        <dd th:text="${reniec?.document_number}"></dd>
                                        <dt>Caracter Verificación</dt>
                                        <dd th:text="${reniec?.previous_character_verification}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div><!-- RENIEC -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Redam</span>
                                        <span th:if="${redamState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${redamState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${redamState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${redamState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Número de Doc.</dt>
                                        <dd th:text="${redam?.documentNumber}"></dd>
                                        <dt>Distrito Judicial</dt>
                                        <dd th:text="${redam?.judicialDistrict}"></dd>
                                        <dt>Corte</dt>
                                        <dd th:text="${redam?.court}"></dd>
                                        <dt>Secretary</dt>
                                        <dd th:text="${redam?.secretary}"></dd>
                                        <dt>Registry</dt>
                                        <dd th:text="${redam?.registry}"></dd>
                                        <dt>Pensión Mensual</dt>
                                        <dd th:text="${@utilService.doubleMoneyFormat(redam?.monthlyPension)}"></dd>
                                        <dt>Cuotas</dt>
                                        <dd th:text="${redam?.installments}"></dd>
                                        <dt>Monto Deuda</dt>
                                        <dd th:text="${@utilService.doubleMoneyFormat(redam?.amountDue)}"></dd>
                                        <dt>Intereses</dt>
                                        <dd th:text="${@utilService.doubleMoneyFormat(redam?.interest)}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div><!-- REDAM -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Movistar</span>
                                        <span th:if="${movistarState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${movistarState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${movistarState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${movistarState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Cantidad</dt>
                                        <dd th:text="${movistar?.cantidad}"></dd>
                                        <dt>Lineas</dt>
                                        <dd id="jsonLineasMovistar" th:text="${movistar?.lineas}"></dd>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonLineasMovistar').html() != null && $('#jsonLineasMovistar').html() != "") {
                                            $('#jsonLineasMovistar').jsonViewer(JSON.parse($('#jsonLineasMovistar').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div><!-- MOVISTAR -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Claro</span>
                                        <span th:if="${claroState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${claroState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${claroState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${claroState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Cantidad</dt>
                                        <dd th:text="${claro?.cantidad}"></dd>
                                        <dt>Lineas</dt>
                                        <dd id="jsonLineasClaro" th:text="${claro?.lineas}"></dd>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonLineasClaro').html() != null && $('#jsonLineasClaro').html() != "") {
                                            $('#jsonLineasClaro').jsonViewer(JSON.parse($('#jsonLineasClaro').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div><!-- CLARO -->

                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Entel</span>
                                        <span th:if="${entelState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${entelState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${entelState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${entelState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Cantidad</dt>
                                        <dd th:text="${entel?.cantidad}"></dd>
                                        <dt>Lineas</dt>
                                        <dd id="jsonLineasEntel" th:text="${entel?.lineas}"></dd>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonLineasEntel').html() != null && $('#jsonLineasEntel').html() != "") {
                                            $('#jsonLineasEntel').jsonViewer(JSON.parse($('#jsonLineasEntel').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div><!-- ENTEL json -->

                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">PLACAS SAT - [LIMA]</span>
                                        <span th:if="${satPlateState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${satPlateState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${satPlateState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${satPlateState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl id="plate_report_content" class="dl-horizontal dl-external-data">

                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        var platesReports = /*[[ ${satPlate} ]]*/;
                                        var list_reports = document.getElementById('plate_report_content');
                                        var str = ''
                                        if (platesReports != null) {
                                            for (var i = 0; i < platesReports.length; i++) {

                                                var plate = platesReports[i].regPlate;
                                                var message = platesReports[i].message;
                                                var total = platesReports[i].total;

                                                var reportsHTML = ''
                                                platesReports[i].reports.forEach(function (ticket) {
                                                    reportsHTML = reportsHTML +
                                                        "<li><b> No.Doc :</b>" + ticket.doc +
                                                        "</li><li><b>Monto :</b>" + ticket.amount + "</li>" +
                                                        "</li><li><b>Fecha :</b>" + ticket.date + "</li>" +
                                                        "</li><li><b>Estado :</b>" + ticket.status + "</li><br>"
                                                });
                                                str = str + "<dt>Placa</dt><dd>" + plate + "</dd><dt>Adeudado</dt><dd> S/." + total + "</dd><dt>Consulta</dt><dd>" + message + "</dd><dt>Reportes (" + platesReports[i].reports.length + ")</dt><dd>" + reportsHTML + "</dd><br>";
                                            }
                                        }
                                        list_reports.innerHTML = str
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div>
                        <!-- SOAT  json -->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reportes SOAT</span>
                                        <span th:if="${soatState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${soatState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${soatState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${soatState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>

                                <div class="portlet-body">

                                    <dl class="dl-horizontal dl-external-data" th:unless="${soat}">
                                        <dt>Registros</dt>
                                        <dd>No encontrados</dd>
                                    </dl>

                                    <dl class="dl-horizontal dl-external-data" th:each="report : ${soat}">
                                        <dt>Número de Placa</dt>
                                        <dd th:text="${report?.regPlate}"></dd>
                                        <dt>Aseguradora</dt>
                                        <dd th:text="${report?.company}"></dd>
                                        <dt>Fecha de Inicio</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(report?.startDate)}"></dd>
                                        <dt>Fecha de Expiración</dt>
                                        <dd th:text="${@utilService.datetimeShortFormat(report?.endingDate)}"></dd>

                                        <dt>Certificado</dt>
                                        <dd th:text="${report?.certificate}"></dd>
                                        <dt>Tipo</dt>
                                        <dd th:text="${report?.typeOfDocument}"></dd>
                                        <dt>Clase</dt>
                                        <dd th:text="${report?.vehicleCategory}"></dd>
                                        <dt>Uso</dt>
                                        <dd th:text="${report?.usage}"></dd>
                                        <br/>
                                        <dt>Anteriores</dt>
                                        <dl class="dl-horizontal dl-external-data" th:each="item : ${report?.reports}">
                                            <dd th:text="${'Compania:'+item?.company}"></dd>
                                            <dd th:text="${'Fecha de Inicio:'+item?.startDate}"></dd>
                                            <dd th:text="${'Fecha de Expiracion:'+item?.endingDate}"></dd>
                                            <dd th:text="${'Certificado:'+item?.certificate}"></dd>
                                            <dd th:text="${'Tipo Doc:'+item?.typeOfDocument}"></dd>
                                            <dd th:text="${'Clase:'+item?.vehicleCategory}"></dd>
                                            <dd th:text="${'Uso:'+item?.usage}"></dd>
                                        </dl>
                                    </dl>
                                </div>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/

                                    /*]]>*/
                                </script>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">SAT</span>
                                        <span th:if="${satState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${satState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${satState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${satState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data">
                                        <dt>Reporte</dt>
                                        <dd id="jsonSat" th:text="${sat?.satIdReportJSONArray}"></dd>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonSat').html() != null && $('#jsonSat').html() != "") {
                                            $('#jsonSat').jsonViewer(JSON.parse($('#jsonSat').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div>
                        <!-- ONPE result-->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">ONPE</span>

                                        <span th:if="${onpeState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${onpeState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${onpeState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${onpeState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>

                                    </div>
                                </div>
                                <div class="portlet-body">

                                    <dl class="dl-horizontal dl-external-data" th:if="${onpe != null}">
                                        <div th:switch="${onpe?.fullName}">
                                            <div th:case="*">
                                                <dt>Nombre</dt>
                                                <dd th:text="${onpe?.fullName}"></dd>
                                                <div th:unless="${#strings.isEmpty(onpe?.fullName)}">

                                                </div>
                                                <dt>Número de Documento</dt>
                                                <dd th:text="${onpe?.inDocnumber}"></dd>
                                                <div th:unless="${#strings.isEmpty(onpe?.inDocnumber)}">
                                                </div>

                                                <div th:switch="${#lists.isEmpty(onpe?.details)}">
                                                    <div th:case="true">
                                                        <p>No se encontraron detalles</p>
                                                    </div>
                                                    <div th:case="false" class="table-responsive">

                                                        <table class="table table-bordered table-striped table-hover" style="padding-bottom: 0px;">
                                                            <thead>
                                                            <tr>
                                                                <th>Código</th>
                                                                <th>Proceso electoral</th>
                                                                <th>Tipo omisión</th>
                                                                <th>Deuda (s/.)</th>
                                                                <th>Etapa de cobranza</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr th:each="detail : ${onpe?.details}">
                                                                <td th:text="${detail?.code}"></td>
                                                                <td th:text="${detail?.electoralProcess}"></td>
                                                                <td th:text="${detail?.omissionType}"></td>
                                                                <td th:text="${detail?.amount}"></td>
                                                                <td th:text="${detail?.collectionStage}"></td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/

                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div>
                        <!-- UNIVERSIDAD PERU result-->
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Universidad Perú</span>

                                        <span th:if="${universidadPeruState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${universidadPeruState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${universidadPeruState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${universidadPeruState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <dl class="dl-horizontal dl-external-data" th:if="${universidadPeru != null}">
                                        <dt>Tel&eacute;fono laboral</dt>
                                        <dd id="lblOccupationalPhoneNumber" th:text="${universidadPeru?.phoneNumber}"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </th:block>
                    <th:block th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">AFIP</span>
                                        <span th:if="${afipState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${afipState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${afipState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${afipState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>
                                    </div>
                                </div>
                                <div class="portlet-body">


                                    <dl class="dl-horizontal dl-external-data" th:if="${afip != null}">
                                        <dt>Tipo documento</dt>
                                        <dd th:text="${afip?.inDocumentType}"></dd>
                                        <dt>Tipo</dt>
                                        <dd th:text="${afip?.tipo}"></dd>
                                        <div th:unless="${#strings.isEmpty(afip?.tipo)}">

                                        </div>
                                        <div th:if="${afip?.inDocumentType==4}">
                                            <dt>Número de Doc.</dt>
                                            <dd th:text="${afip?.inDocumentNumber}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.inDocumentNumber)}">

                                            </div>

                                            <dt>Nombre completo</dt>
                                            <dd th:text="${afip?.fullName}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.fullName)}">

                                            </div>

                                            <th:block th:switch="${#lists.isEmpty(afip?.getTaxRegimesAndDate())}">
                                                <th:block th:case="true">
                                                    <p>No se encontraron Impuestos/Regimenes registrados</p>
                                                </th:block>
                                                <th:block th:case="false" class="table-responsive">
                                                    <th:block th:each="detail : ${afip?.getTaxRegimesAndDate()}">
                                                        <dt th:text="'Impuesto/Regimen ' + ${afip?.getTaxRegimesAndDate()?.indexOf(detail) + 1} + ': '"></dt>
                                                        <dd th:text="${detail}"></dd>
                                                    </th:block>
                                                </th:block>
                                            </th:block>

                                            <dt>Domicilio fiscal 1</dt>
                                            <dd th:text="${afip?.df1}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.df1)}">

                                            </div>

                                            <dt>Domicilio fiscal 2</dt>
                                            <dd th:text="${afip?.df2}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.df2)}">

                                            </div>


                                            <dt>Domicilio fiscal 3</dt>
                                            <dd th:text="${afip?.df3}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.df3)}">


                                            </div>
                                        </div>

                                        <div th:if="${afip?.inDocumentType!=4}">
                                            <dt>Campo de control 1</dt>
                                            <dd th:text="${afip?.control1}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.control1)}">

                                            </div>
                                            <dt>Campo de control 2</dt>
                                            <dd th:text="${afip?.control2}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.control2)}">

                                            </div>
                                            <dt>Campo de control 3</dt>
                                            <dd th:text="${afip?.control3}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.control3)}">

                                            </div>
                                            <dt>Campo de control 4</dt>
                                            <dd th:text="${afip?.control4}"></dd>
                                            <div th:unless="${#strings.isEmpty(afip?.control4)}">

                                            </div>

                                        </div>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        if ($('#jsonAfip').html() != null && $('#jsonAfi').html() != "") {
                                            $('#jsonAfip').jsonViewer(JSON.parse($('#jsonAfip').html()));
                                        }
                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div><!-- AFIP json -->

                        <div class="col-md-6">
                            <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                <div class="portlet-title">
                                    <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">ANSES</span>


                                        <span th:if="${ansesState?.statusId == 1}"
                                              class="label label-sm label-default">En cola</span>
                                        <span th:if="${ansesState?.statusId == 2}"
                                              class="label label-sm label-warning">Corriendo</span>
                                        <span th:if="${ansesState?.statusId == 3}"
                                              class="label label-sm label-success">Exitoso</span>
                                        <span th:if="${ansesState?.statusId == 4}"
                                              class="label label-sm label-danger">Fallido</span>

                                    </div>
                                </div>
                                <div class="portlet-body">


                                    <dl class="dl-horizontal dl-external-data" th:if="${anses != null}">
                                        <dt>Nombre</dt>
                                        <dd th:text="${anses?.fullName}"></dd>
                                        <div th:unless="${#strings.isEmpty(anses?.fullName)}">

                                        </div>
                                        <dt>CUIL/CUIT</dt>
                                        <dd th:text="${anses?.cuilCuit}"></dd>
                                        <div th:unless="${#strings.isEmpty(anses?.cuilCuit)}">

                                        </div>
                                        <dt>Codigo transaccion</dt>
                                        <dd th:text="${anses?.codigoTransaccion}"></dd>
                                        <div th:unless="${#strings.isEmpty(anses?.codigoTransaccion)}">
                                        </div>

                                        <dt>Tipo de documento</dt>
                                        <dd th:text="${anses?.inDocumentType}"></dd>

                                        <dt>Numero de documento</dt>
                                        <dd th:text="${anses?.inDocumentNumber}"></dd>


                                        <div th:switch="${#lists.isEmpty(anses?.details)}">
                                            <div th:case="true">
                                                <p>No se encontraron detalles</p>
                                            </div>
                                            <div th:case="false" class="table-responsive">

                                                <table class="table table-bordered table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>Detalles</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr th:each="detail : ${anses?.details}">
                                                        <td th:text="${detail?.text}"></td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </dl>
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/

                                        /*]]>*/
                                    </script>
                                </div>
                            </div>
                        </div>
                        <!-- ANSES json -->
                    </th:block>
                </th:block>
            </div>
        </div>
    </div>

    <!-- TAB BANK ACCOUNT -->
    <div th:fragment="tab-bankAccount" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de cuenta bancaria
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData">
            <div th:replace="fragments/personFragments :: bank_account(onlyView=false)"/>
        </div>
    </div>

    <!-- TAB SOCIAL NETWORKS -->
    <div th:fragment="tab-socialNetworks" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Redes Sociales
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData" class="form-row">
            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Facebook</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <dl class="dl-horizontal dl-user-data">
                            <dt>Id</dt>
                            <dd th:text="${facebook?.facebookId}"></dd>
                            <dt>Email</dt>
                            <dd th:text="${facebook?.facebookEmail}"></dd>
                            <dt>Nombre Completo</dt>
                            <dd th:text="${facebook?.facebookName}"></dd>
                            <dt>Nombre</dt>
                            <dd th:text="${facebook?.facebookFirstName}"></dd>
                            <dt>Apellido</dt>
                            <dd th:text="${facebook?.facebookLastName}"></dd>
                            <dt>Edad máxima</dt>
                            <dd th:text="${facebook?.facebookAgeMax}"></dd>
                            <dt>Edad mínima</dt>
                            <dd th:text="${facebook?.facebookAgeMin}"></dd>
                            <dt>Link</dt>
                            <dd><a target="_blank" th:if="${facebook?.facebookLink != null}" th:href="${facebook?.facebookLink}" th:text="'Perfil'"></a></dd>
                            <dt>Género</dt>
                            <dd th:text="${facebook?.facebookGender}"></dd>
                            <dt>Locale</dt>
                            <dd th:text="${facebook?.facebookLocale}"></dd>
                            <dt>Foto</dt>
                            <dd><a target="_blank" th:if="${facebook?.facebookPicture != null}" th:href="${facebook?.facebookPicture}" th:text="'Foto'"></a></dd>
                            <dt>Zona horaria</dt>
                            <dd th:text="${facebook?.facebookTimeZone}"></dd>
                            <dt>Fec. actualización</dt>
                            <dd th:text="${@utilService.datetimeShortFormat(facebook?.facebookUpdatedTime)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(facebook?.facebookUpdatedTime)}"></dd>
                            <dt>Verificado</dt>
                            <dd th:text="${facebook?.facebookVerified}"></dd>
                            <dt>Cumpleaños</dt>
                            <dd th:text="${facebook?.facebookBirthday}"></dd>
                            <dt>Localidad</dt>
                            <dd th:text="${facebook?.facebookLocation}"></dd>
                        </dl>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">LinkedIn</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <dl class="dl-horizontal dl-user-data">
                            <dt>Id</dt>
                            <dd th:text="${linkedin?.linkedinId}"></dd>
                            <dt>Nombres</dt>
                            <dd th:text="${linkedin?.linkedinFirstName}"></dd>
                            <dt>Apellidos</dt>
                            <dd th:text="${linkedin?.linkedinLastName}"></dd>
                            <dt>Nom. Soltera</dt>
                            <dd th:text="${linkedin?.linkedinMaidenName}"></dd>
                            <dt>Nom. formateado</dt>
                            <dd th:text="${linkedin?.linkedinFormattedName}"></dd>
                            <dt>Nom. fonético</dt>
                            <dd th:text="${linkedin?.linkedinPhoneticFirstName}"></dd>
                            <dt>Ape. fonético</dt>
                            <dd th:text="${linkedin?.linkedinPhoneticLastName}"></dd>
                            <dt>Nom. fonético format</dt>
                            <dd th:text="${linkedin?.linkedinFormattedPhoneticName}"></dd>
                            <dt>Encabezado</dt>
                            <dd th:text="${linkedin?.linkedinHeadline}"></dd>
                            <dt>Localidad</dt>
                            <dd th:text="${linkedin?.linkedinLocation}" id="jsonLinkedinLocation"></dd>
                            <dt>Industria</dt>
                            <dd th:text="${linkedin?.linkedinIndustry}"></dd>
                            <dt>Num. conexiones</dt>
                            <dd th:text="${linkedin?.linkedinNumConnections}"></dd>
                            <dt>Limite conexiones.</dt>
                            <dd th:text="${linkedin?.linkedinNumConnectionsCapped}"></dd>
                            <dt>Presentación</dt>
                            <dd th:text="${linkedin?.linkedinSummary}"></dd>
                            <dt>Especialidades</dt>
                            <dd th:text="${linkedin?.linkedinSpecialties}"></dd>
                            <dt>Puestos</dt>
                            <dd th:text="${linkedin?.linkedinPositions}" id="jsonLinkedinPosition"></dd>
                            <dt>Foto</dt>
                            <dd th:text="${linkedin?.linkedinPictureUrl}"></dd>
                            <dt>Foto original</dt>
                            <dd th:text="${linkedin?.linkedinPictureUrlsOriginal}"></dd>
                            <dt>Url Perfil</dt>
                            <dd><a target="_blank" th:href="${linkedin?.linkedinPublicProfileUrl}" th:text="${linkedin?.linkedinPublicProfileUrl}"></a></dd>
                            <dt>Email</dt>
                            <dd th:text="${linkedin?.linkedinEmailAddress}"></dd>
                            <dt>Ult. modificado</dt>
                            <dd th:text="${@utilService.datetimeShortFormat(linkedin?.linkedinLastModified)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(linkedin?.linkedinLastModified)}"></dd>
                            <dt>Proposal comments</dt>
                            <dd th:text="${linkedin?.linkedinProposalComments}"></dd>
                            <dt>Asociaciones</dt>
                            <dd th:text="${linkedin?.linkedinAssociations}"></dd>
                            <dt>Intereses</dt>
                            <dd th:text="${linkedin?.linkedinInterests}"></dd>
                            <dt>Idiomas</dt>
                            <dd th:text="${linkedin?.linkedinLanguages}"></dd>
                            <dt>Habilidades</dt>
                            <dd th:text="${linkedin?.linkedinSkills}"></dd>
                            <dt>Certificaciones</dt>
                            <dd th:text="${linkedin?.linkedinCertifications}"></dd>
                            <dt>Educacion</dt>
                            <dd th:text="${linkedin?.linkedinEducations}"></dd>
                            <dt>Cursos</dt>
                            <dd th:text="${linkedin?.linkedinCourses}"></dd>
                            <dt>Voluntariados</dt>
                            <dd th:text="${linkedin?.linkedinVolunteer}"></dd>
                            <dt>Posiciones actules</dt>
                            <dd th:text="${linkedin?.linkedinThreeCurrentPositions}"></dd>
                            <dt>Posiciones anteriores</dt>
                            <dd th:text="${linkedin?.linkedinThreePastPositions}"></dd>
                            <dt>Num. recomendados</dt>
                            <dd th:text="${linkedin?.linkedinNumRecomenders}"></dd>
                            <dt>Recomendaciones</dt>
                            <dd th:text="${linkedin?.linkedinRecommendationsRecived}"></dd>
                            <dt>Suggestions</dt>
                            <dd th:text="${linkedin?.linkedinSuggestions}"></dd>
                            <dt>Fec. nacimiento</dt>
                            <dd th:text="${linkedin?.linkedinDateOfBirth}"></dd>
                            <dt>Reconocimientos</dt>
                            <dd th:text="${linkedin?.linkedinHonorsAwards}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLinkedinPosition').html() != null && $('#jsonLinkedinPosition').html() != "") {
                                $('#jsonLinkedinPosition').jsonViewer(JSON.parse($('#jsonLinkedinPosition').html()));
                            }
                            if ($('#jsonLinkedinLocation').html() != null && $('#jsonLinkedinLocation').html() != "") {
                                $('#jsonLinkedinLocation').jsonViewer(JSON.parse($('#jsonLinkedinLocation').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Google Perfil</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="googleProfileDiv" th:if="${google != null and google.profile != null}"
                             th:text="${google.profile.toString()}">
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#googleProfileDiv').length > 0) {
                                $('#googleProfileDiv').jsonViewer(JSON.parse($('#googleProfileDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Google Contactos</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="googleContactsDiv" th:if="${google != null and google.contacts != null}"
                             th:text="${google.contacts.toString()}">
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#googleContactsDiv').length > 0) {
                                $('#googleContactsDiv').jsonViewer(JSON.parse($('#googleContactsDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Windows Perfil</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="windowsProfileDiv" th:if="${windows != null and windows.profile != null}" th:text="${windows.profile.toString()}"></div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#windowsProfileDiv').length > 0) {
                                $('#windowsProfileDiv').jsonViewer(JSON.parse($('#windowsProfileDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Windows Contactos</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="windowsContactsDiv" th:if="${windows != null and windows.contacts != null}" th:text="${windows.contacts.toString()}">
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#windowsContactsDiv').length > 0) {
                                $('#windowsContactsDiv').jsonViewer(JSON.parse($('#windowsContactsDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Yahoo Perfil</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="yahooProfileDiv" th:if="${yahoo != null and yahoo.profile != null}"
                             th:text="${yahoo.profile.toString()}">
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#yahooProfileDiv').length > 0) {
                                $('#yahooProfileDiv').jsonViewer(JSON.parse($('#yahooProfileDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Yahoo Contactos</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="yahooContactsDiv" th:if="${yahoo != null and yahoo.contacts != null}"
                             th:text="${yahoo.contacts.toString()}">
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#yahooContactsDiv').length > 0) {
                                $('#yahooContactsDiv').jsonViewer(JSON.parse($('#yahooContactsDiv').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- TAB INTERACTIONS -->
    <div th:fragment="tab-interactions" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Interacciones
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData">
            <div class="row">
                <div class="col-md-12">
                    <div th:class="${@frontEndService.getDefaultPortletClass()}"
                         th:if="${unknowInteractions != null and !unknowInteractions.isEmpty()}">
                        <div class="portlet-title">
                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Interacciones sin Solicitud</span>
                            </div>
                            <div class="actions" th:if="false">
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div th:replace="fragments/personFragmentsInteractions :: tab-interactinos-acordeon(interactionsParam=${unknowInteractions}, code='OTROS')"/>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!--Modal for upload-->
        <div id="registerInteractionModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        FORMUlARIO AJAX DE REGISTRO DE INTERACCION CON PERSONA
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" onclick="closeRegisterInteractionModal()">
                            Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            var registerSuccess = false;

            function openRegisterInteractionModal(userId) {
                $('#registerInteractionModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            }

            function closeRegisterInteractionModal() {
                $('#registerInteractionModal').modal('hide');
                if (registerSuccess) {
                    setTimeout(function () {
                        refreshTabAjax('interactions');
                    }, 300)
                }
            }

            /*]]>*/
        </script>
    </div>

    <!-- TAB CONTACTS -->
    <div th:fragment="tab-contact" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando información de Contacto
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData" class="form-row">
            <div class="col-md-6">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Información de Contacto</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <dl class="dl-horizontal dl-user-data">
                            <dt>E-mail</dt>
                            <dd>
                                <a href="#" id="personContactInfoEmailContact"
                                   th:text="${personContactInfo?.email}"></a>
                                <span th:if="${personContactInfo?.emailVerified != null and personContactInfo?.emailVerified}"
                                      class="label label-xs label-primary">Verificado</span>
                                <span th:if="${personContactInfo?.emailVerified != null and !personContactInfo?.emailVerified}"
                                      class="label label-xs label-danger">No Verificado</span>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    var editableJson = getDefaultXEditableJson();
                                    editableJson.type = 'text';
                                    editableJson.url = /*[[ @{/person/email} ]]*/;
                                    editableJson.title = 'Email';
                                    editableJson.value = /*[[ ${personContactInfo?.email} ]]*/;
                                    editableJson.params.loanId = /*[[${applicationId}]]*/;
                                    editableJson.success = function(data) {
                                        swal({
                                            title: "",
                                            text: "Se envi\u00f3 un correo de verificaci\u00f3n",
                                            type: "success"
                                        });
                                    };
                                    $('#personContactInfoEmailContact').editable(editableJson);
                                    /*]]>*/
                                </script>
                            </dd>
                            <dt>Celular</dt>
                            <dd>
                                <span th:text="${personContactInfo?.phoneNumber != null} ? '('+${personContactInfo?.phoneCountryCode}+') '"/>
                                <a href="#" id="personContactInfoPhoneNumberContact"
                                   th:text="${personContactInfo?.phoneNumber}"></a>
                                <span th:if="${personContactInfo?.phoneVerified != null and !personContactInfo.phoneVerified}"
                                      class="label label-xs label-danger">No Verificado</span>
                                <span th:if="${personContactInfo?.phoneVerified != null and personContactInfo?.phoneVerified}"
                                      class="label label-xs label-primary">Verificado</span>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    var editableJson = getDefaultXEditableJson();
                                    editableJson.type = 'text';
                                    editableJson.url = /*[[ @{/person/phone} ]]*/;
                                    editableJson.title = 'Celular';
                                    editableJson.value = /*[[ ${personContactInfo?.phoneNumber} ]]*/;
                                    $('#personContactInfoPhoneNumberContact').editable(editableJson);
                                    /*]]>*/
                                </script>
                            </dd>
                            <dt>Domicilio</dt>
                            <dd>

                                <a href="javascript:;"
                                   th:utext="${personContactInfo?.getFullAddressBO()}"
                                   class="editable editable-click"
                                   onclick="showUpdatePersonAddressModal()"></a>

                            </dd>
                            <dt>Dirección Laboral</dt>
                            <dd>
                                <a th:if="${@personService.getPrincipalOcupationalInormation(person?.id, #locale)?.address == null}"
                                   href="javascript:;"
                                   class="editable editable-click editable-empty" onclick="showUpdatePersonJobAddressModal()">Sin Asignar</a>
                                <a th:if="${@personService.getPrincipalOcupationalInormation(person?.id, #locale)?.address != null}"
                                   href="javascript:;"
                                   th:utext="${@personService.getPrincipalOcupationalInormation(person?.id, #locale)?.address}"
                                   class="editable editable-click"
                                   onclick="showUpdatePersonJobAddressModal()"></a>

                            </dd>
                            <dt>Trabaja donde vive</dt>
                            <dd>
                                <span th:utext="${@personService.getCurrentOcupationalInformation(person?.id, #locale) != null ? (@personService.getCurrentOcupationalInformation(person?.id, #locale)?.homeAddress ? 'Sí' : 'No') : '-'}"></span>
                            </dd>
                            <dt>Teléfono Laboral</dt>
                            <dd>
                                <a href="#" id="occupationalPhoneNumber" class="editable editable-click" onclick="showOccupationalPhoneNumberModal()"
                                   th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} != null and ${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} != ''"
                                   th:text="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber}"></a>
                                <a href="#" id="occupationalPhoneNumber" class="editable editable-click editable-empty" onclick="showOccupationalPhoneNumberModal()"
                                   th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} == null or
                                   ${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumber} == ''"
                                >Sin asignar</a>
                                <span th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumberType == 'L'}"
                                      class="label label-xs label-primary">Fijo</span>
                                <span th:if="${@personService.getCurrentOcupationalInformation(person?.id, #locale)?.phoneNumberType == 'M'}"
                                      class="label label-xs label-primary">Celular</span>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="col-md-6">

                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Información de Redes Sociales</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <dt>Facebook</dt>
                        <dd><a target="_blank" th:href="${facebook?.facebookLink}"
                               th:text="${facebook?.facebookLink}"></a></dd>
                        <dt>LinkedIn</dt>
                        <dd><a target="_blank" th:href="${linkedin?.linkedinPublicProfileUrl}"
                               th:text="${linkedin?.linkedinPublicProfileUrl}"></a></dd>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <th:block th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                        <div class="portlet-title">
                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Información de Contacto Nosis</span>
                            </div>
                        </div>
                        <div class="portlet-body">

                            <dt>Teléfonos</dt>
                            <dd>
                                <span th:utext="${personNosisPhone != null ?  personNosisPhone:'Teléfono no encontrado'}"></span>
                            </dd>

                        </div>
                    </div>
                </th:block>
            </div>

            <div th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}" class="col-md-6">

                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Información de Fuentes Externas</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <dl class="dl-horizontal dl-external-data">
                            <dt>Movistar</dt>
                            <dd id="jsonLineasMovistarContact" th:text="${movistar?.lineas}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLineasMovistarContact').html() != null && $('#jsonLineasMovistarContact').html() != "") {
                                $('#jsonLineasMovistarContact').jsonViewer(JSON.parse($('#jsonLineasMovistarContact').html()));
                            }
                            /*]]>*/
                        </script>
                        <dl class="dl-horizontal dl-external-data">
                            <dt>Claro</dt>
                            <dd id="jsonLineasClaroContact" th:text="${claro?.lineas}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLineasClaroContact').html() != null && $('#jsonLineasClaroContact').html() != "") {
                                $('#jsonLineasClaroContact').jsonViewer(JSON.parse($('#jsonLineasClaroContact').html()));
                            }
                            /*]]>*/
                        </script><!-- TODO JARMANDO-->
                        <dl class="dl-horizontal dl-external-data">
                            <dt>Entel</dt>
                            <dd id="jsonLineasEntelContact" th:text="${entel?.lineas}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLineasEntelContact').html() != null && $('#jsonLineasEntelContact').html() != "") {
                                $('#jsonLineasEntelContact').jsonViewer(JSON.parse($('#jsonLineasEntelContact').html()));
                            }
                            /*]]>*/
                        </script>
                        <dl class="dl-horizontal dl-external-data">
                            <dt>Bitel</dt>
                            <dd id="jsonLineasBitelContact" th:text="${bitel?.lineas}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLineasBitelContact').html() != null && $('#jsonLineasBitelContact').html() != "") {
                                $('#jsonLineasBitelContact').jsonViewer(JSON.parse($('#jsonLineasBitelContact').html()));
                            }
                            /*]]>*/
                        </script>
                        <dl class="dl-horizontal dl-external-data">
                            <dt>Virgin</dt>
                            <dd id="jsonLineasVirginContact" th:text="${virgin?.lineas}"></dd>
                        </dl>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            if ($('#jsonLineasVirginContact').html() != null && $('#jsonLineasVirginContact').html() != "") {
                                $('#jsonLineasVirginContact').jsonViewer(JSON.parse($('#jsonLineasVirginContact').html()));
                            }
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Referencias</span>
                        </div>
                        <div class="actions">
                            <a th:class="${@frontEndService.defaultActionButtonClass}" href="javascript:;"
                               aria-expanded="false" onclick="openAddReferralModal()">
                                <i class="fa fa-plus"></i> Agregar
                            </a>
                        </div>
                    </div>
                    <div class="portlet-body" th:switch="${#lists.isEmpty(personReferrals)}">
                        <div th:case="true">
                            <p>No hay resultados</p>
                        </div>
                        <div th:case="false" class="table-responsive">
                            <table class="table table-bordered" id="referralsTable">
                                <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Parentesco</th>
                                    <th th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">Tipo de Teléfono</th>
                                    <th>Teléfono</th>
                                    <th>Detalle</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="referral : ${personReferrals}">
                                    <script th:inline="javascript">
                                        /*<![CDATA[*/
                                        var personContactReferralId = /*[[ ${referral?.id} ]]*/;
                                        /*]]>*/
                                    </script>
                                    <td>
                                        <a href="#" th:id="'personContactReferralFullName'+${referral?.id}"
                                           th:text="${referral?.fullName}"></a>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            var editableJson = getDefaultXEditableJson();
                                            editableJson.type = 'text';
                                            editableJson.url = /*[[ @{/referral/fullName} ]]*/;
                                            editableJson.params.referralId = /*[[ ${referral?.id} ]]*/;
                                            editableJson.title = 'Nombre completo';
                                            editableJson.value = /*[[ ${referral?.fullName} ]]*/;
                                            $('#personContactReferralFullName' + personContactReferralId).editable(editableJson);
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td>
                                        <a href="#" th:id="'personContactReferralRelationship'+${referral?.id}"
                                           th:text="${referral?.relationship?.relationship}"></a>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            var editableJson = getDefaultXEditableJson();
                                            editableJson.type = 'select';
                                            editableJson.url = /*[[ @{/referral/relationship} ]]*/;
                                            editableJson.params.referralId = /*[[ ${referral?.id} ]]*/;
                                            editableJson.title = 'Parentesco';
                                            editableJson.value = /*[[ ${referral?.relationship?.id} ]]*/;
                                            editableJson.source = function () {
                                                var relationships;
                                                $.ajax({
                                                    url: /*[[ @{/catalog/relationships/json} ]]*/,
                                                    type: 'GET',
                                                    async: false,
                                                    global: false,
                                                    success: function (data) {
                                                        var result = JSON.parse(data);
                                                        relationships = [];

                                                        for (i = 0; i < result.length; i++) {
                                                            relationships[i] = {
                                                                value: result[i].id,
                                                                text: result[i].relationship
                                                            };
                                                        }
                                                    }
                                                })
                                                return relationships;
                                            }
                                            $('#personContactReferralRelationship' + personContactReferralId).editable(editableJson);
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                        <a href="#" th:id="'personContactReferralPhoneType'+${referral?.id}"
                                           th:text="${referral?.phoneType == 'L' ? 'Fijo' : 'Celular'}"></a>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            var editableJson = getDefaultXEditableJson();
                                            editableJson.type = 'select';
                                            editableJson.url = /*[[ @{/referral/phoneType} ]]*/;
                                            editableJson.params.referralId = /*[[ ${referral?.id} ]]*/;
                                            editableJson.title = 'Tipo de Teléfono';
                                            editableJson.value = /*[[ ${referral?.phoneType} ]]*/;
                                            editableJson.source = function () {
                                                var phoneTypes;
                                                $.ajax({
                                                    url: /*[[ @{/catalog/phoneType/json} ]]*/,
                                                    type: 'GET',
                                                    async: false,
                                                    global: false,
                                                    success: function (data) {
                                                        var result = JSON.parse(data);
                                                        phoneTypes = [];

                                                        for (i = 0; i < result.length; i++) {
                                                            phoneTypes[i] = {
                                                                value: result[i].id,
                                                                text: result[i].name
                                                            };
                                                        }
                                                    }
                                                })
                                                return phoneTypes;
                                            }
                                            $('#personContactReferralPhoneType' + personContactReferralId).editable(editableJson);
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td>
                                        <a href="#" th:id="'personContactReferralPhoneNumber'+${referral?.id}"
                                           th:text="${referral?.phoneNumber}"></a>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            var editableJson = getDefaultXEditableJson();
                                            editableJson.type = 'text';
                                            editableJson.url = /*[[ @{/referral/phoneNumber} ]]*/;
                                            editableJson.params.referralId = /*[[ ${referral?.id} ]]*/;
                                            editableJson.title = 'Número telefónico';
                                            editableJson.value = /*[[ ${referral?.phoneNumber} ]]*/;
                                            $('#personContactReferralPhoneNumber' + personContactReferralId).editable(editableJson);
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td>
                                        <a href="#" th:id="'personContactReferralInfo'+${referral?.id}"
                                           th:text="${referral?.referralInfo}"></a>
                                        <script th:inline="javascript">
                                            /*<![CDATA[*/
                                            var editableJson = getDefaultXEditableJson();
                                            editableJson.type = 'text';
                                            editableJson.url = /*[[ @{/referral/info} ]]*/;
                                            editableJson.params.referralId = /*[[ ${referral?.id} ]]*/;
                                            editableJson.title = 'Detalle';
                                            editableJson.value = /*[[ ${referral?.referralInfo} ]]*/;
                                            $('#personContactReferralInfo' + personContactReferralId).editable(editableJson);
                                            /*]]>*/
                                        </script>
                                    </td>
                                    <td align="center">
                                        <a th:if="${!referral?.validated}"
                                           href="javascript:;"
                                           th:id="'validateReferralBtn'+${referral?.id}"
                                           th:class="${@frontEndService.getDefaultInsidePortletButtonClass()}"
                                           th:classappend="' red'"
                                           th:onclick="'updateValidatedReferral(true, '+${referral?.id}+')'">
                                            <!-- TODO DESCONFIRMADO -->
                                            <i class="fa fa-times"></i>No verificado</a>
                                        <a th:if="${referral?.validated}"
                                           href="javascript:;"
                                           th:id="'validateReferralBtn'+${referral?.id}"
                                           th:class="${@frontEndService.getDefaultInsidePortletButtonClass()}"
                                           th:onclick="'updateValidatedReferral(false, '+${referral?.id}+')'">
                                            <!-- TODO CONFIRMADO -->
                                            <i class="fa fa-check"></i>Verificado</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Histórico de Direcciones</span>
                        </div>
                    </div>
                    <div class="portlet-body" th:switch="${#lists.isEmpty(addresses)}">
                        <div th:case="true">
                            <p>Esta persona no tiene histórico de direcciones</p>
                        </div>
                        <div th:case="false" class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>Dirección</th>
                                    <th>Interior</th>
                                    <th>Fecha de Registro</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="address : ${addresses}">
                                    <td>
                                        <label th:text="${address?.addressStreetName}"></label>
                                    </td>
                                    <td>
                                        <label th:text="${address?.addressInterior}"></label>
                                    </td>
                                    <td>
                                        <label th:text="${@utilService.dateFormat(address?.registerDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(address?.registerDate)}"></label>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div th:class="${@frontEndService.getDefaultPortletClass()}">
                    <div class="portlet-title">
                        <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                            <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Contacto por Empresa</span>
                        </div>
                    </div>
                    <div class="portlet-body" th:switch="${#lists.isEmpty(employees)}">
                        <div th:case="true">
                            <p>Esta persona no está asociada a ninguna empresa</p>
                        </div>
                        <div th:case="false" class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>Empresa</th>
                                    <th>Email</th>
                                    <th>Teléfono</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="employee : ${employees}">
                                    <td>
                                        <label th:text="${employee.employer.name}"></label>
                                    </td>
                                    <td>
                                        <label th:text="${employee.workEmail}"></label>
                                    </td>
                                    <td>
                                        <label th:text="${employee.phoneNumber}"></label>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!--Modal for add Referral-->
        <div id="addReferralModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <form id="addReferralModalForm" class="form-row">
                            <div class="form-group col-md-6">
                                <label>Nombre completo</label>
                                <input type="text" name="fullName" class="form-control form-control-sm" placeholder="Nombre completo"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label>Parentesco</label>
                                <select name="relationshipId" class="form-control form-control-sm">
                                    <option th:each="relationship : ${@catalogService.getRelationships(#locale)}" th:value="${relationship.id}" th:text="${relationship.relationship}"></option>
                                </select>
                            </div>
                            <div class="form-group col-md-6" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                <label>Tipo de Teléfono</label>
                                <select name="phoneType" class="form-control form-control-sm">
                                    <option th:each="phoneType : ${@catalogService.getPhoneTypes()}" th:value="${phoneType.id}" th:text="${phoneType.name}"></option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label>Teléfono</label>
                                <div class="input-group">
                                    <span class="input-group-addon" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">+54</span>
                                    <span class="input-group-addon" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">+51</span>
                                    <input type="text" name="phoneNumber" class="form-control form-control-sm" placeholder="Teléfono"/>
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <label>Detalle</label>
                                <textarea name="info" class="form-control form-control-sm" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-info" onclick="addReferral()">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            function openAddReferralModal() {
                $('#addReferralModalForm').find("input[type=text], textarea").val("");
                $('#addReferralModal').modal('show');
            }

            function addReferral() {
                defaultAjax({
                    url: /*[[@{/referral/create/}]]*/,
                    type: 'POST',
                    data: $('#addReferralModalForm').serialize() + '&personId=' + personId,
                    success: function (data) {
                        var newReferral = JSON.parse(data);
                        // Add row
                        var btnClass = /*[[${@frontEndService.getDefaultInsidePortletButtonClass()}]]*/;
                        btnClass += " red";

                        var newRow = $('<tr>')
                            .append(
                                $('<td>').append($('<a>')
                                    .attr("href", "#")
                                    .attr('id', 'personContactReferralFullName' + newReferral.id)
                                    .text(newReferral.fullName)))
                            .append(
                                $('<td>').append($('<a>')
                                    .attr('href', '#')
                                    .attr('id', 'personContactReferralRelationship' + newReferral.id)
                                    .text(newReferral.relationship.relationship)));

                        if (newReferral.phoneTtype) {
                            newRow.append(
                                $('<td>').append($('<a>')
                                    .attr('href', '#')
                                    .attr('id', 'personContactReferralPhoneType' + newReferral.id)
                                    .text(newReferral.phoneType)));
                        }

                        newRow
                            .append(
                                $('<td>').append($('<a>')
                                    .attr('href', '#')
                                    .attr('id', 'personContactReferralPhoneNumber' + newReferral.id)
                                    .text(newReferral.phoneNumber)))
                            .append(
                                $('<td>').append($('<a>')
                                    .attr('href', '#')
                                    .attr('id', 'personContactReferralInfo' + newReferral.id)
                                    .text(newReferral.referralInfo)))
                            .append(
                                $('<td>').attr('align', 'center').append('<a href="javascript:;" class="'+btnClass+'" id="validateReferralBtn'+newReferral.id+'" '+
                                    'onclick="updateValidatedReferral(true, '+newReferral.id+')"><i class="fa fa-times"></i>No verificado</a>'));

                        $('#referralsTable').find('tbody').append(newRow);
                        // Make fullname editable
                        var editableJson = getDefaultXEditableJson();
                        editableJson.type = 'text';
                        editableJson.url = /*[[ @{/referral/fullName} ]]*/;
                        editableJson.params.referralId = newReferral.id;
                        editableJson.title = 'Nombre completo';
                        editableJson.value = newReferral.fullName;
                        $('#personContactReferralFullName' + newReferral.id).editable(editableJson);

                        // Parentesco editable
                        editableJson = getDefaultXEditableJson();
                        editableJson.type = 'select';
                        editableJson.url = /*[[ @{/referral/relationship} ]]*/;
                        editableJson.params.referralId = newReferral.id;
                        editableJson.title = 'Parentesco';
                        editableJson.value = newReferral.relationship.id;
                        editableJson.source = function () {
                            var relationships;
                            $.ajax({
                                url: /*[[ @{/catalog/relationships/json} ]]*/,
                                type: 'GET',
                                async: false,
                                global: false,
                                success: function (data) {
                                    var result = JSON.parse(data);
                                    relationships = [];

                                    for (i = 0; i < result.length; i++) {
                                        relationships[i] = {
                                            value: result[i].id,
                                            text: result[i].relationship
                                        };
                                    }
                                }
                            });
                            return relationships;
                        }
                        $('#personContactReferralRelationship' + newReferral.id).editable(editableJson);

                        // Phone number editable
                        editableJson = getDefaultXEditableJson();
                        editableJson.type = 'text';
                        editableJson.url = /*[[ @{/referral/phoneNumber} ]]*/;
                        editableJson.params.referralId = newReferral.id;
                        editableJson.title = 'Número telefónico';
                        editableJson.value = newReferral.phoneNumber;
                        $('#personContactReferralPhoneNumber' + newReferral.id).editable(editableJson);

                        // Details editable
                        editableJson = getDefaultXEditableJson();
                        editableJson.type = 'text';
                        editableJson.url = /*[[ @{/referral/info} ]]*/;
                        editableJson.params.referralId = newReferral.id;
                        editableJson.title = 'Detalle';
                        editableJson.value = newReferral.referralInfo;
                        $('#personContactReferralInfo' + newReferral.id).editable(editableJson);

                        if (newReferral.phoneTtype) {
                            // ARG - phone type editable
                            editableJson = getDefaultXEditableJson();
                            editableJson.type = 'select';
                            editableJson.url = /*[[ @{/referral/phoneType} ]]*/;
                            editableJson.params.referralId = newReferral.id;
                            editableJson.title = 'Tipo de Teléfono';
                            editableJson.value = newReferral.phoneType;
                            editableJson.source = function () {
                                var phoneTypes;
                                $.ajax({
                                    url: /*[[ @{/catalog/phoneType/json} ]]*/,
                                    type: 'GET',
                                    async: false,
                                    global: false,
                                    success: function (data) {
                                        var result = JSON.parse(data);
                                        phoneTypes = [];

                                        for (i = 0; i < result.length; i++) {
                                            phoneTypes[i] = {
                                                value: result[i].id,
                                                text: result[i].name
                                            };
                                        }
                                    }
                                })
                                return phoneTypes;
                            }
                            $('#personContactReferralPhoneType' + newReferral.id).editable(editableJson);
                        }

                        $('#addReferralModal').modal('hide');
                    }
                })
            }

            function updateValidatedReferral(validated, referralId) {
                var baseUrl = /*[[@{/referral/validated/}]]*/;
                defaultAjax({
                    url: baseUrl,
                    type: 'POST',
                    data: {
                        referralId: referralId,
                        value: validated
                    },
                    success: function (data) {
                        var validateReferralBtn = $('#validateReferralBtn'+referralId);
                        validateReferralBtn.toggleClass('red');

                        if (validated) {
                            validateReferralBtn.html('<i class="fa fa-check"></i> Verificado');
                            validateReferralBtn.attr('onclick', 'updateValidatedReferral(false, '+referralId+')');
                        } else {
                            validateReferralBtn.html('<i class="fa fa-times"></i> No Verificado');
                            validateReferralBtn.attr('onclick', 'updateValidatedReferral(true, '+referralId+')');
                        }

                        validateReferralBtn.blur();
                    }
                })
            }

            /*]]>*/
        </script>

    </div>

    <!-- TAB RCC -->
    <th:block th:fragment="tab-rcc" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li>
                    <th:block th:switch="${personCountry}">
                        <i class="fa-li fa fa-spinner fa-spin"></i>
                        <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">Cargando información de la SBS</span>
                        <span th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">Cargando información del BCRA</span>
                    </th:block>
                </li>
            </ul>
        </div>
        <th:block th:switch="${personCountry}">
            <th:block th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">

                <div id="divFaltanBots" class="alert alert-danger" th:if="${(bcraResult == null ) }">
                    <div class="row">
                        <div class="col-md-12">
                            Falta correr bot BCRA
                            <a href="javascript:;" class="btn btn-circle btn-default btn-xs pull-right"
                               onclick="runPendingBots()">
                                Correr pendiente </a>
                        </div>
                    </div>
                </div>

                <div th:if="${bcraResult !=null}">

                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                        <div class="portlet-body">
                            <div th:if="${bcraResult?.originDate ==null}">
                                No existen registros informados
                            </div>
                            <div th:if="${bcraResult?.originDate !=null}">
                                <div th:text="'Este deudor permanece en Situación 1 - Normal o no ha sido incluido en la Central de Deudores en períodos intermedios, desde: '+ ${bcraResult?.originDate}"></div>
                            </div>
                        </div>
                    </div>

                    <div th:class="${@frontEndService.getDefaultPortletClass()}">

                        <div class="portlet-title tabbable-line">
                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Deudores</span>
                            </div>

                            <div class="portlet-body">
                                <div class="tab-content">
                                    <div class="tab-pane active">
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <div th:if="${not #lists.isEmpty(bcraResult?.deudores)}">
                                                    <table class="table table-bordered table-striped table-hover">
                                                        <thead>
                                                        <tr>
                                                            <th>Denominacion deudor</th>
                                                            <th>Entidad</th>
                                                            <th>Periodo</th>
                                                            <th>Situacion</th>
                                                            <th>Monto</th>
                                                            <th>Dias retraso</th>
                                                            <th>Observaciones</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr th:each="deudor: ${bcraResult?.deudores}">
                                                            <td th:text="${deudor?.denominacionDeudor}"></td>
                                                            <td th:text="${deudor?.entidad}"></td>
                                                            <td th:text="${deudor?.periodo}"></td>
                                                            <td th:text="${deudor?.situacion}"></td>
                                                            <td th:text="${deudor?.monto}"></td>
                                                            <td th:text="${deudor?.diasRetraso}"></td>
                                                            <td th:text="${deudor?.observaciones}"></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div th:if="${#lists.isEmpty(bcraResult?.deudores)}">
                                                    No se encontraron deudores.
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <table class="table table-bordered">
                                                    <thead>
                                                    <tr>
                                                        <td colspan="6">Código de colores</td>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td>-</td>
                                                        <td style="background-color: #32dc0a">1</td>
                                                        <td style="background-color: #ffff00">2</td>
                                                        <td style="background-color: #f2c40f">3</td>
                                                        <td style="background-color: #ffa500">4</td>
                                                        <td style="background-color: #ff0000">5</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div th:class="${@frontEndService.getDefaultPortletClass()}" th:unless="${#lists.isEmpty(bcraResult.historialDeudas)}">
                            <div class="portlet-title tabbable-line">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Historial de deudas</span>
                                </div>
                            </div>

                            <div class="portlet-body">
                                <div class="tab-content">
                                    <div class="tab-pane active">
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <table class="table table-striped table-bordered">
                                                    <thead>
                                                    <tr>
                                                        <td></td>
                                                        <td>Peor situacion</td>
                                                        <td>Maxima deuda</td>
                                                        <td>Deuda en peor situacion</td>
                                                        <td>Cantidad de entidades</td>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td>Situacion Actual</td>
                                                        <td class="text-center" th:with="worstSituationLastMonth=${bcraResult.getWorstSituationBetween(0, 1)}" th:classappend="'situacion-'+ ${worstSituationLastMonth}" th:text="${worstSituationLastMonth}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getMaxDeudaBetween(0, 1), ',')}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaWorstSituacionBetween(0, 1), ',')}"></td>
                                                        <td class="text-center" th:text="${bcraResult.getNumberEntitiesBetween(0, 1)}"></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Ultimos 6 meses</td>
                                                        <td class="text-center" th:with="worstSituationLast6Months=${bcraResult.getWorstSituationBetween(0, 6)}" th:classappend="'situacion-'+ ${worstSituationLast6Months}" th:text="${worstSituationLast6Months}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getMaxDeudaBetween(0, 6), ',')}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaWorstSituacionBetween(0, 6), ',')}"></td>
                                                        <td class="text-center" th:text="${bcraResult.getNumberEntitiesBetween(0, 6)}"></td>
                                                    </tr>
                                                    <tr>
                                                        <td>7 a 12</td>
                                                        <td class="text-center" th:with="worstSituationFrom7To12=${bcraResult.getWorstSituationBetween(6, 12)}" th:classappend="'situacion-'+ ${worstSituationFrom7To12}" th:text="${worstSituationFrom7To12}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getMaxDeudaBetween(6, 12), ',')}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaWorstSituacionBetween(6, 12), ',')}"></td>
                                                        <td class="text-center" th:text="${bcraResult.getNumberEntitiesBetween(6, 12)}"></td>
                                                    </tr>
                                                    <tr>
                                                        <td>13 a 24</td>
                                                        <td class="text-center" th:with="worstSituationFrom13To24=${bcraResult.getWorstSituationBetween(12, 24)}" th:classappend="'situacion-'+ ${worstSituationFrom13To24}" th:text="${worstSituationFrom13To24}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getMaxDeudaBetween(12, 24), ',')}"></td>
                                                        <td class="text-center" th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaWorstSituacionBetween(12, 24), ',')}"></td>
                                                        <td class="text-center" th:text="${bcraResult.getNumberEntitiesBetween(12, 24)}"></td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="table-responsive col-lg-12">
                                                <table class="table table-bordered table-striped table-hover">
                                                    <thead>
                                                    <tr style="background-color: #659be0; color: #fff;">
                                                        <th th:colspan="${#lists.size(banks)*2+5}">Detalle</th>
                                                    </tr>
                                                    <tr style="background-color: #659be0; color: #fff;">
                                                        <th colspan="2"></th>
                                                        <th th:colspan="${#lists.size(banks)}">Situaciones</th>
                                                        <th th:colspan="${#lists.size(banks)}">Montos</th>
                                                        <th colspan="3">Resumen</th>
                                                    </tr>
                                                    <tr style="background-color: #659be0; color: #fff;">
                                                        <th>#</th>
                                                        <th>Mes</th>
                                                        <th th:each="bank, it: ${banks}" th:text="${bank}" th:style="${it.first ? 'border-left: 2px solid #888;': ''}"></th>
                                                        <th th:each="bank, it: ${banks}" th:text="${bank}" th:style="${it.first ? 'border-left: 2px solid #888;': ''}"></th>
                                                        <th style="border-left: 2px solid #888;">Deuda total</th>
                                                        <th>Peor situacion</th>
                                                        <th>Deuda en peor situacion</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr th:each="period,itPeriod: ${periods}">
                                                        <td th:text="${itPeriod.count}"></td>
                                                        <td th:text="${period}"></td>
                                                        <td class="text-center" th:each="bankHistorial, it: ${bcraResult.historialDeudas}"
                                                            th:with="situacionFormatted=${bankHistorial.historial.get(itPeriod.index).situacionFormatted}"
                                                            th:classappend="'situacion-'+ ${situacionFormatted}"
                                                            th:text="${situacionFormatted}"
                                                            th:style="${it.first ? 'border-left: 2px solid #888;': ''}"></td>
                                                        <td class="text-right" th:each="bankHistorial, it: ${bcraResult.historialDeudas}"
                                                            th:text="${@utilService.integerOnlyMoney(bankHistorial.historial.get(itPeriod.index).montoDouble, ',')}"
                                                            th:style="${it.first ? 'border-left: 2px solid #888;': ''}"></td>
                                                        <td class="text-right"
                                                            th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaTotalByPeriod(itPeriod.index), ',')}"
                                                            style="border-left: 2px solid #888;"></td>
                                                        <td class="text-right" th:with="worstSituationPeriod=${bcraResult.getWorstSituacionByPeriod(itPeriod.index)}"
                                                            th:classappend="'situacion-'+ ${worstSituationPeriod}"
                                                            th:text="${worstSituationPeriod}"></td>
                                                        <td class="text-right" th:text="${@utilService.integerOnlyMoney(bcraResult.getDeudaWorstSituacionByPeriod(itPeriod.index), ',')}"></td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div th:class="${@frontEndService.getDefaultPortletClass()}">
                            <div class="portlet-title tabbable-line">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Cheques</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div class="tab-content">
                                    <div class="tab-pane active">
                                        <div class="row">
                                            <div class="table-responsive col-lg-8">
                                                <div th:if="${not #lists.isEmpty(bcraResult?.cheques)}">
                                                    <table class="table table-bordered table-striped table-hover">
                                                        <thead>
                                                        <tr>
                                                            <th>Nro. Cheque</th>
                                                            <th>Fecha retraso</th>
                                                            <th>Monto</th>
                                                            <th>Casual</th>
                                                            <th>Fecha pago</th>
                                                            <th>Fecha pago multa</th>
                                                            <th>Revisión</th>
                                                            <th>Pr jud</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr th:each="cheque: ${bcraResult?.cheques}">
                                                            <td th:text="${cheque?.nroCheque}"></td>
                                                            <td th:text="${cheque?.fecharetrazo}"></td>
                                                            <td th:text="${cheque?.monto}"></td>
                                                            <td th:text="${cheque?.casual}"></td>
                                                            <td th:text="${cheque?.fechaPago}"></td>
                                                            <td th:text="${cheque?.fechaPagoMulta}"></td>
                                                            <td th:text="${cheque?.revision}"></td>
                                                            <td th:text="${cheque?.prjud}"></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div th:if="${#lists.isEmpty(bcraResult?.cheques)}">
                                                    No se encontraron cheques.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
            <th:block th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                <div th:if="${firstCall == null or !firstCall}" id="tabData">
                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                        <div class="portlet-title tabbable-line">
                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Calificación Crediticia</span>
                            </div>
                            <ul class="nav nav-tabs">
                                <li class="active">
                                    <a href="#portlet_tab1" data-toggle="tab" aria-expanded="true"> Titular </a>
                                </li>
                                <li class="">
                                    <a href="#portlet_tab2" data-toggle="tab" aria-expanded="false"> Esposo(a) </a>
                                </li>
                                <li class="">
                                    <a href="#portlet_tab3" data-toggle="tab" aria-expanded="false"> RUC </a>
                                </li>
                            </ul>
                        </div>
                        <div class="portlet-body">
                            <div class="tab-content">
                                <div class="tab-pane active" id="portlet_tab1">
                                    <div class="row">
                                        <div class="table-responsive col-md-8">
                                            <table class="table table-bordered table-striped table-hover">
                                                <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Entidades</th>
                                                    <th>Normal</th>
                                                    <th>CPP</th>
                                                    <th>Deficiente</th>
                                                    <th>Dudoso</th>
                                                    <th>Pérdida</th>
                                                    <th>Calificación</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr th:each="rccCalification : ${personRccCal}">
                                                    <td th:text="${@utilService.dateFormat(rccCalification?.rccDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(rccCalification?.rccDate)}"></td>
                                                    <td class="numeric" th:text="${rccCalification?.entities}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.normal)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.cpp)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.defficient)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.doubtful)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.loss)}"></td>
                                                    <td th:text="${rccCalification?.calification}"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                        <div class="portlet-title">
                                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Detalle de cuentas contables</span>
                                            </div>
                                            <div class="tools">
                                                <a href="javascript:;" class="expand" data-original-title=""
                                                   title="Mostrar"> </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body" style="display: none;">
                                            <span>Todos los montos están expresados en soles</span>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Cuenta</th>
                                                        <th>Cuenta S/</th>
                                                        <th>Cuenta $</th>
                                                        <th>Días de mora</th>
                                                        <th>Calificación</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <th:block th:each="rccMonth : ${personRcc}">
                                                        <tr th:each="rccDetail : ${rccMonth?.getRccDetail()}">
                                                            <td th:text="${rccDetail?.showDate} ? ${@utilService.dateFormat(rccMonth?.rccDate)} : ''"></td>

                                                            <td th:switch="${rccDetail.accountType}">
                                                                <strong th:case="A"
                                                                        th:text="${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></strong>
                                                                <span th:case="B"
                                                                      th:text="'· ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="C"
                                                                      th:text="'· · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="D"
                                                                      th:text="'· · · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="E"
                                                                      th:text="'· · · · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="F"
                                                                      th:text="'· · · · · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="G"
                                                                      th:text="'· · · · · · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="H"
                                                                      th:text="'· · · · · · · ' + ${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></span>
                                                                <span th:case="X"
                                                                      th:text="'· · · · · · · · ' + ${rccDetail?.accountNumber}"></span>
                                                            </td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.solesAmount}"></td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.dollarAmount}"></td>
                                                            <td class="numeric" th:text="${rccDetail?.arrears}"></td>
                                                            <td></td>
                                                        </tr>
                                                    </th:block>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="portlet_tab2">
                                    <div class="row">
                                        <div class="table-responsive col-md-8">
                                            <table class="table table-bordered table-striped table-hover">
                                                <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Entidades</th>
                                                    <th>Normal</th>
                                                    <th>CPP</th>
                                                    <th>Deficiente</th>
                                                    <th>Dudoso</th>
                                                    <th>Pérdida</th>
                                                    <th>Calificación</th>
                                                </tr>
                                                </thead>
                                                <tr th:each="rccCalification : ${partnerRccCal}">
                                                    <td th:text="${@utilService.dateFormat(rccCalification?.rccDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(rccCalification?.rccDate)}"></td>
                                                    <td class="numeric" th:text="${rccCalification?.entities}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.normal)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.cpp)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.defficient)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.doubtful)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.loss)}"></td>
                                                    <td th:text="${rccCalification?.calification}"></td>
                                                </tr>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                        <div class="portlet-title">
                                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Detalle de cuentas contables</span>
                                            </div>
                                            <div class="tools">
                                                <a href="javascript:;" class="expand" data-original-title=""
                                                   title="Mostrar"> </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body" style="display: none;">
                                            <span>Todos los montos están expresados en soles</span>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Cuenta</th>
                                                        <th>Cuenta S/</th>
                                                        <th>Cuenta $</th>
                                                        <th>Días de mora</th>
                                                        <th>Calificación</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <th:block th:each="rccMonth : ${partnerRcc}">
                                                        <tr th:each="rccDetail : ${rccMonth?.getRccDetail()}">
                                                            <td th:text="${@utilService.dateFormat(rccMonth?.rccDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(rccMonth?.rccDate)}"></td>
                                                            <td th:text="${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.solesAmount}"></td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.dollarAmount}"></td>
                                                            <td class="numeric" th:text="${rccDetail?.arrears}"></td>
                                                            <td></td>
                                                        </tr>
                                                    </th:block>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="portlet_tab3">
                                    <div class="row">
                                        <div class="table-responsive col-md-8">
                                            <table class="table table-bordered table-striped table-hover">
                                                <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Entidades</th>
                                                    <th>Normal</th>
                                                    <th>CPP</th>
                                                    <th>Deficiente</th>
                                                    <th>Dudoso</th>
                                                    <th>Pérdida</th>
                                                    <th>Calificación</th>
                                                </tr>
                                                </thead>
                                                <tr th:each="rccCalification : ${rucRccCal}">
                                                    <td th:text="${@utilService.dateFormat(rccCalification?.rccDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(rccCalification?.rccDate)}"></td>
                                                    <td class="numeric" th:text="${rccCalification?.entities}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.normal)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.cpp)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.defficient)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.doubtful)}"></td>
                                                    <td class="numeric"
                                                        th:text="${@utilService.percentFormat(rccCalification?.loss)}"></td>
                                                    <td th:text="${rccCalification?.calification}"></td>
                                                </tr>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div th:class="${@frontEndService.getDefaultPortletClass()}">
                                        <div class="portlet-title">
                                            <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                                <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Detalle de cuentas contables</span>
                                            </div>
                                            <div class="tools">
                                                <a href="javascript:;" class="expand" data-original-title=""
                                                   title="Mostrar"> </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body" style="display: none;">
                                            <span>Todos los montos están expresados en soles</span>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Cuenta</th>
                                                        <th>Cuenta S/</th>
                                                        <th>Cuenta $</th>
                                                        <th>Días de mora</th>
                                                        <th>Calificación</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <th:block th:each="rccMonth : ${rucRcc}">
                                                        <tr th:each="rccDetail : ${rccMonth?.getRccDetail()}">
                                                            <td th:text="${@utilService.dateFormat(rccMonth?.rccDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(rccMonth?.rccDate)}"></td>
                                                            <td th:text="${rccDetail?.accountCode} + ' ' + ${rccDetail?.accountNumber}"></td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.solesAmount}"></td>
                                                            <td class="numeric"
                                                                th:text="${rccDetail?.dollarAmount}"></td>
                                                            <td class="numeric" th:text="${rccDetail?.arrears}"></td>
                                                            <td></td>
                                                        </tr>
                                                    </th:block>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
        </th:block>
    </th:block>

    <!-- BANK ACCOUNT -->
    <!-- Be careful with this and use the variable onlyView because is rendered also by an external user-->
    <div th:fragment="bank_account" th:class="${@frontEndService.getDefaultPortletClass()}">
        <div th:class="${@frontEndService.getDefaultPortletClass()}">
            <div class="portlet-title">
                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Cuenta Bancaria</span>
                    <th:block th:if="${bankAccount?.bank?.country == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                        <span th:if="${(bankAccount?.getVerified() == null or !bankAccount?.getVerified())}">
                            <a class="btn green btn-outline btn-xs" th:onclick="'bankAccountVerified(true,'+ ${person?.id} + ')'">Verificar</a>
                        </span>
                        <span th:unless="${(bankAccount?.getVerified() == null or !bankAccount?.getVerified())}" class="label label-xs label-primary">
                            Verificado
                        </span>
                    </th:block>
                    <span th:if="${advanceCredit}"
                          class="label label-xs label-danger">Adelanto en Cr&eacute;dito</span>
                </div>
            </div>
            <div class="portlet-body">
                <dl class="dl-horizontal dl-user-data">
                    <dt>Banco</dt>
                    <dd>
                        <a href="#" id="bankId"
                           th:text="${bankAccount?.bank?.name}"></a>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var editableJson = getDefaultXEditableJson();
                            editableJson.type = 'select';
                            editableJson.url = /*[[ @{/person/bank} ]]*/;
                            editableJson.value = /*[[ ${bankAccount?.bank?.id} ]]*/;
                            editableJson.title = 'Banco';
                            editableJson.source = function () {
                                var banks;
                                $.ajax({
                                    url: /*[[@{/catalog/banks/json(countryId=${person?.documentType?.countryId})}]]*/null,
                                    type: 'GET',
                                    async: false,
                                    global: false,
                                    success: function (data) {
                                        var result = JSON.parse(data);
                                        banks = [];

                                        for (i = 0; i < result.length; i++) {
                                            banks[i] = {
                                                value: result[i].id,
                                                text: result[i].name
                                            };
                                        }
                                    }
                                })
                                return banks;
                            };
                            $('#bankId').editable(editableJson);
                            /*]]>*/
                        </script>
                    </dd>
                    <dt>Nro. de Cuenta</dt>
                    <dd class="">
                        <a href="#" id="bankAccount"
                           th:text="${bankAccount?.bankAccount}"></a>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var editableJson = getDefaultXEditableJson();
                            editableJson.type = 'text';
                            editableJson.url = /*[[ @{/person/bankAccount} ]]*/;
                            editableJson.title = 'Cuenta';
                            editableJson.value = /*[[ ${bankAccount?.bankAccount} ]]*/;
                            $('#bankAccount').editable(editableJson);
                            /*]]>*/
                        </script>
                    </dd>
                    <th:block th:switch="${person?.documentType?.countryId}">
                        <dt th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">CCI</dt>
                        <dt th:case="${T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">CBU</dt>
                    </th:block>
                    <dd class="">
                        <a href="#" id="cciCode"
                           th:text="${bankAccount?.cciCode}"></a>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var editableJson = getDefaultXEditableJson();
                            editableJson.type = 'text';
                            editableJson.url = /*[[ @{/person/cciCode} ]]*/;
                            editableJson.title = 'CCI';
                            editableJson.value = /*[[ ${bankAccount?.cciCode} ]]*/;
                            $('#cciCode').editable(editableJson);
                            /*]]>*/
                        </script>
                    </dd>
                    <dt>Tipo de Cuenta</dt>
                    <dd>
                        <a href="#" id="bankAccountType"
                           th:text="${#strings.equals(bankAccount?.bankAccountType, 'S') ?'Cuenta de Ahorros' : #strings.equals(bankAccount?.bankAccountType, 'C') ?'Cuenta Corriente' : ''}"></a>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var editableJson = getDefaultXEditableJson();
                            editableJson.type = 'select';
                            editableJson.url = /*[[ @{/person/bankAccountType} ]]*/;
                            editableJson.value = /*[[ ${bankAccount?.bankAccountType} ]]*/
                                editableJson.title = 'Tipo de Cuenta';
                            editableJson.source = function () {
                                bankAccountTypes = [];

                                bankAccountTypes[0] = {
                                    value: "S",
                                    text: "Cuenta de Ahorros"
                                };
                                bankAccountTypes[1] = {
                                    value: "C",
                                    text: "Cuenta Corriente"
                                };
                                return bankAccountTypes;
                            };
                            $('#bankAccountType').editable(editableJson);
                            /*]]>*/
                        </script>
                    </dd>
                    <th:block th:if="${not (person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA)}">
                        <dt>Departamento</dt>
                        <dd>
                            <a href="#" id="department"
                               th:text="${bankAccount?.bankAccountUbigeo?.department?.name}"></a>
                            <script th:inline="javascript">
                                /*<![CDATA[*/
                                var editableJson = getDefaultXEditableJson();
                                editableJson.type = 'select';
                                editableJson.url = /*[[ @{/person/bankDepartment} ]]*/;
                                editableJson.value = /*[[ ${bankAccount?.bankAccountUbigeo?.department?.id} ]]*/;
                                editableJson.title = 'Departamento';
                                editableJson.source = function () {
                                    var departments;
                                    $.ajax({
                                        url: /*[[@{/catalog/departments/json}]]*/null,
                                        type: 'GET',
                                        async: false,
                                        global: false,
                                        success: function (data) {
                                            var result = JSON.parse(data);
                                            departments = [];

                                            for (i = 0; i < result.length; i++) {
                                                departments[i] = {
                                                    value: result[i].id,
                                                    text: result[i].name
                                                };
                                            }
                                        }
                                    })
                                    return departments;
                                };
                                $('#department').editable(editableJson);
                                /*]]>*/
                            </script>
                        </dd>
                    </th:block>
                    <th:block th:if="${bankAccount?.branchOfficeCode != null}">
                        <dt>Sucursal</dt>
                        <dd>
                            <a href="#" id="branchOfficeCode"
                               th:text="${bankAccount?.branchOfficeCode}"></a>
                            <script th:inline="javascript">
                                /*<![CDATA[*/
                                var editableJson = getDefaultXEditableJson();
                                editableJson.type = 'text';
                                editableJson.url = /*[[ @{/person/branchOfficeCode} ]]*/;
                                editableJson.title = 'Sucursal';
                                editableJson.value = /*[[ ${bankAccount?.branchOfficeCode} ]]*/;
                                $('#branchOfficeCode').editable(editableJson);
                                /*]]>*/
                            </script>
                        </dd>
                    </th:block>
                </dl>
            </div>
        </div>
        <div th:each="employee : ${employeeBankAccounts}" th:class="${@frontEndService.getDefaultPortletClass()}">
            <div class="portlet-title">
                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                        <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}"><div th:remove="tag"
                                                                                                  th:text="'Cuenta Bancaria ' + ${employee.employer.name}"></div></span>
                </div>
            </div>
            <div class="portlet-body">
                <dl class="dl-horizontal dl-user-data">
                    <dt>Banco</dt>
                    <dd>
                        <label
                                th:text="${employee.bank}"></label>

                    </dd>
                    <dt>Nro. de Cuenta</dt>
                    <dd>
                        <label
                                th:text="${employee.accountNumber}"></label>

                    </dd>
                    <dt>CCI</dt>
                    <dd>
                        <label
                                th:text="${employee.accountNumberCci}"></label>

                    </dd>
                    <dt>Tipo de Cuenta</dt>
                    <dd>
                        <label
                                th:text="${'Salarial'}"></label>

                    </dd>

                </dl>
            </div>
        </div>
    </div>

    <!-- TAB EMAIL -->
    <div th:fragment="tab-email" th:remove="tag">
        <div id="tabLoading" style="display: none">
            <ul class="fa-ul">
                <li><i class="fa-li fa fa-spinner fa-spin"></i>Cargando Reportes de Seguridad
                </li>
            </ul>
        </div>
        <div th:if="${firstCall == null or !firstCall}" id="tabData">
            <div th:if="${false}" class="row">
                <div class="col-md-6 nopadding">
                    <div class="col-md-12">
                        <div th:class="${@frontEndService.getDefaultPortletClass()}">
                            <div class="portlet-title">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reporte por Email</span>
                                </div>
                            </div>
                            <div class="panel-group" id="accordion">
                                <div id="emailValidation" th:text="${emailReport}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 nopadding">
                    <div class="col-md-12">
                        <div th:class="${@frontEndService.getDefaultPortletClass()}">
                            <div class="portlet-title">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reporte por Email y dirección IP</span>
                                </div>
                            </div>
                            <div class="panel-group" id="accordion">
                                <div id="emailIpValidation" th:text="${emailIpReport}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <script th:inline="javascript">
                    /*<![CDATA[*/
                    if ($('#emailValidation').html() != null && $('#emailValidation').html() != "") {
                        $('#emailValidation').jsonViewer(JSON.parse($('#emailValidation').html()));
                    }
                    if ($('#emailIpValidation').html() != null && $('#emailIpValidation').html() != "") {
                        $('#emailIpValidation').jsonViewer(JSON.parse($('#emailIpValidation').html()));
                    }
                    /*]]>*/
                </script>
            </div>
            <div class="row">
                <div class="col-md-12 nopadding">
                    <div class="col-md-12">
                        <div th:class="${@frontEndService.getDefaultPortletClass()}">
                            <div class="portlet-title">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reporte del dispositivo</span>
                                </div>
                            </div>
                            <div class="panel-group" id="accordion">
                                <div id="deviceSecurity" th:text="${deviceReport}"></div>
                            </div>
                        </div>
                        <div th:class="${@frontEndService.getDefaultPortletClass()}">
                            <div class="portlet-title">
                                <div th:class="${@frontEndService.getDefaultCaptionClass()}">
                                    <span th:class="${@frontEndService.getDefaultCaptionSubjectClass()}">Reporte de Emailage</span>
                                </div>
                            </div>
                            <div class="panel-group" id="accordion-emailage">
                                <div id="emailageSecurity" th:text="${emailageReport}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <script th:inline="javascript">
                    /*<![CDATA[*/
                    if ($('#deviceSecurity').html() != null && $('#deviceSecurity').html() != "") {
                        $('#deviceSecurity').jsonViewer(JSON.parse($('#deviceSecurity').html()));
                    }

                    if ($('#emailageSecurity').html() != null && $('#emailageSecurity').html() != "") {
                        $('#emailageSecurity').jsonViewer(JSON.parse($('#emailageSecurity').html()));
                    }
                    /*]]>*/
                </script>
            </div>
        </div>
    </div>

    <th:block th:fragment="createLoanOfferModal">
        <div class="modal-body">
            <form role="form" action="#" method="post" th:object="${createLoanOfferForm}"
                  id="frmCreateLoanOfferModal">

                <input type="hidden" name="loanApplicationId" th:value="${loanApplicationId}"/>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label" for="ammount"
                                   th:text="#{form.field.ammount}"></label>

                            <input type="text" th:id="ammount" th:name="ammount"
                                   th:value="${loanAmmount != null} ? ${loanAmmount} : ${loanApplication?.amount}"
                                   class="form-control"/>
                            <div class="errorContainer">
                                <span class="help-block form-field-error-message"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label" for="installments"
                                   th:text="#{form.field.installments}"></label>
                            <span id="installmentsValue" style="float: right"></span>
                            <input th:id="installments" th:name="installments"
                                   th:value="${loanApplication?.installments}" type="text" class="form-control"/>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label" for="entityId">Entidad</label>
                            <select th:id="entitySelect" th:field="*{entityId}" class="form-control">
                                <option th:each="entity : ${entities}" th:value="${entity.id}"
                                        th:text="${entity.shortName}"
                                        th:selected="${entity.id == entitySelected}"></option>
                            </select>
                            <script th:inline="javascript">
                                /*<![CDATA[*/
                                $('#entitySelect').on('change', function () {
                                    var entityId = this.value;
                                    var baseUrl = /*[[@{/loanOffer/modal/create}]]*/null;
                                    defaultAjax({
                                        url: baseUrl,
                                        type: 'GET',
                                        data: {
                                            loanApplicationId: /*[[${loanApplicationId}]]*/null,
                                            entityId: entityId
                                        },
                                        success: function (data) {
                                            $('#createLoanOfferModal .content').replaceWith(data);
                                        }
                                    });
                                });
                                /*]]>*/
                            </script>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            <button type="button" class="btn btn-info"
                    th:onclick="'createLoanOffer(' + ${loanApplicationId} + ')'">Guardar
            </button>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/

            var loanOfferJsonFormValidation;
            var $loanOfferRegisterFormValidator;

            var loanOfferValidator = /*[[${createLoanOfferForm.validator.toJson(#locale)}]]*/null;
            if (loanOfferValidator != null) {
                console.log(loanOfferValidator);
                var jsonValidator = JSON.parse(loanOfferValidator);
                loanOfferJsonFormValidation = createFormValidationJson(jsonValidator, $('#frmCreateLoanOfferModal'));

                loanOfferJsonFormValidation.rules.termsAndConditions = {};
                loanOfferJsonFormValidation.rules.termsAndConditions.required = true;

                $loanOfferRegisterFormValidator = $('#frmCreateLoanOfferModal').validateForm(loanOfferJsonFormValidation);
            }

            // LoanApplicationInstallments
            var installmentsOnChange = function () {
                $('#installmentsValue').html($("#installments").val() + /*[[${loanApplication.product?.paymentType?.pluralName}]]*/);
            };
            $('#installments').ionRangeSlider({
                min: /*[[${createLoanOfferForm.validator.installments.minValue}]]*/,
                max: /*[[${createLoanOfferForm.validator.installments.maxValue}]]*/,
                from: /*[[${loanApplication.installments}]]*/,
                keyboard: true,
                hide_from_to: true,
                onChange: installmentsOnChange
            });
            installmentsOnChange();

            /*]]>*/
        </script>
    </th:block>

    <th:block th:fragment="loanApplicationLocationMapModal">
        <div class="modal-body">
            <div class="row">
                <div class="col-md-12">
                    <div id="loanApplicationMap" style="height: 350px;"></div>
                </div>
            </div>
        </div>
        <div class="form-row modal-body">
            <div class="col-md-3">
                <i class="fa fa-map-marker fa-2x" style="color: mediumpurple" aria-hidden="true"></i><span>IP</span>
            </div>
            <div class="col-md-3">
                <i class="fa fa-map-marker fa-2x" style="color: yellow" aria-hidden="true"></i><span>Navegador</span>
            </div>
            <div class="col-md-3">
                <i class="fa fa-map-marker fa-2x" style="color: lightblue" aria-hidden="true"></i><span>Dirección</span>
            </div>
        </div>
        <div class="modal-footer">
            <div>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            // Mapa
            var loanApplicationMap = new google.maps.Map(document.getElementById('loanApplicationMap'), {
                center: {lat: -12.046465, lng: -77.042767},
                zoom: 10
            });
            var bounds = new google.maps.LatLngBounds();

            // Marker IP
            var ipLocationLat = /*[[${loanApplication?.ipLatitude}]]*/null;
            var ipLocationLon = /*[[${loanApplication?.ipLongitude}]]*/null;
            if (ipLocationLat != null && ipLocationLon != null) {
                ipLocationMarker = new google.maps.Marker({
                    map: loanApplicationMap,
                    icon: 'https://maps.google.com/mapfiles/ms/micons/purple.png',
                    draggable: false,
                    animation: google.maps.Animation.DROP,
                    position: {lat: ipLocationLat, lng: ipLocationLon}
                });
                bounds.extend(new google.maps.LatLng(ipLocationLat, ipLocationLon));
            }

            // Marker Nav
            var navLocationLat = /*[[${loanApplication?.navLatitude}]]*/null;
            var navLocationLon = /*[[${loanApplication?.navLongitude}]]*/null;
            if (navLocationLat != null && navLocationLon != null) {
                navLocationMarker = new google.maps.Marker({
                    map: loanApplicationMap,
                    icon: 'https://maps.google.com/mapfiles/ms/micons/yellow.png',
                    draggable: false,
                    animation: google.maps.Animation.DROP,
                    position: {lat: navLocationLat, lng: navLocationLon}
                });
                bounds.extend(new google.maps.LatLng(navLocationLat, navLocationLon));
            }

            // Marker person addresss
            var addressLocationLat = /*[[${personContactInformation?.addressLatitude}]]*/null;
            var addressLocationLon = /*[[${personContactInformation?.addressLongitude}]]*/null;
            if (addressLocationLat != null && addressLocationLon != null) {
                addressLocationMarker = new google.maps.Marker({
                    map: loanApplicationMap,
                    icon: 'https://maps.google.com/mapfiles/ms/micons/lightblue.png',
                    draggable: false,
                    animation: google.maps.Animation.DROP,
                    position: {lat: addressLocationLat, lng: addressLocationLon}
                });
                bounds.extend(new google.maps.LatLng(addressLocationLat, addressLocationLon));
            }

            // DIspara el Resize del mapa despues de 1000ms
            setTimeout(function () {
                google.maps.event.trigger(loanApplicationMap, "resize");

                // Centrar mapa con puntos
                if (!bounds.isEmpty()) {
                    console.log("center: " + bounds.getCenter());
                    loanApplicationMap.fitBounds(bounds);
                }
            }, 1000);

            /*]]>*/
        </script>
    </th:block>


    <!--Modal for update occupational phone number-->
    <th:block th:fragment="updateOccupationalPhoneNumberModal">
        <div class="modal-header">
            <strong>Teléfono laboral</strong>
        </div>
        <div class="modal-body">
            <form role="form" action="#" method="post" th:object="${occupationalPhoneNumberForm}"
                  id="frmUpdateOccupationalPhoneNumber">
                <div class="form-row">
                    <div class="col-md-3">
                        <div class="form-group ">
                            <label>Tipo de teléfono</label>
                            <select th:field="*{typePhone}" class="form-control form-control-sm" id="selTypePhone">
                                <option th:value="${T(com.affirm.common.model.catalog.PhoneType).LANDLINE}">Fijo</option>
                                <option th:value="${T(com.affirm.common.model.catalog.PhoneType).CELLPHONE}">Celular</option>
                            </select>
                            <div class="errorContainer form-bo"></div>
                        </div>
                    </div>
                    <div class="col-md-3" id="divPhoneCode">
                        <div class="form-group ">
                            <label>Cód. área</label>
                            <input id="txtPhoneCode" type="text" th:field="*{phoneCode}" maxlength="4" class="form-control form-control-sm" placeholder="Código"/>
                            <div class="errorContainer form-bo"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Número</label>
                            <input id="txtPhoneNumber" type="text" th:field="*{phoneNumber}" class="form-control form-control-sm" placeholder="Número"/>
                            <div class="errorContainer form-bo"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            <button type="button" class="btn btn-info" th:onclick="'updateOccupationalPhoneNumber()'">Guardar</button>
        </div>
        <script th:inline="javascript" >
            /*<![CDATA[*/
            $(function() {
                $('#selTypePhone').change(function() {
                    if ($(this).val() == /*[[ ${T(com.affirm.common.model.catalog.PhoneType).LANDLINE} ]]*/null) {
                        $('#divPhoneCode').fadeIn();

                        if (/*[[${person?.documentType?.countryId != T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}]]*/) {
                            $('#txtPhoneNumber').mask('000-#');
                        }
                    }
                    else {
                        $('#divPhoneCode').hide();
                        $('#txtPhoneCode').val('');

                        if (/*[[${person?.documentType?.countryId != T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}]]*/) {
                            $('#txtPhoneNumber').mask('0000-#');
                        }
                    }
                });

                $('#selTypePhone').change();
            });

            var occupationalPhoneValidatorJson = /*[[${occupationalPhoneNumberForm.validator.toJson(#locale)}]]*/null;
            if (occupationalPhoneValidatorJson != null) {
                jsonFormValidation = createFormValidationJson(JSON.parse(occupationalPhoneValidatorJson), $('#frmUpdateOccupationalPhoneNumber'));
                $('#frmUpdateOccupationalPhoneNumber').validateForm(jsonFormValidation);
            }

            /*]]>*/
        </script>
    </th:block>

    <th:block th:fragment="updatePersonAddressModal">
        <div class="modal-body">
            <div class="row">
                <div class="col-md-12">
                    <form role="form" action="#" method="post" th:object="${updatePersonAddressForm}"
                          id="frmUpdatePersonAddressModal">
                        <input id='latitude' type="hidden" th:field="*{latitude}"/>
                        <input id='longitude' type="hidden" th:field="*{longitude}"/>
                        <input id='addressType' type="hidden" th:field="*{addressType}"/>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="address"
                                           th:text="'Dirección agregada'"/>
                                    <input type="text" th:field="*{aggregatedAddress}" class="form-control"/>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                <div class="form-group">
                                    <label class="control-label" for="department"
                                           th:text="#{form.field.department}"></label>
                                    <select th:field="*{departamento}" class="form-control">
                                        <option value="" hidden="hidden"></option>
                                        <option th:each="department : ${@catalogService.getDepartments()}"
                                                th:value="${department.id}"
                                                th:text="${department.name}"></option>
                                    </select>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="department"
                                           th:text="#{form.field.department}"></label>
                                    <select th:field="*{departamento}" class="form-control">
                                        <option value="" hidden="hidden"></option>
                                        <option th:each="department : ${@catalogService.getGeneralDepartment(T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA)}"
                                                th:value="${department.departmentId}"
                                                th:text="${department.name}"></option>
                                    </select>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group label-floating">
                                    <label class="control-label" for="province"
                                           th:text="#{form.field.province}"></label>
                                    <select th:field="*{provincia}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:if="*{departamento != null}"
                                                th:each="province : ${@catalogService.getProvinces(updatePersonAddressForm.departamento)}"
                                                th:value="${province.id}" th:text="${province.name}"></option>
                                    </select>
                                    <select th:field="*{provincia}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:if="*{departamento != null}"
                                                th:each="province : ${@catalogService.getGeneralProvinces(updatePersonAddressForm.departamento)}"
                                                th:value="${province.provinceId}" th:text="${province.name}"></option>
                                    </select>
                                    <select th:field="*{provincia}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:each="province : ${@catalogService.getGeneralProvince(54)}"
                                                th:value="${province.provinceId}" th:text="${province.name}"></option>
                                    </select>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group label-floating">
                                    <label class="control-label" for="district"
                                           th:text="#{form.field.district}"></label>
                                    <select th:field="*{distrito}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:if="*{provincia != null}"
                                                th:each="district : ${@catalogService.getDistricts(updatePersonAddressForm.departamento, updatePersonAddressForm.provincia)}"
                                                th:value="${district.id}" th:text="${district.name}"></option>
                                    </select>
                                    <select th:field="*{distrito}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:if="*{provincia != null}"
                                                th:each="district : ${@catalogService.getDistrictsByProvinceId(updatePersonAddressForm.provincia)}"
                                                th:value="${district.districtId}" th:text="${district.name}"></option>
                                    </select>
                                    <select th:field="*{distrito}" class="form-control" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                        <option value="" hidden="hidden"></option>
                                        <option th:if="*{provincia != null}"
                                                th:each="district : ${@catalogService.getGeneralDistrictByProvince(updatePersonAddressForm.provincia)}"
                                                th:value="${district.districtId}" th:text="${district.name}"></option>
                                    </select>
                                    <div class="errorContainer">
                                        <span class="help-block form-field-error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU or
                                                            person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="streetType"
                                           th:text="#{form.field.streetType}"/>
                                    <select th:field="*{roadType}" class="form-control">
                                        <option value="" hidden="hidden"></option>
                                        <option th:each="type : ${@catalogService.getStreetTypes()}"
                                                th:value="${type.id}" th:text="${type.type}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label class="control-label" for="address"
                                           th:text="#{form.field.address}"/>
                                    <input type="text" th:field="*{roadName}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label" for="houseNumber">Número</label>
                                    <input type="text" th:field="*{houseNumber}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-2" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                <div >
                                    <label class="control-label" for="floor">Piso</label>


                                    <label for="withoutNumberId" class="mt-checkbox mt-checkbox-single mt-checkbox-outline withoutNumberId">
                                        <input id="withoutNumberId" type="checkbox"  />
                                        S/N
                                        <span></span>
                                    </label>


                                    <input th:field="*{floor}" type="text" class="form-control" />
                                </div>
                            </div>


                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label" for="interior">Departamento</label>
                                    <input type="text" th:field="*{interior}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-2" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU or
                                                            person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="manzana">Manzana</label>
                                    <input type="text" th:field="*{manzana}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-2" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU or
                                                            person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="lote">Lote</label>
                                    <input type="text" th:field="*{lote}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-2" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
                                <div class="form-group">
                                    <label class="control-label" for="postalCode">Cod. postal</label>
                                    <input type="text" th:field="*{postalCode}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-4" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU or
                                                            person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="zoneType">Tipo zona</label>
                                    <select th:field="*{zoneType}" class="form-control">
                                        <option value="" hidden="hidden"></option>
                                        <option th:each="area : ${@catalogService.getAreaType()}" th:value="${area.id}" th:text="${area.name}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU or
                                                            person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
                                <div class="form-group">
                                    <label class="control-label" for="zoneName">Nombre zona</label>
                                    <input type="text" th:field="*{zoneName}" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="control-label" for="reference">Referencia</label>
                                    <input type="text" th:field="*{reference}" class="form-control"/>
                                </div>
                            </div>
                        </div>
                        <div id="personAddressMap" style="height: 350px;"></div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label" for="searchQuery">Ubicación</label>
                                <input id="address" type="text" th:field="*{searchQuery}" class="form-control"/>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            <button type="button" class="btn btn-info"
                    th:onclick="'updatePersonAddress()'">Guardar
            </button>
        </div>

        <script th:inline="javascript" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_PERU}">
            /*<![CDATA[*/
            $department = $("#frmUpdatePersonAddressModal select[name=departamento]");
            $province = $("#frmUpdatePersonAddressModal select[name=provincia]");
            $district = $("#frmUpdatePersonAddressModal select[name=distrito]");

            $department.on('change', function () {
                $.getJSON(/*[[@{/catalog/provinces/json}]]*/, {departmentId: $(this).val()}, function (data) {
                    var placeholder = "";
                    var options = '<option value="" hidden="hidden">' + placeholder + '</option>';
                    if (data != null) {
                        for (var x = 0; x < data.length; x++) {
                            options += '<option value="' + data[x]['id'] + '" ' + '>' + data[x]['name'] + '</option>';
                        }
                    }
                    $province.html(options);
                    $province.change();
                });
            });
            $province.on('change', function () {
                $.getJSON(/*[[@{/catalog/districts/json}]]*/, {
                    departmentId: $department.val(),
                    provinceId: $(this).val()
                }, function (data) {
                    var placeholder = "";
                    var options = '<option value="" hidden="hidden">' + placeholder + '</option>';
                    if (data != null) {
                        for (var x = 0; x < data.length; x++) {
                            options += '<option value="' + data[x]['id'] + '">' + data[x]['name'] + '</option>';
                        }
                    }
                    $district.html(options);
                });
            });

            /*]]>*/
        </script>

        <script th:inline="javascript" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_COLOMBIA}">
            /*<![CDATA[*/
            $department = $("#frmUpdatePersonAddressModal select[name=departamento]");
            $province = $("#frmUpdatePersonAddressModal select[name=provincia]");
            $district = $("#frmUpdatePersonAddressModal select[name=distrito]");

            $department.on('change', function () {
                $.getJSON(/*[[@{/catalog/provinces/general/json}]]*/, {departmentId: $(this).val()}, function (data) {
                    var placeholder = "";
                    var options = '<option value="" hidden="hidden">' + placeholder + '</option>';
                    if (data != null) {
                        for (var x = 0; x < data.length; x++) {
                            options += '<option value="' + data[x]['provinceId'] + '" ' + '>' + data[x]['name'] + '</option>';
                        }
                    }
                    $province.html(options);
                    $province.change();
                });
            });
            $province.on('change', function () {
                $.getJSON(/*[[@{/catalog/districts/general/json}]]*/, {
                    provinceId: $(this).val()
                }, function (data) {
                    var placeholder = "";
                    var options = '<option value="" hidden="hidden">' + placeholder + '</option>';
                    if (data != null) {
                        for (var x = 0; x < data.length; x++) {
                            options += '<option value="' + data[x]['districtId'] + '">' + data[x]['name'] + '</option>';
                        }
                    }
                    $district.html(options);
                });
            });

            /*]]>*/
        </script>

        <script th:inline="javascript" th:if="${person?.documentType?.countryId == T(com.affirm.common.model.catalog.CountryParam).COUNTRY_ARGENTINA}">
            /*<![CDATA[*/
            $province = $("#frmUpdatePersonAddressModal select[name=provincia]");
            $district = $("#frmUpdatePersonAddressModal select[name=distrito]");

            $province.on('change', function () {
                defaultAjax({
                    url: /*[[@{/catalog/generalDistrict/json}]]*/null,
                    data: {
                        provinceId: $(this).val()
                    },
                    type: 'POST',
                    success: function (data) {
                        var arr = JSON.parse(data);
                        var html = '<option value="" hidden="hidden"></option>';
                        var len = arr.length;
                        for (var i = 0; i < len; i++) {
                            html += '<option value="' + arr[i].districtId + '">' + arr[i].name + '</option>';
                        }
                        $district.html(html);
                    },
                    error: function (data) {
                        showErrorModal('Hubo un problema al obtener las provincias.');
                    }
                });
            });

            /*]]>*/
        </script>

        <script th:inline="javascript">
            /*<![CDATA[*/

            // Setting validations
            var personAddressValidatorJson = /*[[${updatePersonAddressForm.validator.toJson(#locale)}]]*/null;
            if (personAddressValidatorJson != null) {
                jsonFormValidation = createFormValidationJson(JSON.parse(personAddressValidatorJson), $('#frmUpdatePersonAddressModal'));
                $('#frmUpdatePersonAddressModal').validateForm(jsonFormValidation);
            }

            // Mapa
            var addressLat = /*[[${updatePersonAddressForm?.latitude}]]*/null;
            var addressLon = /*[[${updatePersonAddressForm?.longitude}]]*/null;

            var defaultLat = /*[[${@countryContextService.getCountryDefaultMapLatitude(person?.documentType?.countryId)}]]*/null;
            var defaultLon = /*[[${@countryContextService.getCountryDefaultMapLongitude(person?.documentType?.countryId)}]]*/null;

            var personAddressMap = new google.maps.Map(document.getElementById('personAddressMap'), {
                center: addressLat != null && addressLon != null ? {
                    lat: addressLat,
                    lng: addressLon
                } : {lat: defaultLat, lng: defaultLon},
                zoom: 14
            });

            // Marker IP
            var addressLocationMarker = new google.maps.Marker({
                map: personAddressMap,
                icon: 'https://maps.google.com/mapfiles/ms/micons/purple.png',
                draggable: true,
                animation: google.maps.Animation.DROP,
                position: addressLat != null && addressLon != null ? {
                    lat: addressLat,
                    lng: addressLon
                } : {lat: defaultLat, lng: defaultLon}
            });
            addressLocationMarker.addListener('dragend', function (event) {
                console.log("dragend: " + event.latLng.lat() + " - " + event.latLng.lng())
                $("#frmUpdatePersonAddressModal input[name=latitude]").val(event.latLng.lat());
                $("#frmUpdatePersonAddressModal input[name=longitude]").val(event.latLng.lng());
            });

            // DIspara el Resize del mapa despues de 1000ms
            setTimeout(function () {
                google.maps.event.trigger(personAddressMap, "resize");
                if (addressLat != null && addressLon != null) {
                    personAddressMap.setCenter(new google.maps.LatLng(addressLat, addressLon))
                }
            }, 1000);

            var mapLocation;
            var marker;
            var autocomplete;
            var autocompletedPlace = false;

            // Init the searchbox
            autocomplete = new google.maps.places.Autocomplete(
                (document.getElementById('address')), {
                    types: ['geocode'],
                    radius: 500
                });

            var countryString = /*[[${@countryContextService.getCountryStringCode(person?.documentType?.countryId)}]]*/null;

            autocomplete.setComponentRestrictions(
                {'country': [countryString]});


            autocomplete.addListener('place_changed', function () {
                mapLocation = null;
                addressLocationMarker.setVisible(false);

                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }
                var location = place.geometry.location;
                $("#latitude").val(location.lat());
                $("#longitude").val(location.lng());

                // If the place has a geometry, then present it on a map.
                if (place.geometry.viewport) {
                    personAddressMap.fitBounds(place.geometry.viewport);
                } else {
                    personAddressMap.setCenter(place.geometry.location);
                    personAddressMap.setZoom(14);  // Why 14? Because it looks good.
                }

                mapLocation = place.geometry.location;
                addressLocationMarker.setPosition(mapLocation);
                addressLocationMarker.setVisible(true);
                autocompletedPlace = true;
            });

            /*]]>*/
        </script>
    </th:block>

    <th:block th:fragment="downPayments">
        <dl class="dl-horizontal dl-loan-application">
            <th:block th:each="downPayment, iterDownPayment : ${credit?.downPaymentDetail}">
                <dt>Banco</dt>
                <dd th:text="${downPayment?.bank?.name}"></dd>
                <dt th:text="'Nro. ' + ${downPayment?.operationCode}"></dt>
                <dd th:text="${@utilService.doubleMoneyFormat(downPayment?.amount, downPaymentCurrencySymbol != null ? downPaymentCurrencySymbol : credit?.downPaymentCurrency?.symbol)}"></dd>
                <dt>Fecha de Operación</dt>
                <dd th:text="${@utilService.datetimeShortFormat(downPayment?.registerDate)}" th:attr="data-order=${@utilService.datetimeYearFirstFormat(downPayment?.registerDate)}"></dd>
            </th:block>
        </dl>
    </th:block>

    <th:block th:fragment="changeFirstDueDateModal">
        <div class="modal-body">
            <div class="row">
                <div class="col-md-12">
                    <p>Selecciona la nueva fecha del primer vencimiento. Al cambiar esta fecha, se generará y seleccionará una nueva oferta con los mismo parametros de la oferta seleccionada actualmente. Ademas se mandará la solicitud a la pantallade firma.</p>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <input id="loanFirstDueDate" type="text" class="form-control"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            <button id="loanFirstDueDateSaveBtn" type="button" class="btn btn-info">Guardar</button>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            // moment.locale("es");
            var enableDates = [[${enableDates}]];
            var defaultSelectedDate = [[${selectedDate}]];
            var loanApplicationId = [[${loanApplication.id}]];

            var jsonDatePicker = {
                format: 'DD/MM/YYYY',
                inline: true,
                sideBySide: true
            };
            if (enableDates != null) {
                for (i = 0; i < enableDates.length; i++) {
                    enableDates[i] = moment(enableDates[i], "DD/MM/YYYY");
                }
                jsonDatePicker.enabledDates = enableDates;
                jsonDatePicker.defaultDate = moment(defaultSelectedDate, "DD/MM/YYYY");
            }
            $('#loanFirstDueDate').datetimepicker(jsonDatePicker);
            $('#loanFirstDueDate').val(jsonDatePicker.defaultDate.format("DD/MM/YYYY"));
            $('#loanFirstDueDate').on('dp.change', function (event) {
                var formatted_date = event.date.format("DD/MM/YYYY");
                if (event.date) {
                    console.log('Date chosen: ' + event.date.format());
                }
            });
            $('#loanFirstDueDateSaveBtn').on('click', function (event) {
                defaultAjax({
                    url: /*[[@{/loanApplication/changeFirstDueDate}]]*/null,
                    data: {
                        loanApplicationId: loanApplicationId,
                        firstDueDate: $('#loanFirstDueDate').val()
                    },
                    type: 'POST',
                    success: function (data) {
                        $('#changeFirstDueDateModal').modal('hide');
                        refreshTabAjax('applications');
                    },
                    error: function (data) {
                        showErrorModal('Hubo un problema al obtener las provincias.');
                    }
                });
            });
            /*]]>*/
        </script>
    </th:block>
</div>

</body>
</html>
