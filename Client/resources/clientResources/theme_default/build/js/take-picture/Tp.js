function Tp(e){var i=$.extend({container:"#camera",userFileConfig:[],showThumbnails:!0,thumbnails:[],numPics:1,msgBottom:"",messages:[]},e),n=new MobileDetect(window.navigator.userAgent),t=0,o=1200,a=1200;function d(){!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?$("#takeButton").addClass("block-hidden"):$("#takeButton").removeClass("block-hidden"),$("#uploadButton").removeClass("block-hidden");var e,d,l=$('<div class="tp-wrap"></div>'),u=$("#buttons"),f=i.msgBottom?$('<div class="msg-block"><p id="msg">'+i.msgBottom+"</p></div>"):"",v=$('<div class="upload-block"><label for="upload" class="upload-box"><span class="box"><i class="icon icon-image-outline"></i><span class="text-white">Haz click dentro del recuadro para subir una foto</span></span><input type="file" id="upload" accept="image/*,application/pdf" '+(23==i.userFileConfig[t].id?'capture="camera':"")+' multiple="true"/></label></div>'),T=$('<div class="camera-block"><video id="camera-stream"></video><canvas></canvas><img id="snap"/><div class="controls-widgets"><a href="#" id="take-photo" title="Tomar foto" data-toggle="tooltip" data-placement="top" title="Tómate una foto"><i class="icon icon-camera"></i></a></div></div>'),x="",b=$("<ul></ul>");if(i.userFileConfig.length>1){i.userFileConfig.sort(g);for(var C=0;C<i.userFileConfig.length;C++)i.userFileConfig[C].index=C+1;for(C=0;C<i.userFileConfig.length;C++){p(i.userFileConfig[C].id);t==C&&(e=i.userFileConfig[C].id);var F='<li><label for="documentType-'+i.userFileConfig[C].id+'" class="h-input-radio '+(C==t?"radio-selected":"")+'"><input type="radio" name="documentType" class="documentType" id="documentType-'+i.userFileConfig[C].id+'" value="'+i.userFileConfig[C].id+'"/><div class="option-wrapper"><div class="iconic-option-inner"><div class="radio inline"></div><h5 class="inline">'+i.userFileConfig[C].index+"</h5></div></div></label></li>";b.append(F)}}$("#nextButton").addClass("block-hidden"),$("#sendButtonButton").addClass("block-hidden"),i.userFileConfig[t].required||$("#skipButton").removeClass("block-hidden"),console.info(i.userFileConfig);var P=23==i.userFileConfig[t].id?i.messages.selfie:i.messages.uploadDoc,B="";if(i.userFileConfig[t].showTooltip&&(B='<a href="#" id="open-modal-question60"> aquí</a>',$("#modalTituloQuestion_60").text(i.userFileConfig[t].name),$("#modalMessageQuestion_60").html(i.userFileConfig[t].tooltip)),f=$('<div class="msg-block"><p id="msg">'+P+B+"</p></div>"),l.append(f),i.userFileConfig[t].showImage&&l.append('<div class="image"><img src= "'+system.contextPath+"/img/"+i.userFileConfig[t].thumbnail+'"></div>'),23!=i.userFileConfig[t].id){var A=i.userFileConfig[t].required?"":'<span required="">(no obligatorio)</span>';l.append('<div class="status">'+i.userFileConfig[t].name.toUpperCase()+A+"</div>")}d=$('<div class="main-inputs"></div>').append(b),x=m()?l.append(d,f):l.append(d),$(i.container).html(x),$(".documentType").on("change",function(){var o,a;if($(this).closest(".main-inputs").addClass("block-hidden"),!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?(l.html(v),$("#upload").on("change",function(){h($(this)[0],e),t+1==i.userFileConfig.length?($("#nextButton").addClass("block-hidden"),$("#sendButton").removeClass("block-hidden")):($("#nextButton").removeClass("block-hidden"),$("#sendButton").addClass("block-hidden"))})):u.append('<a href="#" class="anchor-button bg-red tpAction" data-target="take">Tomar una foto</a><a href="#" class="anchor-button bg-white tpAction" data-target="upload">Subir foto</a>'),null!=i.userFileConfig.length)for(a=0;a<i.userFileConfig.length;a++)i.userFileConfig[a].id==e&&(o="Sube o toma una foto de "+i.userFileConfig[a].name.toLowerCase());f=$('<div class="msg-block"><p id="msg">'+o+"</p><span></span></div>"),l.append(f)}),$("#upload").on("change",function(){h($(this)[0],e),t+1==i.userFileConfig.length?($("#nextButton").addClass("block-hidden"),$("#sendButton").removeClass("block-hidden")):($("#nextButton").removeClass("block-hidden"),$("#sendButton").addClass("block-hidden"))}),$(".main-buttons").unbind("click"),$(".main-buttons").on("click",".tpAction",function(d){switch(d.preventDefault(),$(this).data("target")){case"take":console.log("target consultando take or upload"),$("#uploadButton").addClass("c-hidden"),$("#takeButton").addClass("c-hidden"),l.html(T);var u=23==i.userFileConfig[t].id?i.messages.selfie:i.messages.uploadDoc;f=$('<div class="msg-block"><p id="msg">'+u+"</p><span></span></div>"),l.append(f),navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}).then(function(e){c=document.querySelector("#camera-stream");try{c.srcObject=e}catch(i){c.src=window.URL.createObjectURL(e)}s=e,c.play()}).catch(function(e){console.log("There was an error with accessing the camera stream: "+e.name,e)}),$("#take-photo").on("click",function(){d.preventDefault(),function(o,a,d){$("canvas")[0].getContext("2d");var s=c.videoWidth,l=c.videoHeight;s<a?(a=s,d=l):d=a*(l/s);var u,g,h=document.createElement("img");h.onload=function(){u=document.createElement("canvas"),g=u.getContext("2d"),u.width=a,u.height=d,g.drawImage(this,0,0,a,d),r(u.toDataURL("image/jpeg",.7),e),t+1==i.userFileConfig.length?($("#nextButton").addClass("block-hidden"),$("#sendButton").removeClass("block-hidden")):($("#nextButton").removeClass("block-hidden"),$("#sendButton").addClass("block-hidden")),!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?$("#takeButton").addClass("c-hidden"):$("#takeButton").removeClass("c-hidden"),$("#uploadButton").removeClass("c-hidden")},h.src=o}(function(){var e=$("canvas")[0],i=e.getContext("2d"),n=c.videoWidth,t=c.videoHeight;if(n&&t)return e.width=n,e.height=t,i.drawImage(c,0,0,n,t),e.toDataURL("image/jpeg")}(),o,a)}),updateBranding();break;case"upload":$("#uploadButton").addClass("c-hidden"),$("#takeButton").removeClass("c-hidden"),l.html(v);u=23==i.userFileConfig[t].id?i.messages.selfie:i.messages.uploadDoc;f=$('<div class="msg-block"><p id="msg">'+u+"</p><span></span></div>"),l.append(f),$("#upload").on("change",function(){this.files[0].size<10485760?h($(this)[0],e):showErrorModal("El archivo tiene un tamaño más grande que el permitido")}),updateBranding()}}),i.userFileConfig[t].showTooltip&&($("#open-modal-question60").on("click",function(e){e.preventDefault(),self.openMsg1Modal(),$("#modal_msg_question60").modal("show"),console.log("lanzó el modal")}),this.openMsg1Modal=function(){$("#modal_msg_question60").modal("show")}),c&&E(),23==i.userFileConfig[t].id&&(!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?$("#uploadButton").click():$("#takeButton").click(),updateBranding()),updateBranding()}this.init=function(){d(),m(),console.log("Compatibility: "+m())},this.uploadPictures=function(e){!function(e){for(var n=0;n<i.userFileConfig.length;n++)if(i.userFileConfig[n].required){var t=p(i.userFileConfig[n].id);if(0==t.length)return void showErrorModal("Falta subir documentacion obligatoria para "+i.userFileConfig[n].name)}for(var o=[],n=0;n<u.length;n++)null==u[n].uploaded&&(u[n].uploaded=!1),u[n].uploaded||o.push(n);!function e(i,n){if(i.length>0){var t=u[i[0]],o=new FormData;o.append("file",t.image),o.append("userFileType",t.userFileType),questionFw.ajaxToCurrentQuestionController({type:"POST",data:o,cache:!1,contentType:!1,processData:!1,success:function(t){i.splice(0,1),e(i,n)}},"userfile")}else null!=n&&n()}(o,e)}(e)},$("#nextButton").on("click",function(){t++,$("#nextButton").addClass("block-hidden"),$("#sendButtonButton").addClass("block-hidden"),$("#skipButton").addClass("block-hidden"),d(),c&&E(),updateBranding()}),$("#skipButton").on("click",function(){$("#nextButton").addClass("block-hidden"),$("#sendButtonButton").addClass("block-hidden"),$("#skipButton").addClass("block-hidden"),++t!=i.userFileConfig.length?(d(),c&&E(),updateBranding()):$("#sendButton").click()});var s,l,c="",u=[];function r(e,n){l=!1;var t=p(n=null==n?i.userFileConfig[0].id:n),o=function(e){for(var n=0;n<i.userFileConfig.length;n++)if(e==i.userFileConfig[n].id)return i.userFileConfig[n]}(n),a={userFileType:n,image:e,fileName:""},s=e.split(";")[0].split("/")[1];return-1==$.inArray(s,["jpg","jpeg","png","pdf","JPG","JPEG","PNG","PDF"])?(showErrorModal("El formato del archivo no es v&aacute;lido"),void(l=!0)):t.length>=o.maxFiles?(showErrorModal("Maximo de im&aacute;genes"),void(l=!0)):(u.push(a),d(),void function(){for(var e,n=$('<div id="thumbs-block" class="thumbs-block"></div>'),t=$("<ul></ul>"),o="",a=0;a<u.length;a++){var s=u[a],l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAU8AAAFOCAYAAAAGkZ9XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzYwMTdDNkY0N0UxMTFFOEFGRjhCQUJEQjU4N0U2NjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzYwMTdDNzA0N0UxMTFFOEFGRjhCQUJEQjU4N0U2NjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDNjAxN0M2RDQ3RTExMUU4QUZGOEJBQkRCNTg3RTY2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDNjAxN0M2RTQ3RTExMUU4QUZGOEJBQkRCNTg3RTY2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pp36gEUAAA1USURBVHja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",c=s.image.split(";")[0].split("/")[1];"pdf"!=c?(l=s.image,o='<li id="thumb-'+a+'"><div class="circle"><img src=" '+l+' "/><button class="delete-pic" data-index="'+a+'"><i class="icon icon-close"></i></button></div></li>'):o='<li id="thumb-'+a+'"><div class="circle"><img class="pdf-result" src=" '+l+' "/><button class="delete-pic" data-index="'+a+'"><i class="icon icon-close"></i></button></div></li>',t.html(o)}$("#takeButton").addClass("block-hidden"),$("#uploadButton").addClass("block-hidden"),e=n.html(t),$(i.container).find("#thumbs-block").remove(),$(i.container).append(e),$(".delete-pic").on("click",function(e){e.preventDefault(),function(e){u.splice(e,1),$("#sendButton").addClass("block-hidden"),$("#nextButton").addClass("block-hidden");for(var i=0;i<u.length;i++)u[i]===e&&u.splice(i,1)}($(this).data("index")),d()})}())}function g(e,i){var n=e.order,t=i.order,o=0;return n>t?o=1:n<t&&(o=-1),o}function h(e,d){if(e.files&&e.files[0])for(var s=0;s<e.files.length;s++){var c=new FileReader;c.onload=function(e){var s,c,u,g,h;"pdf"!=e.target.result.split(";")[0].split("/")[1]?(s=e.target.result,c=o,u=a,g=d,(h=new Image).onload=function(){ratio=h.height/h.width,h.width<c?(c=h.width,u=h.height):u=c*ratio;var e,o,a=document.createElement("img");a.onload=function(){e=document.createElement("canvas"),o=e.getContext("2d"),e.width=c,e.height=u,o.drawImage(this,0,0,c,u),r(e.toDataURL("image/jpeg",.7),g),t+1==i.userFileConfig.length?($("#nextButton").addClass("block-hidden"),$("#sendButton").removeClass("block-hidden")):(0==l?$("#nextButton").removeClass("block-hidden"):$("#nextButton").addClass("block-hidden"),$("#sendButton").addClass("block-hidden")),$("#uploadButton").removeClass("c-hidden"),!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?$("#takeButton").addClass("c-hidden"):$("#takeButton").removeClass("c-hidden")},a.src=s},h.src=s):(r(e.target.result,d),t+1==i.userFileConfig.length?($("#nextButton").addClass("block-hidden"),$("#sendButton").removeClass("block-hidden")):(0==l?$("#nextButton").removeClass("block-hidden"):$("#nextButton").addClass("block-hidden"),$("#sendButton").addClass("block-hidden")),$("#uploadButton").removeClass("c-hidden"),!m()||n.mobile()||"AndroidOS"==n.os()||"iOS"==n.os()?$("#takeButton").addClass("c-hidden"):$("#takeButton").removeClass("c-hidden"))},c.readAsDataURL(e.files[s])}}function p(e){for(var i=[],n=0;n<u.length;n++)e==u[n].userFileType&&i.push(u[n]);return i}function m(){return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia}function E(){c.pause(),c.src="",s.getVideoTracks().forEach(function(e){e.stop()})}}