function takePicture(){function e(){return r(o())}function t(){navigator.getMedia({video:!0},function(e){n.src=window.URL.createObjectURL(e),localStream=e,n.play(),n.onplay=function(){i()}},function(e){a("There was an error with accessing the camera stream: "+e.name,e)})}function i(){s(),n.classList.add("visible"),u.classList.add("visible")}function o(){var e=document.querySelector("canvas"),t=e.getContext("2d"),i=n.videoWidth,o=n.videoHeight;if(i&&o)return e.width=i,e.height=o,t.drawImage(n,0,0,i,o),e.toDataURL("image/jpeg")}function r(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return new Blob([o],{type:i})}function a(e,t){t=t||"",t&&console.log(t),d.innerText=e,s(),d.classList.add("visible")}function s(){u.classList.remove("visible"),l.classList.remove("visible"),n.classList.remove("visible"),snap.classList.remove("visible"),d.classList.remove("visible")}var n=document.querySelector("#camera-stream"),c=document.querySelector("#snap"),l=document.querySelector("#start-camera"),u=document.querySelector(".controls"),d=(document.querySelector("#take-photo"),document.querySelector("#delete-photo"),document.querySelector("#download-photo"),document.querySelector("#save-photo"),document.querySelector("#error-message"));this.checkCompatibility=function(){return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!!navigator.getMedia},this.startCamera=function(){this.checkCompatibility()?(n.play(),t(),i()):a("Browser doesn't support this feature!")},this.takePhoto=function(t){var i=o(),r=document.querySelector(t);return t&&r.setAttribute("src",i),c.setAttribute("src",i),c.classList.add("visible"),e()},this.deletePhoto=function(){c.setAttribute("src",""),c.classList.remove("visible"),n.play()},this.stopStream=function(){console.log("stop called"),n.pause(),n.src="",localStream.getVideoTracks().forEach(function(e){e.stop()})}}var localStream;