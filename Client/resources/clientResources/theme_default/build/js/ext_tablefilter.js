function TableFilter(t,e){var a=this;this.portlet=t,this.filters=[],this.resultsContainer=null,this.limit=e,this.offset=0,this.init=function(){a.portlet.find(".tablefilter-action-button").click(this.openFilters),a.portlet.find(".tablefilter-action-button-clean").click(this.removeFilters),a.tablePaginatorInfoDiv=$('<div class="table-paginator-info" style="display: inline-block;vertical-align: top;margin-top: .5em;margin-right: 1em;"></div>'),a.tablePaginatorDiv=$('<div class="table-paginator paging_bootstrap_number" style="display: inline-block;vertical-align: top;"><ul class="pagination pull-right" style="margin: 0px;"><li class="page-first"><a href="#" title="Primero"><i class="fa fa-angle-double-left"></i></a></li><li class="page-pre"><a href="#" title="Previos"><i class="fa fa-angle-left"></i></a></li><li class="page-next"><a href="#" title="Siguientes"><i class="fa fa-angle-right"></i></a></li><li class="page-last"><a href="#" title="Ãšltimo"><i class="fa fa-angle-double-right"></i></a></li></ul></div>');var t=a.portlet.find(".portlet-title").find(".actions");t.length||(t=$('<div class="actions"></div>'),a.portlet.find(".portlet-title").append(t)),t.append(a.tablePaginatorInfoDiv),t.append(a.tablePaginatorDiv),a.tablePaginatorDiv.find(".page-next > a").click(this.next),a.tablePaginatorDiv.find(".page-last > a").click(this.last),a.tablePaginatorDiv.find(".page-pre > a").click(this.pre),a.tablePaginatorDiv.find(".page-first > a").click(this.first),a.refreshInfo()},this.openFilters=function(){a.portlet.find(".tablefilter-filters").fadeIn(500),a.portlet.find(".actions").not(".tablefilter-actions").hide(),a.portlet.find(".actions").parent().append($("<div></div>").fadeIn(500).addClass("actions tablefilter-actions").append($('<a href="javascript:;" class="btn btn-circle btn-default"><i class="fa fa-times"></i> Cancelar</a>').click(a.closeFilters)).append($('<a href="javascript:;" class="btn btn-circle btn-default"><i class="fa fa-check"></i> Aplicar Filtros</a>').click(a.applyFilters))),$("#creationFromFilter").val(moment().format("DD/MM/YYYY")),$("#creationToFilter").val(moment().format("DD/MM/YYYY")),$("#creationFromFilter").datepicker("endDate",moment().toDate()),$("#creationFromFilter").datepicker("update"),$("#creationToFilter").datepicker("endDate",moment().toDate()),$("#creationToFilter").datepicker("update")},this.closeFilters=function(){a.portlet.find(".tablefilter-filters").hide(),a.portlet.find(".tablefilter-actions").hide(),a.portlet.find(".actions").not(".tablefilter-actions").fadeIn(500),a.portlet.find(".tablefilter-actions").remove(),a.portlet.find(".tablefilter-filters").find("form").find("select,input").each(function(){$(this).val("")})},this.applyFilters=function(){var t=a.getFormFilters();a.filters=$.merge(a.filters,t),a.callBackend()},this.loadData=function(t){var e={},i=$("#credits-tab");if(i){var l=i.find("[aria-expanded=true]").data("tab");e.tabId=void 0===l?1:l}for(var n=0;n<a.filters.length;n++)null==e[a.filters[n].name]&&(e[a.filters[n].name]=[]),e[a.filters[n].name][e[a.filters[n].name].length]=a.filters[n].value;var r=a.portlet.find(".tablefilter-filters").find("form");window.filters=a.filters,e.offset=t,e.limit=a.limit,e.listSize=$("#listSize").attr("paginator-total"),console.log("Se va a mandar: "+e),void 0!==window.assistedProcess&&(e.assistedProcess=window.assistedProcess),defaultAjax({url:r.attr("action"),type:r.attr("method"),data:e,success:function(e){a.portlet.find("#table").html(e),a.paintFilters(),a.closeFilters(),a.offset=t,a.refreshInfo()}})},this.callBackend=function(){var t={};$(".nav.nav-tabs.pull-left").find("a").each(function(e,a){null==$(this).attr("aria-expanded")&&(t.collectionManagement="true"),"true"==$(this).attr("aria-expanded")&&(t.collectionManagement=$(this).attr("data-management"))});for(var e=0;e<a.filters.length;e++)null==t[a.filters[e].name]&&(t[a.filters[e].name]=[]),t[a.filters[e].name][t[a.filters[e].name].length]=a.filters[e].value;var i=a.portlet.find(".tablefilter-filters").find("form");console.log("Se va a mandar: "+i.serialize()),defaultAjax({url:i.attr("action"),type:i.attr("method"),data:t,success:function(t){a.portlet.find("#tableResults tbody").html(t),a.paintFilters(),a.closeFilters()}})},this.getFormFilters=function(){var t=[];return a.portlet.find(".tablefilter-filters").find("form").find("select,input").each(function(){if(""!=$(this).val()){var e={};"select"==$(this).prop("tagName").toLowerCase()?(e.label=$(this).find("option:selected").text(),e.value=$(this).val(),e.name=$(this).attr("name"),$(this).find("option:selected").prop("disabled",!0)):"input"==$(this).prop("tagName").toLowerCase()&&(e.label=$(this).val(),e.value=$(this).val(),e.name=$(this).attr("name")),t[t.length]=e}}),console.log(t),t},this.paintFilters=function(){var t=a.portlet.find(".portlet-body").find("#filterTagsContainer");if(t.length>0&&t.remove(),a.filters.length>0){t=$('<div id="filterTagsContainer" style="margin-bottom: 10px">Filtrado por </div>');for(var e=0;e<a.filters.length;e++)t.append($('<span class="label label-info" style="margin-right: 4px;">'+a.filters[e].label+" </span>").append($('<a href="javascript:;" data-filter-index="'+e+'"><i class="fa fa-times"  style="color:white"></i></a>').click(function(){console.log($(this)),console.log($(this).attr("data-filter-index")),a.removeFilter($(this).attr("data-filter-index"))})));a.portlet.find(".portlet-body").prepend(t)}},this.removeFilter=function(t){a.portlet.find('select[name="'+a.filters[t].name+'"]').length>0&&a.portlet.find('select[name="'+a.filters[t].name+'"] option[value="'+a.filters[t].value+'"]').prop("disabled",!1),a.filters.splice(t,1),a.callBackend()},this.next=function(){var t;console.log("offset "+a.offset+" "+a.limit+" "+a.total),a.offset+a.limit>a.total?console.log("No next is available"):(t=a.offset+a.limit,a.loadData(t))},this.first=function(){0!=a.offset?(0,a.loadData(0)):console.log("You are already in the first page")},this.last=function(){var t;if(a.offset+a.limit>a.total)console.log("You are already in the last page");else{for(t=a.offset;t+a.limit<a.total;)t+=a.limit;a.loadData(t)}},this.pre=function(){var t;0!=a.offset?(t=a.offset-a.limit<0?0:a.offset-a.limit,a.loadData(t)):console.log("No pre is available")},this.refreshInfo=function(){var t=a.portlet.find(".table:first > tbody");void 0!==t.data("table-paginator-total")?a.total=t.data("table-paginator-total"):a.total=0,a.total>0?a.tablePaginatorInfoDiv.html("<b>"+(a.offset+1)+"</b>-<b>"+(a.offset+a.limit>a.total?a.total:a.offset+a.limit)+"</b> de <b>"+a.total+"</b>"):(a.tablePaginatorInfoDiv.html("No hay resultados"),a.tablePaginatorDiv.find("button")),0==a.offset?(a.tablePaginatorDiv.find(".page-pre").addClass("disabled"),a.tablePaginatorDiv.find(".page-first").addClass("disabled")):(a.tablePaginatorDiv.find(".page-pre").removeClass("disabled"),a.tablePaginatorDiv.find(".page-first").removeClass("disabled")),a.offset+a.limit>=a.total?(a.tablePaginatorDiv.find(".page-next").addClass("disabled"),a.tablePaginatorDiv.find(".page-last").addClass("disabled")):(a.tablePaginatorDiv.find(".page-next").removeClass("disabled"),a.tablePaginatorDiv.find(".page-last").removeClass("disabled"))},this.init()}$(document).ready(function(){$(".tablefilter").each(function(){$(this).data("tablefilter",new TableFilter($(this),200))})});