function QuestionFramework(e){this.TYPE_SELFEVALUATION=1,this.TYPE_EVALUATION=2,this.TYPE_COMPARISON=3,this.SELFEVALUATION_URL="autoevaluacion",this.EVALUATION_URL="evaluacion",this.COMPARISON_URL="compara";var r=this;this.token,this.type,this.currentQuestion,this.categoryUrl,this.agent,this.externalParams,this.questionContainer=e,this.errorContainer,this.urlUpdateAmountInstallments,this.loggable=!1,this.brandingPrimaryColor,this.brandingSecundaryColor,this.branding=!1,this.globalUserNameForZendesk=null,this.globalUseeEmailForZendesk=null,this.showZendeskChatTimeout=12e4,this.pushNotificationUserId=null,this.pushNotificationsQuestionsToTrigger=[],this.goToQuestion=function(e){r.currentQuestion=e;r.questionContainer.outerHeight()<200||r.questionContainer.outerHeight();r.questionContainer.html('<div class="process-loading-container circle-progress-question"> <div class="loading-content"> <div class="sk-fading-circle"> <div class="sk-circle1 sk-circle"><span></span></div><div class="loading-indicator sk-circle2 sk-circle"><span></span></div><div class="sk-circle3 sk-circle"><span></span></div><div class="sk-circle4 sk-circle"><span></span></div><div class="sk-circle5 sk-circle"><span></span></div><div class="sk-circle6 sk-circle"><span></span></div><div class="sk-circle7 sk-circle"><span></span></div><div class="sk-circle8 sk-circle"><span></span></div><div class="sk-circle9 sk-circle"><span></span></div><div class="sk-circle10 sk-circle"><span></span></div><div class="sk-circle11 sk-circle"></div></div><span class="loading-text">Cargando<span>.</span><span>.</span><span>.</span></span> </div></div>'),updateBranding(),setTimeout(function(){r.sendBeaconPushNotification(null)},15e3);var t={url:system.contextPath+"/"+r.getUrlByType()+"/question/"+e,type:"GET",data:{},success:function(e){r.replaceQuestionContent(e)},error:function(e,t){return r.questionContainer.html(""),null!=r.errorContainer&&r.errorContainer.show(),!1}};null!=r.externalParams&&(t.data.externalParams=r.externalParams),null!=r.token?t.data.token=r.token:(null!=r.agent&&(t.data.agent=r.agent),null!=r.categoryUrl&&(t.data.categoryUrl=r.categoryUrl)),r.defaultProcessQuestionAjax(t)},this.replaceQuestionContent=function(e){null!=r.errorContainer&&r.errorContainer.hide(),r.questionContainer.html(e),$("#questionModals").html(""),r.questionContainer.find(".modal").each(function(){$(this).detach().appendTo("#questionModals")});var t=r.questionContainer.find("#questionConfiguration");if(null!=t){if(r.globalUserNameForZendesk=t.data("user-name"),r.globalUserEmailForZendesk=t.data("user-email"),r.showHideAgent(t.data("show-agent")),r.showHideUpdateModal(t.data("show-application-update-modal"),t.data("show-offer-update-modal")),r.showGoBack(t.data("show-go-back")),r.showPreApproved(t.data("show-pre-approved"),t.data("show-pre-approved-message")),r.showOfferMedal(t.data("show-offer-modal")),t.data("show-name-email")&&r.showEmailName(t.data("user-email"),t.data("user-name")),null!=t.data("percentage")?r.paintProgress(t.data("percentage"),t.data("question-catgory")):r.paintProgress(0,1),null!=t.data("force-vehicle-modal-show")&&t.data("force-vehicle-modal-show")&&r.openUpdateModal(),null!=t.data("hotjar-id")&&this.tagRecording(t.data("hotjar-id")),50===r.currentQuestion&&0===$(".q50 .offer-container").length?r.shouldShowZendeskChat(!1):(null!=t.data("showZendeskWidget")&&(console.log("shouldShowZendeskChat",t.data("showZendeskWidget")),r.shouldShowZendeskChat(t.data("showZendeskWidget"))),null!=t.data("showZendeskWidget")&&!0===t.data("showZendeskWidget")&&(console.log("timeoutCountDown"),r.timeoutCountDown())),console.log("A1"),86===r.currentQuestion||95===r.currentQuestion)console.log("A"),$(".loan-process").addClass("new-loan-process");else $(".loan-process").hasClass("new-loan-process").removeClass("new-loan-process");50===r.currentQuestion&&1===$(".q50 .offer-container").length?$("#processHeaderAmount").css("visibility","visible"):$("#processHeaderAmount").css("visibility","hidden"),(4===t.data("question-catgory")&&50===r.currentQuestion||5===t.data("question-catgory")||6===t.data("question-catgory")||7===t.data("question-catgory"))&&r.pushNotificationsQuestionsToTrigger.push(r.currentQuestion),7===t.data("question-catgory")&&(r.pushNotificationUserId=null),null!==r.isMobile.any()&&setTimeout(function(){7===t.data("question-catgory")&&(r.pushNotificationUserId=null),r.sendBeaconPushNotification(r.pushNotificationUserId)},15e3),t.data("document-title")&&(document.title=customDocumentTitle),t.remove()}r.initializeFormInputs(),1==r.questionContainer.find("form").find("input[type=text]").length&&r.questionContainer.find("form").prepend($('<input type="text" name="dummyInput" style="display: none"/>'));var n=$("#offer-carousel");n.doOnce(function(){n.owlCarousel({items:3,navText:['<i class="icon icon-control-prev"></i>','<i class="icon icon-control-next"></i>'],responsiveClass:!0,responsive:{0:{items:1,nav:!0},568:{items:2,nav:!0},1200:{items:3,nav:!0}}})}),$("#reason-carousel").doOnce(function(){$("#reason-carousel").owlCarousel({items:4,navText:['<i class="icon icon-control-prev"></i>','<i class="icon icon-control-next"></i>'],responsiveClass:!0,responsive:{0:{items:1,nav:!0},600:{items:1,nav:!0},1e3:{items:4,nav:!0}}})}),$("label.custom-check").on("change",".real-check",function(){$(this).checked()}),$("label.h-input-check").on("change",".checkbox",function(){$(this).checkbox()}),$("select").each(function(){$(this).select2({minimumResultsForSearch:-1,placeholder:$(this).data("placeholder"),width:$(this).data("width")+"px"})}),$(".input-radio, .h-input-radio").radio(),r.loggable&&($("#logDiv").remove(),$('<div id="logDiv" style="position: fixed;z-index: 99999999;right:0;bottom:0; font-size: 12px; background:#e9e9e9;">Pregunta: '+r.currentQuestion+"</div>").appendTo("body")),updateBranding(),r.updateETAmessage(r.currentQuestion,t.data("question-catgory"))},this.timeoutCountDown=function(){var e;function t(){clearTimeout(e),void 0===sessionStorage.wasContacted&&(e=setTimeout(r.contactZendesk,r.showZendeskChatTimeout))}t(),window.onloadstart=t,window.onmousemove=t,window.onmousedown=t,window.ontouchstart=t,window.onclick=t,window.onkeypress=t,window.addEventListener("scroll",t,!0)},this.contactZendesk=function(){"undefined"!=typeof zE&&(console.log("contactZendesk"),sessionStorage.wasContacted="true",zE("webWidget","setLocale","es"),zE("webWidget","chat:send","Solven, solicitud de asesoría"),zE("webWidget","identify",{name:r.globalUserNameForZendesk,email:r.globalUserEmailForZendesk}),zE("webWidget","open"))},this.shouldShowZendeskChat=function(e){"undefined"!=typeof zE&&(e?(zE("webWidget","setLocale","es"),zE("webWidget","close"),zE("webWidget","updateSettings",{webWidget:{chat:{suppress:!1}}})):zE("webWidget","updateSettings",{webWidget:{chat:{suppress:!0}}}))},this.updateETAmessage=function(e,t){var n="Estimado<br/>3 min.";83===e?n="&iexcl;Con esto <br/>Finalizamos&excl;":(null!=t&&0<t&&(6===t||7===t)||isEfectivoAlToque)&&(n=""),$(".estimated").eq(0).html(n)},this.initializeFormInputs=function(){r.questionContainer.find(".input-outline, .selec2-item").on("keyup select2:select",function(e){if(13==e.keyCode)return $(this).closest(".questions-section").find(".button").click(),e.preventDefault(),!1})},this.refreshQuestion=function(){r.goToQuestion(r.currentQuestion)},this.backwards=function(){var e={url:system.contextPath+"/"+r.getUrlByType()+"/backwards",type:"POST",data:{},error:function(){return showErrorModal("No puedes volver atrás"),!1}};null!=r.token&&(e.data.token=r.token),r.defaultProcessQuestionAjax(e)},this.updateLoanApplication=function(e){e.url=system.contextPath+"/"+r.getUrlByType()+"/updateLoanApplication",null==e.data&&(e.data={}),null!=r.token&&(e.data.token=r.token),r.defaultProcessQuestionAjax(e)},this.updateLoanApplicationVehicle=function(e){e.url=system.contextPath+"/"+r.getUrlByType()+"/updateLoanApplicationVehicle",null==e.data&&(e.data={}),null!=r.token&&(e.data.token=r.token),r.defaultProcessQuestionAjax(e)},this.updateLoanOffer=function(e){e.url=system.contextPath+"/"+r.getUrlByType()+"/updateLoanOffer",null==e.data&&(e.data={}),null!=r.token&&(e.data.token=r.token),r.defaultProcessQuestionAjax(e)},this.ajaxToCurrentQuestionController=function(e,t){e.url=system.contextPath+"/"+r.getUrlByType()+"/question/"+r.currentQuestion+"/"+t,null==e.data&&(e.data={}),null!=r.token?e.data.constructor==FormData?e.data.append("token",r.token):e.data.constructor=={}.constructor&&(e.data.token=r.token):null!=r.externalParams&&(e.data.constructor==FormData?e.data.append("externalParams",r.externalParams):e.data.constructor=={}.constructor&&(e.data.externalParams=r.externalParams)),r.defaultProcessQuestionAjax(e)},this.defaultProcessQuestionAjax=function(n){null!=n.showLoadingBar&&!n.showLoadingBar||(r.branding&&null!=r.brandingPrimaryColor?addMask(r.brandingPrimaryColor,gradientOfHexaColors(r.brandingPrimaryColor,"#FFFFFF")):addMask()),null!=n.button&&n.button.loading("",2);var o=[];if(o[o.length]=function(e){if(null!=n.button)try{n.button.unloading()}catch(e){}if(isJsonString(e)){var t=JSON.parse(e);if(null!=t.token&&(r.token=t.token,window.history.pushState(null,null,system.contextPath+"/"+(r.type==r.TYPE_EVALUATION?r.categoryUrl+"/":"")+r.getUrlByType()+"/"+r.token)),null!=t.type&&"processQuestion"==t.type&&null!=t.goto)return null!=a&&a(e),r.goToQuestion(t.goto),!1}unMask()},null!=n.success){var t=n.success;o[o.length]=function(e){return t(e)}}var s,e,a=null;null!=n.successBeforeChangeQuestion&&(a=n.successBeforeChangeQuestion),n.success=function(e){for(i=0;i<o.length;i++){var t=o[i](e);if(null!=t&&!t)break}},null!=n.error&&(s=n.error),n.error=function(e,t){if(unMask(),null!=n.button)try{n.button.unloading()}catch(e){}if(null!=s)return s(e,t)},null!==n.complete&&(e=n.complete),n.complete=function(){if(setTimeout(function(){$(".circle-progress").hide()},1e3),null!=e)return e()},defaultAjax(n)},this.init=function(){null!=r.errorContainer&&r.errorContainer.hide(),r.showHideAgent(!1),r.goToQuestion(r.currentQuestion)},this.validateForm=function(e,t){var n=createFormValidationJson(t,e,{errorPlacement:function(e,t){t.closest(".field").find(".errorContainer").length?e.appendTo(t.closest(".field").find(".errorContainer")):e.appendTo(t.closest("form").find(".errorContainer"))}});e.validateForm(n)},this.resetUrl=function(){window.history.pushState(null,null,system.contextPath+"/"+(r.type==r.TYPE_EVALUATION?r.categoryUrl+"/":"")+r.getUrlByType()+(null!=r.token?"/"+r.token:""))},this.setUrl=function(e){""!==e&&(e+="/");var t="";null!=r.token&&(t=r.token),path=system.contextPath+"/"+(r.type==r.TYPE_EVALUATION?r.categoryUrl+"/":"")+r.getUrlByType()+"/"+e+t,window.history.pushState(null,null,path)},this.showHideAgent=function(e){e?$(".adviser-section").show():$(".adviser-section").hide()},this.showHideUpdateModal=function(e,t){e||t?(r.urlUpdateAmountInstallments=e?system.contextPath+"/"+r.categoryUrl+"/"+r.EVALUATION_URL+"/"+r.token+"/updateLoanApplication":system.contextPath+"/"+r.categoryUrl+"/"+r.EVALUATION_URL+"/"+r.token+"/updateLoanOffer",r.refreshAmountAndInstallments()):$(".edit-amount-box").hide()},this.showGoBack=function(e){e?$("#anchor-back").css("display","flex"):$("#anchor-back").css("display","none")},this.showEmailName=function(e,t){$("#contactFullName").val(t),$("#contactEmail").val(e)},this.showHideToky=function(e,t){e?$("#toky-iframe-content").css({display:"block"}):$("#toky-iframe-content").css({display:"none"})},this.refreshAmountAndInstallments=function(e){null!=r.token&&defaultAjax({url:system.contextPath+"/"+r.categoryUrl+"/"+r.EVALUATION_URL+"/"+r.token+"/amountAndInstallments",type:"GET",success:function(e){$("#processHeaderAmount").html(e),$(".edit-amount-box").show(),$("#edit-loan").off("click"),$("#edit-loan").on("click",function(e){e.preventDefault(),r.openUpdateModal()}),updateBranding()}})},this.openUpdateModal=function(){$("#edit-modal").modal({backdrop:"static",keyboard:!1,show:!0}),$("#edit-modal").html(""),$("#edit-modal").defaultLoad(r.urlUpdateAmountInstallments,null,function(){updateBranding()})},this.getUrlByType=function(){return r.type==r.TYPE_SELFEVALUATION?r.SELFEVALUATION_URL:r.type==r.TYPE_EVALUATION?r.EVALUATION_URL:r.type==r.TYPE_COMPARISON?r.COMPARISON_URL:void 0},this.tagRecording=function(e){r.isHotjarActive&&(window.hj=window.hj||function(){(hj.q=hj.q||[]).push(arguments)},hj("tagRecording",[e]))},this.showPreApproved=function(e,t){e?$("#pre-aproved-message").show().html(t):$("#pre-aproved-message").hide()},this.showOfferMedal=function(e){e?$(".sello").show():$(".sello").hide()},this.paintProgress=function(e,t){if(r.type==r.TYPE_SELFEVALUATION)$(".steps-question.category-1").find(".progress-line").css("width",e+"%"),100==e?$(".steps-question.category-1").addClass("active"):$(".steps-question.category-1").removeClass("active");else for(0<=$.inArray(t,[1,2,3,4,8])?($(".list-question.before-offer").show(),$(".list-question.after-offer").hide()):($(".list-question.before-offer").hide(),$(".list-question.after-offer").show()),i=1;i<=10;i++)i<t?$(".steps-question.category-"+i).find(".progress-line").css("width","100%"):i==t?$(".steps-question.category-"+i).find(".progress-line").css("width",e+"%"):$(".steps-question.category-"+i).find(".progress-line").css("width","0%"),1<i&&(i<=t?$(".steps-question.category-"+(i-1)).addClass("active"):$(".steps-question.category-"+(i-1)).removeClass("active"))},this.generateURlToCurrentQuestionController=function(e){return system.contextPath+"/"+r.getUrlByType()+"/question/"+r.currentQuestion+"/"+e},this.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},this.sendBeaconPushNotification=function(e){if(null==e||-1!==r.pushNotificationsQuestionsToTrigger.indexOf(r.currentQuestion))try{if(OneSignal.sendTag("current_question",r.currentQuestion),"sendBeacon"in navigator){var t=window.location.origin+"/loanapplication/updatePlayerId",n=JSON.stringify({token:r.token,playerId:e});navigator.sendBeacon(t,n)?console.log("sendBeaconPushNotification Beacon sent"):console.error("sendBeaconPushNotification Failed to send beacon")}else console.error("Browser does not support Beacon API")}catch(e){console.error("OneSignal not available / Adblocker On?")}else console.log("sendBeaconPushNotification Not sending beacon")}}