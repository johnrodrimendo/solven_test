<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="templates/companyTemplate">
<head>

    <!--Jquery Validation-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/jquery.validate.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/jquery-validation/dist/additional-methods.min.js'}"></script>

    <!--Drop Zone-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/dropzone/dist/min/dropzone.min.css'}"
          rel="stylesheet"/>

    <!--Ekko Lightbox For Images-->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/ekko-lightbox/dist/ekko-lightbox.min.css'}"
          rel="stylesheet"/>

    <!-- CounterUp -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.waypoints.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/counterup/jquery.counterup.min.js'}"
            type="text/javascript"></script>

    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&amp;subset=all" rel="stylesheet"
          type="text/css"/>


    <!-- Swipebox -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/js/jquery.swipebox.min.js'}"></script>
    <link th:href="${@urlService.externalUrl(#httpServletRequest) + '/swipebox/css/swipebox.min.css'}"
          rel="stylesheet"/>

    <!-- Owl. Carousel -->
    <link rel="stylesheet"
          th:href="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/owl.carousel/owl-carousel/owl.carousel.min.js'}"></script>

    <!-- Flot -->
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.resize.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.categories.min.js'}"
            type="text/javascript"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/flot/jquery.flot.pie.min.js'}"
            type="text/javascript"></script>

    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" th:href="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css'}"/>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js'}"></script>
    <script th:src="${@urlService.externalUrl(#httpServletRequest) + '/bootstrap-datepicker/dist/locales/bootstrap-datepicker.es.min.js'}"></script>

    <link rel="stylesheet" th:href="@{/css/company.css}" />

    <script th:inline="javascript">
        Dropzone.autoDiscover = false;
    </script>

    <script>
        $(document).ready(function () {

            $(".account").click(function () {

                var X = $(this).attr('id');
                if (X == 1) {
                    $(".s-menu").hide();
                    $(this).attr('id', '0');
                } else {
                    $(".s-menu").show();
                    $(this).attr('id', '1');
                }
            });

            $(".s-menu").mouseup(function () {
                return false
            });

            $(".account").mouseup(function () {
                return false
            });

            $(document).mouseup(function () {
                $(".s-menu").hide();
                $(".account").attr('id', '');
            });

            var sizeDocuments = $('.image-box').length;

            switch (sizeDocuments) {
                case 1:
                    $('.image-box').addClass('col-lg-12');
                    break;
                case 2:
                    $('.image-box').addClass('col-lg-6 col-md-6 col-sm-12');
                    break;
                case 3:
                    $('.image-box').addClass('col-lg-4 col-md-4 col-sm-12');
                    break;
                default:
                    $('.image-box').addClass('col-lg-4 col-md-4 col-sm-12');
                    break;
            }

            $('.counter').counterUp({
                delay: 10,
                time: 1000
            });

        });
    </script>
    <script th:inline="javascript"
            th:if="${loanApplication != null and loanApplication?.status?.id == T(com.affirm.common.model.catalog.LoanApplicationStatus).WAITING_APPROVAL}">
        /*<![CDATA[*/
        var uploadedSuccess = false;
        function openUploadUserFileModal(userFileType, loanApplicationId) {
            uploadedSuccess = false;
            var url = /*[[ @{/file/userFile} ]]*/;
            var userId = /*[[ ${loanApplication?.userId} ]]*/;
            $("#uploadUserFile").dropzone({
                url: url,
                params: {
                    userId: userId,
                    loanApplicationId: loanApplicationId,
                    userFileType: userFileType
                },
                paramName: 'file',
                maxFilesize: 2, // MB
                maxFiles: 5,
                dictDefaultMessage: 'Arrastra una imagen aqu&iacute; para subirla, o haz click para seleccionar una.',
                acceptedFiles: 'image/*',
                headers: addCsrfToJsonHeaders({
                    'x-request-sender-type': 'ajax'
                }),
                init: function () {
                    this.on("success", function () {
                        debugger;
                        uploadedSuccess = true;
                        closeUploadUserFileModal();
                    });
                }
            });

            $('#uploadUserFileModal').modal({
                backdrop: 'static',
                keyboard: false
            });
        }

        function closeUploadUserFileModal() {
            $('#uploadUserFileModal').modal('hide');
            Dropzone.forElement("div#uploadUserFile").destroy()
            if (uploadedSuccess) {
                var baseUrl = /*[[ @{/extranet/dashboard/documentation/panel} ]]*/;
                $('#docSection').load(baseUrl + ' #docSection > *', function () {
                    initializeUserFileSection();
                });
            }
        }

        function initializeUserFileSection() {
            debugger;
            $('#docSection').find('.fileImage').click(function () {
                $(this).ekkoLightbox();
            });
        }
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/

        $(document).on('ready', function () {

            /** Edit dueDate **/

            $('#editDueDate, #addDueDate').on('click', function (event) {

                event.preventDefault();

                $('#calendarModal').modal({backdrop: 'static', keyboard: false, show: true});

            });

            var today = new Date();
            var startDate = new Date(today.getFullYear(), today.getMonth(0)+1, -7);
            var lastDate = new Date(today.getFullYear(), today.getMonth(0)+1, 5);

            if ($('#firstDueDate').length > 0) {
                $('#firstDueDate').datepicker({
                    startDate: startDate,
                    endDate: lastDate
                }).on('changeDate', function (ev) {

                });
            }

            $('#dateSelect').on('click', function (event) {
                event.preventDefault();
                if ($('#firstDueDateInput').val()) {
                    $('#dateSelect').loading();
                    defaultAjax({
                        url: /*[[@{/currentPaymentDay}]]*/,
                        type: 'POST',
                        data: {
                            paymentDate: $('#firstDueDateInput').val()
                        },
                        success: function (data) {
                            resetTimer();
                            $('#dateSelect').unloading();
                            $('#calendarModal').modal('hide');
                            window.location.reload();
                        },
                        error: function () {
                            $('#dateSelect').unloading();
                            $('#calendarModal').modal('hide');
                        }
                    });
                }
            });

        });


        /*]]>*/
    </script>
</head>
<body>
<th:block layout:fragment="header">
    <th:block th:replace="fragments/headers :: companyDashboardHeader "></th:block>
    <!-- BEGIN HEADER & CONTENT DIVIDER -->
    <div class="clearfix"></div>
    <!-- END HEADER & CONTENT DIVIDER -->
</th:block>

<th:block layout:fragment="content">

    <!-- Sidebar -->
    <th:block
            th:replace="fragments/extranetSidebarFragments :: extranetCompanySidebar(currentPage='dashboard')"></th:block>
    <!-- / Sidebar -->

    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-green-sharp">
                                    <span data-counter="counterup" th:attr="data-value=${stats.currentMonthCredits}"></span>
                                    <small>/ S/</small>
                                    <small data-counter="counterup" th:attr="data-value=${@utilService.doubleFormat(stats.currentMonthAmount)}">0</small>
                                </h3>
                                <small>Desembolsos del mes</small>
                            </div>
                            <div class="icon">
                                <i class="icon-pie-chart"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-red-haze">
                                    <span data-counter="counterup" th:attr="data-value=${stats.activeCredits}"></span>
                                    <small >/ S/</small>
                                    <small data-counter="counterup" th:attr="data-value=${@utilService.doubleFormat(stats.totalPendinAmount)}">0</small>
                                </h3>
                                <small>Deuda total
                                </small>
                            </div>
                            <div class="icon">
                                <i class="icon-like"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12" th:if="${hasSalaryAdvance != null}">
                    <div class="dashboard-stat2 bordered">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-blue-sharp" th:if="${paymentDay != null and paymentDay.paymentDay != null}">
                                    <span data-counter="counterup" th:attr="data-value=${paymentDay.paymentDay.getDayOfMonth()}"></span>
                                    <small class="font-blue-sharp" th:text="${@utilService.localDateFormat(paymentDay.paymentDay, 'MMMM', #locale)}"></small>
                                    <small><a href="#" id="editDueDate"><i class="fa fa-pencil"></i></a></small>
                                </h3>
                                <h3 th:if="${paymentDay == null || paymentDay.paymentDay == null}">
                                    <a href="#" class="btn blue" id="addDueDate"> Agregar fecha de pago
                                        <i class="fa fa-plus"></i>
                                    </a>
                                </h3>
                                <small>Pr&oacute;ximo pago de sueldos</small>
                            </div>
                            <div class="icon">
                                <i class="icon-calendar"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- / Top summary -->
        </div>
        <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->


    <!-- Modal -->
    <div id="calendarModal" class="modal fade" tabindex='-1'>
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-top">
                    <div class="title-wrap">
                        <h4 class="title-modal">Fecha de pago</h4>
                    </div>
                    <div class="corner-close">
                        <button class="icon icon-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-middle">
                    <form action="#" role="form" autocomplete="off">
                        <div id="calendar-section" class="calendar-container">
                            <div id="firstDueDate">
                                <input type="hidden" id="firstDueDateInput"
                                       class="form-control small-input-number"
                                       placeholder="dd/mm/yyyy" th:value="${@utilService.localDateFormat(paymentDay?.paymentDay, 'dd/MM/yyyy', #locale)}"/>
                            </div>
                            <div id="response-ajax"></div>
                            <div class="actions text-center" style="padding-top: 15px">
                                <button type="button" class="button bg-red" id="dateSelect">
                                    Actualizar
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</th:block>

<th:block layout:fragment="footer">
    <th:block th:replace="fragments/footers :: footerDefault"></th:block>
</th:block>

</body>
</html>